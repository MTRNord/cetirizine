import"../sb-preview/runtime.js";import{r as l,j as o,E as yt,m as N,o as Wt,d as Zt,L as Ae,W as Xt,P as Gt,a as Yt,p as Qt,H as rt,l as es,b as at,c as ts,e as S,f as O,g as He,h as A,T as xt,i as _t,k as bt,n as vt,q as wt,Q as St,C as Ve,s as ze,t as U,u as q,v as $,U as ss,R as ns,w as os,x as rs,y as as,z as Et,A as it,B as is,I as cs,D as ls,S as ms,F as ds,G as us,J as Be,K as ps,M as gs,N as hs,O as fs,V as ys,X as xs,Y as _s,Z as bs,_ as vs,$ as jt,a0 as qe,a1 as We,a2 as Nt,a3 as ws,a4 as Ss,a5 as ct,a6 as Es,a7 as js,a8 as Ns,a9 as ks,aa as Rs,ab as Is,ac as Ds,ad as Cs,ae as Ms,af as Ts,ag as Os,ah as Ls,ai as As,aj as Us,ak as $s}from"./vendor-71e2323d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const kt="light",Rt=(s,e)=>{const{theme:t}=e.globals;return l.useEffect(()=>{document.documentElement.setAttribute("data-mode",t||kt)},[t]),o.jsx(s,{})};Rt.__docgenInfo={description:"",methods:[],displayName:"withTailwindTheme"};const Ps={parameters:{actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},options:{storySort:{order:["Introduction","Fundamentals","*"]}}},globalTypes:{theme:{name:"Theme",description:"Global theme for components",defaultValue:kt,toolbar:{icon:"paintbrush",items:[{value:"light",title:"Light",left:"ðŸŒž"},{value:"dark",title:"Dark",left:"ðŸŒ›"}],dynamicTitle:!0}}},decorators:[Rt]},zs=Object.freeze(Object.defineProperty({__proto__:null,default:Ps},Symbol.toStringTag,{value:"Module"})),I=l.memo(({avatarUrl:s,displayname:e,dm:t=!1,online:n=!1})=>{const[r,a]=l.useState(!1);return s&&!r?o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[o.jsx("img",{className:"rounded-full w-8 h-8 object-cover",alt:e,src:s,onError:()=>{a(!0)}}),t?n?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx(o.Fragment,{})]}):o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[e.replace("@","").replace("!","").replace("#","")[0].toUpperCase(),t?n?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx(o.Fragment,{})]})});I.__docgenInfo={description:"",methods:[],displayName:"Avatar",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the avatar user"}}};const Fs={title:"Chat/Avatar",component:I,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"User ID",description:"The DISPLAY name of the User"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the Avatar is used for a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"}}},J={args:{displayname:"test",dm:!1,online:!1,avatarUrl:""}},K={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1}},W={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1}},Z={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}},X={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1}},G={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0}};J.parameters={...J.parameters,docs:{...J.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: ""
  }
}`,...J.parameters?.docs?.source}}};K.parameters={...K.parameters,docs:{...K.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false
  }
}`,...K.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false
  }
}`,...W.parameters?.docs?.source}}};Z.parameters={...Z.parameters,docs:{...Z.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true
  }
}`,...Z.parameters?.docs?.source}}};X.parameters={...X.parameters,docs:{...X.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false
  }
}`,...X.parameters?.docs?.source}}};G.parameters={...G.parameters,docs:{...G.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true
  }
}`,...G.parameters?.docs?.source}}};const qs=["Fallback","Image","DMOffline","DMOnline","DMNoAvatarOffline","DMNoAvatarOnline"],Hs=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:X,DMNoAvatarOnline:G,DMOffline:W,DMOnline:Z,Fallback:J,Image:K,__namedExportsOrder:qs,default:Fs},Symbol.toStringTag,{value:"Module"}));const Ze=l.memo(({type:s="button",style:e="primary",onClick:t,children:n,readonly:r})=>e==="secondary"?o.jsx("button",{disabled:r,onClick:t,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:s,children:n}):e==="abort"?o.jsx("button",{disabled:r,onClick:t,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:s,children:n}):o.jsx("button",{disabled:r,onClick:t,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:s,children:n}));Ze.__docgenInfo={description:"",methods:[],displayName:"Button",props:{type:{defaultValue:{value:'"button"',computed:!1},required:!1,tsType:{name:"union",raw:'"button" | "submit" | "reset"',elements:[{name:"literal",value:'"button"'},{name:"literal",value:'"submit"'},{name:"literal",value:'"reset"'}]},description:"The button type"},style:{defaultValue:{value:'"primary"',computed:!1},required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "abort"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"abort"'}]},description:"The button style"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The button onClick handler"},children:{required:!0,tsType:{name:"string"},description:"The button Label"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the button is readonly"}}};const Vs={title:"Fundamentals/Buttons/BasicButton",component:Ze,argTypes:{children:{required:!0,name:"Label",description:"The button label"},onClick:{description:"The button onClick handler",required:!0},type:{description:"The button type",control:"select",options:["button","submit","reset"],defaultValue:"button"},style:{description:"The button styling",control:"select",options:["primary","secondary","abort"],defaultValue:"primary"}}},Y={args:{children:"Click me",type:"button",style:"primary"}},Q={args:{children:"Submit",type:"submit",style:"primary"}},ee={args:{children:"Reset",type:"reset",style:"primary"}},te={args:{children:"Click me",type:"button",style:"secondary"}},se={args:{children:"Submit",type:"submit",style:"secondary"}},ne={args:{children:"Reset",type:"reset",style:"secondary"}},oe={args:{children:"Abort",type:"button",style:"abort"}};Y.parameters={...Y.parameters,docs:{...Y.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'primary'
  }
}`,...Y.parameters?.docs?.source}}};Q.parameters={...Q.parameters,docs:{...Q.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'primary'
  }
}`,...Q.parameters?.docs?.source}}};ee.parameters={...ee.parameters,docs:{...ee.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'primary'
  }
}`,...ee.parameters?.docs?.source}}};te.parameters={...te.parameters,docs:{...te.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'secondary'
  }
}`,...te.parameters?.docs?.source}}};se.parameters={...se.parameters,docs:{...se.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'secondary'
  }
}`,...se.parameters?.docs?.source}}};ne.parameters={...ne.parameters,docs:{...ne.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'secondary'
  }
}`,...ne.parameters?.docs?.source}}};oe.parameters={...oe.parameters,docs:{...oe.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Abort',
    type: 'button',
    style: 'abort'
  }
}`,...oe.parameters?.docs?.source}}};const Bs=["Default","Submit","Reset","DefaultSecondary","SubmitSecondary","ResetSecondary","Abort"],Js=Object.freeze(Object.defineProperty({__proto__:null,Abort:oe,Default:Y,DefaultSecondary:te,Reset:ee,ResetSecondary:ne,Submit:Q,SubmitSecondary:se,__namedExportsOrder:Bs,default:Vs},Symbol.toStringTag,{value:"Module"})),Xe=l.memo(({event:s})=>(t=>o.jsxs("p",{className:"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out",children:[t.content.displayname?t.content.displayname:t.state_key," ",t.content.membership==="join"?"joined the room":t.content.membership==="leave"?"left the room":t.content.membership==="ban"?"was banned from the room by "+t.sender:t.content.membership==="invite"?"was invited to the room by "+t.sender:t.content.membership==="knock"?"knocked on the room":"changed their membership status to "+t.content.membership]}))(s));Xe.__docgenInfo={description:"",methods:[],displayName:"MemberEvent"};const Ks={title:"Chat/Events/MembershipEvents",component:Xe},re={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ae={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"leave",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ie={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"invite",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ce={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"knock",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},le={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"ban",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};re.parameters={...re.parameters,docs:{...re.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...re.parameters?.docs?.source}}};ae.parameters={...ae.parameters,docs:{...ae.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "leave",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ae.parameters?.docs?.source}}};ie.parameters={...ie.parameters,docs:{...ie.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "invite",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ie.parameters?.docs?.source}}};ce.parameters={...ce.parameters,docs:{...ce.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "knock",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ce.parameters?.docs?.source}}};le.parameters={...le.parameters,docs:{...le.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "ban",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...le.parameters?.docs?.source}}};const Ws=["JoinEvent","LeaveEvent","InviteEvent","KnockEvent","BanEvent"],Zs=Object.freeze(Object.defineProperty({__proto__:null,BanEvent:le,InviteEvent:ie,JoinEvent:re,KnockEvent:ce,LeaveEvent:ae,__namedExportsOrder:Ws,default:Ks},Symbol.toStringTag,{value:"Module"}));function Xs(s){return s.op==="SYNC"}function Gs(s){return s.op==="INSERT"}function Ys(s){return s.op==="INVALIDATE"}function Qs(s){return s.op==="DELETE"}function en(s){return s.type==="m.room.message"&&s.content.msgtype==="m.text"}function tn(s){return s.type==="m.room.message"&&s.content.msgtype==="m.notice"}function lt(s){return s.type==="m.room.message"&&s.content.msgtype==="m.image"}function mt(s){return s.type==="m.room.message"&&s.content.msgtype==="m.audio"}function dt(s){return s.state_key!==void 0}function sn(s){return s.type==="m.room.create"}function nn(s){return s.type==="m.room.avatar"}function on(s){return s.type==="m.space.child"}function rn(s){return s.type==="m.space.parent"}function an(s){return s.type==="m.room.topic"}class F extends yt{constructor(e,t,n){super(),this.roomID=e,this.hostname=t,this.client=n}events=[];stateEvents=[];name;notification_count=0;notification_highlight_count=0;joined_count=0;invited_count=0;is_dm=!1;windowPos={};addEvents(e){e.forEach(t=>{this.events.push(t)}),this.emit("events",this.events)}addStateEvents(e){e.forEach(t=>{const n=this.stateEvents.findIndex(r=>r.state_key===t.state_key&&r.type===t.type);n!==-1?this.stateEvents[n]=t:this.stateEvents.push(t)}),this.emit("state_events",this.stateEvents)}getStateEvents(){return this.stateEvents}isTombstoned(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.tombstone"&&(e=!0)}),e}getAvatarURL(){let e;return this.stateEvents.forEach(t=>{if(nn(t)){const n=t.content.url;n?.startsWith("mxc://")&&(e=this.client.convertMXC(n))}}),e}isSpace(){let e=!1;return this.stateEvents.forEach(t=>{sn(t)&&(e=t.content.type==="m.space")}),e}setName(e){this.name=e}getName(){return this.name?this.name:this.roomID}getTopic(){let e;return this.stateEvents.forEach(t=>{an(t)&&(e=t.content.topic)}),e}setNotificationCount(e){this.notification_count=e}getNotificationCount(){return this.notification_count}setNotificationHighlightCount(e){this.notification_highlight_count=e}getNotificationHighlightCount(){return this.notification_highlight_count}setJoinedCount(e){this.joined_count=e}getJoinedCount(){return this.joined_count}setInvitedCount(e){this.invited_count=e}getInvitedCount(){return this.invited_count}getSpaceChildrenIDs(){const e=[];return this.stateEvents.forEach(t=>{on(t)&&e.push(t.state_key)}),e}getSpaceParentIDs(){const e=[];return this.stateEvents.forEach(t=>{rn(t)&&e.push({roomID:t.state_key,canonical:t.content.canonical||!1})}),e}setDM(e){this.is_dm=e}isDM(){return this.is_dm}isOnline(){return!1}getEvents(){return this.events}getMemberName(e){let t=e;return this.stateEvents.forEach(n=>{n.type==="m.room.member"&&n.state_key===e&&n.content.membership=="join"&&(t=n.content.displayname)}),t}getMemberAvatar(e){let t;return this.stateEvents.forEach(n=>{if(n.type==="m.room.member"&&n.state_key===e&&n.content.membership=="join"){const r=n.content.avatar_url;r?.startsWith("mxc://")&&(t=this.client.convertMXC(r))}}),t}isEncrypted(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.content.algorithm==="m.megolm.v1.aes-sha2"&&t.state_key===""&&(e=!0)}),e}async sendHtmlMessage(e,t){if(this.isEncrypted()){console.log("Sending encrypted message"),await this.client.getMissingSessions(),await this.client.shareKeysForRoom(this);const n=await this.client.olmMachine?.encryptRoomEvent(new N.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})),r=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:n});if(!r.ok)throw new Error(`Failed to send message: ${r.status} ${r.statusText}`);return(await r.json()).event_id}else{const n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})});if(!n.ok)throw new Error(`Failed to send message: ${n.status} ${n.statusText}`);return(await n.json()).event_id}}async sendTextMessage(e){if(this.isEncrypted()){console.log("Sending encrypted message2"),await this.client.getMissingSessions(),await this.client.shareKeysForRoom(this);const t=await this.client.olmMachine?.encryptRoomEvent(new N.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:e})),n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:t});if(!n.ok)throw new Error(`Failed to send message: ${n.status} ${n.statusText}`);return(await n.json()).event_id}else{const t=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:e})});if(!t.ok)throw new Error(`Failed to send message: ${t.status} ${t.statusText}`);return(await t.json()).event_id}}getJoinedMemberIDs(){const e=[];return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.content.membership==="join"&&e.push(t.state_key)}),e}getEncryptionSettings(){let e;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.state_key===""&&(e||(e=new N.EncryptionSettings),e.algorithm=t.content.algorithm==="m.megolm.v1.aes-sha2"?N.EncryptionAlgorithm.MegolmV1AesSha2:N.EncryptionAlgorithm.OlmV1Curve25519AesSha2,t.content.rotation_period_ms&&(e.rotationPeriod=BigInt(t.content.rotation_period_ms)),t.content.rotation_period_msgs&&(e.rotationPeriodMessages=BigInt(t.content.rotation_period_msgs))),t.type==="m.room.history_visibility"&&t.state_key===""&&(e||(e=new N.EncryptionSettings),e.historyVisibility=t.content.history_visibility)}),e&&(e.onlyAllowTrustedDevices=!1),e}isJoined(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.state_key===this.client.mxid&&(e=t.content.membership==="join")}),e}}function cn(s){const[e,t]=l.useState(s?.getEvents()||[]);return l.useEffect(()=>{if(s){t(s?.getEvents()||[]);const n=r=>{t([...r])};return s.on("events",n),()=>{s.removeListener("events",n)}}else t([])},[s]),e}class ln extends yt{static _instance;access_token;device_id;mxid;hostname;slidingSyncHostname;syncing=!1;roomsInView=[];spacesInView=[];spaceOpen=[];rooms=new Set;syncPos;initialSync=!0;database;profileInfo;lastRanges;lastTxnID;to_device_since;olmMachine;currentRoom;abortController=new AbortController;mustUpdateTxnID=!0;outgoingRequestsBeingProcessed=!1;missingSessionsBeingRequested=!1;get accessToken(){return this.access_token}get isLoggedIn(){return this.access_token!==void 0}convertMXC(e){return`${this.hostname}/_matrix/media/r0/download/${e.substring(6)}`}setCurrentRoom(e){e!==this.currentRoom&&(this.currentRoom=e,console.log("Current room changed to",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}static async Instance(){let e=this._instance;if(!e){e=this._instance=new this,e.database||await e.createDatabase();const t=e.database?.transaction("loginInfo","readonly"),n=await t?.store.getAll();if(await t?.done,n&&n.length>0){e.mxid=n[0].userId,e.hostname=n[0].hostname,e.slidingSyncHostname=n[0].slidingSyncHostname,e.access_token=n[0].access_token,e.device_id=n[0].device_id,e.profileInfo={avatar_url:n[0].avatarUrl,displayname:n[0].displayName},e.mxid&&e.hostname&&e.access_token&&e.device_id&&(e.olmMachine=await N.OlmMachine.initialize(new N.UserId(e.mxid),new N.DeviceId(e.device_id),"cetirizine-crypto"));const r=e.database?.transaction("syncInfo","readonly"),a=await r?.store.get(e.mxid);await r?.done,a&&(e.syncPos=a.syncPos,e.initialSync=a.initialSync,e.lastRanges=a.lastRanges,e.lastTxnID=a.lastTxnID,e.to_device_since=a.to_device_since);const i=e.database?.transaction("rooms","readonly"),c=await i?.store.getAll();await i?.done,c&&(e.rooms=new Set(c.map(g=>{const y=new F(g.roomID,e.hostname,e);return y.windowPos=g.windowPos,y.setInvitedCount(g.invited_count),y.setJoinedCount(g.joined_count),y.setNotificationCount(g.notification_count),y.setNotificationHighlightCount(g.highlight_count),y.setName(g.name),g.events&&y.addEvents(g.events),g.stateEvents&&y.addStateEvents(g.stateEvents),g.isDM&&y.setDM(g.isDM),y})),e.emit("rooms",e.rooms))}}return e}async createDatabase(){this.database=await Wt("matrix",4,{upgrade(e,t){t<1&&(e.objectStoreNames.contains("rooms")&&e.deleteObjectStore("rooms"),e.objectStoreNames.contains("syncInfo")&&e.deleteObjectStore("syncInfo"),e.createObjectStore("rooms",{keyPath:"roomID"}),e.createObjectStore("loginInfo",{keyPath:"userId"}),e.createObjectStore("syncInfo",{keyPath:"userId"}))}})}async setHostname(e){if(!e.startsWith("https://"))throw Error("Hostname must start with 'https://'");this.database||await this.createDatabase();const t=this.database?.transaction("loginInfo","readwrite");await t?.store.put({userId:this.mxid,hostname:e,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,device_id:this.device_id}),await t?.done,this.hostname=e}async startSync(){if(!this.isLoggedIn)throw Error("Not logged in");if(this.database||await this.createDatabase(),!this.syncing)for(this.syncing=!0;this.syncing;)try{await this.sync()}catch(e){console.error(e)}}stopSync(){this.syncing=!1}isIndexInRange(e,t){for(const n of t)if(n[0]<e&&e<=n[1])return!0;return!1}shiftRight(e,t,n,r){for(let a=n-1;a>r-1;a--)if(this.isIndexInRange(a,t)){const i=[...this.rooms].find(c=>c.windowPos[e]===a+1);i&&(i.windowPos[e]=a)}}shiftLeft(e,t,n,r){for(let a=r+1;a<n+1;a++)if(this.isIndexInRange(a,t)){const i=[...this.rooms].find(c=>c.windowPos[e]===a-1);i&&(i.windowPos[e]=a)}}async removeEntry(e,t,n){let r=-1;const a=[...this.rooms].map(i=>i.windowPos[e]);for(const i in a)Number(i)>r&&(r=Number(i));r<0||n>r||this.shiftLeft(e,t,r,n)}addEntry(e,t,n){let r=-1;const a=[...this.rooms].map(i=>i.windowPos[e]);for(const i in a)Number(i)>r&&(r=Number(i));r<0||n>r||this.shiftRight(e,t,r+1,n)}async sendIdentifyAndOneTimeKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.outgoingRequestsBeingProcessed)return;this.outgoingRequestsBeingProcessed=!0;const e=await this.olmMachine.outgoingRequests();for(const t of e)await this.processRequest(t);await this.getMissingSessions(),this.outgoingRequestsBeingProcessed=!1}async shareKeysForRoom(e){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");const t=e.getEncryptionSettings();if(t){const n=await this.olmMachine.shareRoomKey(new N.RoomId(e.roomID),e.getJoinedMemberIDs().map(r=>new N.UserId(r)),t);for(const r of n)await this.processRequest(r)}}async getMissingSessions(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.missingSessionsBeingRequested)return;this.missingSessionsBeingRequested=!0;const t=[...this.rooms].filter(r=>r.isEncrypted()).map(r=>r.getJoinedMemberIDs().map(a=>new N.UserId(a))).flat(),n=await this.olmMachine?.getMissingSessions(t);n&&await this.processRequest(n),this.missingSessionsBeingRequested=!1}async logout(){this.stopSync(),this.abortController.abort(),this.access_token=void 0,this.device_id=void 0,this.initialSync=!0,this.rooms=new Set,this.slidingSyncHostname=void 0,this.syncPos=void 0,this.to_device_since=void 0,this.outgoingRequestsBeingProcessed=!1,this.missingSessionsBeingRequested=!1;const e=this.database?.transaction("syncInfo","readwrite");await e?.store.delete(this.mxid),await e?.done;const t=this.database?.transaction("loginInfo","readwrite");await t?.store.delete(this.mxid),await t?.done;const n=this.database?.transaction("rooms","readwrite");await n?.store.clear(),await n?.done,await Zt("cetirizine-crypto"),this.mxid=void 0}async processRequest(e){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(e.type===N.RequestType.KeysUpload){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to upload keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===N.RequestType.KeysQuery){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to query keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===N.RequestType.KeysClaim){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to claim keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===N.RequestType.ToDevice){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/sendToDevice/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to send to device",n);return}this.olmMachine.markRequestAsSent(t.id??t.txn_id,t.type,await n.text())}else if(e.type===N.RequestType.SignatureUpload){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/signatures/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to upload signatures",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===N.RequestType.RoomMessage){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${t.room_id}/send/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to send message",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===N.RequestType.KeysBackup){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/room_keys/keys`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to backup keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}}async sync(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");await this.sendIdentifyAndOneTimeKeys();let e={overview:[[0,20]],spaces:[[0,20]]};for(const m of this.spaceOpen)m!=="other"&&(e[m]=[[0,20]]);let t=1,n=10;if(!this.initialSync){for(const m in e){t=10,n=50;let v=new Set([...this.rooms].filter(d=>this.roomsInView.includes(d.roomID)).map(d=>d.windowPos[m]).sort().filter(d=>d!=null));if(this.getSpaces().find(d=>d.roomID===m)&&(v=new Set([...this.rooms].filter(d=>this.spacesInView.includes(d.roomID)).map(d=>d.windowPos[m]).sort().filter(d=>d!=null))),v.size!==0){const d=Math.min(...v),u=Math.max(...v);e[m]=[[Math.max(d-10,0),u+10]]}}e.e2ee=e.overview}this.lastRanges&&Object.entries(e).toString()!==Object.entries(this.lastRanges).toString()&&(console.log("Ranges changed, resetting sync txn_id",e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.lastRanges||(this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.mustUpdateTxnID&&(this.lastTxnID=Date.now().toString(),this.mustUpdateTxnID=!1);let r=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000`;this.syncPos&&(r=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000&pos=${this.syncPos}`);const a={txn_id:this.lastTxnID,lists:{spaces:{ranges:this.lastRanges.spaces,sort:["by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:0,filters:{room_types:["m.space"]}},overview:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"]}},e2ee:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","*"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"],is_encrypted:!0}}},bump_event_types:["m.room.message","m.room.encrypted"],extensions:{e2ee:{enabled:!0},to_device:{enabled:!0,since:this.to_device_since}}};for(const m of this.spaceOpen)m!=="other"&&(a.lists||(a.lists={}),a.lists[m]={slow_get_all_rooms:!0,ranges:this.lastRanges[m],sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{spaces:[m]}});this.currentRoom&&(a.room_subscriptions={},a.room_subscriptions[this.currentRoom]={sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:n,filters:{}});const i=await fetch(r,{method:"POST",signal:this.abortController.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:JSON.stringify(a)});if(!i.ok)if(i.status===400){if((await i.json()).errcode==="M_UNKNOWN_POS"){this.syncPos=void 0;const m=this.database?.transaction("syncInfo","readwrite");await m?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID}),await m?.done}return}else i.status===401&&(await this.logout(),console.error(i),console.error("Error syncing. See console for error."));const c=await i.json();this.syncPos=c.pos,c.extensions?.to_device&&(await this.olmMachine?.receiveSyncChanges(JSON.stringify(c.extensions.to_device.events||[]),new N.DeviceLists(c.extensions.e2ee?.device_lists?.changed?.map(m=>new N.UserId(m)),c.extensions.e2ee?.device_lists?.left?.map(m=>new N.UserId(m))),new Map(Object.entries(c.extensions.e2ee?.device_one_time_keys_count||[])),new Set(c.extensions.e2ee?.device_unused_fallback_key_types)),this.to_device_since=c.extensions.to_device.next_batch),await this.sendIdentifyAndOneTimeKeys();const g=this.database?.transaction("syncInfo","readwrite");await g?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID,to_device_since:this.to_device_since}),await g?.done;let y=-1;for(const m in c.lists){const v=c.lists[m];if(v.ops){for(const d of v.ops)if(Xs(d)){const u=this.database?.transaction("rooms","readwrite");for(let p=d.range[0];p<=d.range[1];p++){const f=d.room_ids[p-d.range[0]];if(!f)break;const x=[...this.rooms].find(b=>b.roomID===f);if(x){x.windowPos[m]=p;continue}const h=new F(f,this.hostname,this);h.setName(f),h.windowPos[m]=p,this.rooms.add(h),await u?.store.put({windowPos:h.windowPos,roomID:h.roomID,name:h.getName(),notification_count:h.getNotificationCount(),highlight_count:h.getNotificationHighlightCount(),joined_count:h.getJoinedCount(),invited_count:h.getInvitedCount(),avatarUrl:h.getAvatarURL(),isSpace:h.isSpace(),isDM:h.isDM(),stateEvents:h.getStateEvents(),events:h.getEvents()})}await u?.done}else if(Gs(d)){console.log("Got INSERT OP",d),[...this.rooms].find(b=>b.windowPos[m]===d.index)&&(y<0?this.addEntry(m,this.lastRanges[m],d.index):y>d.index?this.shiftRight(m,this.lastRanges[m],y,d.index):y<d.index&&this.shiftLeft(m,this.lastRanges[m],d.index,y)),y=-1;const p=this.database?.transaction("rooms","readwrite"),f=[...this.rooms].find(b=>b.roomID===d.room_id);if(f)f.windowPos[m]=d.index,await p?.store.put({windowPos:f.windowPos,roomID:f.roomID,name:f.getName(),notification_count:f.getNotificationCount(),highlight_count:f.getNotificationHighlightCount(),joined_count:f.getJoinedCount(),invited_count:f.getInvitedCount(),avatarUrl:f.getAvatarURL(),isSpace:f.isSpace(),isDM:f.isDM(),stateEvents:f.getStateEvents(),events:f.getEvents()});else{const b=await p?.store.get(d.room_id);let _=new F(d.room_id,this.hostname,this);_.setName(d.room_id),_.windowPos[m]=d.index,b&&(console.warn("Room in db but not in obj list.",d.room_id,"Updating obj list."),_=new F(d.room_id,this.hostname,this),_.setName(b.name),_.setNotificationCount(b.notification_count),_.setNotificationHighlightCount(b.highlight_count),_.setJoinedCount(b.joined_count),_.setInvitedCount(b.invited_count),_.setDM(b.isDM||!1)),this.rooms.add(_),await p?.store.put({windowPos:_.windowPos,roomID:_.roomID,name:_.getName(),notification_count:_.getNotificationCount(),highlight_count:_.getNotificationHighlightCount(),joined_count:_.getJoinedCount(),invited_count:_.getInvitedCount(),avatarUrl:_.getAvatarURL(),isSpace:_.isSpace(),isDM:_.isDM(),stateEvents:_.getStateEvents(),events:_.getEvents()})}const x=[...this.rooms].map(b=>b.roomID),h=x.filter((b,_)=>x.indexOf(b)!=_);h.length>0&&console.error("Duplicates found",h),await p?.done}else Qs(d)?(console.log("Got DELETE OP",d),y!==-1&&await this.removeEntry(m,this.lastRanges[m],y),y=d.index):Ys(d);y!==-1&&await this.removeEntry(m,this.lastRanges[m],y)}}for(const m in c.rooms){const v=c.rooms[m],d=v.name,u=v.notification_count,p=v.highlight_count,f=v.joined_count,x=v.invited_count,h=v.timeline,b=h?.filter(E=>dt(E)).map(E=>E),_=h?.filter(E=>!dt(E)).map(E=>E),j=v.required_state,T=v.is_dm;let w=[...this.rooms].find(E=>E.roomID===m);if(!w){console.warn("Could not find roomObj for roomID:",m);const E=this.database?.transaction("rooms","readwrite"),R=await E?.store.get(m);await E?.done,R?(console.warn("Room in db but not in obj list.",m,"Updating obj list."),w=new F(m,this.hostname,this),w.setName(R.name),w.setNotificationCount(R.notification_count),w.setNotificationHighlightCount(R.highlight_count),w.setJoinedCount(R.joined_count),w.setInvitedCount(R.invited_count),w.setDM(R.isDM||!1),R.events&&w.addEvents(R.events),R.stateEvents&&w.addStateEvents(R.stateEvents),w.windowPos=R.windowPos):(console.warn("Could not find room in db. Creating new one."),w=new F(m,this.hostname,this),this.rooms.add(w))}if(d&&w.setName(d),w.setNotificationCount(u),w.setNotificationHighlightCount(p),w.setJoinedCount(f),w.setInvitedCount(x),_&&w.addEvents(_),j&&w.addStateEvents(j),b&&w.addStateEvents(b),(j||b)&&w.isEncrypted()&&w.isJoined()){const R=[...j||[],...b||[]].filter(z=>z.type==="m.room.member"&&z.content.membership==="join").map(z=>new N.UserId(z.state_key));await this.olmMachine?.updateTrackedUsers(R)}T&&w.setDM(T);const C=this.database?.transaction("rooms","readwrite");await C?.store.put({windowPos:w.windowPos,roomID:w.roomID,name:w.getName(),notification_count:w.getNotificationCount(),highlight_count:w.getNotificationHighlightCount(),joined_count:w.getJoinedCount(),invited_count:w.getInvitedCount(),events:w.getEvents(),stateEvents:w.getStateEvents(),avatarUrl:w.getAvatarURL(),isSpace:w.isSpace(),isDM:w.isDM()}),await C?.done}this.initialSync&&(this.initialSync=!1,console.log("initialSyncComplete")),c.rooms&&Object.keys(c.rooms).length>0&&this.emit("rooms",this.rooms)}addInViewRoom(e){this.roomsInView.push(e)}removeInViewRoom(e){this.roomsInView=this.roomsInView.filter(t=>t!==e)}addInViewSpace(e){this.spacesInView.push(e)}removeInViewSpace(e){this.spacesInView=this.spacesInView.filter(t=>t!==e)}addSpaceOpen(e){e!=="other"&&(this.spaceOpen.push(e),console.log("Space opened",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}removeSpaceOpen(e){e!=="other"&&(this.spaceOpen=this.spaceOpen.filter(t=>t!==e),this.mustUpdateTxnID=!0)}getRooms(){return this.rooms}getSpaces(){return[...this.rooms].filter(e=>e.isSpace()&&!e.isTombstoned()).sort((e,t)=>e.getName()<t.getName()?-1:e.getName()>t.getName()?1:0)}getSpacesWithRooms(){const e=this.getSpaces(),t=new Set;for(const n of e){const r=n.getSpaceChildrenIDs(),a=new Set([...this.getRooms()].filter(i=>r.includes(i.roomID)));t.add({spaceRoom:n,children:a})}for(const n of this.getRooms()){if(n.isSpace()||n.isTombstoned())continue;const r=n.getSpaceParentIDs();for(const a of r){const i=[...this.getRooms()].find(g=>g.roomID===a.roomID);if(!i)continue;const c=[...t].find(g=>g.spaceRoom.roomID===i.roomID);if(c){[...c.children].find(g=>g.roomID===n.roomID)||c.children.add(n);continue}t.add({spaceRoom:i,children:new Set([n])})}}return t}async getLoginFlows(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/login`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async getWellKnown(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/.well-known/matrix/client`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async passwordLogin(e,t,n=5){if(this.database||await this.createDatabase(),!e)throw Error("Username must be set");if(!t)throw Error("Password must be set");this.mxid=e,await this.setHostname(`https://${e.split(":")[1]}`);try{const c=await this.getWellKnown();if(c["m.homeserver"]?.base_url&&await this.setHostname(c["m.homeserver"].base_url),c["org.matrix.msc3575.proxy"]?.url){const g=this.database?.transaction("loginInfo","readwrite");await g?.store.put({userId:this.mxid,hostname:this.hostname,slidingSyncHostname:c["org.matrix.msc3575.proxy"].url,access_token:this.access_token,device_id:this.device_id}),await g?.done,this.slidingSyncHostname=c["org.matrix.msc3575.proxy"].url}else throw Error("No sliding sync proxy found")}catch(c){console.warn(`No well-known found for ${this.hostname}:
${c}`)}if(((await this.getLoginFlows()).flows.filter(c=>c.type==="m.login.password")?.length||0)==0)throw Error("Password login is not supported by this homeserver");const a=await fetch(`${this.hostname}/_matrix/client/r0/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"m.login.password",identifier:{type:"m.id.user",user:e},user:e,password:t})});if(!a.ok)throw console.error(a),Error("Error logging in. See console for error.");const i=await a.json();if(un(i))throw Error(`Error logging in: ${i.errcode}: ${i.error}`);if(mn(i)&&(console.error(`Rate limited. Retrying in ${i.retry_after_ms}ms. ${n} tries left.`),await this.passwordLogin(e,t,n-1)),dn(i)){const c=this.database?.transaction("loginInfo","readwrite");await c?.store.put({userId:i.user_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:i.access_token,device_id:i.device_id}),await c?.done,this.access_token=i.access_token,this.device_id=i.device_id,this.mxid=i.user_id,this.olmMachine=await N.OlmMachine.initialize(new N.UserId(this.mxid),new N.DeviceId(this.device_id),"cetirizine-crypto")}}async fetchProfileInfo(e){if(this.profileInfo)return this.profileInfo;if(!this.hostname)throw Error("Hostname must be set first");if(this.database||await this.createDatabase(),!this.access_token)throw Error("Access token must be set first");const t=await fetch(`${this.hostname}/_matrix/client/r0/profile/${e}`,{headers:{Authorization:`Bearer ${this.access_token}`}});if(!t.ok){if(t.status===404||t.status===403)return{};throw console.error(t),Error("Error fetching profile info. See console for error.")}const n=await t.json();n.avatar_url=n.avatar_url?.replace("mxc://",`${this.hostname}/_matrix/media/r0/download/`),this.profileInfo=n;const r=this.database?.transaction("loginInfo","readwrite");return await r?.store.put({userId:this.mxid,device_id:this.device_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,displayName:n.displayname,avatarUrl:n.avatar_url}),await r?.done,n}}function mn(s){return s.retry_after_ms!==void 0}function dn(s){return s.access_token!==void 0}function un(s){return s.errcode!==void 0}const It=await ln.Instance(),M=l.createContext(It);function pn(){const s=l.useContext(M),[e,t]=l.useState(s.getRooms());return l.useEffect(()=>{const n=r=>{t(r)};return s.on("rooms",n),s.startSync(),()=>{s.removeListener("rooms",n)}},[]),e}function P(s){return[...l.useContext(M).getRooms()].find(t=>t.roomID===s)}function gn(){const s=l.useContext(M),[e,t]=l.useState(s.getSpacesWithRooms());return l.useEffect(()=>{const n=r=>{t(s.getSpacesWithRooms())};return s.on("rooms",n),s.startSync(),()=>{s.removeListener("rooms",n)}},[]),e}function hn(){const s=l.useContext(M),[e,t]=l.useState({displayname:s.mxid||"Unknown"});return l.useEffect(()=>{s.fetchProfileInfo(s.mxid).then(n=>{n.displayname||(n.displayname=s.mxid||"Unknown"),t(n)})},[]),e}const Dt={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},Ge=l.memo(({event:s,roomID:e,hasPreviousEvent:t})=>{const n=P(e);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:n?.getMemberName(s.sender)||s.sender,avatarUrl:n?.getMemberAvatar(s.sender),online:n?.isOnline()||!1,dm:n?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:n?.getMemberName(s.sender)||s.sender}),o.jsx(Ae,{options:Dt,as:"p",className:"whitespace-break-spaces text-black text-base font-normal",children:JSON.stringify(s,null,4)})]})]})}),H=l.memo(({event:s,roomID:e,hasPreviousEvent:t})=>{const n=P(e);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:n?.getMemberName(s.sender)||s.sender,avatarUrl:n?.getMemberAvatar(s.sender),online:n?.isOnline()||!1,dm:n?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:n?.getMemberName(s.sender)||s.sender}),o.jsx(Ae,{options:Dt,as:"p",className:"whitespace-pre-wrap text-base font-normal text-orange-600",children:"Unable to decrypt event"})]})]})}),Oe=l.memo(({event:s,redacted_because:e,roomID:t,hasPreviousEvent:n})=>{const r=P(t);return o.jsxs("div",{className:n?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!n&&o.jsx(I,{displayname:r?.getMemberName(s.sender)||s.sender,avatarUrl:r?.getMemberAvatar(s.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),o.jsxs("div",{className:n?"ml-[3.7rem]":"flex flex-col gap-1",children:[!n&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(s.sender)||s.sender}),e&&o.jsxs("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:["Message was redacted: ",e]}),!e&&o.jsx("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:"Message was redacted"})]})]})});Ge.__docgenInfo={description:"",methods:[],displayName:"UnknownEvent"};H.__docgenInfo={description:"",methods:[],displayName:"UndecryptableEvent"};Oe.__docgenInfo={description:"",methods:[],displayName:"RedactedEvent"};const Ct=l.memo(({src_url:s})=>{const[e,t]=l.useState(!1),[n,r]=l.useState(0),[a,i]=l.useState(void 0),c=l.useRef(null);l.useEffect(()=>{c.current&&(c.current.children.length>0&&a&&i(y=>{if(y?.destroy(),c.current)for(const m of c.current.children)m.remove()}),c.current.children.length===0&&i(Xt.create({barWidth:5,cursorWidth:1,container:c.current,backend:"WebAudio",height:45,progressColor:"#f59e0b",responsive:!0,waveColor:"#cbd5e1",cursorColor:"transparent",barRadius:5,hideScrollbar:!0,normalize:!0})))},[]),l.useEffect(()=>{a&&(a.load(s),a.on("ready",()=>{r(a.getDuration())}))},[a]);const g=()=>{a&&(t(y=>!y),a.playPause())};return o.jsxs("div",{className:"flex w-[min-content] flex-row h-full items-start justify-start gap-3 bg-slate-200 rounded border-2 border-slate-500 p-1",children:[o.jsx("button",{className:"text-center flex justify-center items-center w-12 h-12 min-w-12 min-h-12 rounded-full outline-none cursor-pointer pb-1 bg-orange-500 border-orange-600 border hover:bg-orange-600 group",onClick:g,children:e?o.jsx(Yt,{size:24,className:"stroke-slate-700 group-hover:stroke-slate-600"}):o.jsx(Gt,{viewBox:"0 0 21 24",className:"stroke-slate-50 group-hover:stroke-slate-100"})}),o.jsxs("div",{className:"flex flex-col w-96 gap-2 justify-between",children:[o.jsx("div",{className:"w-full h-12",id:"waveform",ref:c}),o.jsx("span",{className:"w-full text-sm font-medium text-slate-600 text-right",children:fn(n)})]})]})});function fn(s){if(!s)return"00:00";const e=Math.floor(s/3600),t=Math.floor(s%3600/60),n=Math.floor(s%3600%60);return e===0&&t===0&&n===0?"00:00":e===0&&t===0?`00:${n.toString().padStart(2,"0")}`:e===0?`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${e}:${t}:${n}`}Ct.__docgenInfo={description:"",methods:[],displayName:"Waveform"};const Je={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},Ye=l.memo(({event:s,roomID:e,hasPreviousEvent:t,reactions:n})=>{const r=l.useContext(M),a=P(e);return(c=>{if(en(c))return o.jsx(ut,{event:c,roomID:e,hasPreviousEvent:t,reactions:n});if(tn(c))return o.jsx(ut,{event:c,roomID:e,hasPreviousEvent:t,reactions:n,message_type:1});if(lt(c)){const[g,y]=l.useState(void 0),[m,v]=l.useState(c.content.file!==void 0),d=u=>{console.log("Downloading image:",u.event_id),fetch(r.convertMXC(u.content.file.url),{headers:{Authorization:`Bearer ${r.accessToken}`}}).then(p=>{if(!p.ok){console.log("Unable to decrypt image:",p.text());return}console.log("Downloaded image:",u.event_id),p.arrayBuffer().then(f=>{at.decryptAttachment(f,u.content.file).then(x=>{let h=u.content.info?.mimetype?u.content.info.mimetype.split(";")[0].trim():"";h=pt(h);const b=new Blob([x],{type:h});y(URL.createObjectURL(b)),v(!1),console.log("Decrypted image:",u.event_id)}).catch(x=>{console.log("Unable to decrypt image due to decryption error:",x),v(!0)})})})};return l.useEffect(()=>{lt(c)&&(c.content.url?y(r.convertMXC(c.content.url)):c.content.file&&d(c))},[c]),m?o.jsx(H,{event:c,roomID:e,hasPreviousEvent:t}):o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:a?.getMemberName(c.sender)||c.sender,avatarUrl:a?.getMemberAvatar(c.sender),online:a?.isOnline()||!1,dm:a?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:a?.getMemberName(c.sender)||c.sender}),o.jsx("img",{src:g,alt:c.content.body,title:c.content.body,className:"rounded-md object-cover border-slate-400 border-2 max-h-[23.333rem] max-w-[23.333rem] h-[unset]"})]})]})}else if(mt(c)){const[g,y]=l.useState(void 0),[m,v]=l.useState(c.content.file!==void 0),d=u=>{console.log("Downloading audio file:",u.event_id),fetch(r.convertMXC(u.content.file.url),{headers:{Authorization:`Bearer ${r.accessToken}`}}).then(p=>{if(!p.ok){console.log("Unable to decrypt audio file:",p.text());return}console.log("Downloaded audio file:",u.event_id),p.arrayBuffer().then(f=>{at.decryptAttachment(f,u.content.file).then(x=>{let h=u.content.info?.mimetype?u.content.info.mimetype.split(";")[0].trim():"";h=pt(h);const b=new Blob([x],{type:h});y(URL.createObjectURL(b)),v(!1),console.log("Decrypted audio file:",u.event_id)}).catch(x=>{console.log("Unable to decrypt audio file due to decryption error:",x),v(!0)})})})};return l.useEffect(()=>{mt(c)&&(c.content.url?y(r.convertMXC(c.content.url)):c.content.file&&d(c))},[c]),m?o.jsx(H,{event:c,roomID:e,hasPreviousEvent:t}):o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:a?.getMemberName(c.sender)||c.sender,avatarUrl:a?.getMemberAvatar(c.sender),online:a?.isOnline()||!1,dm:a?.isDM()||!1}),o.jsxs("div",{className:t?"flex-1 ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:a?.getMemberName(c.sender)||c.sender}),g&&o.jsx(Ct,{src_url:g})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:a?.getMemberName(c.sender)||c.sender,avatarUrl:a?.getMemberAvatar(c.sender),online:a?.isOnline()||!1,dm:a?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:a?.getMemberName(c.sender)||c.sender}),o.jsx(Ae,{options:Je,as:"p",className:"whitespace-pre-wrap text-black text-base font-normal",children:c.content.body})]})]})})(s)}),ut=l.memo(({event:s,roomID:e,hasPreviousEvent:t,message_type:n=0})=>{const r=P(e);let a="text-black";if(n===1&&(a="text-slate-500"),s.content.format==="org.matrix.custom.html"){let i=Qt.sanitize(s.content.formatted_body,{ADD_TAGS:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","caption","pre","span","img","details","summary"]});const g=/<pre><code (?:class="language-(?<language>.*?)")?.*?>(?<code>[\s\S]*?)<\/code><\/pre>/.exec(i);if(g?.groups?.code)if(g.groups?.language){const m=rt.highlight(g.groups?.code,{language:g.groups?.language}).value;i=i.replace(g.groups?.code,`${m}`)}else{const m=rt.highlightAuto(g.groups?.code).value;i=i.replace(g[0],`${m}`)}const y=es(i,Je);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:r?.getMemberName(s.sender)||s.sender,avatarUrl:r?.getMemberAvatar(s.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(s.sender)||s.sender}),o.jsx("p",{className:`whitespace-pre-wrap ${a} text-base font-normal`,dangerouslySetInnerHTML:{__html:y}})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(I,{displayname:r?.getMemberName(s.sender)||s.sender,avatarUrl:r?.getMemberAvatar(s.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(s.sender)||s.sender}),o.jsx(Ae,{options:Je,as:"p",className:`whitespace-pre-wrap ${a} text-base font-normal`,children:s.content.body})]})]})}),yn=["image/jpeg","image/gif","image/png","image/apng","image/webp","image/avif","video/mp4","video/webm","video/ogg","video/quicktime","audio/mp4","audio/webm","audio/aac","audio/mpeg","audio/ogg","audio/wave","audio/wav","audio/x-wav","audio/x-pn-wav","audio/flac","audio/x-flac"];function pt(s){return yn.includes(s)?s:"application/octet-stream"}Ye.__docgenInfo={description:"",methods:[],displayName:"MessageEvent"};const xn={title:"Chat/Events/MessageEvents",component:Ye},me={args:{event:{content:{body:"._.",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},de={args:{event:{content:{body:"I think it's mostly a matter of doing the right `padding-block` in `.content`",format:"org.matrix.custom.html",formatted_body:"I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};It.hostname="https://matrix.org";const ue={args:{event:{content:{body:"image.png",info:{h:680,mimetype:"image/png",size:252133,thumbnail_info:{h:600,mimetype:"image/png",size:223185,w:600},thumbnail_url:"mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",w:680,"xyz.amorgan.blurhash":"UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"},msgtype:"m.image",url:"mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},pe={args:{event:{content:{body:"mixaund-bright-future.mp3",info:{mimetype:"audio/mpeg",size:9329941},msgtype:"m.audio",url:"mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};me.parameters={...me.parameters,docs:{...me.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "._.",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...me.parameters?.docs?.source}}};de.parameters={...de.parameters,docs:{...de.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "I think it's mostly a matter of doing the right \`padding-block\` in \`.content\`",
        format: "org.matrix.custom.html",
        formatted_body: "I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...de.parameters?.docs?.source}}};ue.parameters={...ue.parameters,docs:{...ue.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "image.png",
        info: {
          h: 680,
          mimetype: "image/png",
          size: 252133,
          thumbnail_info: {
            h: 600,
            mimetype: "image/png",
            size: 223185,
            w: 600
          },
          thumbnail_url: "mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",
          w: 680,
          "xyz.amorgan.blurhash": "UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"
        },
        msgtype: "m.image",
        url: "mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...ue.parameters?.docs?.source}}};pe.parameters={...pe.parameters,docs:{...pe.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "mixaund-bright-future.mp3",
        info: {
          mimetype: "audio/mpeg",
          size: 9329941
        },
        msgtype: "m.audio",
        url: "mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...pe.parameters?.docs?.source}}};const _n=["TextEvent","FormattedEvent","ImageEvent","AudioEvent"],bn=Object.freeze(Object.defineProperty({__proto__:null,AudioEvent:pe,FormattedEvent:de,ImageEvent:ue,TextEvent:me,__namedExportsOrder:_n,default:xn},Symbol.toStringTag,{value:"Module"})),vn={title:"Chat/Events/RedactedEvent",component:Oe},ge={name:"Redacted Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},he={name:"Redacted Event with Reason",args:{redacted_because:"Because I can",event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};ge.parameters={...ge.parameters,docs:{...ge.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ge.parameters?.docs?.source}}};he.parameters={...he.parameters,docs:{...he.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event with Reason",
  args: {
    redacted_because: "Because I can",
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...he.parameters?.docs?.source}}};const wn=["RedactedEventEvent","RedactedEventReasonEvent"],Sn=Object.freeze(Object.defineProperty({__proto__:null,RedactedEventEvent:ge,RedactedEventReasonEvent:he,__namedExportsOrder:wn,default:vn},Symbol.toStringTag,{value:"Module"})),En={title:"Chat/Events/UndecryptableEvent",component:H},fe={name:"Undecryptable Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};fe.parameters={...fe.parameters,docs:{...fe.parameters?.docs,source:{originalSource:`{
  name: "Undecryptable Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...fe.parameters?.docs?.source}}};const jn=["UndecryptableEventEvent"],Nn=Object.freeze(Object.defineProperty({__proto__:null,UndecryptableEventEvent:fe,__namedExportsOrder:jn,default:En},Symbol.toStringTag,{value:"Module"})),kn={title:"Chat/Events/UnknownEvent",component:Ge},ye={name:"Unknown Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};ye.parameters={...ye.parameters,docs:{...ye.parameters?.docs,source:{originalSource:`{
  name: "Unknown Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ye.parameters?.docs?.source}}};const Rn=["UnknownEventEvent"],In=Object.freeze(Object.defineProperty({__proto__:null,UnknownEventEvent:ye,__namedExportsOrder:Rn,default:kn},Symbol.toStringTag,{value:"Module"})),Qe=l.memo(({children:s})=>o.jsx("h1",{className:"text-black font-bold text-xl",children:s}));Qe.__docgenInfo={description:"",methods:[],displayName:"Header",props:{children:{required:!0,tsType:{name:"string"},description:"The HeaderText"}}};const Dn={title:"Fundamentals/Typography/Header",component:Qe,argTypes:{children:{required:!0,name:"Content",description:"The Headertext"}}},xe={args:{children:"Header"}};xe.parameters={...xe.parameters,docs:{...xe.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Header'
  }
}`,...xe.parameters?.docs?.source}}};const Cn=["Default"],Mn=Object.freeze(Object.defineProperty({__proto__:null,Default:xe,__namedExportsOrder:Cn,default:Dn},Symbol.toStringTag,{value:"Module"})),Pe=l.memo(({placeholder:s,password:e=!1,autoFocus:t=!1,value:n,readonly:r,onChange:a})=>o.jsx("input",{disabled:r,className:"text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:n,type:e?"password":"text",autoFocus:t,placeholder:s,onChange:a}));Pe.__docgenInfo={description:"",methods:[],displayName:"Input",props:{password:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If it is a password input"},autoFocus:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If input should be autofocused"},placeholder:{required:!0,tsType:{name:"string"},description:"The Placeholder text"},value:{required:!0,tsType:{name:"string"},description:"The value of the input field"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the input is readonly"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{name:"e",type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"}}],return:{name:"void"}}},description:"Handler for the onChange event"}}};const Tn={title:"Fundamentals/Inputs/BasicInput",component:Pe,argTypes:{placeholder:{required:!0,name:"Placeholder",description:"The Placeholder for the input field. Shown if it is empty."},password:{required:!1,name:"Password",control:"boolean",defaultValue:!1,description:"If the input field takes a password."},autoFocus:{required:!1,name:"Auto Focus",control:"boolean",defaultValue:!1,description:"If the field should be focused automatically."},value:{required:!0,name:"Value",description:"The current value of the input."},onChange:{description:"The onChange handler of the input field.",required:!0}}},_e={args:{placeholder:"Placeholder",password:!1,autoFocus:!1}};_e.parameters={..._e.parameters,docs:{..._e.parameters?.docs,source:{originalSource:`{
  args: {
    placeholder: "Placeholder",
    password: false,
    autoFocus: false
  }
}`,..._e.parameters?.docs?.source}}};const On=["Default"],Ln=Object.freeze(Object.defineProperty({__proto__:null,Default:_e,__namedExportsOrder:On,default:Tn},Symbol.toStringTag,{value:"Module"})),An=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,Un=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,$n=[s=>{const e=An.exec(s);return e&&{index:e.index,length:e[0].length,text:e[0],url:e[0]}},s=>{const e=Un.exec(s);return e&&{index:e.index,length:e[0].length,text:e[0],url:`mailto:${e[0]}`}}];function Mt(){return o.jsx(ts.AutoLinkPlugin,{matchers:$n})}Mt.__docgenInfo={description:"",methods:[],displayName:"PlaygroundAutoLinkPlugin"};class V extends S.ParagraphNode{static getType(){return"custom-paragraph"}static clone(e){return new V(e.__key)}exportDOM(e){const{element:t}=super.exportDOM(e);if(this.isEmpty()){const n=S.$getRoot();let r=!1;for(const a of n.getChildren())a!==this&&(a instanceof V||a instanceof S.ParagraphNode)&&(a.isEmpty()||(r=!0));if(!r)return{element:null}}return{element:t}}exportJSON(){const e=super.exportJSON();return e.type="custom-paragraph",e}static importJSON(e){return super.importJSON(e)}}function Pn(){return S.$applyNodeReplacement(new V)}const $e=1,zn=new Set(["custom-paragraph","quote","code","h1","h2","ul","ol"]),Fn={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List","custom-paragraph":"Normal",quote:"Quote",ul:"Bulleted List"},gt=l.memo(()=>o.jsx("div",{className:"divider"}));function ht(s,e){e?(s.style.opacity="1",s.style.top=`${e.top+e.height+window.pageYOffset+10}px`,s.style.left=`${e.left+window.pageXOffset-s.offsetWidth/2+e.width/2}px`):(s.style.opacity="0",s.style.top="-1000px",s.style.left="-1000px")}const qn=l.memo(({editor:s})=>{const e=l.useRef(null),t=l.useRef(null),n=l.useRef(!1),[r,a]=l.useState(""),[i,c]=l.useState(!1),[g,y]=l.useState(null),m=l.useCallback(()=>{const d=S.$getSelection();if(S.$isRangeSelection(d)){const h=Tt(d),b=h.getParent();O.$isLinkNode(b)?a(b.getURL()):O.$isLinkNode(h)?a(h.getURL()):a("")}const u=e.current,p=window.getSelection(),f=document.activeElement;if(u===null)return;const x=s.getRootElement();if(d!==null&&!p?.isCollapsed&&x!==null&&x.contains(p?.anchorNode)){const h=p?.getRangeAt(0);let b;if(p?.anchorNode===x){let _=x;for(;_.firstElementChild!=null;)_=_.firstElementChild;b=_.getBoundingClientRect()}else b=h?.getBoundingClientRect();n.current||ht(u,b),y(d)}else(!f||f.className!=="link-input")&&(ht(u,void 0),y(null),c(!1),a(""));return!0},[s]);l.useEffect(()=>He.mergeRegister(s.registerUpdateListener(({editorState:d})=>{d.read(()=>{m()})}),s.registerCommand(S.SELECTION_CHANGE_COMMAND,()=>(m(),!0),$e)),[s,m]),l.useEffect(()=>{s.getEditorState().read(()=>{m()})},[s,m]),l.useEffect(()=>{i&&t.current&&t.current.focus()},[i]);const v=l.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},r);return o.jsx("div",{ref:e,className:"link-editor",children:i?o.jsx("input",{ref:t,className:"link-input",value:r,onChange:d=>{a(d.target.value)},onKeyDown:d=>{d.key==="Enter"?(d.preventDefault(),g!==null&&(r!==""&&s.dispatchCommand(O.TOGGLE_LINK_COMMAND,r),c(!1))):d.key==="Escape"&&(d.preventDefault(),c(!1))}}):o.jsx(o.Fragment,{children:o.jsxs("div",{className:"link-input",children:[v,o.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:d=>d.preventDefault(),onClick:()=>{c(!0)}})]})})})}),Hn=l.memo(({onChange:s,className:e,options:t,value:n})=>o.jsxs("select",{className:e,onChange:s,value:n,children:[o.jsx("option",{hidden:!0,value:""}),t.map(r=>o.jsx("option",{value:r,children:r},r))]}));function Tt(s){const e=s.anchor,t=s.focus,n=s.anchor.getNode(),r=s.focus.getNode();return n===r?n:s.isBackward()?A.$isAtNodeEnd(t)?n:r:A.$isAtNodeEnd(e)?r:n}const Vn=l.memo(({editor:s,blockType:e,toolbarRef:t,setShowBlockOptionsDropDown:n})=>{const r=l.useRef(null);l.useEffect(()=>{const d=r.current,u=t.current;if(d!==null&&u!==null){const p=f=>{const x=f.target;!d.contains(x)&&!u.contains(x)&&n(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}},[r,n,t]);const a=()=>{e!=="custom-paragraph"&&s.update(()=>{const d=S.$getSelection();S.$isRangeSelection(d)&&A.$wrapNodes(d,()=>Pn())}),n(!1)},i=()=>{e!=="h1"&&s.update(()=>{const d=S.$getSelection();S.$isRangeSelection(d)&&A.$wrapNodes(d,()=>q.$createHeadingNode("h1"))}),n(!1)},c=()=>{e!=="h2"&&s.update(()=>{const d=S.$getSelection();S.$isRangeSelection(d)&&A.$wrapNodes(d,()=>q.$createHeadingNode("h2"))}),n(!1)},g=()=>{e!=="ul"?s.dispatchCommand(U.INSERT_UNORDERED_LIST_COMMAND,void 0):s.dispatchCommand(U.REMOVE_LIST_COMMAND,void 0),n(!1)},y=()=>{e!=="ol"?s.dispatchCommand(U.INSERT_ORDERED_LIST_COMMAND,void 0):s.dispatchCommand(U.REMOVE_LIST_COMMAND,void 0),n(!1)},m=()=>{e!=="quote"&&s.update(()=>{const d=S.$getSelection();S.$isRangeSelection(d)&&A.$wrapNodes(d,()=>q.$createQuoteNode())}),n(!1)},v=()=>{e!=="code"&&s.update(()=>{const d=S.$getSelection();S.$isRangeSelection(d)&&A.$wrapNodes(d,()=>$.$createCodeNode())}),n(!1)};return o.jsxs("div",{className:"dropdown",ref:r,children:[o.jsxs("button",{className:"item",onClick:a,children:[o.jsx(xt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Normal"}),e==="custom-paragraph"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:i,children:[o.jsx(_t,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Large Heading"}),e==="h1"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:c,children:[o.jsx(bt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Small Heading"}),e==="h2"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:g,children:[o.jsx(vt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Bullet List"}),e==="ul"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:y,children:[o.jsx(wt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Numbered List"}),e==="ol"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:m,children:[o.jsx(St,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Quote"}),e==="quote"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:v,children:[o.jsx(Ve,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Code Block"}),e==="code"&&o.jsx("span",{className:"active"})]})]})}),Ot=l.memo(()=>{const[s]=ze.useLexicalComposerContext(),e=l.useRef(null),[t,n]=l.useState(!1),[r,a]=l.useState(!1),[i,c]=l.useState("custom-paragraph"),[g,y]=l.useState(null),[m,v]=l.useState(!1),[d,u]=l.useState(""),[p,f]=l.useState(!1),[x,h]=l.useState(!1),[b,_]=l.useState(!1),[j,T]=l.useState(!1),[w,C]=l.useState(!1),[E,R]=l.useState(!1),[z,zt]=l.useState(!1),Fe=l.useCallback(()=>{const k=S.$getSelection();if(S.$isRangeSelection(k)){const D=k.anchor.getNode(),L=D.getKey()==="root"?D:D.getTopLevelElementOrThrow(),nt=L.getKey();if(s.getElementByKey(nt)!==null)if(y(nt),U.$isListNode(L)){const Ue=He.$getNearestNodeOfType(D,U.ListNode),Kt=Ue?Ue.getTag():L.getTag();c(Kt)}else{const Ue=q.$isHeadingNode(L)?L.getTag():L.getType();c(Ue),$.$isCodeNode(L)&&u(L.getLanguage()||$.getDefaultCodeLanguage())}_(k.hasFormat("bold")),T(k.hasFormat("italic")),C(k.hasFormat("underline")),R(k.hasFormat("strikethrough")),zt(k.hasFormat("code")),f(A.$isParentElementRTL(k));const ot=Tt(k),Jt=ot.getParent();O.$isLinkNode(Jt)||O.$isLinkNode(ot)?h(!0):h(!1)}},[s]);l.useEffect(()=>He.mergeRegister(s.registerUpdateListener(({editorState:k})=>{k.read(()=>{Fe()})}),s.registerCommand(S.SELECTION_CHANGE_COMMAND,(k,D)=>(Fe(),!1),$e),s.registerCommand(S.CAN_UNDO_COMMAND,k=>(n(k),!1),$e),s.registerCommand(S.CAN_REDO_COMMAND,k=>(a(k),!1),$e)),[s,Fe]);const Ft=l.useMemo(()=>$.getCodeLanguages(),[]),qt=l.useCallback(k=>{s.update(()=>{if(g!==null){const D=S.$getNodeByKey(g);$.$isCodeNode(D)&&D.setLanguage(k.target.value)}})},[s,g]),Ht=l.useCallback(()=>{x?s.dispatchCommand(O.TOGGLE_LINK_COMMAND,null):s.dispatchCommand(O.TOGGLE_LINK_COMMAND,"https://")},[s,x]),[Vt,Bt]=l.useState(null);return l.useEffect(()=>{const k=document.getElementsByClassName("editor-container")[0],D=document.createElement("div");return k.prepend(D),Bt(D),()=>{k.removeChild(D)}},[]),o.jsxs("div",{className:"toolbar",ref:e,children:[o.jsx("button",{disabled:!t,onClick:()=>{s.dispatchCommand(S.UNDO_COMMAND,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:o.jsx(ss,{className:"format",size:20})}),o.jsx("button",{disabled:!r,onClick:()=>{s.dispatchCommand(S.REDO_COMMAND,void 0)},className:"toolbar-item","aria-label":"Redo",children:o.jsx(ns,{className:"format",size:20})}),o.jsx(gt,{}),zn.has(i)&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"toolbar-item block-controls",onClick:()=>v(!m),"aria-label":"Formatting Options",children:[i==="h1"?o.jsx(_t,{className:"icon",size:20}):i==="h2"?o.jsx(bt,{className:"icon",size:20}):i==="h3"?o.jsx(os,{className:"icon",size:20}):i==="h4"?o.jsx(rs,{className:"icon",size:20}):i==="h5"?o.jsx(as,{className:"icon",size:20}):i==="code"?o.jsx(Ve,{className:"icon",size:20}):i==="custom-paragraph"?o.jsx(xt,{className:"icon",size:20}):i==="ol"?o.jsx(wt,{className:"icon",size:20}):i==="ul"?o.jsx(vt,{className:"icon",size:20}):i==="quote"?o.jsx(St,{className:"icon",size:20}):o.jsx(o.Fragment,{}),o.jsx("span",{className:"text",children:Fn[i]}),o.jsx(Et,{size:20})]}),m&&it.createPortal(o.jsx(Vn,{editor:s,blockType:i,toolbarRef:e,setShowBlockOptionsDropDown:v}),Vt),o.jsx(gt,{})]}),i==="code"?o.jsxs(o.Fragment,{children:[o.jsx(Hn,{className:"toolbar-item code-language",onChange:qt,options:Ft,value:d}),o.jsx("i",{className:"chevron-down inside"})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{s.dispatchCommand(S.FORMAT_TEXT_COMMAND,"bold")},className:"toolbar-item spaced "+(b?"active":""),"aria-label":"Format Bold",children:o.jsx(is,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{s.dispatchCommand(S.FORMAT_TEXT_COMMAND,"italic")},className:"toolbar-item spaced "+(j?"active":""),"aria-label":"Format Italics",children:o.jsx(cs,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{s.dispatchCommand(S.FORMAT_TEXT_COMMAND,"underline")},className:"toolbar-item spaced "+(w?"active":""),"aria-label":"Format Underline",children:o.jsx(ls,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{s.dispatchCommand(S.FORMAT_TEXT_COMMAND,"strikethrough")},className:"toolbar-item spaced "+(E?"active":""),"aria-label":"Format Strikethrough",children:o.jsx(ms,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{s.dispatchCommand(S.FORMAT_TEXT_COMMAND,"code")},className:"toolbar-item spaced "+(z?"active":""),"aria-label":"Insert Code",children:o.jsx(Ve,{className:"format",size:20})}),o.jsx("button",{onClick:Ht,className:"toolbar-item spaced "+(x?"active":""),"aria-label":"Insert Link",children:o.jsx(ds,{className:"format",size:20})}),x&&it.createPortal(o.jsx(qn,{editor:s}),document.body)," "]})]})});Ot.__docgenInfo={description:"",methods:[],displayName:"ToolbarPlugin"};function Bn(){const[s]=ze.useLexicalComposerContext();return l.useEffect(()=>$.registerCodeHighlighting(s),[s]),null}const Jn={ltr:"ltr",rtl:"rtl",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough",code:"editor-text-code"},code:"editor-code",codeHighlight:{atrule:"editor-tokenAttr",attr:"editor-tokenAttr",boolean:"editor-tokenProperty",builtin:"editor-tokenSelector",cdata:"editor-tokenComment",char:"editor-tokenSelector",class:"editor-tokenFunction","class-name":"editor-tokenFunction",comment:"editor-tokenComment",constant:"editor-tokenProperty",deleted:"editor-tokenProperty",doctype:"editor-tokenComment",entity:"editor-tokenOperator",function:"editor-tokenFunction",important:"editor-tokenVariable",inserted:"editor-tokenSelector",keyword:"editor-tokenAttr",namespace:"editor-tokenVariable",number:"editor-tokenProperty",operator:"editor-tokenOperator",prolog:"editor-tokenComment",property:"editor-tokenProperty",punctuation:"editor-tokenPunctuation",regex:"editor-tokenVariable",selector:"editor-tokenSelector",string:"editor-tokenSelector",symbol:"editor-tokenProperty",tag:"editor-tokenProperty",url:"editor-tokenOperator",variable:"editor-tokenVariable"}};const B=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Kn=B&&"documentMode"in document?document.documentMode:null,Wn=B&&"InputEvent"in window&&!Kn?"getTargetRanges"in new window.InputEvent("input"):!1,Zn=B&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Xn=B&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Gn=B&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Yn=B&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Gn;function Qn(){return o.jsx("div",{className:"editor-placeholder",id:"editor-placeholder",children:"Enter message..."})}const eo=l.memo(({roomID:s,onStartSending:e,onStopSending:t})=>{const n=P(s||""),[r]=ze.useLexicalComposerContext(),a=l.useCallback(()=>{n&&r.getEditorState().read(()=>{let i=us.$generateHtmlFromNodes(r);const c=/(?<all><code .* (?:data-highlight-language="(?<language>.*?)")(?: .*?)?>(?<code>[\s\S]*?)<\/code>)/;let g=c.exec(i);for(;g!==null;){if(g){const{groups:m}=g;if(m){let{all:v,language:d,code:u}=m;const p=/<span(?: class=".*?")?>(?<content>.*?)<\/span>/;let f=p.exec(u);for(;f!==null;){if(f){const{groups:x}=f;if(x){const{content:h}=x;u=u.replaceAll(f[0],h)}}f=p.exec(u)}u=u.replaceAll("<br>",`
`),i=i.replace(v,`<pre><code class="language-${d}">${u}</code></pre>`)}}g=c.exec(i)}const y=Be.$convertToMarkdownString(Be.TRANSFORMERS);console.log(i),!(i===""&&y===""||i==='<p class="editor-paragraph"><br></p>')&&(e(),console.log("Sending message to: ",s),i!=='<p class="editor-paragraph"><br></p>'?n.sendHtmlMessage(i,y).then(()=>{r.dispatchCommand(S.CLEAR_EDITOR_COMMAND,void 0),r.dispatchCommand(S.CLEAR_HISTORY_COMMAND,void 0),localStorage.removeItem(`editor-${s}`),t()}).catch(m=>{console.log(m),t()}):n.sendTextMessage(y).then(()=>{r.dispatchCommand(S.CLEAR_EDITOR_COMMAND,void 0),r.dispatchCommand(S.CLEAR_HISTORY_COMMAND,void 0),localStorage.removeItem(`editor-${s}`),t()}).catch(m=>{console.log(m),t()}))})},[s,r]);return l.useEffect(()=>{r.registerCommand(S.KEY_ENTER_COMMAND,i=>{const c=S.$getSelection();if(!S.$isRangeSelection(c))return!1;if(i!==null){if((Xn||Zn||Yn)&&Wn)return!1;if(i.preventDefault(),i.shiftKey)return r.dispatchCommand(S.INSERT_PARAGRAPH_COMMAND,void 0)}return a(),r.dispatchCommand(S.INSERT_PARAGRAPH_COMMAND,void 0)},S.COMMAND_PRIORITY_CRITICAL)},[r]),o.jsx(ps,{size:45,stroke:"unset",className:"stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer",onClick:a})}),to=({roomID:s})=>{const[e]=ze.useLexicalComposerContext(),{pathname:t}=jt(),[n,r]=l.useState(void 0);return l.useEffect(()=>{if(s){if(s!==n){console.log("Saving editor state");const i=e.getEditorState();localStorage.setItem(`editor-${n}`,JSON.stringify(i.toJSON()))}r(s);const a=localStorage.getItem(`editor-${s}`);if(a){const i=e.parseEditorState(a);e.setEditorState(i)}else e.dispatchCommand(S.CLEAR_EDITOR_COMMAND,void 0),e.dispatchCommand(S.CLEAR_HISTORY_COMMAND,void 0)}},[t,s]),o.jsx(o.Fragment,{})},et=l.memo(({namespace:s,roomID:e})=>{const[t,n]=l.useState(!1),r={namespace:s,theme:Jn,onError:a=>console.error(a),editable:!t,nodes:[q.HeadingNode,U.ListNode,U.ListItemNode,q.QuoteNode,$.CodeNode,$.CodeHighlightNode,qe.TableNode,qe.TableCellNode,qe.TableRowNode,O.AutoLinkNode,O.LinkNode,V,{replace:S.ParagraphNode,with:a=>new V}]};return o.jsx("div",{className:"flex flex-row items-end",children:o.jsxs(gs.LexicalComposer,{initialConfig:r,children:[o.jsxs("div",{className:"editor-container flex-1",children:[o.jsx(Ot,{}),o.jsxs("div",{className:"editor-inner",children:[o.jsx(hs.RichTextPlugin,{contentEditable:o.jsx(fs.ContentEditable,{className:"editor-input",ariaLabelledBy:"editor-placeholder"}),placeholder:o.jsx(Qn,{}),ErrorBoundary:ys}),o.jsx(xs.HistoryPlugin,{}),o.jsx(_s.LinkPlugin,{}),o.jsx(Bn,{}),o.jsx(Mt,{}),o.jsx(bs.MarkdownShortcutPlugin,{transformers:Be.TRANSFORMERS}),o.jsx(vs.ClearEditorPlugin,{}),o.jsx(to,{roomID:e})]})]}),o.jsx(eo,{roomID:e,onStartSending:()=>{console.log("Sending"),n(!0)},onStopSending:()=>{n(!1)}})]})})});et.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{namespace:{required:!0,tsType:{name:"string"},description:"The Namespace"},roomID:{required:!1,tsType:{name:"string"},description:"The current Room"}}};const so={title:"Chat/Input",component:et,decorators:[We],argTypes:{namespace:{required:!0,name:"Namespace",description:"The Namespace of the editor."}}},be={args:{namespace:"Editor"}};be.parameters={...be.parameters,docs:{...be.parameters?.docs,source:{originalSource:`{
  args: {
    namespace: "Editor"
  }
}`,...be.parameters?.docs?.source}}};const no=["Default"],oo=Object.freeze(Object.defineProperty({__proto__:null,Default:be,__namedExportsOrder:no,default:so},Symbol.toStringTag,{value:"Module"})),tt=l.memo(({roomId:s,avatarUrl:e,displayname:t,dm:n=!1,online:r=!1,active:a=!1,onClick:i,hidden:c})=>{const g=l.useContext(M),{ref:y,inView:m}=Nt({triggerOnce:!0,skip:c,threshold:1,onChange(v){v?g.addInViewRoom(s):g.removeInViewRoom(s)}});return o.jsx("div",{ref:y,onClick:i,className:"w-full cursor-pointer",children:m&&(a?o.jsxs("div",{className:"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(I,{avatarUrl:e,displayname:t,dm:n,online:r}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}):o.jsxs("div",{className:"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(I,{avatarUrl:e,displayname:t,dm:n,online:r}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}))})});tt.__docgenInfo={description:"",methods:[],displayName:"RoomListItem",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},active:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the current room is selected"},roomId:{required:!0,tsType:{name:"string"},description:"Room id"},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the room list item"},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The onClick handler"},hidden:{required:!0,tsType:{name:"boolean"},description:"If room is hidden"}}};const ro=l.memo(({sectionID:s,rooms:e,onClick:t,activeRoom:n,hidden:r})=>{const a=e.map(i=>o.jsx(tt,{roomId:i.roomID,hidden:r,avatarUrl:i.avatarUrl,displayname:i.displayname,dm:i.dm,online:i.online,active:i.roomID===n,onClick:()=>{t(i.roomID)}},`${i.roomID}+${s}`));return o.jsx(o.Fragment,{children:a})}),Ke=l.memo(({section:s,onRoomClick:e,activeRoom:t})=>{const[n,r]=l.useState(!0),a=l.useContext(M),{ref:i,inView:c}=Nt({triggerOnce:!0,threshold:1,onChange(g){s.roomID!=="other"&&(g?a.addInViewRoom(s.roomID):a.removeInViewRoom(s.roomID))}});return l.useEffect(()=>{n?a.removeSpaceOpen(s.roomID):a.addSpaceOpen(s.roomID)},[n]),o.jsxs("div",{ref:i,className:"flex flex-col gap-1 pl-4 select-none",children:[c&&o.jsxs("div",{className:"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600",onClick:()=>r(g=>!g),children:[n?o.jsx(ws,{size:14}):o.jsx(Et,{size:14}),o.jsx("span",{className:"font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:s.sectionName})]}),!n&&c&&o.jsx(ro,{hidden:n,sectionID:s.roomID,rooms:s.rooms,onClick:e,activeRoom:t}),!n&&c&&s.subsections.map(g=>o.jsx(Ke,{section:g,onRoomClick:e,activeRoom:t},g.roomID))]},s.roomID)}),st=l.memo(({sections:s,rooms:e})=>{const[t,n]=l.useState(void 0),r=Ss();return o.jsxs("div",{className:"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]",children:[s.map(a=>o.jsx(Ke,{section:a,onRoomClick:i=>{n(i),r(`/${encodeURIComponent(i)}`)},activeRoom:t},a.roomID)),o.jsx(Ke,{section:{sectionName:"Others",roomID:"other",subsections:[],rooms:e},onRoomClick:a=>{n(a),r(`/${encodeURIComponent(a)}`)},activeRoom:t})]})});st.__docgenInfo={description:"",methods:[],displayName:"RoomList",props:{sections:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * Section Name. Can be a Space or a Tag
     */
    sectionName: string
    /**
     * The Rooms within the Section
     */
    rooms: Room[]
    /**
     * The Subsections of the Section
     */
    subsections: Section[]
    /**
     * The roomid of the Space
     */
    roomID: string
}`,signature:{properties:[{key:"sectionName",value:{name:"string",required:!0}},{key:"rooms",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]",required:!0}},{key:"subsections",value:{name:"Array",elements:[{name:"Section"}],raw:"Section[]",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Section[]"},description:"The Sections available"},rooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections"}}};const ao={title:"Chat/RoomList",component:st,decorators:[We],argTypes:{sections:{required:!0,defaultValue:[],name:"Sections",description:"The Sections available"},rooms:{required:!0,defaultValue:[],name:"Rooms",description:"Rooms outside of any Sections"}}},ve={args:{rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0},{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],sections:[{sectionName:"Test Section",rooms:[{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],roomID:"12",subsections:[{sectionName:"Test Subsection",rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}],roomID:"14",subsections:[]}]}]}};ve.parameters={...ve.parameters,docs:{...ve.parameters?.docs,source:{originalSource:`{
  args: {
    rooms: [{
      roomID: "1",
      displayname: "test",
      avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
      dm: true,
      online: true
    }, {
      roomID: "2",
      displayname: "test1",
      dm: false,
      online: false
    }, {
      roomID: "3",
      displayname: "test2",
      dm: false,
      online: false
    }],
    sections: [{
      sectionName: "Test Section",
      rooms: [{
        roomID: "2",
        displayname: "test1",
        dm: false,
        online: false
      }, {
        roomID: "3",
        displayname: "test2",
        dm: false,
        online: false
      }],
      roomID: "12",
      subsections: [{
        sectionName: "Test Subsection",
        rooms: [{
          roomID: "1",
          displayname: "test",
          avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
          dm: true,
          online: true
        }],
        roomID: "14",
        subsections: []
      }]
    }]
  }
}`,...ve.parameters?.docs?.source}}};const io=["RootList"],co=Object.freeze(Object.defineProperty({__proto__:null,RootList:ve,__namedExportsOrder:io,default:ao},Symbol.toStringTag,{value:"Module"})),lo={title:"Chat/RoomList/Item",component:tt,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"Displayname",description:"The displayname of the Room"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the room is a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"},active:{required:!1,defaultValue:!1,control:"boolean",name:"Active",description:"Wether the room is currently selected"}}},we={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!1}},Se={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!0}},Ee={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!1}},je={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!0}},Ne={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!1}},ke={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!0}},Re={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!1}},Ie={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!0}},De={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1,active:!1}},Ce={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0,active:!1}};we.parameters={...we.parameters,docs:{...we.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: false
  }
}`,...we.parameters?.docs?.source}}};Se.parameters={...Se.parameters,docs:{...Se.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: true
  }
}`,...Se.parameters?.docs?.source}}};Ee.parameters={...Ee.parameters,docs:{...Ee.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: false
  }
}`,...Ee.parameters?.docs?.source}}};je.parameters={...je.parameters,docs:{...je.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: true
  }
}`,...je.parameters?.docs?.source}}};Ne.parameters={...Ne.parameters,docs:{...Ne.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: false
  }
}`,...Ne.parameters?.docs?.source}}};ke.parameters={...ke.parameters,docs:{...ke.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: true
  }
}`,...ke.parameters?.docs?.source}}};Re.parameters={...Re.parameters,docs:{...Re.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: false
  }
}`,...Re.parameters?.docs?.source}}};Ie.parameters={...Ie.parameters,docs:{...Ie.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: true
  }
}`,...Ie.parameters?.docs?.source}}};De.parameters={...De.parameters,docs:{...De.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false,
    active: false
  }
}`,...De.parameters?.docs?.source}}};Ce.parameters={...Ce.parameters,docs:{...Ce.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true,
    active: false
  }
}`,...Ce.parameters?.docs?.source}}};const mo=["Fallback","FallbackActive","Image","ImageActive","DMOffline","DMOfflineActive","DMOnline","DMOnlineActive","DMNoAvatarOffline","DMNoAvatarOnline"],uo=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:De,DMNoAvatarOnline:Ce,DMOffline:Ne,DMOfflineActive:ke,DMOnline:Re,DMOnlineActive:Ie,Fallback:we,FallbackActive:Se,Image:Ee,ImageActive:je,__namedExportsOrder:mo,default:lo},Symbol.toStringTag,{value:"Module"}));function po(s={}){const{wrapper:e}=Object.assign({},ct(),s.components);return e?o.jsx(e,{...s,children:o.jsx(t,{})}):t();function t(){const n=Object.assign({h1:"h1",p:"p"},ct(),s.components);return o.jsxs(o.Fragment,{children:[o.jsx(Es,{title:"Introduction/Welcome"}),`
`,o.jsx(n.h1,{id:"about-cetirizine",children:"About Cetirizine"}),`
`,o.jsx(n.p,{children:"Welcome to the Cetirizine Design System!"}),`
`,o.jsx(n.p,{children:`This storybook design system describes in depth the components used within the
Cetirizine Matrix Client.`}),`
`,o.jsx(n.p,{children:`The Design heavily leans on the Tailwindcss Design System. However there are speciic
components for some things and Pages are also documented.`})]})}}const Lt=()=>{throw new Error("Docs-only story")};Lt.parameters={docsOnly:!0};const Le={title:"Introduction/Welcome",tags:["stories-mdx"],includeStories:["__page"]};Le.parameters=Le.parameters||{};Le.parameters.docs={...Le.parameters.docs||{},page:po};const go=["__page"],ho=Object.freeze(Object.defineProperty({__proto__:null,__namedExportsOrder:go,__page:Lt,default:Le},Symbol.toStringTag,{value:"Module"}));const At=l.memo(()=>{const s=l.useContext(M),[e,t]=l.useState(!1),[n,r]=l.useState(""),[a,i]=l.useState(""),[c,g]=l.useState("");if(s.isLoggedIn)return o.jsx(js,{to:"/"});const y=async()=>{try{t(!0),await s.passwordLogin(a,c)}catch(m){r(m.toString())}t(!1)};return o.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:m=>{m.preventDefault(),y()},children:[o.jsx(Qe,{children:"Login"}),n?o.jsx("h2",{className:"text-red-500 font-normal text-sm",children:n}):o.jsx("div",{className:"min-h-[1.25rem]"}),o.jsx(Pe,{readonly:e,value:a,placeholder:"Username",onChange:m=>i(m.target.value)}),o.jsx(Pe,{readonly:e,value:c,password:!0,placeholder:"Password",onChange:m=>g(m.target.value)}),o.jsx(Ze,{readonly:e,style:"primary",type:"submit",children:"Login"})]})});At.__docgenInfo={description:"",methods:[],displayName:"Login"};const Ut=l.memo(()=>o.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:o.jsx(At,{})}));Ut.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const fo={title:"Pages/LoginPage",component:Ut},Me={};Me.parameters={...Me.parameters,docs:{...Me.parameters?.docs,source:{originalSource:"{}",...Me.parameters?.docs?.source}}};const yo=["Default"],xo=Object.freeze(Object.defineProperty({__proto__:null,Default:Me,__namedExportsOrder:yo,default:fo},Symbol.toStringTag,{value:"Module"}));const _o=l.memo(({roomID:s,scrollRef:e})=>{const t=P(decodeURIComponent(s||"")),n=l.useContext(M),r=cn(t),{pathname:a}=jt(),[i,c]=l.useState([]),g=m=>{const v=m?.filter((u,p,f)=>f.findIndex(x=>x.event_id===u.event_id)===p).sort((u,p)=>u.origin_server_ts-p.origin_server_ts),d=v.filter(u=>u.type!=="m.reaction"&&u.type!=="m.room.redaction"&&u.content["m.relates_to"]?.rel_type!=="m.replace");Promise.all(d?.map(async(u,p)=>{let f=d?.[p-1];const x=f?.sender===u.sender;let h=f?.type;const b=v?.filter(E=>E.type==="m.reaction"&&E.content["m.relates_to"].event_id===u.event_id),_=v?.find(E=>E.type==="m.room.redaction"&&E.redacts===u.event_id),j=_!==void 0;let T,w;j&&(w=_?.event_id,_.content.reason&&(T=_.content.reason));const C=v?.find(E=>E.content["m.relates_to"]?E.content["m.relates_to"].rel_type==="m.replace"&&E.content["m.relates_to"].event_id===u.event_id:!1);if(C&&(u=C,C.content["m.new_content"]&&(u.content.body=C.content["m.new_content"].body,u.content.formatted_body=C.content["m.new_content"].formatted_body,u.content.format=C.content["m.new_content"].format)),u.type==="m.room.encrypted")try{const E=await n.olmMachine?.decryptRoomEvent(JSON.stringify(u),new N.RoomId(s||""));if(E)u=JSON.parse(E.event),u.content["m.new_content"]&&(u.content.body=u.content["m.new_content"].body,u.content.formatted_body=u.content["m.new_content"].formatted_body,u.content.format=u.content["m.new_content"].format);else return j?o.jsx(Oe,{event:u,redacted_because:T,roomID:s,hasPreviousEvent:x},w):o.jsx(H,{event:u,hasPreviousEvent:x,roomID:s},u.event_id)}catch(E){return console.error(E),j?o.jsx(Oe,{event:u,redacted_because:T,roomID:s,hasPreviousEvent:x},w):o.jsx(H,{event:u,hasPreviousEvent:x,roomID:s},u.event_id)}if(f?.type==="m.room.encrypted")try{const E=await n.olmMachine?.decryptRoomEvent(JSON.stringify(f),new N.RoomId(s||""));E&&(f=JSON.parse(E.event),h=f.type,f.content["m.new_content"]&&(f.content.body=f.content["m.new_content"].body,f.content.formatted_body=f.content["m.new_content"].formatted_body,f.content.format=f.content["m.new_content"].format))}catch(E){console.error(E)}return y(u,x,h,b,j,T,w)})).then(u=>{c(u)})};l.useEffect(()=>{r&&g(r)},[r]),l.useEffect(()=>{e.current?.scrollTo(0,e.current?.scrollHeight)},[a]);const y=(m,v,d,u,p,f,x)=>{if(p)return o.jsx(Oe,{event:m,redacted_because:f,roomID:s,hasPreviousEvent:v},x);switch(m.type){case"m.room.message":return o.jsx(Ye,{reactions:u,event:m,roomID:s,hasPreviousEvent:v&&d==="m.room.message"},m.event_id);case"m.room.member":return o.jsx(Xe,{event:m},m.event_id);default:return o.jsx(Ge,{event:m},m.event_id)}};return o.jsx("div",{className:"max-w-[130ch] flex flex-col",children:i})}),$t=l.memo(()=>{const s=hn(),e=gn(),t=pn(),n=l.useContext(M);let r=Ns();const a=P(decodeURIComponent(r.roomIdOrAlias||""));n.setCurrentRoom(r.roomIdOrAlias?decodeURIComponent(r.roomIdOrAlias):void 0);const i=l.useRef(null),c=[...e].filter(({spaceRoom:p})=>{const f=!p.isTombstoned(),x=![...e].some(({children:b})=>[...b].some(_=>_.roomID===p.roomID)),h=p.getSpaceParentIDs().length===0;return x&&h&&f}),g=[...t].filter(p=>{const f=!p.isTombstoned(),x=![...e].some(({children:_})=>[..._].some(j=>j.roomID===p.roomID)),h=p.getSpaceParentIDs().length===0,b=!p.isSpace();return x&&h&&b&&f}).sort((p,f)=>{const x=p.windowPos.overview,h=f.windowPos.overview;return x===-1?1:h===-1?-1:x-h}),y=c.map(p=>{const f=[...p.children].filter(h=>!h.isSpace()&&!h.isTombstoned()).sort((h,b)=>{const _=h.windowPos[p.spaceRoom.roomID],j=b.windowPos[p.spaceRoom.roomID];return _===-1?1:j===-1?-1:_-j}).map(h=>({roomID:h.roomID,displayname:h.getName(),avatarUrl:h.getAvatarURL(),dm:h.isDM(),online:h.isOnline()})),x=h=>{const b=[...e].find(_=>_.spaceRoom.roomID===h.roomID);if(b){const _=[...b?.children].filter(j=>!j.isSpace()&&!j.isTombstoned()).map(j=>({roomID:j.roomID,displayname:j.getName(),avatarUrl:j.getAvatarURL(),dm:j.isDM(),online:j.isOnline()}));return{sectionName:h.getName(),rooms:_,roomID:h.roomID,subsections:[...b?.children].filter(j=>j.isSpace()&&!j.isTombstoned()).map(x).filter(j=>j!==void 0)}}};return{sectionName:p.spaceRoom.getName(),rooms:f,roomID:p.spaceRoom.roomID,subsections:[...p.children].filter(h=>h.isSpace()).map(x)}}),m=g.filter(p=>!p.isSpace()).map(p=>({roomID:p.roomID,displayname:p.getName(),avatarUrl:p.getAvatarURL(),dm:p.isDM(),online:p.isOnline()})),v=m.map(p=>p.roomID),d=v.filter((p,f)=>v.indexOf(p)!==f);d.length>0&&console.error("otherRooms has duplicates",d);const u={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"};return o.jsxs("div",{className:"flex flex-row gap-2 min-h-screen h-screen",children:[o.jsxs("div",{className:"flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300",children:[o.jsxs("div",{className:"flex flex-row gap-2 m-2 p-1 items-center border-b-2",children:[o.jsx(I,{displayname:s.displayname||n.mxid,avatarUrl:s?.avatar_url,dm:!1,online:!1}),o.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[o.jsx("span",{className:"text-base font-semibold",children:s?.displayname}),o.jsx(ks,{size:28,stroke:"unset",className:"stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer"})]})]}),o.jsx(st,{sections:y,rooms:m})]}),a&&o.jsxs("div",{className:"flex-1 flex flex-col",children:[o.jsxs("div",{className:"pb-2 flex flex-row items-center border-b-2 mt-4 ml-2",children:[o.jsx(I,{displayname:a.getName(),avatarUrl:a.getAvatarURL(),dm:a.isDM(),online:a.isOnline()}),o.jsxs("div",{className:"flex flex-row items-start",children:[o.jsx("h1",{className:"text-black font-semibold text-lg flex-shrink-0",children:a.getName()}),o.jsx(Ae,{options:u,as:"p",className:"ml-4 text-slate-700 font-normal text-base line-clamp-2 text-ellipsis",children:a.getTopic()})]})]}),o.jsx("div",{ref:i,className:"overflow-y-auto overflow-x-hidden scrollbarSmall mr-2 my-1 flex-1 w-full flex flex-col-reverse",children:o.jsx(_o,{roomID:r.roomIdOrAlias,scrollRef:i})}),o.jsx(et,{namespace:"Editor",roomID:decodeURIComponent(r.roomIdOrAlias||"")})]})]})});$t.__docgenInfo={description:"",methods:[],displayName:"MainPage"};const bo={title:"Pages/MainPage",component:$t,decorators:[We]},Te={};Te.parameters={...Te.parameters,docs:{...Te.parameters?.docs,source:{originalSource:"{}",...Te.parameters?.docs?.source}}};const vo=["Default"],wo=Object.freeze(Object.defineProperty({__proto__:null,Default:Te,__namedExportsOrder:vo,default:bo},Symbol.toStringTag,{value:"Module"}));function Pt(s){return{"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":Hs,"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":Js,"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":Zs,"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":bn,"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":Sn,"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":Nn,"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":In,"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":Mn,"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":Ln,"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":oo,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":co,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":uo,"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":ho,"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":xo,"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":wo}[s]}Object.assign(Pt,{keys:()=>["/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx"],resolve:s=>({"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":"./src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":"./src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":"./src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":"./src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":"./src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":"./src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":"./src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":"./src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":"./src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":"./src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":"./src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":"./src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":"./src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":"./src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":"./src/pages/MainPage.stories.tsx"})[s]});function So(s){s(Pt,{hot:void 0},!1)}__STORYBOOK_MODULE_CLIENT_LOGGER__;const Eo=__STORYBOOK_MODULE_PREVIEW_API__,{addDecorator:jo,addParameters:ft,addLoader:No,addArgs:ko,addArgTypes:Ro,addStepRunner:Io,addArgTypesEnhancer:Do,addArgsEnhancer:Co,setGlobalRender:Mo}=Eo,To=[Rs,Is,Ds,Cs,Ms,Ts,Os,Ls,As,Us,zs].filter(Boolean);To.map(s=>s.default?s.default:s).forEach(s=>{Object.keys(s).forEach(e=>{const t=s[e];switch(e){case"args":return ko(t);case"argTypes":return Ro(t);case"decorators":return t.forEach(n=>jo(n,!1));case"loaders":return t.forEach(n=>No(n,!1));case"parameters":return ft({...t},!1);case"argTypesEnhancers":return t.forEach(n=>Do(n));case"argsEnhancers":return t.forEach(n=>Co(n));case"render":return Mo(t);case"globals":case"globalTypes":{const n={};return n[e]=t,ft(n,!1)}case"decorateStory":case"applyDecorators":case"renderToDOM":case"renderToCanvas":return null;case"runStep":return Io(t);default:return console.log(e+" was not supported :( !")}})});So($s);
//# sourceMappingURL=iframe-8874483b.js.map
