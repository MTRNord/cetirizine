import"../sb-preview/runtime.mjs";import{$ as vt,j as o,r as l,e as P,L as Nt,a as N,b as T,c as ke,d as O,T as We,H as Je,f as Xe,g as Ke,h as Ge,Q as Ze,C as Ce,i as Se,k as L,l as z,m as A,U as St,R as jt,n as It,o as Et,p as kt,q as Ye,s as Ue,B as Ct,I as Rt,t as Dt,S as Tt,u as Mt,v as Qe,w as S,x as Ot,y as Lt,z as At,A as Pt,D as $t,E as Ut,F as zt,G as qt,J as Ht,K as Ie,M as Ft,N as Bt,O as Vt,P as Wt,V as et,W as Ee,X as Jt,Y as Xt,Z as Kt,_ as tt,a0 as ze,a1 as Gt,a2 as Zt,a3 as Yt,a4 as ye,a5 as Qt,a6 as es,a7 as ts,a8 as ss,a9 as os,aa as ns,ab as as,ac as rs,ad as is,ae as cs,af as ls,ag as ds,ah as ms,ai as us}from"./vendor-9d6749bd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const ps={parameters:{actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},options:{storySort:{order:["Introduction","Fundamentals","*"]}}},decorators:[vt({themes:{light:"light",dark:"dark"},defaultTheme:"light",attributeName:"data-mode"}),n=>o.jsx(n,{})]},hs=Object.freeze(Object.defineProperty({__proto__:null,default:ps},Symbol.toStringTag,{value:"Module"})),R=l.memo(({avatarUrl:n,displayname:e,dm:t=!1,online:s=!1})=>n?o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[o.jsx("img",{className:"rounded-full w-8 h-8 object-cover",alt:e,src:n}),t?s?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx(o.Fragment,{})]}):o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[e.replace("@","")[0].toUpperCase(),t?s?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):o.jsx(o.Fragment,{})]}));R.__docgenInfo={description:"",methods:[],displayName:"Avatar",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the avatar user"}}};const fs={title:"Chat/Avatar",tags:["autodocs"],component:R,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"User ID",description:"The DISPLAY name of the User"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the Avatar is used for a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"}}},H={args:{displayname:"test",dm:!1,online:!1,avatarUrl:""}},F={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1}},B={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1}},V={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}},W={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1}},J={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0}};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: ""
  }
}`,...H.parameters?.docs?.source}}};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false
  }
}`,...F.parameters?.docs?.source}}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false
  }
}`,...B.parameters?.docs?.source}}};V.parameters={...V.parameters,docs:{...V.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true
  }
}`,...V.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false
  }
}`,...W.parameters?.docs?.source}}};J.parameters={...J.parameters,docs:{...J.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true
  }
}`,...J.parameters?.docs?.source}}};const gs=["Fallback","Image","DMOffline","DMOnline","DMNoAvatarOffline","DMNoAvatarOnline"],ys=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:W,DMNoAvatarOnline:J,DMOffline:B,DMOnline:V,Fallback:H,Image:F,__namedExportsOrder:gs,default:fs},Symbol.toStringTag,{value:"Module"}));const Te=l.memo(({type:n="button",style:e="primary",onClick:t,children:s,readonly:a})=>e==="secondary"?o.jsx("button",{disabled:a,onClick:t,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}):e==="abort"?o.jsx("button",{disabled:a,onClick:t,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}):o.jsx("button",{disabled:a,onClick:t,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}));Te.__docgenInfo={description:"",methods:[],displayName:"Button",props:{type:{defaultValue:{value:'"button"',computed:!1},required:!1,tsType:{name:"union",raw:'"button" | "submit" | "reset"',elements:[{name:"literal",value:'"button"'},{name:"literal",value:'"submit"'},{name:"literal",value:'"reset"'}]},description:"The button type"},style:{defaultValue:{value:'"primary"',computed:!1},required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "abort"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"abort"'}]},description:"The button style"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The button onClick handler"},children:{required:!0,tsType:{name:"string"},description:"The button Label"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the button is readonly"}}};const xs={title:"Fundamentals/Buttons/BasicButton",tags:["autodocs"],component:Te,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{children:{required:!0,name:"Label",description:"The button label"},onClick:{description:"The button onClick handler",required:!0},type:{description:"The button type",control:"select",options:["button","submit","reset"],defaultValue:"button"},style:{description:"The button styling",control:"select",options:["primary","secondary","abort"],defaultValue:"primary"}}},X={args:{children:"Click me",type:"button",style:"primary"}},K={args:{children:"Submit",type:"submit",style:"primary"}},G={args:{children:"Reset",type:"reset",style:"primary"}},Z={args:{children:"Click me",type:"button",style:"secondary"}},Y={args:{children:"Submit",type:"submit",style:"secondary"}},Q={args:{children:"Reset",type:"reset",style:"secondary"}},ee={args:{children:"Abort",type:"button",style:"abort"}};X.parameters={...X.parameters,docs:{...X.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'primary'
  }
}`,...X.parameters?.docs?.source}}};K.parameters={...K.parameters,docs:{...K.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'primary'
  }
}`,...K.parameters?.docs?.source}}};G.parameters={...G.parameters,docs:{...G.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'primary'
  }
}`,...G.parameters?.docs?.source}}};Z.parameters={...Z.parameters,docs:{...Z.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'secondary'
  }
}`,...Z.parameters?.docs?.source}}};Y.parameters={...Y.parameters,docs:{...Y.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'secondary'
  }
}`,...Y.parameters?.docs?.source}}};Q.parameters={...Q.parameters,docs:{...Q.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'secondary'
  }
}`,...Q.parameters?.docs?.source}}};ee.parameters={...ee.parameters,docs:{...ee.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Abort',
    type: 'button',
    style: 'abort'
  }
}`,...ee.parameters?.docs?.source}}};const bs=["Default","Submit","Reset","DefaultSecondary","SubmitSecondary","ResetSecondary","Abort"],_s=Object.freeze(Object.defineProperty({__proto__:null,Abort:ee,Default:X,DefaultSecondary:Z,Reset:G,ResetSecondary:Q,Submit:K,SubmitSecondary:Y,__namedExportsOrder:bs,default:xs},Symbol.toStringTag,{value:"Module"})),Me=l.memo(({children:n})=>o.jsx("h1",{className:"text-black font-bold text-xl",children:n}));Me.__docgenInfo={description:"",methods:[],displayName:"Header",props:{children:{required:!0,tsType:{name:"string"},description:"The HeaderText"}}};const ws={title:"Fundamentals/Typography/Header",tags:["autodocs"],component:Me,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{children:{required:!0,name:"Content",description:"The Headertext"}}},te={args:{children:"Header"}};te.parameters={...te.parameters,docs:{...te.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Header'
  }
}`,...te.parameters?.docs?.source}}};const vs=["Default"],Ns=Object.freeze(Object.defineProperty({__proto__:null,Default:te,__namedExportsOrder:vs,default:ws},Symbol.toStringTag,{value:"Module"})),Ne=l.memo(({placeholder:n,password:e=!1,autoFocus:t=!1,value:s,readonly:a,onChange:i})=>o.jsx("input",{disabled:a,className:"text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:s,type:e?"password":"text",autoFocus:t,placeholder:n,onChange:i}));Ne.__docgenInfo={description:"",methods:[],displayName:"Input",props:{password:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If it is a password input"},autoFocus:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If input should be autofocused"},placeholder:{required:!0,tsType:{name:"string"},description:"The Placeholder text"},value:{required:!0,tsType:{name:"string"},description:"The value of the input field"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the input is readonly"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{name:"e",type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"}}],return:{name:"void"}}},description:"Handler for the onChange event"}}};const Ss={title:"Fundamentals/Inputs/BasicInput",tags:["autodocs"],component:Ne,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{placeholder:{required:!0,name:"Placeholder",description:"The Placeholder for the input field. Shown if it is empty."},password:{required:!1,name:"Password",control:"boolean",defaultValue:!1,description:"If the input field takes a password."},autoFocus:{required:!1,name:"Auto Focus",control:"boolean",defaultValue:!1,description:"If the field should be focused automatically."},value:{required:!0,name:"Value",description:"The current value of the input."},onChange:{description:"The onChange handler of the input field.",required:!0}}},se={args:{placeholder:"Placeholder",password:!1,autoFocus:!1}};se.parameters={...se.parameters,docs:{...se.parameters?.docs,source:{originalSource:`{
  args: {
    placeholder: "Placeholder",
    password: false,
    autoFocus: false
  }
}`,...se.parameters?.docs?.source}}};const js=["Default"],Is=Object.freeze(Object.defineProperty({__proto__:null,Default:se,__namedExportsOrder:js,default:Ss},Symbol.toStringTag,{value:"Module"})),Es=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,ks=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,Cs=[n=>{const e=Es.exec(n);return e&&{index:e.index,length:e[0].length,text:e[0],url:e[0]}},n=>{const e=ks.exec(n);return e&&{index:e.index,length:e[0].length,text:e[0],url:`mailto:${e[0]}`}}];function st(){return o.jsx(Nt.AutoLinkPlugin,{matchers:Cs})}st.__docgenInfo={description:"",methods:[],displayName:"PlaygroundAutoLinkPlugin"};const ve=1,Rs=new Set(["paragraph","quote","code","h1","h2","ul","ol"]),Ds={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List",paragraph:"Normal",quote:"Quote",ul:"Bulleted List"},qe=l.memo(()=>o.jsx("div",{className:"divider"}));function He(n,e){e?(n.style.opacity="1",n.style.top=`${e.top+e.height+window.pageYOffset+10}px`,n.style.left=`${e.left+window.pageXOffset-n.offsetWidth/2+e.width/2}px`):(n.style.opacity="0",n.style.top="-1000px",n.style.left="-1000px")}const Ts=l.memo(({editor:n})=>{const e=l.useRef(null),t=l.useRef(null),s=l.useRef(!1),[a,i]=l.useState(""),[r,d]=l.useState(!1),[x,b]=l.useState(null),m=l.useCallback(()=>{const c=N.$getSelection();if(N.$isRangeSelection(c)){const h=ot(c),g=h.getParent();T.$isLinkNode(g)?i(g.getURL()):T.$isLinkNode(h)?i(h.getURL()):i("")}const v=e.current,u=window.getSelection(),y=document.activeElement;if(v===null)return;const f=n.getRootElement();if(c!==null&&!u?.isCollapsed&&f!==null&&f.contains(u?.anchorNode)){const h=u?.getRangeAt(0);let g;if(u?.anchorNode===f){let p=f;for(;p.firstElementChild!=null;)p=p.firstElementChild;g=p.getBoundingClientRect()}else g=h?.getBoundingClientRect();s.current||He(v,g),b(c)}else(!y||y.className!=="link-input")&&(He(v,void 0),b(null),d(!1),i(""));return!0},[n]);l.useEffect(()=>ke.mergeRegister(n.registerUpdateListener(({editorState:c})=>{c.read(()=>{m()})}),n.registerCommand(N.SELECTION_CHANGE_COMMAND,()=>(m(),!0),ve)),[n,m]),l.useEffect(()=>{n.getEditorState().read(()=>{m()})},[n,m]),l.useEffect(()=>{r&&t.current&&t.current.focus()},[r]);const w=l.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a);return o.jsx("div",{ref:e,className:"link-editor",children:r?o.jsx("input",{ref:t,className:"link-input",value:a,onChange:c=>{i(c.target.value)},onKeyDown:c=>{c.key==="Enter"?(c.preventDefault(),x!==null&&(a!==""&&n.dispatchCommand(T.TOGGLE_LINK_COMMAND,a),d(!1))):c.key==="Escape"&&(c.preventDefault(),d(!1))}}):o.jsx(o.Fragment,{children:o.jsxs("div",{className:"link-input",children:[w,o.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:c=>c.preventDefault(),onClick:()=>{d(!0)}})]})})})}),Ms=l.memo(({onChange:n,className:e,options:t,value:s})=>o.jsxs("select",{className:e,onChange:n,value:s,children:[o.jsx("option",{hidden:!0,value:""}),t.map(a=>o.jsx("option",{value:a,children:a},a))]}));function ot(n){const e=n.anchor,t=n.focus,s=n.anchor.getNode(),a=n.focus.getNode();return s===a?s:n.isBackward()?O.$isAtNodeEnd(t)?s:a:O.$isAtNodeEnd(e)?a:s}const Os=l.memo(({editor:n,blockType:e,toolbarRef:t,setShowBlockOptionsDropDown:s})=>{const a=l.useRef(null);l.useEffect(()=>{const c=a.current,v=t.current;if(c!==null&&v!==null){const u=y=>{const f=y.target;!c.contains(f)&&!v.contains(f)&&s(!1)};return document.addEventListener("click",u),()=>{document.removeEventListener("click",u)}}},[a,s,t]);const i=()=>{e!=="paragraph"&&n.update(()=>{const c=N.$getSelection();N.$isRangeSelection(c)&&O.$wrapNodes(c,()=>N.$createParagraphNode())}),s(!1)},r=()=>{e!=="h1"&&n.update(()=>{const c=N.$getSelection();N.$isRangeSelection(c)&&O.$wrapNodes(c,()=>z.$createHeadingNode("h1"))}),s(!1)},d=()=>{e!=="h2"&&n.update(()=>{const c=N.$getSelection();N.$isRangeSelection(c)&&O.$wrapNodes(c,()=>z.$createHeadingNode("h2"))}),s(!1)},x=()=>{e!=="ul"?n.dispatchCommand(L.INSERT_UNORDERED_LIST_COMMAND,void 0):n.dispatchCommand(L.REMOVE_LIST_COMMAND,void 0),s(!1)},b=()=>{e!=="ol"?n.dispatchCommand(L.INSERT_ORDERED_LIST_COMMAND,void 0):n.dispatchCommand(L.REMOVE_LIST_COMMAND,void 0),s(!1)},m=()=>{e!=="quote"&&n.update(()=>{const c=N.$getSelection();N.$isRangeSelection(c)&&O.$wrapNodes(c,()=>z.$createQuoteNode())}),s(!1)},w=()=>{e!=="code"&&n.update(()=>{const c=N.$getSelection();N.$isRangeSelection(c)&&O.$wrapNodes(c,()=>A.$createCodeNode())}),s(!1)};return o.jsxs("div",{className:"dropdown",ref:a,children:[o.jsxs("button",{className:"item",onClick:i,children:[o.jsx(We,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Normal"}),e==="paragraph"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:r,children:[o.jsx(Je,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Large Heading"}),e==="h1"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:d,children:[o.jsx(Xe,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Small Heading"}),e==="h2"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:x,children:[o.jsx(Ke,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Bullet List"}),e==="ul"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:b,children:[o.jsx(Ge,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Numbered List"}),e==="ol"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:m,children:[o.jsx(Ze,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Quote"}),e==="quote"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:w,children:[o.jsx(Ce,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Code Block"}),e==="code"&&o.jsx("span",{className:"active"})]})]})}),nt=l.memo(()=>{const[n]=Se.useLexicalComposerContext(),e=l.useRef(null),[t,s]=l.useState(!1),[a,i]=l.useState(!1),[r,d]=l.useState("paragraph"),[x,b]=l.useState(null),[m,w]=l.useState(!1),[c,v]=l.useState(""),[u,y]=l.useState(!1),[f,h]=l.useState(!1),[g,p]=l.useState(!1),[I,be]=l.useState(!1),[_,_e]=l.useState(!1),[k,E]=l.useState(!1),[$,ht]=l.useState(!1),je=l.useCallback(()=>{const j=N.$getSelection();if(N.$isRangeSelection(j)){const C=j.anchor.getNode(),M=C.getKey()==="root"?C:C.getTopLevelElementOrThrow(),Pe=M.getKey();if(n.getElementByKey(Pe)!==null)if(b(Pe),L.$isListNode(M)){const we=ke.$getNearestNodeOfType(C,L.ListNode),wt=we?we.getTag():M.getTag();d(wt)}else{const we=z.$isHeadingNode(M)?M.getTag():M.getType();d(we),A.$isCodeNode(M)&&v(M.getLanguage()||A.getDefaultCodeLanguage())}p(j.hasFormat("bold")),be(j.hasFormat("italic")),_e(j.hasFormat("underline")),E(j.hasFormat("strikethrough")),ht(j.hasFormat("code")),y(O.$isParentElementRTL(j));const $e=ot(j),_t=$e.getParent();T.$isLinkNode(_t)||T.$isLinkNode($e)?h(!0):h(!1)}},[n]);l.useEffect(()=>ke.mergeRegister(n.registerUpdateListener(({editorState:j})=>{j.read(()=>{je()})}),n.registerCommand(N.SELECTION_CHANGE_COMMAND,(j,C)=>(je(),!1),ve),n.registerCommand(N.CAN_UNDO_COMMAND,j=>(s(j),!1),ve),n.registerCommand(N.CAN_REDO_COMMAND,j=>(i(j),!1),ve)),[n,je]);const ft=l.useMemo(()=>A.getCodeLanguages(),[]),gt=l.useCallback(j=>{n.update(()=>{if(x!==null){const C=N.$getNodeByKey(x);A.$isCodeNode(C)&&C.setLanguage(j.target.value)}})},[n,x]),yt=l.useCallback(()=>{f?n.dispatchCommand(T.TOGGLE_LINK_COMMAND,null):n.dispatchCommand(T.TOGGLE_LINK_COMMAND,"https://")},[n,f]),[xt,bt]=l.useState(null);return l.useEffect(()=>{const j=document.getElementsByClassName("editor-container")[0],C=document.createElement("div");return j.prepend(C),bt(C),()=>{j.removeChild(C)}},[]),o.jsxs("div",{className:"toolbar",ref:e,children:[o.jsx("button",{disabled:!t,onClick:()=>{n.dispatchCommand(N.UNDO_COMMAND,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:o.jsx(St,{className:"format",size:20})}),o.jsx("button",{disabled:!a,onClick:()=>{n.dispatchCommand(N.REDO_COMMAND,void 0)},className:"toolbar-item","aria-label":"Redo",children:o.jsx(jt,{className:"format",size:20})}),o.jsx(qe,{}),Rs.has(r)&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"toolbar-item block-controls",onClick:()=>w(!m),"aria-label":"Formatting Options",children:[r==="h1"?o.jsx(Je,{className:"icon",size:20}):r==="h2"?o.jsx(Xe,{className:"icon",size:20}):r==="h3"?o.jsx(It,{className:"icon",size:20}):r==="h4"?o.jsx(Et,{className:"icon",size:20}):r==="h5"?o.jsx(kt,{className:"icon",size:20}):r==="code"?o.jsx(Ce,{className:"icon",size:20}):r==="paragraph"?o.jsx(We,{className:"icon",size:20}):r==="ol"?o.jsx(Ge,{className:"icon",size:20}):r==="ul"?o.jsx(Ke,{className:"icon",size:20}):r==="quote"?o.jsx(Ze,{className:"icon",size:20}):o.jsx(o.Fragment,{}),o.jsx("span",{className:"text",children:Ds[r]}),o.jsx(Ye,{size:20})]}),m&&Ue.createPortal(o.jsx(Os,{editor:n,blockType:r,toolbarRef:e,setShowBlockOptionsDropDown:w}),xt),o.jsx(qe,{})]}),r==="code"?o.jsxs(o.Fragment,{children:[o.jsx(Ms,{className:"toolbar-item code-language",onChange:gt,options:ft,value:c}),o.jsx("i",{className:"chevron-down inside"})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{n.dispatchCommand(N.FORMAT_TEXT_COMMAND,"bold")},className:"toolbar-item spaced "+(g?"active":""),"aria-label":"Format Bold",children:o.jsx(Ct,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(N.FORMAT_TEXT_COMMAND,"italic")},className:"toolbar-item spaced "+(I?"active":""),"aria-label":"Format Italics",children:o.jsx(Rt,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(N.FORMAT_TEXT_COMMAND,"underline")},className:"toolbar-item spaced "+(_?"active":""),"aria-label":"Format Underline",children:o.jsx(Dt,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(N.FORMAT_TEXT_COMMAND,"strikethrough")},className:"toolbar-item spaced "+(k?"active":""),"aria-label":"Format Strikethrough",children:o.jsx(Tt,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(N.FORMAT_TEXT_COMMAND,"code")},className:"toolbar-item spaced "+($?"active":""),"aria-label":"Insert Code",children:o.jsx(Ce,{className:"format",size:20})}),o.jsx("button",{onClick:yt,className:"toolbar-item spaced "+(f?"active":""),"aria-label":"Insert Link",children:o.jsx(Mt,{className:"format",size:20})}),f&&Ue.createPortal(o.jsx(Ts,{editor:n}),document.body)," "]})]})});nt.__docgenInfo={description:"",methods:[],displayName:"ToolbarPlugin"};function Ls(){const[n]=Se.useLexicalComposerContext();return l.useEffect(()=>A.registerCodeHighlighting(n),[n]),null}const As={ltr:"ltr",rtl:"rtl",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough",code:"editor-text-code"},code:"editor-code",codeHighlight:{atrule:"editor-tokenAttr",attr:"editor-tokenAttr",boolean:"editor-tokenProperty",builtin:"editor-tokenSelector",cdata:"editor-tokenComment",char:"editor-tokenSelector",class:"editor-tokenFunction","class-name":"editor-tokenFunction",comment:"editor-tokenComment",constant:"editor-tokenProperty",deleted:"editor-tokenProperty",doctype:"editor-tokenComment",entity:"editor-tokenOperator",function:"editor-tokenFunction",important:"editor-tokenVariable",inserted:"editor-tokenSelector",keyword:"editor-tokenAttr",namespace:"editor-tokenVariable",number:"editor-tokenProperty",operator:"editor-tokenOperator",prolog:"editor-tokenComment",property:"editor-tokenProperty",punctuation:"editor-tokenPunctuation",regex:"editor-tokenVariable",selector:"editor-tokenSelector",string:"editor-tokenSelector",symbol:"editor-tokenProperty",tag:"editor-tokenProperty",url:"editor-tokenOperator",variable:"editor-tokenVariable"}};function Ps(n){return n.op==="SYNC"}function $s(n){return n.op==="INSERT"}function Us(n){return n.op==="INVALIDATE"}function zs(n){return n.op==="DELETE"}function qs(n){return n.type==="m.room.message"&&n.content.msgtype==="m.text"}function Hs(n){return n.type==="m.room.message"&&n.content.msgtype==="m.image"}function Fe(n){return n.state_key!==void 0}function Fs(n){return n.type==="m.room.create"}function Bs(n){return n.type==="m.room.avatar"}function Vs(n){return n.type==="m.space.child"}function Ws(n){return n.type==="m.space.parent"}function Js(n){return n.type==="m.room.topic"}class U extends Qe{constructor(e,t,s){super(),this.roomID=e,this.hostname=t,this.client=s}events=[];stateEvents=[];name;notification_count=0;notification_highlight_count=0;joined_count=0;invited_count=0;is_dm=!1;windowPos={};addEvents(e){e.forEach(t=>{this.events.push(t)}),this.emit("events",this.events)}addStateEvents(e){e.forEach(t=>{const s=this.stateEvents.findIndex(a=>a.state_key===t.state_key&&a.type===t.type);s!==-1?this.stateEvents[s]=t:this.stateEvents.push(t)}),this.emit("state_events",this.stateEvents)}getStateEvents(){return this.stateEvents}getAvatarURL(){let e;return this.stateEvents.forEach(t=>{if(Bs(t)){const s=t.content.url;s?.startsWith("mxc://")&&(e=this.client.convertMXC(s))}}),e}isSpace(){let e=!1;return this.stateEvents.forEach(t=>{Fs(t)&&(e=t.content.type==="m.space")}),e}setName(e){this.name=e}getName(){return this.name?this.name:this.roomID}getTopic(){let e;return this.stateEvents.forEach(t=>{Js(t)&&(e=t.content.topic)}),e}setNotificationCount(e){this.notification_count=e}getNotificationCount(){return this.notification_count}setNotificationHighlightCount(e){this.notification_highlight_count=e}getNotificationHighlightCount(){return this.notification_highlight_count}setJoinedCount(e){this.joined_count=e}getJoinedCount(){return this.joined_count}setInvitedCount(e){this.invited_count=e}getInvitedCount(){return this.invited_count}getSpaceChildrenIDs(){const e=[];return this.stateEvents.forEach(t=>{Vs(t)&&e.push(t.state_key)}),e}getSpaceParentIDs(){const e=[];return this.stateEvents.forEach(t=>{Ws(t)&&e.push({roomID:t.state_key,canonical:t.content.canonical||!1})}),e}setDM(e){this.is_dm=e}isDM(){return this.is_dm}isOnline(){return!1}getEvents(){return this.events}getMemberName(e){let t=e;return this.stateEvents.forEach(s=>{s.type==="m.room.member"&&s.state_key===e&&s.content.membership=="join"&&(t=s.content.displayname)}),t}getMemberAvatar(e){let t;return this.stateEvents.forEach(s=>{if(s.type==="m.room.member"&&s.state_key===e&&s.content.membership=="join"){const a=s.content.avatar_url;a?.startsWith("mxc://")&&(t=this.client.convertMXC(a))}}),t}isEncrypted(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.content.algorithm==="m.megolm.v1.aes-sha2"&&t.state_key===""&&(e=!0)}),e}async sendHtmlMessage(e,t){if(this.isEncrypted()){console.log("Sending encrypted message"),await this.client.shareKeys();const s=await this.client.olmMachine?.encryptRoomEvent(new S.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})),a=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:s});if(!a.ok)throw new Error(`Failed to send message: ${a.status} ${a.statusText}`);return(await a.json()).event_id}else{const s=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})});if(!s.ok)throw new Error(`Failed to send message: ${s.status} ${s.statusText}`);return(await s.json()).event_id}}async sendTextMessage(e){if(this.isEncrypted()){console.log("Sending encrypted message2"),await this.client.shareKeys();const t=await this.client.olmMachine?.encryptRoomEvent(new S.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:e})),s=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:t});if(!s.ok)throw new Error(`Failed to send message: ${s.status} ${s.statusText}`);return(await s.json()).event_id}else{const t=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:e})});if(!t.ok)throw new Error(`Failed to send message: ${t.status} ${t.statusText}`);return(await t.json()).event_id}}getJoinedMemberIDs(){const e=[];return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.content.membership==="join"&&e.push(t.state_key)}),e}getEncryptionSettings(){let e;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.state_key===""&&(e||(e=new S.EncryptionSettings),e.algorithm=t.content.algorithm==="m.megolm.v1.aes-sha2"?S.EncryptionAlgorithm.MegolmV1AesSha2:S.EncryptionAlgorithm.OlmV1Curve25519AesSha2,t.content.rotation_period_ms&&(e.rotationPeriod=BigInt(t.content.rotation_period_ms)),t.content.rotation_period_msgs&&(e.rotationPeriodMessages=BigInt(t.content.rotation_period_msgs))),t.type==="m.room.history_visibility"&&t.state_key===""&&(e||(e=new S.EncryptionSettings),e.historyVisibility=t.content.history_visibility)}),e&&(e.onlyAllowTrustedDevices=!1),e}}function Xs(n){const[e,t]=l.useState(n?.getEvents()||[]);return l.useEffect(()=>{if(n){t(n?.getEvents()||[]);const s=a=>{t([...a])};return n.on("events",s),()=>{n.removeListener("events",s)}}else t([])},[n]),e}class Ks extends Qe{static _instance;access_token;device_id;mxid;hostname;slidingSyncHostname;syncing=!1;roomsInView=[];spaceOpen=[];rooms=new Set;syncPos;initialSync=!0;database;profileInfo;lastRanges;lastTxnID;to_device_since;olmMachine;currentRoom;abortController=new AbortController;mustUpdateTxnID=!0;outgoingRequestsBeingProcessed=!1;missingSessionsBeingRequested=!1;get accessToken(){return this.access_token}get isLoggedIn(){return this.access_token!==void 0}convertMXC(e){return`${this.hostname}/_matrix/media/r0/download/${e.substring(6)}`}setCurrentRoom(e){e!==this.currentRoom&&(this.currentRoom=e,console.log("Current room changed to",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}static async Instance(){let e=this._instance;if(!e){e=this._instance=new this,e.database||await e.createDatabase();const t=e.database?.transaction("loginInfo","readonly"),s=await t?.store.getAll();if(await t?.done,s&&s.length>0){e.mxid=s[0].userId,e.hostname=s[0].hostname,e.slidingSyncHostname=s[0].slidingSyncHostname,e.access_token=s[0].access_token,e.device_id=s[0].device_id,e.profileInfo={avatar_url:s[0].avatarUrl,displayname:s[0].displayName},e.mxid&&e.hostname&&e.access_token&&e.device_id&&(e.olmMachine=await S.OlmMachine.initialize(new S.UserId(e.mxid),new S.DeviceId(e.device_id),"cetirizine-crypto"));const a=e.database?.transaction("syncInfo","readonly"),i=await a?.store.get(e.mxid);await a?.done,i&&(e.syncPos=i.syncPos,e.initialSync=i.initialSync,e.lastRanges=i.lastRanges,e.lastTxnID=i.lastTxnID,e.to_device_since=i.to_device_since);const r=e.database?.transaction("rooms","readonly"),d=await r?.store.getAll();await r?.done,d&&(e.rooms=new Set(d.map(x=>{const b=new U(x.roomID,e.hostname,e);return b.windowPos=x.windowPos,b.setInvitedCount(x.invited_count),b.setJoinedCount(x.joined_count),b.setNotificationCount(x.notification_count),b.setNotificationHighlightCount(x.highlight_count),b.setName(x.name),x.events&&b.addEvents(x.events),x.stateEvents&&b.addStateEvents(x.stateEvents),x.isDM&&b.setDM(x.isDM),b})),e.emit("rooms",e.rooms))}}return e}async createDatabase(){this.database=await Ot("matrix",4,{upgrade(e,t){t<1&&(e.objectStoreNames.contains("rooms")&&e.deleteObjectStore("rooms"),e.objectStoreNames.contains("syncInfo")&&e.deleteObjectStore("syncInfo"),e.createObjectStore("rooms",{keyPath:"roomID"}),e.createObjectStore("loginInfo",{keyPath:"userId"}),e.createObjectStore("syncInfo",{keyPath:"userId"}))}})}async setHostname(e){if(!e.startsWith("https://"))throw Error("Hostname must start with 'https://'");this.database||await this.createDatabase();const t=this.database?.transaction("loginInfo","readwrite");await t?.store.put({userId:this.mxid,hostname:e,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,device_id:this.device_id}),await t?.done,this.hostname=e}async startSync(){if(!this.isLoggedIn)throw Error("Not logged in");if(this.database||await this.createDatabase(),!this.syncing)for(this.syncing=!0;this.syncing;)try{await this.sync()}catch(e){console.error(e)}}stopSync(){this.syncing=!1}isIndexInRange(e,t){for(const s of t)if(s[0]<e&&e<=s[1])return!0;return!1}shiftRight(e,t,s,a){for(let i=s-1;i>a-1;i--)if(this.isIndexInRange(i,t)){const r=[...this.rooms].find(d=>d.windowPos[e]===i+1);r&&(r.windowPos[e]=i)}}shiftLeft(e,t,s,a){for(let i=a+1;i<s+1;i++)if(this.isIndexInRange(i,t)){const r=[...this.rooms].find(d=>d.windowPos[e]===i-1);r&&(r.windowPos[e]=i)}}async removeEntry(e,t,s){let a=-1;const i=[...this.rooms].map(d=>d.windowPos[e]);for(const d in i)Number(d)>a&&(a=Number(d));const r=[...this.rooms].find(d=>d.windowPos[e]===s);if(r){const d=this.database?.transaction("rooms","readwrite");await d?.store.delete(r.roomID),await d?.done,this.rooms.delete(r)}a<0||s>a||this.shiftLeft(e,t,a,s)}addEntry(e,t,s){let a=-1;const i=[...this.rooms].map(r=>r.windowPos[e]);for(const r in i)Number(r)>a&&(a=Number(r));a<0||s>a||this.shiftRight(e,t,a+1,s)}async sendIdentifyAndOneTimeKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.outgoingRequestsBeingProcessed)return;this.outgoingRequestsBeingProcessed=!0;const e=await this.olmMachine.outgoingRequests();for(const t of e)await this.processRequest(t);await this.shareKeys(),this.outgoingRequestsBeingProcessed=!1}async shareKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.missingSessionsBeingRequested)return;this.missingSessionsBeingRequested=!0;const e=[...this.rooms].filter(a=>a.isEncrypted()),t=e.map(a=>a.getJoinedMemberIDs().map(i=>new S.UserId(i))).flat(),s=await this.olmMachine?.getMissingSessions(t);s&&await this.processRequest(s);for(const a of e){const i=a.getEncryptionSettings();if(i){const r=await this.olmMachine.shareRoomKey(new S.RoomId(a.roomID),a.getJoinedMemberIDs().map(d=>new S.UserId(d)),i);for(const d of r)await this.processRequest(d)}}this.missingSessionsBeingRequested=!1}async logout(){this.stopSync(),this.abortController.abort(),this.access_token=void 0,this.device_id=void 0,this.initialSync=!0,this.rooms=new Set,this.slidingSyncHostname=void 0,this.syncPos=void 0,this.to_device_since=void 0,this.outgoingRequestsBeingProcessed=!1,this.missingSessionsBeingRequested=!1;const e=this.database?.transaction("syncInfo","readwrite");await e?.store.delete(this.mxid),await e?.done;const t=this.database?.transaction("loginInfo","readwrite");await t?.store.delete(this.mxid),await t?.done;const s=this.database?.transaction("rooms","readwrite");await s?.store.clear(),await s?.done,await Lt("cetirizine-crypto"),this.mxid=void 0}async processRequest(e){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(e.type===S.RequestType.KeysUpload){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/keys/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to upload keys",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===S.RequestType.KeysQuery){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/keys/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to query keys",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===S.RequestType.KeysClaim){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/keys/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to claim keys",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===S.RequestType.ToDevice){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/sendToDevice/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to send to device",s)),console.log(t),this.olmMachine.markRequestAsSent(t.id??t.txn_id,t.type,await s.text())}else if(e.type===S.RequestType.SignatureUpload){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/keys/signatures/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to upload signatures",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===S.RequestType.RoomMessage){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${t.room_id}/send/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to send message",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===S.RequestType.KeysBackup){const t=e,s=await fetch(`${this.hostname}/_matrix/client/v3/room_keys/keys`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});s.ok||(s.status===401&&(await this.logout(),console.error(s)),console.error("Failed to backup keys",s)),this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}}async sync(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");await this.sendIdentifyAndOneTimeKeys();let e={overview:[[0,50]],spaces:[[0,Number.MAX_SAFE_INTEGER]]};for(const m of this.spaceOpen)m!=="other"&&(e[m]=[[0,50]]);let t=1,s=10;if(!this.initialSync)for(const m in e){t=10,s=50;const w=new Set([...this.rooms].filter(f=>this.roomsInView.includes(f.roomID)).map(f=>f.windowPos[m]).sort());if(w.size===0)continue;w.add([...w][w.size-1]+5);const v=[...w].reduce((f,h,g,p)=>g===0?(f.push([h,h]),f):h===p[g-1]+1?(f[f.length-1][1]=h,f):(f.push([h,h]),f),[]).sort((f,h)=>f[0]-h[0]),u=[];u.push(v[0]);for(let f=1;f<v.length;f++){let h;for(let g=0;g<f;g++)if(u[g].length==v[f].length){h=!1;for(let p=0;p<v[f].length;p++)v[f][p]!=v[g][p]&&(h=!0);if(h==!1)break}h&&u.push(v[f])}const y=u.filter(f=>f.length===2).filter(f=>f[0]!==void 0&&f[1]!==void 0&&f[0]!==null&&f[1]!==null);e[m]=y}this.lastRanges&&Object.entries(e).toString()!==Object.entries(this.lastRanges).toString()&&(console.log("Ranges changed, resetting sync txn_id",e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.lastRanges||(console.log(e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.mustUpdateTxnID&&(this.lastTxnID=Date.now().toString(),this.mustUpdateTxnID=!1);let a=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000`;this.syncPos&&(a=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000&pos=${this.syncPos}`);const i={txn_id:this.lastTxnID,lists:{spaces:{slow_get_all_rooms:!0,sort:["by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{room_types:["m.space"]}},overview:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"]}}},bump_event_types:["m.room.message","m.room.encrypted"],extensions:{e2ee:{enabled:!0},to_device:{enabled:!0,since:this.to_device_since||null}}};for(const m of this.spaceOpen)m!=="other"&&(i.lists||(i.lists={}),i.lists[m]={slow_get_all_rooms:!0,required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{spaces:[m]}});this.currentRoom&&(i.room_subscriptions={},i.room_subscriptions[this.currentRoom]={sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:s,filters:{}});const r=await fetch(a,{method:"POST",signal:this.abortController.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:JSON.stringify(i)});if(!r.ok)if(r.status===400){if((await r.json()).errcode==="M_UNKNOWN_POS"){this.syncPos=void 0;const m=this.database?.transaction("syncInfo","readwrite");await m?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID}),await m?.done}return}else r.status===401&&(await this.logout(),console.error(r),console.error("Error syncing. See console for error."));const d=await r.json();this.syncPos=d.pos,d.extensions?.to_device&&(await this.olmMachine?.receiveSyncChanges(JSON.stringify(d.extensions.to_device.events||[]),new S.DeviceLists(d.extensions.e2ee?.device_lists?.changed?.map(m=>new S.UserId(m)),d.extensions.e2ee?.device_lists?.left?.map(m=>new S.UserId(m))),new Map(Object.entries(d.extensions.e2ee?.device_one_time_keys_count||[])),new Set(d.extensions.e2ee?.device_unused_fallback_key_types)),this.to_device_since=d.extensions.to_device.next_batch),await this.sendIdentifyAndOneTimeKeys();const x=this.database?.transaction("syncInfo","readwrite");await x?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID,to_device_since:this.to_device_since}),await x?.done;let b=-1;for(const m in d.lists){const w=d.lists[m];if(w.ops){for(const c of w.ops)if(Ps(c)){const v=this.database?.transaction("rooms","readwrite");for(let u=c.range[0];u<=c.range[1];u++){const y=c.room_ids[u-c.range[0]];if(!y)break;const f=[...this.rooms].find(g=>g.roomID===y);if(f){f.windowPos[m]=u;continue}const h=new U(y,this.hostname,this);h.setName(y),h.windowPos[m]=u,this.rooms.add(h),await v?.store.put({windowPos:h.windowPos,roomID:h.roomID,name:h.getName(),notification_count:h.getNotificationCount(),highlight_count:h.getNotificationHighlightCount(),joined_count:h.getJoinedCount(),invited_count:h.getInvitedCount(),avatarUrl:h.getAvatarURL(),isSpace:h.isSpace(),isDM:h.isDM(),stateEvents:h.getStateEvents(),events:h.getEvents()})}await v?.done}else if($s(c)){console.log("Got INSERT OP",c),[...this.rooms].find(g=>g.windowPos[m]===c.index)&&(b<0?this.addEntry(m,this.lastRanges[m],c.index):b>c.index?this.shiftRight(m,this.lastRanges[m],b,c.index):b<c.index&&this.shiftLeft(m,this.lastRanges[m],c.index,b)),b=-1;const u=this.database?.transaction("rooms","readwrite"),y=[...this.rooms].find(g=>g.roomID===c.room_id);if(y)y.windowPos[m]=c.index,await u?.store.put({windowPos:y.windowPos,roomID:y.roomID,name:y.getName(),notification_count:y.getNotificationCount(),highlight_count:y.getNotificationHighlightCount(),joined_count:y.getJoinedCount(),invited_count:y.getInvitedCount(),avatarUrl:y.getAvatarURL(),isSpace:y.isSpace(),isDM:y.isDM(),stateEvents:y.getStateEvents(),events:y.getEvents()});else{const g=await u?.store.get(c.room_id);let p=new U(c.room_id,this.hostname,this);p.setName(c.room_id),p.windowPos[m]=c.index,g&&(console.warn("Room in db but not in obj list.",c.room_id,"Updating obj list."),p=new U(c.room_id,this.hostname,this),p.setName(g.name),p.setNotificationCount(g.notification_count),p.setNotificationHighlightCount(g.highlight_count),p.setJoinedCount(g.joined_count),p.setInvitedCount(g.invited_count),p.setDM(g.isDM||!1)),this.rooms.add(p),await u?.store.put({windowPos:p.windowPos,roomID:p.roomID,name:p.getName(),notification_count:p.getNotificationCount(),highlight_count:p.getNotificationHighlightCount(),joined_count:p.getJoinedCount(),invited_count:p.getInvitedCount(),avatarUrl:p.getAvatarURL(),isSpace:p.isSpace(),isDM:p.isDM(),stateEvents:p.getStateEvents(),events:p.getEvents()})}const f=[...this.rooms].map(g=>g.roomID),h=f.filter((g,p)=>f.indexOf(g)!=p);h.length>0&&console.error("Duplicates found",h),await u?.done}else if(zs(c))console.log("Got DELETE OP",c),b!==-1&&await this.removeEntry(m,this.lastRanges[m],b),b=c.index;else if(Us(c)){const v=this.database?.transaction("rooms","readwrite");for(let u=c.range[0];u<=c.range[1];u++){const y=[...this.rooms].find(f=>f.windowPos[m]===u);y&&(await v?.store.delete(y.roomID),this.rooms.delete(y))}await v?.done}b!==-1&&await this.removeEntry(m,this.lastRanges[m],b)}}for(const m in d.rooms){const w=d.rooms[m],c=w.name,v=w.notification_count,u=w.highlight_count,y=w.joined_count,f=w.invited_count,h=w.timeline,g=h?.filter(k=>Fe(k)).map(k=>k),p=h?.filter(k=>!Fe(k)).map(k=>k),I=w.required_state,be=w.is_dm;let _=[...this.rooms].find(k=>k.roomID===m);if(!_){console.warn("Could not find roomObj for roomID:",m);const k=this.database?.transaction("rooms","readwrite"),E=await k?.store.get(m);await k?.done,E?(console.warn("Room in db but not in obj list.",m,"Updating obj list."),_=new U(m,this.hostname,this),_.setName(E.name),_.setNotificationCount(E.notification_count),_.setNotificationHighlightCount(E.highlight_count),_.setJoinedCount(E.joined_count),_.setInvitedCount(E.invited_count),_.setDM(E.isDM||!1),E.events&&_.addEvents(E.events),E.stateEvents&&_.addStateEvents(E.stateEvents),_.windowPos=E.windowPos):(console.warn("Could not find room in db. Creating new one."),_=new U(m,this.hostname,this),this.rooms.add(_))}if(c&&_.setName(c),_.setNotificationCount(v),_.setNotificationHighlightCount(u),_.setJoinedCount(y),_.setInvitedCount(f),p&&_.addEvents(p),I&&_.addStateEvents(I),g&&_.addStateEvents(g),(I||g)&&_.isEncrypted()){const E=[...I||[],...g||[]].filter($=>$.type==="m.room.member"&&$.content.membership==="join").map($=>new S.UserId($.state_key));await this.olmMachine?.updateTrackedUsers(E)}be&&_.setDM(be);const _e=this.database?.transaction("rooms","readwrite");await _e?.store.put({windowPos:_.windowPos,roomID:_.roomID,name:_.getName(),notification_count:_.getNotificationCount(),highlight_count:_.getNotificationHighlightCount(),joined_count:_.getJoinedCount(),invited_count:_.getInvitedCount(),events:_.getEvents(),stateEvents:_.getStateEvents(),avatarUrl:_.getAvatarURL(),isSpace:_.isSpace(),isDM:_.isDM()}),await _e?.done}this.initialSync&&(this.initialSync=!1,console.log("initialSyncComplete")),d.rooms&&Object.keys(d.rooms).length>0&&this.emit("rooms",this.rooms)}addInViewRoom(e){this.roomsInView.push(e)}removeInViewRoom(e){this.roomsInView=this.roomsInView.filter(t=>t!==e)}addSpaceOpen(e){e!=="other"&&(this.spaceOpen.push(e),console.log("Space opened",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}removeSpaceOpen(e){e!=="other"&&(this.spaceOpen=this.spaceOpen.filter(t=>t!==e),this.mustUpdateTxnID=!0)}getRooms(){return this.rooms}getSpaces(){return[...this.rooms].filter(e=>e.isSpace()).sort((e,t)=>e.getName()<t.getName()?-1:e.getName()>t.getName()?1:0)}getSpacesWithRooms(){const e=this.getSpaces(),t=new Set;for(const s of e){const a=s.getSpaceChildrenIDs(),i=new Set([...this.getRooms()].filter(r=>a.includes(r.roomID)));t.add({spaceRoom:s,children:i})}for(const s of this.getRooms()){const a=s.getSpaceParentIDs();for(const i of a){const r=[...this.getRooms()].find(x=>x.roomID===i.roomID);if(!r)continue;const d=[...t].find(x=>x.spaceRoom.roomID===r.roomID);if(d){[...d.children].find(x=>x.roomID===s.roomID)||d.children.add(s);continue}t.add({spaceRoom:r,children:new Set([s])})}}return t}async getLoginFlows(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/login`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async getWellKnown(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/.well-known/matrix/client`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async passwordLogin(e,t,s=5){if(this.database||await this.createDatabase(),!e)throw Error("Username must be set");if(!t)throw Error("Password must be set");this.mxid=e,await this.setHostname(`https://${e.split(":")[1]}`);try{const d=await this.getWellKnown();if(d["m.homeserver"]?.base_url&&await this.setHostname(d["m.homeserver"].base_url),d["org.matrix.msc3575.proxy"]?.url){const x=this.database?.transaction("loginInfo","readwrite");await x?.store.put({userId:this.mxid,hostname:this.hostname,slidingSyncHostname:d["org.matrix.msc3575.proxy"].url,access_token:this.access_token,device_id:this.device_id}),await x?.done,this.slidingSyncHostname=d["org.matrix.msc3575.proxy"].url}else throw Error("No sliding sync proxy found")}catch(d){console.warn(`No well-known found for ${this.hostname}:
${d}`)}if(((await this.getLoginFlows()).flows.filter(d=>d.type==="m.login.password")?.length||0)==0)throw Error("Password login is not supported by this homeserver");const i=await fetch(`${this.hostname}/_matrix/client/r0/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"m.login.password",identifier:{type:"m.id.user",user:e},user:e,password:t})});if(!i.ok)throw console.error(i),Error("Error logging in. See console for error.");const r=await i.json();if(Ys(r))throw Error(`Error logging in: ${r.errcode}: ${r.error}`);if(Gs(r)&&(console.error(`Rate limited. Retrying in ${r.retry_after_ms}ms. ${s} tries left.`),await this.passwordLogin(e,t,s-1)),Zs(r)){const d=this.database?.transaction("loginInfo","readwrite");await d?.store.put({userId:r.user_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:r.access_token,device_id:r.device_id}),await d?.done,this.access_token=r.access_token,this.device_id=r.device_id,this.mxid=r.user_id,this.olmMachine=await S.OlmMachine.initialize(new S.UserId(this.mxid),new S.DeviceId(this.device_id),"cetirizine-crypto")}}async fetchProfileInfo(e){if(this.profileInfo)return this.profileInfo;if(!this.hostname)throw Error("Hostname must be set first");if(this.database||await this.createDatabase(),!this.access_token)throw Error("Access token must be set first");const t=await fetch(`${this.hostname}/_matrix/client/r0/profile/${e}`,{headers:{Authorization:`Bearer ${this.access_token}`}});if(!t.ok){if(t.status===404||t.status===403)return{};throw console.error(t),Error("Error fetching profile info. See console for error.")}const s=await t.json();s.avatar_url=s.avatar_url?.replace("mxc://",`${this.hostname}/_matrix/media/r0/download/`),this.profileInfo=s;const a=this.database?.transaction("loginInfo","readwrite");return await a?.store.put({userId:this.mxid,device_id:this.device_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,displayName:s.displayname,avatarUrl:s.avatar_url}),await a?.done,s}}function Gs(n){return n.retry_after_ms!==void 0}function Zs(n){return n.access_token!==void 0}function Ys(n){return n.errcode!==void 0}const Qs=await Ks.Instance(),D=l.createContext(Qs);function eo(){const n=l.useContext(D),[e,t]=l.useState(n.getRooms());return l.useEffect(()=>{const s=a=>{t(a)};return n.on("rooms",s),n.startSync(),()=>{n.removeListener("rooms",s)}},[]),e}function q(n){return[...l.useContext(D).getRooms()].find(t=>t.roomID===n)}function to(){const n=l.useContext(D),[e,t]=l.useState(n.getSpacesWithRooms());return l.useEffect(()=>{const s=a=>{t(n.getSpacesWithRooms())};return n.on("rooms",s),n.startSync(),()=>{n.removeListener("rooms",s)}},[]),e}function so(){const n=l.useContext(D),[e,t]=l.useState({displayname:n.mxid||"Unknown"});return l.useEffect(()=>{n.fetchProfileInfo(n.mxid).then(s=>{s.displayname||(s.displayname=n.mxid||"Unknown"),t(s)})},[]),e}function oo(){return o.jsx("div",{className:"editor-placeholder",id:"editor-placeholder",children:"Enter message..."})}const no=l.memo(({roomID:n,htmlMessage:e,plainMessage:t})=>{const s=q(n||""),[a]=Se.useLexicalComposerContext();return o.jsx(At,{size:45,stroke:"unset",className:"stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer",onClick:async()=>{if(s&&(console.log("Sending message to: ",n),!(e===""&&t==="")))if(e!=='<p class="editor-paragraph"><br></p>')try{await s.sendHtmlMessage(e,t),a.dispatchCommand(N.CLEAR_EDITOR_COMMAND,void 0),localStorage.removeItem(`editor-${n}`)}catch(i){console.log(i)}else try{await s.sendTextMessage(t),a.dispatchCommand(N.CLEAR_EDITOR_COMMAND,void 0),localStorage.removeItem(`editor-${n}`)}catch(i){console.log(i)}}})}),ao=({roomID:n})=>{const[e]=Se.useLexicalComposerContext(),{pathname:t}=et(),[s,a]=l.useState(void 0);return l.useEffect(()=>{if(n){if(n!==s){console.log("Saving editor state");const r=e.getEditorState();localStorage.setItem(`editor-${s}`,JSON.stringify(r.toJSON()))}a(n);const i=localStorage.getItem(`editor-${n}`);if(i){const r=e.parseEditorState(i);e.setEditorState(r)}else e.dispatchCommand(N.CLEAR_EDITOR_COMMAND,void 0)}},[t,n]),o.jsx(o.Fragment,{})},Oe=l.memo(({namespace:n,roomID:e})=>{const[t,s]=l.useState(""),[a,i]=l.useState(""),r={namespace:n,theme:As,onError:d=>console.error(d),nodes:[z.HeadingNode,L.ListNode,L.ListItemNode,z.QuoteNode,A.CodeNode,A.CodeHighlightNode,Ee.TableNode,Ee.TableCellNode,Ee.TableRowNode,T.AutoLinkNode,T.LinkNode]};return o.jsx("div",{className:"flex flex-row items-end",children:o.jsxs(Pt.LexicalComposer,{initialConfig:r,children:[o.jsxs("div",{className:"editor-container flex-1",children:[o.jsx(nt,{}),o.jsxs("div",{className:"editor-inner",children:[o.jsx($t.RichTextPlugin,{contentEditable:o.jsx(Ut.ContentEditable,{className:"editor-input",ariaLabelledBy:"editor-placeholder"}),placeholder:o.jsx(oo,{}),ErrorBoundary:zt}),o.jsx(qt.OnChangePlugin,{onChange:(d,x)=>{d.read(()=>{const b=Ht.$generateHtmlFromNodes(x);s(b);const m=Ie.$convertToMarkdownString(Ie.TRANSFORMERS);i(m)})}}),o.jsx(Ft.HistoryPlugin,{}),o.jsx(Bt.LinkPlugin,{}),o.jsx(Ls,{}),o.jsx(st,{}),o.jsx(Vt.MarkdownShortcutPlugin,{transformers:Ie.TRANSFORMERS}),o.jsx(Wt.ClearEditorPlugin,{}),o.jsx(ao,{roomID:e})]})]}),o.jsx(no,{roomID:e,htmlMessage:t,plainMessage:a})]})})});Oe.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{namespace:{required:!0,tsType:{name:"string"},description:"The Namespace"},roomID:{required:!1,tsType:{name:"string"},description:"The current Room"}}};const ro={title:"Chat/Input",tags:["autodocs"],component:Oe,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{namespace:{required:!0,name:"Namespace",description:"The Namespace of the editor."}}},oe={args:{namespace:"Editor"}};oe.parameters={...oe.parameters,docs:{...oe.parameters?.docs,source:{originalSource:`{
  args: {
    namespace: "Editor"
  }
}`,...oe.parameters?.docs?.source}}};const io=["Default"],co=Object.freeze(Object.defineProperty({__proto__:null,Default:oe,__namedExportsOrder:io,default:ro},Symbol.toStringTag,{value:"Module"})),Le=l.memo(({roomId:n,avatarUrl:e,displayname:t,dm:s=!1,online:a=!1,active:i=!1,onClick:r,hidden:d})=>{const x=l.useContext(D),{ref:b,inView:m}=Jt({triggerOnce:!0,rootMargin:"200px 0px",skip:d,onChange(w){w?x.addInViewRoom(n):x.removeInViewRoom(n)}});return o.jsx("div",{ref:b,onClick:r,className:"w-full cursor-pointer",children:m&&(i?o.jsxs("div",{className:"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(R,{avatarUrl:e,displayname:t,dm:s,online:a}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}):o.jsxs("div",{className:"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(R,{avatarUrl:e,displayname:t,dm:s,online:a}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}))})});Le.__docgenInfo={description:"",methods:[],displayName:"RoomListItem",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},active:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the current room is selected"},roomId:{required:!0,tsType:{name:"string"},description:"Room id"},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the room list item"},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The onClick handler"},hidden:{required:!0,tsType:{name:"boolean"},description:"If room is hidden"}}};const lo=l.memo(({sectionID:n,rooms:e,onClick:t,activeRoom:s,hidden:a})=>{const i=e.map(r=>o.jsx(Le,{roomId:r.roomID,hidden:a,avatarUrl:r.avatarUrl,displayname:r.displayname,dm:r.dm,online:r.online,active:r.roomID===s,onClick:()=>{t(r.roomID)}},`${r.roomID}+${n}`));return o.jsx(o.Fragment,{children:i})}),Re=l.memo(({section:n,onRoomClick:e,activeRoom:t})=>{const[s,a]=l.useState(!0),i=l.useContext(D);return s?i.removeSpaceOpen(n.roomID):i.addSpaceOpen(n.roomID),o.jsxs("div",{className:"flex flex-col gap-1 pl-4 select-none",children:[o.jsxs("div",{className:"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600",onClick:()=>a(r=>!r),children:[s?o.jsx(Xt,{size:14}):o.jsx(Ye,{size:14}),o.jsx("span",{className:"font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:n.sectionName})]}),!s&&o.jsx(lo,{hidden:s,sectionID:n.roomID,rooms:n.rooms,onClick:e,activeRoom:t}),!s&&n.subsections.map(r=>o.jsx(Re,{section:r,onRoomClick:e,activeRoom:t},r.roomID))]},n.roomID)}),Ae=l.memo(({sections:n,rooms:e})=>{const[t,s]=l.useState(void 0),a=Kt();return o.jsxs("div",{className:"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]",children:[n.map(i=>o.jsx(Re,{section:i,onRoomClick:r=>{s(r),a(`/${encodeURIComponent(r)}`)},activeRoom:t},i.roomID)),o.jsx(Re,{section:{sectionName:"Others",roomID:"other",subsections:[],rooms:e},onRoomClick:i=>{s(i),a(`/${encodeURIComponent(i)}`)},activeRoom:t})]})});Ae.__docgenInfo={description:"",methods:[],displayName:"RoomList",props:{sections:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * Section Name. Can be a Space or a Tag
     */
    sectionName: string
    /**
     * The Rooms within the Section
     */
    rooms: Room[]
    /**
     * The Subsections of the Section
     */
    subsections: Section[]
    /**
     * The roomid of the Space
     */
    roomID: string
}`,signature:{properties:[{key:"sectionName",value:{name:"string",required:!0}},{key:"rooms",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]",required:!0}},{key:"subsections",value:{name:"Array",elements:[{name:"Section"}],raw:"Section[]",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Section[]"},description:"The Sections available"},rooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections"}}};const mo={title:"Chat/RoomList",tags:["autodocs"],component:Ae,decorators:[tt],parameters:{badges:[P.EXPERIMENTAL]},argTypes:{sections:{required:!0,defaultValue:[],name:"Sections",description:"The Sections available"},rooms:{required:!0,defaultValue:[],name:"Rooms",description:"Rooms outside of any Sections"}}},ne={args:{rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0},{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],sections:[{sectionName:"Test Section",rooms:[{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],roomID:"12",subsections:[{sectionName:"Test Subsection",rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}],roomID:"14",subsections:[]}]}]}};ne.parameters={...ne.parameters,docs:{...ne.parameters?.docs,source:{originalSource:`{
  args: {
    rooms: [{
      roomID: "1",
      displayname: "test",
      avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
      dm: true,
      online: true
    }, {
      roomID: "2",
      displayname: "test1",
      dm: false,
      online: false
    }, {
      roomID: "3",
      displayname: "test2",
      dm: false,
      online: false
    }],
    sections: [{
      sectionName: "Test Section",
      rooms: [{
        roomID: "2",
        displayname: "test1",
        dm: false,
        online: false
      }, {
        roomID: "3",
        displayname: "test2",
        dm: false,
        online: false
      }],
      roomID: "12",
      subsections: [{
        sectionName: "Test Subsection",
        rooms: [{
          roomID: "1",
          displayname: "test",
          avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
          dm: true,
          online: true
        }],
        roomID: "14",
        subsections: []
      }]
    }]
  }
}`,...ne.parameters?.docs?.source}}};const uo=["RootList"],po=Object.freeze(Object.defineProperty({__proto__:null,RootList:ne,__namedExportsOrder:uo,default:mo},Symbol.toStringTag,{value:"Module"})),ho={title:"Chat/RoomList/Item",tags:["autodocs"],component:Le,parameters:{badges:[P.EXPERIMENTAL]},argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"Displayname",description:"The displayname of the Room"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the room is a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"},active:{required:!1,defaultValue:!1,control:"boolean",name:"Active",description:"Wether the room is currently selected"}}},ae={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!1}},re={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!0}},ie={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!1}},ce={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!0}},le={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!1}},de={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!0}},me={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!1}},ue={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!0}},pe={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1,active:!1}},he={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0,active:!1}};ae.parameters={...ae.parameters,docs:{...ae.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: false
  }
}`,...ae.parameters?.docs?.source}}};re.parameters={...re.parameters,docs:{...re.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: true
  }
}`,...re.parameters?.docs?.source}}};ie.parameters={...ie.parameters,docs:{...ie.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: false
  }
}`,...ie.parameters?.docs?.source}}};ce.parameters={...ce.parameters,docs:{...ce.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: true
  }
}`,...ce.parameters?.docs?.source}}};le.parameters={...le.parameters,docs:{...le.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: false
  }
}`,...le.parameters?.docs?.source}}};de.parameters={...de.parameters,docs:{...de.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: true
  }
}`,...de.parameters?.docs?.source}}};me.parameters={...me.parameters,docs:{...me.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: false
  }
}`,...me.parameters?.docs?.source}}};ue.parameters={...ue.parameters,docs:{...ue.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: true
  }
}`,...ue.parameters?.docs?.source}}};pe.parameters={...pe.parameters,docs:{...pe.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false,
    active: false
  }
}`,...pe.parameters?.docs?.source}}};he.parameters={...he.parameters,docs:{...he.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true,
    active: false
  }
}`,...he.parameters?.docs?.source}}};const fo=["Fallback","FallbackActive","Image","ImageActive","DMOffline","DMOfflineActive","DMOnline","DMOnlineActive","DMNoAvatarOffline","DMNoAvatarOnline"],go=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:pe,DMNoAvatarOnline:he,DMOffline:le,DMOfflineActive:de,DMOnline:me,DMOnlineActive:ue,Fallback:ae,FallbackActive:re,Image:ie,ImageActive:ce,__namedExportsOrder:fo,default:ho},Symbol.toStringTag,{value:"Module"}));function yo(n={}){const{wrapper:e}=Object.assign({},ze(),n.components);return e?o.jsx(e,{...n,children:o.jsx(t,{})}):t();function t(){const s=Object.assign({h1:"h1",p:"p"},ze(),n.components);return o.jsxs(o.Fragment,{children:[o.jsx(Gt,{title:"Introduction/Welcome"}),`
`,o.jsx(s.h1,{id:"about-cetirizine",children:"About Cetirizine"}),`
`,o.jsx(s.p,{children:"Welcome to the Cetirizine Design System!"}),`
`,o.jsx(s.p,{children:`This storybook design system describes in depth the components used within the
Cetirizine Matrix Client.`}),`
`,o.jsx(s.p,{children:`The Design heavily leans on the Tailwindcss Design System. However there are speciic
components for some things and Pages are also documented.`})]})}}const at=()=>{throw new Error("Docs-only story")};at.parameters={docsOnly:!0};const xe={title:"Introduction/Welcome",tags:["stories-mdx"],includeStories:["__page"]};xe.parameters=xe.parameters||{};xe.parameters.docs={...xe.parameters.docs||{},page:yo};const xo=["__page"],bo=Object.freeze(Object.defineProperty({__proto__:null,__namedExportsOrder:xo,__page:at,default:xe},Symbol.toStringTag,{value:"Module"}));const rt=l.memo(()=>{const n=l.useContext(D),[e,t]=l.useState(!1),[s,a]=l.useState(""),[i,r]=l.useState(""),[d,x]=l.useState("");if(n.isLoggedIn)return o.jsx(Zt,{to:"/"});const b=async()=>{try{t(!0),await n.passwordLogin(i,d)}catch(m){a(m.toString())}t(!1)};return o.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:m=>{m.preventDefault(),b()},children:[o.jsx(Me,{children:"Login"}),s?o.jsx("h2",{className:"text-red-500 font-normal text-sm",children:s}):o.jsx("div",{className:"min-h-[1.25rem]"}),o.jsx(Ne,{readonly:e,value:i,placeholder:"Username",onChange:m=>r(m.target.value)}),o.jsx(Ne,{readonly:e,value:d,password:!0,placeholder:"Password",onChange:m=>x(m.target.value)}),o.jsx(Te,{readonly:e,style:"primary",type:"submit",children:"Login"})]})});rt.__docgenInfo={description:"",methods:[],displayName:"Login"};const it=l.memo(()=>o.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:o.jsx(rt,{})}));it.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const _o={title:"Pages/LoginPage",tags:["autodocs"],component:it},fe={};fe.parameters={...fe.parameters,docs:{...fe.parameters?.docs,source:{originalSource:"{}",...fe.parameters?.docs?.source}}};const wo=["Default"],vo=Object.freeze(Object.defineProperty({__proto__:null,Default:fe,__namedExportsOrder:wo,default:_o},Symbol.toStringTag,{value:"Module"}));const Be={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},ct=l.memo(({event:n,roomID:e,hasPreviousEvent:t})=>{const s=q(e),a=l.useContext(D);return(r=>{if(qs(r))if(r.content.format==="org.matrix.custom.html"){const d=Yt.sanitize(r.content.formatted_body,{ADD_TAGS:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","caption","pre","span","img","details","summary"]});return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),o.jsx("p",{className:"whitespace-normal text-black text-base font-normal",dangerouslySetInnerHTML:{__html:d}})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),o.jsx(ye,{options:Be,as:"p",className:"whitespace-normal text-black text-base font-normal",children:r.content.body})]})]});else if(Hs(r)){const[d,x]=l.useState(void 0);return l.useEffect(()=>{r.content.url&&x(a.convertMXC(r.content.url))},[r.content.url]),o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),o.jsx("img",{src:d,alt:r.content.body,title:r.content.body,className:"rounded-md object-cover border-slate-400 border-2 max-h-[512px] max-w-[512px] h-[unset]"})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),o.jsx(ye,{options:Be,as:"p",className:"whitespace-normal text-black text-base font-normal",children:r.content.body})]})]})})(n)});ct.__docgenInfo={description:"",methods:[],displayName:"MessageEvent"};const lt={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},dt=l.memo(({event:n,roomID:e,hasPreviousEvent:t})=>{const s=q(e);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(n.sender)||"",avatarUrl:s?.getMemberAvatar(n.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(n.sender)}),o.jsx(ye,{options:lt,as:"p",className:"whitespace-break-spaces text-black text-base font-normal",children:JSON.stringify(n,null,4)})]})]})}),De=l.memo(({event:n,roomID:e,hasPreviousEvent:t})=>{const s=q(e);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:s?.getMemberName(n.sender)||"",avatarUrl:s?.getMemberAvatar(n.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(n.sender)}),o.jsx(ye,{options:lt,as:"p",className:"whitespace-normal text-base font-normal text-orange-600",children:"Unable to decrypt event"})]})]})});dt.__docgenInfo={description:"",methods:[],displayName:"UnknownEvent"};De.__docgenInfo={description:"",methods:[],displayName:"UndecryptableEvent"};const mt=l.memo(({event:n})=>(t=>o.jsxs("p",{className:"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out",children:[t.content.displayname?t.content.displayname:t.state_key," ",t.content.membership==="join"?"joined the room":t.content.membership==="leave"?"left the room":t.content.membership==="ban"?"was banned from the room by "+t.sender:t.content.membership==="invite"?"was invited to the room by "+t.sender:t.content.membership==="knock"?"knocked on the room":"changed their membership status to "+t.content.membership]}))(n));mt.__docgenInfo={description:"",methods:[],displayName:"MemberEvent"};const No=l.memo(({roomID:n,scrollRef:e})=>{const t=q(decodeURIComponent(n||"")),s=l.useContext(D),a=Xs(t),{pathname:i}=et(),[r,d]=l.useState([]),x=m=>{const w=m?.filter((c,v,u)=>u.findIndex(y=>y.event_id===c.event_id)===v);Promise.all(w?.filter(c=>c.type!=="m.reaction"&&!c.content["m.relates_to"]).map(async(c,v)=>{let u=w?.filter(p=>p.type!=="m.reaction")[v-1];const y=u?.sender===c.sender;let f=u?.type;const h=w?.filter(p=>p.type==="m.reaction"&&p.content["m.relates_to"].event_id===c.event_id),g=w?.find(p=>p.content["m.relates_to"]?p.content["m.relates_to"].rel_type==="m.replace"&&p.content["m.relates_to"].event_id===c.event_id:!1);if(g&&(c=g,g.content["m.new_content"]&&(c.content.body=g.content["m.new_content"].body,c.content.formatted_body=g.content["m.new_content"].formatted_body,c.content.format=g.content["m.new_content"].format)),c.type==="m.room.encrypted")try{const p=await s.olmMachine?.decryptRoomEvent(JSON.stringify(c),new S.RoomId(n||""));if(p)c=JSON.parse(p.event),c.content["m.new_content"]&&(c.content.body=c.content["m.new_content"].body,c.content.formatted_body=c.content["m.new_content"].formatted_body,c.content.format=c.content["m.new_content"].format);else return o.jsx(De,{event:c,hasPreviousEvent:y,roomID:n})}catch(p){return console.error(p),o.jsx(De,{event:c,hasPreviousEvent:y,roomID:n})}if(u?.type==="m.room.encrypted")try{const p=await s.olmMachine?.decryptRoomEvent(JSON.stringify(u),new S.RoomId(n||""));p&&(u=JSON.parse(p.event),f=u.type,u.content["m.new_content"]&&(u.content.body=u.content["m.new_content"].body,u.content.formatted_body=u.content["m.new_content"].formatted_body,u.content.format=u.content["m.new_content"].format))}catch(p){console.error(p)}return b(c,y,f,h)})).then(c=>{d(c)})};l.useEffect(()=>{a&&x(a)},[a]),l.useEffect(()=>{e.current?.scrollTo(0,e.current?.scrollHeight)},[i]);const b=(m,w,c,v)=>{switch(m.type){case"m.room.message":return o.jsx(ct,{reactions:v,event:m,roomID:n,hasPreviousEvent:w&&c==="m.room.message"},m.event_id);case"m.room.member":return o.jsx(mt,{event:m},m.event_id);case"m.room.redaction":return o.jsx(o.Fragment,{});default:return o.jsx(dt,{event:m},m.event_id)}};return o.jsx("div",{className:"max-w-[130ch] flex flex-col",children:r})}),ut=l.memo(()=>{const n=so(),e=to(),t=eo(),s=l.useContext(D);let a=Qt();const i=q(decodeURIComponent(a.roomIdOrAlias||""));s.setCurrentRoom(a.roomIdOrAlias?decodeURIComponent(a.roomIdOrAlias):void 0);const r=l.useRef(null),d=[...e].filter(({spaceRoom:u})=>{const y=![...e].some(({children:h})=>[...h].some(g=>g.roomID===u.roomID)),f=u.getSpaceParentIDs().length===0;return y&&f}),x=[...t].filter(u=>{const y=![...e].some(({children:g})=>[...g].some(p=>p.roomID===u.roomID)),f=u.getSpaceParentIDs().length===0,h=!u.isSpace();return y&&f&&h}),b=d.map(u=>{const y=[...u.children].filter(h=>!h.isSpace()).map(h=>({roomID:h.roomID,displayname:h.getName(),avatarUrl:h.getAvatarURL(),dm:h.isDM(),online:h.isOnline()})),f=h=>{const g=[...e].find(p=>p.spaceRoom.roomID===h.roomID);if(g){const p=[...g?.children].map(I=>({roomID:I.roomID,displayname:I.getName(),avatarUrl:I.getAvatarURL(),dm:I.isDM(),online:I.isOnline()}));return{sectionName:h.getName(),rooms:p,roomID:h.roomID,subsections:[...g?.children].filter(I=>I.isSpace()).map(f).filter(I=>I!==void 0)}}};return{sectionName:u.spaceRoom.getName(),rooms:y,roomID:u.spaceRoom.roomID,subsections:[...u.children].filter(h=>h.isSpace()).map(f)}}),m=x.filter(u=>!u.isSpace()).map(u=>({roomID:u.roomID,displayname:u.getName(),avatarUrl:u.getAvatarURL(),dm:u.isDM(),online:u.isOnline()})),w=m.map(u=>u.roomID),c=w.filter((u,y)=>w.indexOf(u)!==y);c.length>0&&console.error("otherRooms has duplicates",c);const v={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"};return o.jsxs("div",{className:"flex flex-row gap-2 min-h-screen h-screen",children:[o.jsxs("div",{className:"flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300",children:[o.jsxs("div",{className:"flex flex-row gap-2 m-2 p-1 items-center border-b-2",children:[o.jsx(R,{displayname:n.displayname||s.mxid,avatarUrl:n?.avatar_url,dm:!1,online:!1}),o.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[o.jsx("span",{className:"text-base font-semibold",children:n?.displayname}),o.jsx(es,{size:28,stroke:"unset",className:"stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer"})]})]}),o.jsx(Ae,{sections:b,rooms:m})]}),i&&o.jsxs("div",{className:"flex-1 flex flex-col",children:[o.jsxs("div",{className:"pb-2 flex flex-row items-center border-b-2 mt-4 ml-2",children:[o.jsx(R,{displayname:i.getName(),avatarUrl:i.getAvatarURL(),dm:i.isDM(),online:i.isOnline()}),o.jsxs("div",{className:"flex flex-row items-start",children:[o.jsx("h1",{className:"text-black font-semibold text-lg flex-shrink-0",children:i.getName()}),o.jsx(ye,{options:v,as:"p",className:"ml-4 text-slate-700 font-normal text-base line-clamp-2 text-ellipsis",children:i.getTopic()})]})]}),o.jsx("div",{ref:r,className:"overflow-y-auto overflow-x-hidden scrollbarSmall mr-2 my-1 flex-1 w-full flex flex-col-reverse",children:o.jsx(No,{roomID:a.roomIdOrAlias,scrollRef:r})}),o.jsx(Oe,{namespace:"Editor",roomID:decodeURIComponent(a.roomIdOrAlias||"")})]})]})});ut.__docgenInfo={description:"",methods:[],displayName:"MainPage"};const So={title:"Pages/MainPage",tags:["autodocs"],component:ut,decorators:[tt]},ge={};ge.parameters={...ge.parameters,docs:{...ge.parameters?.docs,source:{originalSource:"{}",...ge.parameters?.docs?.source}}};const jo=["Default"],Io=Object.freeze(Object.defineProperty({__proto__:null,Default:ge,__namedExportsOrder:jo,default:So},Symbol.toStringTag,{value:"Module"}));function pt(n){return{"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":ys,"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":_s,"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":Ns,"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":Is,"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":co,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":po,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":go,"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":bo,"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":vo,"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":Io}[n]}Object.assign(pt,{keys:()=>["/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx"],resolve:n=>({"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":"./src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":"./src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":"./src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":"./src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":"./src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":"./src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":"./src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":"./src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":"./src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":"./src/pages/MainPage.stories.tsx"})[n]});function Eo(n){n(pt,{hot:void 0},!1)}__STORYBOOK_MODULE_CLIENT_LOGGER__;const ko=__STORYBOOK_MODULE_PREVIEW_API__,{addDecorator:Co,addParameters:Ve,addLoader:Ro,addArgs:Do,addArgTypes:To,addStepRunner:Mo,addArgTypesEnhancer:Oo,addArgsEnhancer:Lo,setGlobalRender:Ao}=ko,Po=[ts,ss,os,ns,as,rs,is,cs,ls,ds,ms,hs].filter(Boolean);Po.map(n=>n.default?n.default:n).forEach(n=>{Object.keys(n).forEach(e=>{const t=n[e];switch(e){case"args":return Do(t);case"argTypes":return To(t);case"decorators":return t.forEach(s=>Co(s,!1));case"loaders":return t.forEach(s=>Ro(s,!1));case"parameters":return Ve({...t},!1);case"argTypesEnhancers":return t.forEach(s=>Oo(s));case"argsEnhancers":return t.forEach(s=>Lo(s));case"render":return Ao(t);case"globals":case"globalTypes":{const s={};return s[e]=t,Ve(s,!1)}case"decorateStory":case"applyDecorators":case"renderToDOM":case"renderToCanvas":return null;case"runStep":return Mo(t);default:return console.log(e+" was not supported :( !")}})});Eo(us);
//# sourceMappingURL=iframe-fddcf612.js.map
