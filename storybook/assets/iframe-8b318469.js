import"../sb-preview/runtime.js";import{r as l,j as s,E as ht,m as j,o as Jt,d as Kt,L as Oe,W as Wt,P as Zt,a as Xt,p as Gt,l as Yt,H as ot,b as rt,c as Qt,e as E,f as O,g as Ve,h as U,T as ft,i as yt,k as xt,n as _t,q as bt,Q as vt,C as Be,s as Pe,t as A,u as q,v as $,U as en,R as tn,w as nn,x as sn,y as on,z as wt,A as at,B as rn,I as an,D as cn,S as ln,F as mn,G as dn,J as un,K as pn,M as gn,N as hn,O as fn,V as yn,X as Fe,Y as xn,Z as _n,_ as bn,$ as vn,a0 as St,a1 as qe,a2 as Ke,a3 as Et,a4 as wn,a5 as Sn,a6 as it,a7 as En,a8 as jn,a9 as Nn,aa as kn,ab as In,ac as Rn,ad as Dn,ae as Cn,af as Mn,ag as Tn,ah as On,ai as Ln,aj as Un,ak as An,al as $n}from"./vendor-dddbfd35.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=t(r);fetch(r.href,c)}})();const jt="light",Nt=(o,e)=>{const{theme:t}=e.globals;return l.useEffect(()=>{document.documentElement.setAttribute("data-mode",t||jt)},[t]),s.jsx(o,{})};Nt.__docgenInfo={description:"",methods:[],displayName:"withTailwindTheme"};const Pn={parameters:{actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},options:{storySort:{order:["Introduction","Fundamentals","*"]}}},globalTypes:{theme:{name:"Theme",description:"Global theme for components",defaultValue:jt,toolbar:{icon:"paintbrush",items:[{value:"light",title:"Light",left:"ðŸŒž"},{value:"dark",title:"Dark",left:"ðŸŒ›"}],dynamicTitle:!0}}},decorators:[Nt]},zn=Object.freeze(Object.defineProperty({__proto__:null,default:Pn},Symbol.toStringTag,{value:"Module"})),D=l.memo(({avatarUrl:o,displayname:e,dm:t=!1,online:n=!1})=>{const[r,c]=l.useState(!1);return o&&!r?s.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[s.jsx("img",{className:"rounded-full w-8 h-8 object-cover",alt:e,src:o,onError:()=>{c(!0)}}),t?n?s.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):s.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):s.jsx(s.Fragment,{})]}):s.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[e.replace("@","").replace("!","").replace("#","")[0].toUpperCase(),t?n?s.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):s.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):s.jsx(s.Fragment,{})]})});D.__docgenInfo={description:"",methods:[],displayName:"Avatar",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the avatar user"}}};const Fn={title:"Chat/Avatar",component:D,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"User ID",description:"The DISPLAY name of the User"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the Avatar is used for a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"}}},B={args:{displayname:"test",dm:!1,online:!1,avatarUrl:""}},J={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1}},K={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1}},W={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}},Z={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1}},X={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: ""
  }
}`,...B.parameters?.docs?.source}}};J.parameters={...J.parameters,docs:{...J.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false
  }
}`,...J.parameters?.docs?.source}}};K.parameters={...K.parameters,docs:{...K.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false
  }
}`,...K.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true
  }
}`,...W.parameters?.docs?.source}}};Z.parameters={...Z.parameters,docs:{...Z.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false
  }
}`,...Z.parameters?.docs?.source}}};X.parameters={...X.parameters,docs:{...X.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true
  }
}`,...X.parameters?.docs?.source}}};const qn=["Fallback","Image","DMOffline","DMOnline","DMNoAvatarOffline","DMNoAvatarOnline"],Hn=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:Z,DMNoAvatarOnline:X,DMOffline:K,DMOnline:W,Fallback:B,Image:J,__namedExportsOrder:qn,default:Fn},Symbol.toStringTag,{value:"Module"}));const We=l.memo(({type:o="button",style:e="primary",onClick:t,children:n,readonly:r})=>e==="secondary"?s.jsx("button",{disabled:r,onClick:t,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:n}):e==="abort"?s.jsx("button",{disabled:r,onClick:t,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:n}):s.jsx("button",{disabled:r,onClick:t,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:n}));We.__docgenInfo={description:"",methods:[],displayName:"Button",props:{type:{defaultValue:{value:'"button"',computed:!1},required:!1,tsType:{name:"union",raw:'"button" | "submit" | "reset"',elements:[{name:"literal",value:'"button"'},{name:"literal",value:'"submit"'},{name:"literal",value:'"reset"'}]},description:"The button type"},style:{defaultValue:{value:'"primary"',computed:!1},required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "abort"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"abort"'}]},description:"The button style"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The button onClick handler"},children:{required:!0,tsType:{name:"string"},description:"The button Label"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the button is readonly"}}};const Vn={title:"Fundamentals/Buttons/BasicButton",component:We,argTypes:{children:{required:!0,name:"Label",description:"The button label"},onClick:{description:"The button onClick handler",required:!0},type:{description:"The button type",control:"select",options:["button","submit","reset"],defaultValue:"button"},style:{description:"The button styling",control:"select",options:["primary","secondary","abort"],defaultValue:"primary"}}},G={args:{children:"Click me",type:"button",style:"primary"}},Y={args:{children:"Submit",type:"submit",style:"primary"}},Q={args:{children:"Reset",type:"reset",style:"primary"}},ee={args:{children:"Click me",type:"button",style:"secondary"}},te={args:{children:"Submit",type:"submit",style:"secondary"}},ne={args:{children:"Reset",type:"reset",style:"secondary"}},se={args:{children:"Abort",type:"button",style:"abort"}};G.parameters={...G.parameters,docs:{...G.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'primary'
  }
}`,...G.parameters?.docs?.source}}};Y.parameters={...Y.parameters,docs:{...Y.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'primary'
  }
}`,...Y.parameters?.docs?.source}}};Q.parameters={...Q.parameters,docs:{...Q.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'primary'
  }
}`,...Q.parameters?.docs?.source}}};ee.parameters={...ee.parameters,docs:{...ee.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'secondary'
  }
}`,...ee.parameters?.docs?.source}}};te.parameters={...te.parameters,docs:{...te.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'secondary'
  }
}`,...te.parameters?.docs?.source}}};ne.parameters={...ne.parameters,docs:{...ne.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'secondary'
  }
}`,...ne.parameters?.docs?.source}}};se.parameters={...se.parameters,docs:{...se.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Abort',
    type: 'button',
    style: 'abort'
  }
}`,...se.parameters?.docs?.source}}};const Bn=["Default","Submit","Reset","DefaultSecondary","SubmitSecondary","ResetSecondary","Abort"],Jn=Object.freeze(Object.defineProperty({__proto__:null,Abort:se,Default:G,DefaultSecondary:ee,Reset:Q,ResetSecondary:ne,Submit:Y,SubmitSecondary:te,__namedExportsOrder:Bn,default:Vn},Symbol.toStringTag,{value:"Module"})),Ze=l.memo(({event:o})=>(t=>s.jsxs("p",{className:"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out",children:[t.content.displayname?t.content.displayname:t.state_key," ",t.content.membership==="join"?"joined the room":t.content.membership==="leave"?"left the room":t.content.membership==="ban"?"was banned from the room by "+t.sender:t.content.membership==="invite"?"was invited to the room by "+t.sender:t.content.membership==="knock"?"knocked on the room":"changed their membership status to "+t.content.membership]}))(o));Ze.__docgenInfo={description:"",methods:[],displayName:"MemberEvent"};const Kn={title:"Chat/Events/MembershipEvents",component:Ze},oe={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},re={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"leave",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ae={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"invite",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ie={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"knock",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ce={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"ban",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};oe.parameters={...oe.parameters,docs:{...oe.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...oe.parameters?.docs?.source}}};re.parameters={...re.parameters,docs:{...re.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "leave",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...re.parameters?.docs?.source}}};ae.parameters={...ae.parameters,docs:{...ae.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "invite",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ae.parameters?.docs?.source}}};ie.parameters={...ie.parameters,docs:{...ie.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "knock",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ie.parameters?.docs?.source}}};ce.parameters={...ce.parameters,docs:{...ce.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "ban",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ce.parameters?.docs?.source}}};const Wn=["JoinEvent","LeaveEvent","InviteEvent","KnockEvent","BanEvent"],Zn=Object.freeze(Object.defineProperty({__proto__:null,BanEvent:ce,InviteEvent:ae,JoinEvent:oe,KnockEvent:ie,LeaveEvent:re,__namedExportsOrder:Wn,default:Kn},Symbol.toStringTag,{value:"Module"}));function Xn(o){return o.op==="SYNC"}function Gn(o){return o.op==="INSERT"}function Yn(o){return o.op==="INVALIDATE"}function Qn(o){return o.op==="DELETE"}function es(o){return o.type==="m.room.message"&&o.content.msgtype==="m.text"}function ct(o){return o.type==="m.room.message"&&o.content.msgtype==="m.image"}function lt(o){return o.type==="m.room.message"&&o.content.msgtype==="m.audio"}function mt(o){return o.state_key!==void 0}function ts(o){return o.type==="m.room.create"}function ns(o){return o.type==="m.room.avatar"}function ss(o){return o.type==="m.space.child"}function os(o){return o.type==="m.space.parent"}function rs(o){return o.type==="m.room.topic"}class F extends ht{constructor(e,t,n){super(),this.roomID=e,this.hostname=t,this.client=n}events=[];stateEvents=[];name;notification_count=0;notification_highlight_count=0;joined_count=0;invited_count=0;is_dm=!1;windowPos={};addEvents(e){e.forEach(t=>{this.events.push(t)}),this.emit("events",this.events)}addStateEvents(e){e.forEach(t=>{const n=this.stateEvents.findIndex(r=>r.state_key===t.state_key&&r.type===t.type);n!==-1?this.stateEvents[n]=t:this.stateEvents.push(t)}),this.emit("state_events",this.stateEvents)}getStateEvents(){return this.stateEvents}isTombstoned(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.tombstone"&&(e=!0)}),e}getAvatarURL(){let e;return this.stateEvents.forEach(t=>{if(ns(t)){const n=t.content.url;n?.startsWith("mxc://")&&(e=this.client.convertMXC(n))}}),e}isSpace(){let e=!1;return this.stateEvents.forEach(t=>{ts(t)&&(e=t.content.type==="m.space")}),e}setName(e){this.name=e}getName(){return this.name?this.name:this.roomID}getTopic(){let e;return this.stateEvents.forEach(t=>{rs(t)&&(e=t.content.topic)}),e}setNotificationCount(e){this.notification_count=e}getNotificationCount(){return this.notification_count}setNotificationHighlightCount(e){this.notification_highlight_count=e}getNotificationHighlightCount(){return this.notification_highlight_count}setJoinedCount(e){this.joined_count=e}getJoinedCount(){return this.joined_count}setInvitedCount(e){this.invited_count=e}getInvitedCount(){return this.invited_count}getSpaceChildrenIDs(){const e=[];return this.stateEvents.forEach(t=>{ss(t)&&e.push(t.state_key)}),e}getSpaceParentIDs(){const e=[];return this.stateEvents.forEach(t=>{os(t)&&e.push({roomID:t.state_key,canonical:t.content.canonical||!1})}),e}setDM(e){this.is_dm=e}isDM(){return this.is_dm}isOnline(){return!1}getEvents(){return this.events}getMemberName(e){let t=e;return this.stateEvents.forEach(n=>{n.type==="m.room.member"&&n.state_key===e&&n.content.membership=="join"&&(t=n.content.displayname)}),t}getMemberAvatar(e){let t;return this.stateEvents.forEach(n=>{if(n.type==="m.room.member"&&n.state_key===e&&n.content.membership=="join"){const r=n.content.avatar_url;r?.startsWith("mxc://")&&(t=this.client.convertMXC(r))}}),t}isEncrypted(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.content.algorithm==="m.megolm.v1.aes-sha2"&&t.state_key===""&&(e=!0)}),e}async sendHtmlMessage(e,t){if(this.isEncrypted()){console.log("Sending encrypted message"),await this.client.shareKeys();const n=await this.client.olmMachine?.encryptRoomEvent(new j.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})),r=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:n});if(!r.ok)throw new Error(`Failed to send message: ${r.status} ${r.statusText}`);return(await r.json()).event_id}else{const n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e})});if(!n.ok)throw new Error(`Failed to send message: ${n.status} ${n.statusText}`);return(await n.json()).event_id}}async sendTextMessage(e){if(this.isEncrypted()){console.log("Sending encrypted message2"),await this.client.shareKeys();const t=await this.client.olmMachine?.encryptRoomEvent(new j.RoomId(this.roomID),"m.room.message",JSON.stringify({msgtype:"m.text",body:e})),n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:t});if(!n.ok)throw new Error(`Failed to send message: ${n.status} ${n.statusText}`);return(await n.json()).event_id}else{const t=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${Date.now().toString()}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify({msgtype:"m.text",body:e})});if(!t.ok)throw new Error(`Failed to send message: ${t.status} ${t.statusText}`);return(await t.json()).event_id}}getJoinedMemberIDs(){const e=[];return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.content.membership==="join"&&e.push(t.state_key)}),e}getEncryptionSettings(){let e;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.state_key===""&&(e||(e=new j.EncryptionSettings),e.algorithm=t.content.algorithm==="m.megolm.v1.aes-sha2"?j.EncryptionAlgorithm.MegolmV1AesSha2:j.EncryptionAlgorithm.OlmV1Curve25519AesSha2,t.content.rotation_period_ms&&(e.rotationPeriod=BigInt(t.content.rotation_period_ms)),t.content.rotation_period_msgs&&(e.rotationPeriodMessages=BigInt(t.content.rotation_period_msgs))),t.type==="m.room.history_visibility"&&t.state_key===""&&(e||(e=new j.EncryptionSettings),e.historyVisibility=t.content.history_visibility)}),e&&(e.onlyAllowTrustedDevices=!1),e}}function as(o){const[e,t]=l.useState(o?.getEvents()||[]);return l.useEffect(()=>{if(o){t(o?.getEvents()||[]);const n=r=>{t([...r])};return o.on("events",n),()=>{o.removeListener("events",n)}}else t([])},[o]),e}class is extends ht{static _instance;access_token;device_id;mxid;hostname;slidingSyncHostname;syncing=!1;roomsInView=[];spacesInView=[];spaceOpen=[];rooms=new Set;syncPos;initialSync=!0;database;profileInfo;lastRanges;lastTxnID;to_device_since;olmMachine;currentRoom;abortController=new AbortController;mustUpdateTxnID=!0;outgoingRequestsBeingProcessed=!1;missingSessionsBeingRequested=!1;get accessToken(){return this.access_token}get isLoggedIn(){return this.access_token!==void 0}convertMXC(e){return`${this.hostname}/_matrix/media/r0/download/${e.substring(6)}`}setCurrentRoom(e){e!==this.currentRoom&&(this.currentRoom=e,console.log("Current room changed to",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}static async Instance(){let e=this._instance;if(!e){e=this._instance=new this,e.database||await e.createDatabase();const t=e.database?.transaction("loginInfo","readonly"),n=await t?.store.getAll();if(await t?.done,n&&n.length>0){e.mxid=n[0].userId,e.hostname=n[0].hostname,e.slidingSyncHostname=n[0].slidingSyncHostname,e.access_token=n[0].access_token,e.device_id=n[0].device_id,e.profileInfo={avatar_url:n[0].avatarUrl,displayname:n[0].displayName},e.mxid&&e.hostname&&e.access_token&&e.device_id&&(e.olmMachine=await j.OlmMachine.initialize(new j.UserId(e.mxid),new j.DeviceId(e.device_id),"cetirizine-crypto"));const r=e.database?.transaction("syncInfo","readonly"),c=await r?.store.get(e.mxid);await r?.done,c&&(e.syncPos=c.syncPos,e.initialSync=c.initialSync,e.lastRanges=c.lastRanges,e.lastTxnID=c.lastTxnID,e.to_device_since=c.to_device_since);const a=e.database?.transaction("rooms","readonly"),d=await a?.store.getAll();await a?.done,d&&(e.rooms=new Set(d.map(p=>{const x=new F(p.roomID,e.hostname,e);return x.windowPos=p.windowPos,x.setInvitedCount(p.invited_count),x.setJoinedCount(p.joined_count),x.setNotificationCount(p.notification_count),x.setNotificationHighlightCount(p.highlight_count),x.setName(p.name),p.events&&x.addEvents(p.events),p.stateEvents&&x.addStateEvents(p.stateEvents),p.isDM&&x.setDM(p.isDM),x})),e.emit("rooms",e.rooms))}}return e}async createDatabase(){this.database=await Jt("matrix",4,{upgrade(e,t){t<1&&(e.objectStoreNames.contains("rooms")&&e.deleteObjectStore("rooms"),e.objectStoreNames.contains("syncInfo")&&e.deleteObjectStore("syncInfo"),e.createObjectStore("rooms",{keyPath:"roomID"}),e.createObjectStore("loginInfo",{keyPath:"userId"}),e.createObjectStore("syncInfo",{keyPath:"userId"}))}})}async setHostname(e){if(!e.startsWith("https://"))throw Error("Hostname must start with 'https://'");this.database||await this.createDatabase();const t=this.database?.transaction("loginInfo","readwrite");await t?.store.put({userId:this.mxid,hostname:e,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,device_id:this.device_id}),await t?.done,this.hostname=e}async startSync(){if(!this.isLoggedIn)throw Error("Not logged in");if(this.database||await this.createDatabase(),!this.syncing)for(this.syncing=!0;this.syncing;)try{await this.sync()}catch(e){console.error(e)}}stopSync(){this.syncing=!1}isIndexInRange(e,t){for(const n of t)if(n[0]<e&&e<=n[1])return!0;return!1}shiftRight(e,t,n,r){for(let c=n-1;c>r-1;c--)if(this.isIndexInRange(c,t)){const a=[...this.rooms].find(d=>d.windowPos[e]===c+1);a&&(a.windowPos[e]=c)}}shiftLeft(e,t,n,r){for(let c=r+1;c<n+1;c++)if(this.isIndexInRange(c,t)){const a=[...this.rooms].find(d=>d.windowPos[e]===c-1);a&&(a.windowPos[e]=c)}}async removeEntry(e,t,n){let r=-1;const c=[...this.rooms].map(a=>a.windowPos[e]);for(const a in c)Number(a)>r&&(r=Number(a));r<0||n>r||this.shiftLeft(e,t,r,n)}addEntry(e,t,n){let r=-1;const c=[...this.rooms].map(a=>a.windowPos[e]);for(const a in c)Number(a)>r&&(r=Number(a));r<0||n>r||this.shiftRight(e,t,r+1,n)}async sendIdentifyAndOneTimeKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.outgoingRequestsBeingProcessed)return;this.outgoingRequestsBeingProcessed=!0;const e=await this.olmMachine.outgoingRequests();for(const t of e)await this.processRequest(t);await this.shareKeys(),this.outgoingRequestsBeingProcessed=!1}async shareKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.missingSessionsBeingRequested)return;this.missingSessionsBeingRequested=!0;const e=[...this.rooms].filter(r=>r.isEncrypted()),t=e.map(r=>r.getJoinedMemberIDs().map(c=>new j.UserId(c))).flat(),n=await this.olmMachine?.getMissingSessions(t);n&&await this.processRequest(n);for(const r of e){const c=r.getEncryptionSettings();if(c){const a=await this.olmMachine.shareRoomKey(new j.RoomId(r.roomID),r.getJoinedMemberIDs().map(d=>new j.UserId(d)),c);for(const d of a)await this.processRequest(d)}}this.missingSessionsBeingRequested=!1}async logout(){this.stopSync(),this.abortController.abort(),this.access_token=void 0,this.device_id=void 0,this.initialSync=!0,this.rooms=new Set,this.slidingSyncHostname=void 0,this.syncPos=void 0,this.to_device_since=void 0,this.outgoingRequestsBeingProcessed=!1,this.missingSessionsBeingRequested=!1;const e=this.database?.transaction("syncInfo","readwrite");await e?.store.delete(this.mxid),await e?.done;const t=this.database?.transaction("loginInfo","readwrite");await t?.store.delete(this.mxid),await t?.done;const n=this.database?.transaction("rooms","readwrite");await n?.store.clear(),await n?.done,await Kt("cetirizine-crypto"),this.mxid=void 0}async processRequest(e){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(e.type===j.RequestType.KeysUpload){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to upload keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===j.RequestType.KeysQuery){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to query keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===j.RequestType.KeysClaim){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to claim keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===j.RequestType.ToDevice){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/sendToDevice/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to send to device",n);return}this.olmMachine.markRequestAsSent(t.id??t.txn_id,t.type,await n.text())}else if(e.type===j.RequestType.SignatureUpload){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/keys/signatures/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to upload signatures",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===j.RequestType.RoomMessage){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${t.room_id}/send/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to send message",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}else if(e.type===j.RequestType.KeysBackup){const t=e,n=await fetch(`${this.hostname}/_matrix/client/v3/room_keys/keys`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:t.body});if(!n.ok){n.status===401&&(await this.logout(),console.error(n)),console.error("Failed to backup keys",n);return}this.olmMachine.markRequestAsSent(t.id,t.type,await n.text())}}async sync(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");await this.sendIdentifyAndOneTimeKeys();let e={overview:[[0,20]],spaces:[[0,20]]};for(const m of this.spaceOpen)m!=="other"&&(e[m]=[[0,20]]);let t=1,n=10;if(!this.initialSync)for(const m in e){t=10,n=50;let _=new Set([...this.rooms].filter(i=>this.roomsInView.includes(i.roomID)).map(i=>i.windowPos[m]).sort().filter(i=>i!=null));if(this.getSpaces().find(i=>i.roomID===m)&&(_=new Set([...this.rooms].filter(i=>this.spacesInView.includes(i.roomID)).map(i=>i.windowPos[m]).sort().filter(i=>i!=null))),_.size!==0){const i=Math.min(..._),w=Math.max(..._);e[m]=[[Math.max(i-10,0),w+10]]}}this.lastRanges&&Object.entries(e).toString()!==Object.entries(this.lastRanges).toString()&&(console.log("Ranges changed, resetting sync txn_id",e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.lastRanges||(this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.mustUpdateTxnID&&(this.lastTxnID=Date.now().toString(),this.mustUpdateTxnID=!1);let r=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000`;this.syncPos&&(r=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000&pos=${this.syncPos}`);const c={txn_id:this.lastTxnID,lists:{spaces:{ranges:this.lastRanges.spaces,sort:["by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:0,filters:{room_types:["m.space"]}},overview:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"]}}},bump_event_types:["m.room.message","m.room.encrypted"],extensions:{e2ee:{enabled:!0},to_device:{enabled:!0,since:this.to_device_since}}};for(const m of this.spaceOpen)m!=="other"&&(c.lists||(c.lists={}),c.lists[m]={slow_get_all_rooms:!0,ranges:this.lastRanges[m],sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{spaces:[m]}});this.currentRoom&&(c.room_subscriptions={},c.room_subscriptions[this.currentRoom]={sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:n,filters:{}});const a=await fetch(r,{method:"POST",signal:this.abortController.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:JSON.stringify(c)});if(!a.ok)if(a.status===400){if((await a.json()).errcode==="M_UNKNOWN_POS"){this.syncPos=void 0;const m=this.database?.transaction("syncInfo","readwrite");await m?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID}),await m?.done}return}else a.status===401&&(await this.logout(),console.error(a),console.error("Error syncing. See console for error."));const d=await a.json();this.syncPos=d.pos,d.extensions?.to_device&&(await this.olmMachine?.receiveSyncChanges(JSON.stringify(d.extensions.to_device.events||[]),new j.DeviceLists(d.extensions.e2ee?.device_lists?.changed?.map(m=>new j.UserId(m)),d.extensions.e2ee?.device_lists?.left?.map(m=>new j.UserId(m))),new Map(Object.entries(d.extensions.e2ee?.device_one_time_keys_count||[])),new Set(d.extensions.e2ee?.device_unused_fallback_key_types)),this.to_device_since=d.extensions.to_device.next_batch),await this.sendIdentifyAndOneTimeKeys();const p=this.database?.transaction("syncInfo","readwrite");await p?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID,to_device_since:this.to_device_since}),await p?.done;let x=-1;for(const m in d.lists){const _=d.lists[m];if(_.ops){for(const i of _.ops)if(Xn(i)){const w=this.database?.transaction("rooms","readwrite");for(let u=i.range[0];u<=i.range[1];u++){const h=i.room_ids[u-i.range[0]];if(!h)break;const v=[...this.rooms].find(f=>f.roomID===h);if(v){v.windowPos[m]=u;continue}const g=new F(h,this.hostname,this);g.setName(h),g.windowPos[m]=u,this.rooms.add(g),await w?.store.put({windowPos:g.windowPos,roomID:g.roomID,name:g.getName(),notification_count:g.getNotificationCount(),highlight_count:g.getNotificationHighlightCount(),joined_count:g.getJoinedCount(),invited_count:g.getInvitedCount(),avatarUrl:g.getAvatarURL(),isSpace:g.isSpace(),isDM:g.isDM(),stateEvents:g.getStateEvents(),events:g.getEvents()})}await w?.done}else if(Gn(i)){console.log("Got INSERT OP",i),[...this.rooms].find(f=>f.windowPos[m]===i.index)&&(x<0?this.addEntry(m,this.lastRanges[m],i.index):x>i.index?this.shiftRight(m,this.lastRanges[m],x,i.index):x<i.index&&this.shiftLeft(m,this.lastRanges[m],i.index,x)),x=-1;const u=this.database?.transaction("rooms","readwrite"),h=[...this.rooms].find(f=>f.roomID===i.room_id);if(h)h.windowPos[m]=i.index,await u?.store.put({windowPos:h.windowPos,roomID:h.roomID,name:h.getName(),notification_count:h.getNotificationCount(),highlight_count:h.getNotificationHighlightCount(),joined_count:h.getJoinedCount(),invited_count:h.getInvitedCount(),avatarUrl:h.getAvatarURL(),isSpace:h.isSpace(),isDM:h.isDM(),stateEvents:h.getStateEvents(),events:h.getEvents()});else{const f=await u?.store.get(i.room_id);let y=new F(i.room_id,this.hostname,this);y.setName(i.room_id),y.windowPos[m]=i.index,f&&(console.warn("Room in db but not in obj list.",i.room_id,"Updating obj list."),y=new F(i.room_id,this.hostname,this),y.setName(f.name),y.setNotificationCount(f.notification_count),y.setNotificationHighlightCount(f.highlight_count),y.setJoinedCount(f.joined_count),y.setInvitedCount(f.invited_count),y.setDM(f.isDM||!1)),this.rooms.add(y),await u?.store.put({windowPos:y.windowPos,roomID:y.roomID,name:y.getName(),notification_count:y.getNotificationCount(),highlight_count:y.getNotificationHighlightCount(),joined_count:y.getJoinedCount(),invited_count:y.getInvitedCount(),avatarUrl:y.getAvatarURL(),isSpace:y.isSpace(),isDM:y.isDM(),stateEvents:y.getStateEvents(),events:y.getEvents()})}const v=[...this.rooms].map(f=>f.roomID),g=v.filter((f,y)=>v.indexOf(f)!=y);g.length>0&&console.error("Duplicates found",g),await u?.done}else Qn(i)?(console.log("Got DELETE OP",i),x!==-1&&await this.removeEntry(m,this.lastRanges[m],x),x=i.index):Yn(i);x!==-1&&await this.removeEntry(m,this.lastRanges[m],x)}}for(const m in d.rooms){const _=d.rooms[m],i=_.name,w=_.notification_count,u=_.highlight_count,h=_.joined_count,v=_.invited_count,g=_.timeline,f=g?.filter(R=>mt(R)).map(R=>R),y=g?.filter(R=>!mt(R)).map(R=>R),S=_.required_state,C=_.is_dm;let b=[...this.rooms].find(R=>R.roomID===m);if(!b){console.warn("Could not find roomObj for roomID:",m);const R=this.database?.transaction("rooms","readwrite"),I=await R?.store.get(m);await R?.done,I?(console.warn("Room in db but not in obj list.",m,"Updating obj list."),b=new F(m,this.hostname,this),b.setName(I.name),b.setNotificationCount(I.notification_count),b.setNotificationHighlightCount(I.highlight_count),b.setJoinedCount(I.joined_count),b.setInvitedCount(I.invited_count),b.setDM(I.isDM||!1),I.events&&b.addEvents(I.events),I.stateEvents&&b.addStateEvents(I.stateEvents),b.windowPos=I.windowPos):(console.warn("Could not find room in db. Creating new one."),b=new F(m,this.hostname,this),this.rooms.add(b))}if(i&&b.setName(i),b.setNotificationCount(w),b.setNotificationHighlightCount(u),b.setJoinedCount(h),b.setInvitedCount(v),y&&b.addEvents(y),S&&b.addStateEvents(S),f&&b.addStateEvents(f),(S||f)&&b.isEncrypted()){const I=[...S||[],...f||[]].filter(z=>z.type==="m.room.member"&&z.content.membership==="join").map(z=>new j.UserId(z.state_key));await this.olmMachine?.updateTrackedUsers(I)}C&&b.setDM(C);const N=this.database?.transaction("rooms","readwrite");await N?.store.put({windowPos:b.windowPos,roomID:b.roomID,name:b.getName(),notification_count:b.getNotificationCount(),highlight_count:b.getNotificationHighlightCount(),joined_count:b.getJoinedCount(),invited_count:b.getInvitedCount(),events:b.getEvents(),stateEvents:b.getStateEvents(),avatarUrl:b.getAvatarURL(),isSpace:b.isSpace(),isDM:b.isDM()}),await N?.done}this.initialSync&&(this.initialSync=!1,console.log("initialSyncComplete")),d.rooms&&Object.keys(d.rooms).length>0&&this.emit("rooms",this.rooms)}addInViewRoom(e){this.roomsInView.push(e)}removeInViewRoom(e){this.roomsInView=this.roomsInView.filter(t=>t!==e)}addInViewSpace(e){this.spacesInView.push(e)}removeInViewSpace(e){this.spacesInView=this.spacesInView.filter(t=>t!==e)}addSpaceOpen(e){e!=="other"&&(this.spaceOpen.push(e),console.log("Space opened",e,"restarting sync"),this.mustUpdateTxnID=!0,this.abortController=new AbortController)}removeSpaceOpen(e){e!=="other"&&(this.spaceOpen=this.spaceOpen.filter(t=>t!==e),this.mustUpdateTxnID=!0)}getRooms(){return this.rooms}getSpaces(){return[...this.rooms].filter(e=>e.isSpace()&&!e.isTombstoned()).sort((e,t)=>e.getName()<t.getName()?-1:e.getName()>t.getName()?1:0)}getSpacesWithRooms(){const e=this.getSpaces(),t=new Set;for(const n of e){const r=n.getSpaceChildrenIDs(),c=new Set([...this.getRooms()].filter(a=>r.includes(a.roomID)));t.add({spaceRoom:n,children:c})}for(const n of this.getRooms()){if(n.isSpace()||n.isTombstoned())continue;const r=n.getSpaceParentIDs();for(const c of r){const a=[...this.getRooms()].find(p=>p.roomID===c.roomID);if(!a)continue;const d=[...t].find(p=>p.spaceRoom.roomID===a.roomID);if(d){[...d.children].find(p=>p.roomID===n.roomID)||d.children.add(n);continue}t.add({spaceRoom:a,children:new Set([n])})}}return t}async getLoginFlows(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/login`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async getWellKnown(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/.well-known/matrix/client`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async passwordLogin(e,t,n=5){if(this.database||await this.createDatabase(),!e)throw Error("Username must be set");if(!t)throw Error("Password must be set");this.mxid=e,await this.setHostname(`https://${e.split(":")[1]}`);try{const d=await this.getWellKnown();if(d["m.homeserver"]?.base_url&&await this.setHostname(d["m.homeserver"].base_url),d["org.matrix.msc3575.proxy"]?.url){const p=this.database?.transaction("loginInfo","readwrite");await p?.store.put({userId:this.mxid,hostname:this.hostname,slidingSyncHostname:d["org.matrix.msc3575.proxy"].url,access_token:this.access_token,device_id:this.device_id}),await p?.done,this.slidingSyncHostname=d["org.matrix.msc3575.proxy"].url}else throw Error("No sliding sync proxy found")}catch(d){console.warn(`No well-known found for ${this.hostname}:
${d}`)}if(((await this.getLoginFlows()).flows.filter(d=>d.type==="m.login.password")?.length||0)==0)throw Error("Password login is not supported by this homeserver");const c=await fetch(`${this.hostname}/_matrix/client/r0/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"m.login.password",identifier:{type:"m.id.user",user:e},user:e,password:t})});if(!c.ok)throw console.error(c),Error("Error logging in. See console for error.");const a=await c.json();if(ms(a))throw Error(`Error logging in: ${a.errcode}: ${a.error}`);if(cs(a)&&(console.error(`Rate limited. Retrying in ${a.retry_after_ms}ms. ${n} tries left.`),await this.passwordLogin(e,t,n-1)),ls(a)){const d=this.database?.transaction("loginInfo","readwrite");await d?.store.put({userId:a.user_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:a.access_token,device_id:a.device_id}),await d?.done,this.access_token=a.access_token,this.device_id=a.device_id,this.mxid=a.user_id,this.olmMachine=await j.OlmMachine.initialize(new j.UserId(this.mxid),new j.DeviceId(this.device_id),"cetirizine-crypto")}}async fetchProfileInfo(e){if(this.profileInfo)return this.profileInfo;if(!this.hostname)throw Error("Hostname must be set first");if(this.database||await this.createDatabase(),!this.access_token)throw Error("Access token must be set first");const t=await fetch(`${this.hostname}/_matrix/client/r0/profile/${e}`,{headers:{Authorization:`Bearer ${this.access_token}`}});if(!t.ok){if(t.status===404||t.status===403)return{};throw console.error(t),Error("Error fetching profile info. See console for error.")}const n=await t.json();n.avatar_url=n.avatar_url?.replace("mxc://",`${this.hostname}/_matrix/media/r0/download/`),this.profileInfo=n;const r=this.database?.transaction("loginInfo","readwrite");return await r?.store.put({userId:this.mxid,device_id:this.device_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,displayName:n.displayname,avatarUrl:n.avatar_url}),await r?.done,n}}function cs(o){return o.retry_after_ms!==void 0}function ls(o){return o.access_token!==void 0}function ms(o){return o.errcode!==void 0}const kt=await is.Instance(),T=l.createContext(kt);function ds(){const o=l.useContext(T),[e,t]=l.useState(o.getRooms());return l.useEffect(()=>{const n=r=>{t(r)};return o.on("rooms",n),o.startSync(),()=>{o.removeListener("rooms",n)}},[]),e}function P(o){return[...l.useContext(T).getRooms()].find(t=>t.roomID===o)}function us(){const o=l.useContext(T),[e,t]=l.useState(o.getSpacesWithRooms());return l.useEffect(()=>{const n=r=>{t(o.getSpacesWithRooms())};return o.on("rooms",n),o.startSync(),()=>{o.removeListener("rooms",n)}},[]),e}function ps(){const o=l.useContext(T),[e,t]=l.useState({displayname:o.mxid||"Unknown"});return l.useEffect(()=>{o.fetchProfileInfo(o.mxid).then(n=>{n.displayname||(n.displayname=o.mxid||"Unknown"),t(n)})},[]),e}const It={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},Xe=l.memo(({event:o,roomID:e,hasPreviousEvent:t})=>{const n=P(e);return s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:n?.getMemberName(o.sender)||o.sender,avatarUrl:n?.getMemberAvatar(o.sender),online:n?.isOnline()||!1,dm:n?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:n?.getMemberName(o.sender)||o.sender}),s.jsx(Oe,{options:It,as:"p",className:"whitespace-break-spaces text-black text-base font-normal",children:JSON.stringify(o,null,4)})]})]})}),H=l.memo(({event:o,roomID:e,hasPreviousEvent:t})=>{const n=P(e);return s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:n?.getMemberName(o.sender)||o.sender,avatarUrl:n?.getMemberAvatar(o.sender),online:n?.isOnline()||!1,dm:n?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:n?.getMemberName(o.sender)||o.sender}),s.jsx(Oe,{options:It,as:"p",className:"whitespace-pre-wrap text-base font-normal text-orange-600",children:"Unable to decrypt event"})]})]})}),Te=l.memo(({event:o,redacted_because:e,roomID:t,hasPreviousEvent:n})=>{const r=P(t);return s.jsxs("div",{className:n?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!n&&s.jsx(D,{displayname:r?.getMemberName(o.sender)||o.sender,avatarUrl:r?.getMemberAvatar(o.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:n?"ml-[3.7rem]":"flex flex-col gap-1",children:[!n&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(o.sender)||o.sender}),e&&s.jsxs("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:["Message was redacted: ",e]}),!e&&s.jsx("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:"Message was redacted"})]})]})});Xe.__docgenInfo={description:"",methods:[],displayName:"UnknownEvent"};H.__docgenInfo={description:"",methods:[],displayName:"UndecryptableEvent"};Te.__docgenInfo={description:"",methods:[],displayName:"RedactedEvent"};const Rt=l.memo(({src_url:o})=>{const[e,t]=l.useState(!1),[n,r]=l.useState(0),[c,a]=l.useState(void 0),d=l.useRef(null);l.useEffect(()=>{d.current&&(d.current.children.length>0&&c&&a(x=>{if(x?.destroy(),d.current)for(const m of d.current.children)m.remove()}),d.current.children.length===0&&a(Wt.create({barWidth:5,cursorWidth:1,container:d.current,backend:"WebAudio",height:45,progressColor:"#f59e0b",responsive:!0,waveColor:"#cbd5e1",cursorColor:"transparent",barRadius:5,hideScrollbar:!0,normalize:!0})))},[]),l.useEffect(()=>{c&&(c.load(o),c.on("ready",()=>{r(c.getDuration())}))},[c]);const p=()=>{c&&(t(x=>!x),c.playPause())};return s.jsxs("div",{className:"flex w-[min-content] flex-row h-full items-start justify-start gap-3 bg-slate-200 rounded border-2 border-slate-500 p-1",children:[s.jsx("button",{className:"text-center flex justify-center items-center w-12 h-12 min-w-12 min-h-12 rounded-full outline-none cursor-pointer pb-1 bg-orange-500 border-orange-600 border hover:bg-orange-600 group",onClick:p,children:e?s.jsx(Xt,{size:24,className:"stroke-slate-700 group-hover:stroke-slate-600"}):s.jsx(Zt,{viewBox:"0 0 21 24",className:"stroke-slate-50 group-hover:stroke-slate-100"})}),s.jsxs("div",{className:"flex flex-col w-96 gap-2 justify-between",children:[s.jsx("div",{className:"w-full h-12",id:"waveform",ref:d}),s.jsx("span",{className:"w-full text-sm font-medium text-slate-600 text-right",children:gs(n)})]})]})});function gs(o){if(!o)return"00:00";const e=Math.floor(o/3600),t=Math.floor(o%3600/60),n=Math.floor(o%3600%60);return e===0&&t===0&&n===0?"00:00":e===0&&t===0?`00:${n.toString().padStart(2,"0")}`:e===0?`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${e}:${t}:${n}`}Rt.__docgenInfo={description:"",methods:[],displayName:"Waveform"};const He={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},Ge=l.memo(({event:o,roomID:e,hasPreviousEvent:t})=>{const n=l.useContext(T),r=P(e);return(a=>{if(es(a))if(a.content.format==="org.matrix.custom.html"){const d=Gt.sanitize(a.content.formatted_body,{ADD_TAGS:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","caption","pre","span","img","details","summary"]});let p=Yt(d,He);const m=/<pre><code (?:class="language-(?<language>.*?)")?.*?>(?<code>[\s\S]*?)<\/code><\/pre>/.exec(p);if(m?.groups?.code)if(m.groups?.language){const _=ot.highlight(m.groups?.code,{language:m.groups?.language}).value;p=p.replace(m.groups?.code,`${_}`)}else{const _=ot.highlightAuto(m.groups?.code).value;p=p.replace(m[0],`${_}`)}return s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:r?.getMemberName(a.sender)||a.sender,avatarUrl:r?.getMemberAvatar(a.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(a.sender)||a.sender}),s.jsx("p",{className:"whitespace-pre-wrap text-black text-base font-normal",dangerouslySetInnerHTML:{__html:p}})]})]})}else return s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:r?.getMemberName(a.sender)||a.sender,avatarUrl:r?.getMemberAvatar(a.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(a.sender)||a.sender}),s.jsx(Oe,{options:He,as:"p",className:"whitespace-pre-wrap text-black text-base font-normal",children:a.content.body})]})]});else if(ct(a)){const[d,p]=l.useState(void 0),[x,m]=l.useState(a.content.file!==void 0),_=i=>{console.log("Downloading image:",i.event_id),fetch(n.convertMXC(i.content.file.url),{headers:{Authorization:`Bearer ${n.accessToken}`}}).then(w=>{if(!w.ok){console.log("Unable to decrypt image:",w.text());return}console.log("Downloaded image:",i.event_id),w.arrayBuffer().then(u=>{rt.decryptAttachment(u,i.content.file).then(h=>{let v=i.content.info?.mimetype?i.content.info.mimetype.split(";")[0].trim():"";v=dt(v);const g=new Blob([h],{type:v});p(URL.createObjectURL(g)),m(!1),console.log("Decrypted image:",i.event_id)}).catch(h=>{console.log("Unable to decrypt image due to decryption error:",h),m(!0)})})})};return l.useEffect(()=>{ct(a)&&(a.content.url?p(n.convertMXC(a.content.url)):a.content.file&&_(a))},[a]),x?s.jsx(H,{event:a,roomID:e,hasPreviousEvent:t}):s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:r?.getMemberName(a.sender)||a.sender,avatarUrl:r?.getMemberAvatar(a.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(a.sender)||a.sender}),s.jsx("img",{src:d,alt:a.content.body,title:a.content.body,className:"rounded-md object-cover border-slate-400 border-2 max-h-[23.333rem] max-w-[23.333rem] h-[unset]"})]})]})}else if(lt(a)){const[d,p]=l.useState(void 0),[x,m]=l.useState(a.content.file!==void 0),_=i=>{console.log("Downloading audio file:",i.event_id),fetch(n.convertMXC(i.content.file.url),{headers:{Authorization:`Bearer ${n.accessToken}`}}).then(w=>{if(!w.ok){console.log("Unable to decrypt audio file:",w.text());return}console.log("Downloaded audio file:",i.event_id),w.arrayBuffer().then(u=>{rt.decryptAttachment(u,i.content.file).then(h=>{let v=i.content.info?.mimetype?i.content.info.mimetype.split(";")[0].trim():"";v=dt(v);const g=new Blob([h],{type:v});p(URL.createObjectURL(g)),m(!1),console.log("Decrypted audio file:",i.event_id)}).catch(h=>{console.log("Unable to decrypt audio file due to decryption error:",h),m(!0)})})})};return l.useEffect(()=>{lt(a)&&(a.content.url?p(n.convertMXC(a.content.url)):a.content.file&&_(a))},[a]),x?s.jsx(H,{event:a,roomID:e,hasPreviousEvent:t}):s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:r?.getMemberName(a.sender)||a.sender,avatarUrl:r?.getMemberAvatar(a.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:t?"flex-1 ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(a.sender)||a.sender}),d&&s.jsx(Rt,{src_url:d})]})]})}else return s.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&s.jsx(D,{displayname:r?.getMemberName(a.sender)||a.sender,avatarUrl:r?.getMemberAvatar(a.sender),online:r?.isOnline()||!1,dm:r?.isDM()||!1}),s.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&s.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-pre-wrap",children:r?.getMemberName(a.sender)||a.sender}),s.jsx(Oe,{options:He,as:"p",className:"whitespace-pre-wrap text-black text-base font-normal",children:a.content.body})]})]})})(o)}),hs=["image/jpeg","image/gif","image/png","image/apng","image/webp","image/avif","video/mp4","video/webm","video/ogg","video/quicktime","audio/mp4","audio/webm","audio/aac","audio/mpeg","audio/ogg","audio/wave","audio/wav","audio/x-wav","audio/x-pn-wav","audio/flac","audio/x-flac"];function dt(o){return hs.includes(o)?o:"application/octet-stream"}Ge.__docgenInfo={description:"",methods:[],displayName:"MessageEvent"};const fs={title:"Chat/Events/MessageEvents",component:Ge},le={args:{event:{content:{body:"._.",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},me={args:{event:{content:{body:"I think it's mostly a matter of doing the right `padding-block` in `.content`",format:"org.matrix.custom.html",formatted_body:"I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};kt.hostname="https://matrix.org";const de={args:{event:{content:{body:"image.png",info:{h:680,mimetype:"image/png",size:252133,thumbnail_info:{h:600,mimetype:"image/png",size:223185,w:600},thumbnail_url:"mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",w:680,"xyz.amorgan.blurhash":"UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"},msgtype:"m.image",url:"mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},ue={args:{event:{content:{body:"mixaund-bright-future.mp3",info:{mimetype:"audio/mpeg",size:9329941},msgtype:"m.audio",url:"mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};le.parameters={...le.parameters,docs:{...le.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "._.",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...le.parameters?.docs?.source}}};me.parameters={...me.parameters,docs:{...me.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "I think it's mostly a matter of doing the right \`padding-block\` in \`.content\`",
        format: "org.matrix.custom.html",
        formatted_body: "I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...me.parameters?.docs?.source}}};de.parameters={...de.parameters,docs:{...de.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "image.png",
        info: {
          h: 680,
          mimetype: "image/png",
          size: 252133,
          thumbnail_info: {
            h: 600,
            mimetype: "image/png",
            size: 223185,
            w: 600
          },
          thumbnail_url: "mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",
          w: 680,
          "xyz.amorgan.blurhash": "UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"
        },
        msgtype: "m.image",
        url: "mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...de.parameters?.docs?.source}}};ue.parameters={...ue.parameters,docs:{...ue.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "mixaund-bright-future.mp3",
        info: {
          mimetype: "audio/mpeg",
          size: 9329941
        },
        msgtype: "m.audio",
        url: "mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...ue.parameters?.docs?.source}}};const ys=["TextEvent","FormattedEvent","ImageEvent","AudioEvent"],xs=Object.freeze(Object.defineProperty({__proto__:null,AudioEvent:ue,FormattedEvent:me,ImageEvent:de,TextEvent:le,__namedExportsOrder:ys,default:fs},Symbol.toStringTag,{value:"Module"})),_s={title:"Chat/Events/RedactedEvent",component:Te},pe={name:"Redacted Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ge={name:"Redacted Event with Reason",args:{redacted_because:"Because I can",event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};pe.parameters={...pe.parameters,docs:{...pe.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...pe.parameters?.docs?.source}}};ge.parameters={...ge.parameters,docs:{...ge.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event with Reason",
  args: {
    redacted_because: "Because I can",
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ge.parameters?.docs?.source}}};const bs=["RedactedEventEvent","RedactedEventReasonEvent"],vs=Object.freeze(Object.defineProperty({__proto__:null,RedactedEventEvent:pe,RedactedEventReasonEvent:ge,__namedExportsOrder:bs,default:_s},Symbol.toStringTag,{value:"Module"})),ws={title:"Chat/Events/UndecryptableEvent",component:H},he={name:"Undecryptable Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};he.parameters={...he.parameters,docs:{...he.parameters?.docs,source:{originalSource:`{
  name: "Undecryptable Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...he.parameters?.docs?.source}}};const Ss=["UndecryptableEventEvent"],Es=Object.freeze(Object.defineProperty({__proto__:null,UndecryptableEventEvent:he,__namedExportsOrder:Ss,default:ws},Symbol.toStringTag,{value:"Module"})),js={title:"Chat/Events/UnknownEvent",component:Xe},fe={name:"Unknown Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};fe.parameters={...fe.parameters,docs:{...fe.parameters?.docs,source:{originalSource:`{
  name: "Unknown Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...fe.parameters?.docs?.source}}};const Ns=["UnknownEventEvent"],ks=Object.freeze(Object.defineProperty({__proto__:null,UnknownEventEvent:fe,__namedExportsOrder:Ns,default:js},Symbol.toStringTag,{value:"Module"})),Ye=l.memo(({children:o})=>s.jsx("h1",{className:"text-black font-bold text-xl",children:o}));Ye.__docgenInfo={description:"",methods:[],displayName:"Header",props:{children:{required:!0,tsType:{name:"string"},description:"The HeaderText"}}};const Is={title:"Fundamentals/Typography/Header",component:Ye,argTypes:{children:{required:!0,name:"Content",description:"The Headertext"}}},ye={args:{children:"Header"}};ye.parameters={...ye.parameters,docs:{...ye.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Header'
  }
}`,...ye.parameters?.docs?.source}}};const Rs=["Default"],Ds=Object.freeze(Object.defineProperty({__proto__:null,Default:ye,__namedExportsOrder:Rs,default:Is},Symbol.toStringTag,{value:"Module"})),$e=l.memo(({placeholder:o,password:e=!1,autoFocus:t=!1,value:n,readonly:r,onChange:c})=>s.jsx("input",{disabled:r,className:"text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:n,type:e?"password":"text",autoFocus:t,placeholder:o,onChange:c}));$e.__docgenInfo={description:"",methods:[],displayName:"Input",props:{password:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If it is a password input"},autoFocus:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If input should be autofocused"},placeholder:{required:!0,tsType:{name:"string"},description:"The Placeholder text"},value:{required:!0,tsType:{name:"string"},description:"The value of the input field"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the input is readonly"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{name:"e",type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"}}],return:{name:"void"}}},description:"Handler for the onChange event"}}};const Cs={title:"Fundamentals/Inputs/BasicInput",component:$e,argTypes:{placeholder:{required:!0,name:"Placeholder",description:"The Placeholder for the input field. Shown if it is empty."},password:{required:!1,name:"Password",control:"boolean",defaultValue:!1,description:"If the input field takes a password."},autoFocus:{required:!1,name:"Auto Focus",control:"boolean",defaultValue:!1,description:"If the field should be focused automatically."},value:{required:!0,name:"Value",description:"The current value of the input."},onChange:{description:"The onChange handler of the input field.",required:!0}}},xe={args:{placeholder:"Placeholder",password:!1,autoFocus:!1}};xe.parameters={...xe.parameters,docs:{...xe.parameters?.docs,source:{originalSource:`{
  args: {
    placeholder: "Placeholder",
    password: false,
    autoFocus: false
  }
}`,...xe.parameters?.docs?.source}}};const Ms=["Default"],Ts=Object.freeze(Object.defineProperty({__proto__:null,Default:xe,__namedExportsOrder:Ms,default:Cs},Symbol.toStringTag,{value:"Module"})),Os=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,Ls=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,Us=[o=>{const e=Os.exec(o);return e&&{index:e.index,length:e[0].length,text:e[0],url:e[0]}},o=>{const e=Ls.exec(o);return e&&{index:e.index,length:e[0].length,text:e[0],url:`mailto:${e[0]}`}}];function Dt(){return s.jsx(Qt.AutoLinkPlugin,{matchers:Us})}Dt.__docgenInfo={description:"",methods:[],displayName:"PlaygroundAutoLinkPlugin"};class V extends E.ParagraphNode{static getType(){return"custom-paragraph"}static clone(e){return new V(e.__key)}exportDOM(e){const{element:t}=super.exportDOM(e);if(this.isEmpty()){const n=E.$getRoot();let r=!1;for(const c of n.getChildren())c!==this&&(c instanceof V||c instanceof E.ParagraphNode)&&(c.isEmpty()||(r=!0));if(!r)return{element:null}}return{element:t}}exportJSON(){const e=super.exportJSON();return e.type="custom-paragraph",e}}function As(){return E.$applyNodeReplacement(new V)}const Ae=1,$s=new Set(["custom-paragraph","quote","code","h1","h2","ul","ol"]),Ps={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List","custom-paragraph":"Normal",quote:"Quote",ul:"Bulleted List"},ut=l.memo(()=>s.jsx("div",{className:"divider"}));function pt(o,e){e?(o.style.opacity="1",o.style.top=`${e.top+e.height+window.pageYOffset+10}px`,o.style.left=`${e.left+window.pageXOffset-o.offsetWidth/2+e.width/2}px`):(o.style.opacity="0",o.style.top="-1000px",o.style.left="-1000px")}const zs=l.memo(({editor:o})=>{const e=l.useRef(null),t=l.useRef(null),n=l.useRef(!1),[r,c]=l.useState(""),[a,d]=l.useState(!1),[p,x]=l.useState(null),m=l.useCallback(()=>{const i=E.$getSelection();if(E.$isRangeSelection(i)){const g=Ct(i),f=g.getParent();O.$isLinkNode(f)?c(f.getURL()):O.$isLinkNode(g)?c(g.getURL()):c("")}const w=e.current,u=window.getSelection(),h=document.activeElement;if(w===null)return;const v=o.getRootElement();if(i!==null&&!u?.isCollapsed&&v!==null&&v.contains(u?.anchorNode)){const g=u?.getRangeAt(0);let f;if(u?.anchorNode===v){let y=v;for(;y.firstElementChild!=null;)y=y.firstElementChild;f=y.getBoundingClientRect()}else f=g?.getBoundingClientRect();n.current||pt(w,f),x(i)}else(!h||h.className!=="link-input")&&(pt(w,void 0),x(null),d(!1),c(""));return!0},[o]);l.useEffect(()=>Ve.mergeRegister(o.registerUpdateListener(({editorState:i})=>{i.read(()=>{m()})}),o.registerCommand(E.SELECTION_CHANGE_COMMAND,()=>(m(),!0),Ae)),[o,m]),l.useEffect(()=>{o.getEditorState().read(()=>{m()})},[o,m]),l.useEffect(()=>{a&&t.current&&t.current.focus()},[a]);const _=l.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},r);return s.jsx("div",{ref:e,className:"link-editor",children:a?s.jsx("input",{ref:t,className:"link-input",value:r,onChange:i=>{c(i.target.value)},onKeyDown:i=>{i.key==="Enter"?(i.preventDefault(),p!==null&&(r!==""&&o.dispatchCommand(O.TOGGLE_LINK_COMMAND,r),d(!1))):i.key==="Escape"&&(i.preventDefault(),d(!1))}}):s.jsx(s.Fragment,{children:s.jsxs("div",{className:"link-input",children:[_,s.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:i=>i.preventDefault(),onClick:()=>{d(!0)}})]})})})}),Fs=l.memo(({onChange:o,className:e,options:t,value:n})=>s.jsxs("select",{className:e,onChange:o,value:n,children:[s.jsx("option",{hidden:!0,value:""}),t.map(r=>s.jsx("option",{value:r,children:r},r))]}));function Ct(o){const e=o.anchor,t=o.focus,n=o.anchor.getNode(),r=o.focus.getNode();return n===r?n:o.isBackward()?U.$isAtNodeEnd(t)?n:r:U.$isAtNodeEnd(e)?r:n}const qs=l.memo(({editor:o,blockType:e,toolbarRef:t,setShowBlockOptionsDropDown:n})=>{const r=l.useRef(null);l.useEffect(()=>{const i=r.current,w=t.current;if(i!==null&&w!==null){const u=h=>{const v=h.target;!i.contains(v)&&!w.contains(v)&&n(!1)};return document.addEventListener("click",u),()=>{document.removeEventListener("click",u)}}},[r,n,t]);const c=()=>{e!=="custom-paragraph"&&o.update(()=>{const i=E.$getSelection();E.$isRangeSelection(i)&&U.$wrapNodes(i,()=>As())}),n(!1)},a=()=>{e!=="h1"&&o.update(()=>{const i=E.$getSelection();E.$isRangeSelection(i)&&U.$wrapNodes(i,()=>q.$createHeadingNode("h1"))}),n(!1)},d=()=>{e!=="h2"&&o.update(()=>{const i=E.$getSelection();E.$isRangeSelection(i)&&U.$wrapNodes(i,()=>q.$createHeadingNode("h2"))}),n(!1)},p=()=>{e!=="ul"?o.dispatchCommand(A.INSERT_UNORDERED_LIST_COMMAND,void 0):o.dispatchCommand(A.REMOVE_LIST_COMMAND,void 0),n(!1)},x=()=>{e!=="ol"?o.dispatchCommand(A.INSERT_ORDERED_LIST_COMMAND,void 0):o.dispatchCommand(A.REMOVE_LIST_COMMAND,void 0),n(!1)},m=()=>{e!=="quote"&&o.update(()=>{const i=E.$getSelection();E.$isRangeSelection(i)&&U.$wrapNodes(i,()=>q.$createQuoteNode())}),n(!1)},_=()=>{e!=="code"&&o.update(()=>{const i=E.$getSelection();E.$isRangeSelection(i)&&U.$wrapNodes(i,()=>$.$createCodeNode())}),n(!1)};return s.jsxs("div",{className:"dropdown",ref:r,children:[s.jsxs("button",{className:"item",onClick:c,children:[s.jsx(ft,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Normal"}),e==="custom-paragraph"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:a,children:[s.jsx(yt,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Large Heading"}),e==="h1"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:d,children:[s.jsx(xt,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Small Heading"}),e==="h2"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:p,children:[s.jsx(_t,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Bullet List"}),e==="ul"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:x,children:[s.jsx(bt,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Numbered List"}),e==="ol"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:m,children:[s.jsx(vt,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Quote"}),e==="quote"&&s.jsx("span",{className:"active"})]}),s.jsxs("button",{className:"item",onClick:_,children:[s.jsx(Be,{className:"icon",size:20}),s.jsx("span",{className:"text",children:"Code Block"}),e==="code"&&s.jsx("span",{className:"active"})]})]})}),Mt=l.memo(()=>{const[o]=Pe.useLexicalComposerContext(),e=l.useRef(null),[t,n]=l.useState(!1),[r,c]=l.useState(!1),[a,d]=l.useState("custom-paragraph"),[p,x]=l.useState(null),[m,_]=l.useState(!1),[i,w]=l.useState(""),[u,h]=l.useState(!1),[v,g]=l.useState(!1),[f,y]=l.useState(!1),[S,C]=l.useState(!1),[b,N]=l.useState(!1),[R,I]=l.useState(!1),[z,$t]=l.useState(!1),ze=l.useCallback(()=>{const k=E.$getSelection();if(E.$isRangeSelection(k)){const M=k.anchor.getNode(),L=M.getKey()==="root"?M:M.getTopLevelElementOrThrow(),nt=L.getKey();if(o.getElementByKey(nt)!==null)if(x(nt),A.$isListNode(L)){const Ue=Ve.$getNearestNodeOfType(M,A.ListNode),Bt=Ue?Ue.getTag():L.getTag();d(Bt)}else{const Ue=q.$isHeadingNode(L)?L.getTag():L.getType();d(Ue),$.$isCodeNode(L)&&w(L.getLanguage()||$.getDefaultCodeLanguage())}y(k.hasFormat("bold")),C(k.hasFormat("italic")),N(k.hasFormat("underline")),I(k.hasFormat("strikethrough")),$t(k.hasFormat("code")),h(U.$isParentElementRTL(k));const st=Ct(k),Vt=st.getParent();O.$isLinkNode(Vt)||O.$isLinkNode(st)?g(!0):g(!1)}},[o]);l.useEffect(()=>Ve.mergeRegister(o.registerUpdateListener(({editorState:k})=>{k.read(()=>{ze()})}),o.registerCommand(E.SELECTION_CHANGE_COMMAND,(k,M)=>(ze(),!1),Ae),o.registerCommand(E.CAN_UNDO_COMMAND,k=>(n(k),!1),Ae),o.registerCommand(E.CAN_REDO_COMMAND,k=>(c(k),!1),Ae)),[o,ze]);const Pt=l.useMemo(()=>$.getCodeLanguages(),[]),zt=l.useCallback(k=>{o.update(()=>{if(p!==null){const M=E.$getNodeByKey(p);$.$isCodeNode(M)&&M.setLanguage(k.target.value)}})},[o,p]),Ft=l.useCallback(()=>{v?o.dispatchCommand(O.TOGGLE_LINK_COMMAND,null):o.dispatchCommand(O.TOGGLE_LINK_COMMAND,"https://")},[o,v]),[qt,Ht]=l.useState(null);return l.useEffect(()=>{const k=document.getElementsByClassName("editor-container")[0],M=document.createElement("div");return k.prepend(M),Ht(M),()=>{k.removeChild(M)}},[]),s.jsxs("div",{className:"toolbar",ref:e,children:[s.jsx("button",{disabled:!t,onClick:()=>{o.dispatchCommand(E.UNDO_COMMAND,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:s.jsx(en,{className:"format",size:20})}),s.jsx("button",{disabled:!r,onClick:()=>{o.dispatchCommand(E.REDO_COMMAND,void 0)},className:"toolbar-item","aria-label":"Redo",children:s.jsx(tn,{className:"format",size:20})}),s.jsx(ut,{}),$s.has(a)&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"toolbar-item block-controls",onClick:()=>_(!m),"aria-label":"Formatting Options",children:[a==="h1"?s.jsx(yt,{className:"icon",size:20}):a==="h2"?s.jsx(xt,{className:"icon",size:20}):a==="h3"?s.jsx(nn,{className:"icon",size:20}):a==="h4"?s.jsx(sn,{className:"icon",size:20}):a==="h5"?s.jsx(on,{className:"icon",size:20}):a==="code"?s.jsx(Be,{className:"icon",size:20}):a==="custom-paragraph"?s.jsx(ft,{className:"icon",size:20}):a==="ol"?s.jsx(bt,{className:"icon",size:20}):a==="ul"?s.jsx(_t,{className:"icon",size:20}):a==="quote"?s.jsx(vt,{className:"icon",size:20}):s.jsx(s.Fragment,{}),s.jsx("span",{className:"text",children:Ps[a]}),s.jsx(wt,{size:20})]}),m&&at.createPortal(s.jsx(qs,{editor:o,blockType:a,toolbarRef:e,setShowBlockOptionsDropDown:_}),qt),s.jsx(ut,{})]}),a==="code"?s.jsxs(s.Fragment,{children:[s.jsx(Fs,{className:"toolbar-item code-language",onChange:zt,options:Pt,value:i}),s.jsx("i",{className:"chevron-down inside"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{o.dispatchCommand(E.FORMAT_TEXT_COMMAND,"bold")},className:"toolbar-item spaced "+(f?"active":""),"aria-label":"Format Bold",children:s.jsx(rn,{className:"format",size:20})}),s.jsx("button",{onClick:()=>{o.dispatchCommand(E.FORMAT_TEXT_COMMAND,"italic")},className:"toolbar-item spaced "+(S?"active":""),"aria-label":"Format Italics",children:s.jsx(an,{className:"format",size:20})}),s.jsx("button",{onClick:()=>{o.dispatchCommand(E.FORMAT_TEXT_COMMAND,"underline")},className:"toolbar-item spaced "+(b?"active":""),"aria-label":"Format Underline",children:s.jsx(cn,{className:"format",size:20})}),s.jsx("button",{onClick:()=>{o.dispatchCommand(E.FORMAT_TEXT_COMMAND,"strikethrough")},className:"toolbar-item spaced "+(R?"active":""),"aria-label":"Format Strikethrough",children:s.jsx(ln,{className:"format",size:20})}),s.jsx("button",{onClick:()=>{o.dispatchCommand(E.FORMAT_TEXT_COMMAND,"code")},className:"toolbar-item spaced "+(z?"active":""),"aria-label":"Insert Code",children:s.jsx(Be,{className:"format",size:20})}),s.jsx("button",{onClick:Ft,className:"toolbar-item spaced "+(v?"active":""),"aria-label":"Insert Link",children:s.jsx(mn,{className:"format",size:20})}),v&&at.createPortal(s.jsx(zs,{editor:o}),document.body)," "]})]})});Mt.__docgenInfo={description:"",methods:[],displayName:"ToolbarPlugin"};function Hs(){const[o]=Pe.useLexicalComposerContext();return l.useEffect(()=>$.registerCodeHighlighting(o),[o]),null}const Vs={ltr:"ltr",rtl:"rtl",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough",code:"editor-text-code"},code:"editor-code",codeHighlight:{atrule:"editor-tokenAttr",attr:"editor-tokenAttr",boolean:"editor-tokenProperty",builtin:"editor-tokenSelector",cdata:"editor-tokenComment",char:"editor-tokenSelector",class:"editor-tokenFunction","class-name":"editor-tokenFunction",comment:"editor-tokenComment",constant:"editor-tokenProperty",deleted:"editor-tokenProperty",doctype:"editor-tokenComment",entity:"editor-tokenOperator",function:"editor-tokenFunction",important:"editor-tokenVariable",inserted:"editor-tokenSelector",keyword:"editor-tokenAttr",namespace:"editor-tokenVariable",number:"editor-tokenProperty",operator:"editor-tokenOperator",prolog:"editor-tokenComment",property:"editor-tokenProperty",punctuation:"editor-tokenPunctuation",regex:"editor-tokenVariable",selector:"editor-tokenSelector",string:"editor-tokenSelector",symbol:"editor-tokenProperty",tag:"editor-tokenProperty",url:"editor-tokenOperator",variable:"editor-tokenVariable"}};function Bs(){return s.jsx("div",{className:"editor-placeholder",id:"editor-placeholder",children:"Enter message..."})}const Js=l.memo(({roomID:o,htmlMessage:e,plainMessage:t,onStartSending:n,onStopSending:r})=>{const c=P(o||""),[a]=Pe.useLexicalComposerContext();return s.jsx(dn,{size:45,stroke:"unset",className:"stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer",onClick:async()=>{if(c&&!(e===""&&t===""||e==='<p class="editor-paragraph"><br></p>')){if(n(),console.log("Sending message to: ",o),e!=='<p class="editor-paragraph"><br></p>')try{await c.sendHtmlMessage(e,t),a.dispatchCommand(E.CLEAR_EDITOR_COMMAND,void 0),localStorage.removeItem(`editor-${o}`)}catch(d){console.log(d)}else try{await c.sendTextMessage(t),a.dispatchCommand(E.CLEAR_EDITOR_COMMAND,void 0),localStorage.removeItem(`editor-${o}`)}catch(d){console.log(d)}r()}}})}),Ks=({roomID:o})=>{const[e]=Pe.useLexicalComposerContext(),{pathname:t}=St(),[n,r]=l.useState(void 0);return l.useEffect(()=>{if(o){if(o!==n){console.log("Saving editor state");const a=e.getEditorState();localStorage.setItem(`editor-${n}`,JSON.stringify(a.toJSON()))}r(o);const c=localStorage.getItem(`editor-${o}`);if(c){const a=e.parseEditorState(c);e.setEditorState(a)}else e.dispatchCommand(E.CLEAR_EDITOR_COMMAND,void 0)}},[t,o]),s.jsx(s.Fragment,{})},Qe=l.memo(({namespace:o,roomID:e})=>{const[t,n]=l.useState(""),[r,c]=l.useState(""),[a,d]=l.useState(!1),p={namespace:o,theme:Vs,onError:x=>console.error(x),editable:!a,nodes:[q.HeadingNode,A.ListNode,A.ListItemNode,q.QuoteNode,$.CodeNode,$.CodeHighlightNode,qe.TableNode,qe.TableCellNode,qe.TableRowNode,O.AutoLinkNode,O.LinkNode,V,{replace:E.ParagraphNode,with:x=>new V}]};return s.jsx("div",{className:"flex flex-row items-end",children:s.jsxs(un.LexicalComposer,{initialConfig:p,children:[s.jsxs("div",{className:"editor-container flex-1",children:[s.jsx(Mt,{}),s.jsxs("div",{className:"editor-inner",children:[s.jsx(pn.RichTextPlugin,{contentEditable:s.jsx(gn.ContentEditable,{className:"editor-input",ariaLabelledBy:"editor-placeholder"}),placeholder:s.jsx(Bs,{}),ErrorBoundary:hn}),s.jsx(fn.OnChangePlugin,{onChange:(x,m)=>{x.read(()=>{let _=yn.$generateHtmlFromNodes(m);const i=/(?<all><code .* (?:data-highlight-language="(?<language>.*?)")(?: .*?)?>(?<code>[\s\S]*?)<\/code>)/;let w=i.exec(_);for(;w!==null;){if(w){const{groups:h}=w;if(h){let{all:v,language:g,code:f}=h;const y=/<span(?: class=".*?")?>(?<content>.*?)<\/span>/;let S=y.exec(f);for(;S!==null;){if(S){const{groups:C}=S;if(C){const{content:b}=C;f=f.replaceAll(S[0],b)}}S=y.exec(f)}f=f.replaceAll("<br>",`
`),_=_.replace(v,`<pre><code class="language-${g}">${f}</code></pre>`)}}w=i.exec(_)}n(_);const u=Fe.$convertToMarkdownString(Fe.TRANSFORMERS);c(u)})}}),s.jsx(xn.HistoryPlugin,{}),s.jsx(_n.LinkPlugin,{}),s.jsx(Hs,{}),s.jsx(Dt,{}),s.jsx(bn.MarkdownShortcutPlugin,{transformers:Fe.TRANSFORMERS}),s.jsx(vn.ClearEditorPlugin,{}),s.jsx(Ks,{roomID:e})]})]}),s.jsx(Js,{roomID:e,htmlMessage:t,plainMessage:r,onStartSending:()=>{console.log("Sending"),d(!0)},onStopSending:()=>{d(!1)}})]})})});Qe.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{namespace:{required:!0,tsType:{name:"string"},description:"The Namespace"},roomID:{required:!1,tsType:{name:"string"},description:"The current Room"}}};const Ws={title:"Chat/Input",component:Qe,decorators:[Ke],argTypes:{namespace:{required:!0,name:"Namespace",description:"The Namespace of the editor."}}},_e={args:{namespace:"Editor"}};_e.parameters={..._e.parameters,docs:{..._e.parameters?.docs,source:{originalSource:`{
  args: {
    namespace: "Editor"
  }
}`,..._e.parameters?.docs?.source}}};const Zs=["Default"],Xs=Object.freeze(Object.defineProperty({__proto__:null,Default:_e,__namedExportsOrder:Zs,default:Ws},Symbol.toStringTag,{value:"Module"})),et=l.memo(({roomId:o,avatarUrl:e,displayname:t,dm:n=!1,online:r=!1,active:c=!1,onClick:a,hidden:d})=>{const p=l.useContext(T),{ref:x,inView:m}=Et({triggerOnce:!0,skip:d,threshold:1,onChange(_){_?p.addInViewRoom(o):p.removeInViewRoom(o)}});return s.jsx("div",{ref:x,onClick:a,className:"w-full cursor-pointer",children:m&&(c?s.jsxs("div",{className:"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center",children:[s.jsx(D,{avatarUrl:e,displayname:t,dm:n,online:r}),s.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}):s.jsxs("div",{className:"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center",children:[s.jsx(D,{avatarUrl:e,displayname:t,dm:n,online:r}),s.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}))})});et.__docgenInfo={description:"",methods:[],displayName:"RoomListItem",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},active:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the current room is selected"},roomId:{required:!0,tsType:{name:"string"},description:"Room id"},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the room list item"},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The onClick handler"},hidden:{required:!0,tsType:{name:"boolean"},description:"If room is hidden"}}};const Gs=l.memo(({sectionID:o,rooms:e,onClick:t,activeRoom:n,hidden:r})=>{const c=e.map(a=>s.jsx(et,{roomId:a.roomID,hidden:r,avatarUrl:a.avatarUrl,displayname:a.displayname,dm:a.dm,online:a.online,active:a.roomID===n,onClick:()=>{t(a.roomID)}},`${a.roomID}+${o}`));return s.jsx(s.Fragment,{children:c})}),Je=l.memo(({section:o,onRoomClick:e,activeRoom:t})=>{const[n,r]=l.useState(!0),c=l.useContext(T),{ref:a,inView:d}=Et({triggerOnce:!0,threshold:1,onChange(p){o.roomID!=="other"&&(p?c.addInViewRoom(o.roomID):c.removeInViewRoom(o.roomID))}});return l.useEffect(()=>{n?c.removeSpaceOpen(o.roomID):c.addSpaceOpen(o.roomID)},[n]),s.jsxs("div",{ref:a,className:"flex flex-col gap-1 pl-4 select-none",children:[d&&s.jsxs("div",{className:"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600",onClick:()=>r(p=>!p),children:[n?s.jsx(wn,{size:14}):s.jsx(wt,{size:14}),s.jsx("span",{className:"font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:o.sectionName})]}),!n&&d&&s.jsx(Gs,{hidden:n,sectionID:o.roomID,rooms:o.rooms,onClick:e,activeRoom:t}),!n&&d&&o.subsections.map(p=>s.jsx(Je,{section:p,onRoomClick:e,activeRoom:t},p.roomID))]},o.roomID)}),tt=l.memo(({sections:o,rooms:e})=>{const[t,n]=l.useState(void 0),r=Sn();return s.jsxs("div",{className:"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]",children:[o.map(c=>s.jsx(Je,{section:c,onRoomClick:a=>{n(a),r(`/${encodeURIComponent(a)}`)},activeRoom:t},c.roomID)),s.jsx(Je,{section:{sectionName:"Others",roomID:"other",subsections:[],rooms:e},onRoomClick:c=>{n(c),r(`/${encodeURIComponent(c)}`)},activeRoom:t})]})});tt.__docgenInfo={description:"",methods:[],displayName:"RoomList",props:{sections:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * Section Name. Can be a Space or a Tag
     */
    sectionName: string
    /**
     * The Rooms within the Section
     */
    rooms: Room[]
    /**
     * The Subsections of the Section
     */
    subsections: Section[]
    /**
     * The roomid of the Space
     */
    roomID: string
}`,signature:{properties:[{key:"sectionName",value:{name:"string",required:!0}},{key:"rooms",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]",required:!0}},{key:"subsections",value:{name:"Array",elements:[{name:"Section"}],raw:"Section[]",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Section[]"},description:"The Sections available"},rooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections"}}};const Ys={title:"Chat/RoomList",component:tt,decorators:[Ke],argTypes:{sections:{required:!0,defaultValue:[],name:"Sections",description:"The Sections available"},rooms:{required:!0,defaultValue:[],name:"Rooms",description:"Rooms outside of any Sections"}}},be={args:{rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0},{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],sections:[{sectionName:"Test Section",rooms:[{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],roomID:"12",subsections:[{sectionName:"Test Subsection",rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}],roomID:"14",subsections:[]}]}]}};be.parameters={...be.parameters,docs:{...be.parameters?.docs,source:{originalSource:`{
  args: {
    rooms: [{
      roomID: "1",
      displayname: "test",
      avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
      dm: true,
      online: true
    }, {
      roomID: "2",
      displayname: "test1",
      dm: false,
      online: false
    }, {
      roomID: "3",
      displayname: "test2",
      dm: false,
      online: false
    }],
    sections: [{
      sectionName: "Test Section",
      rooms: [{
        roomID: "2",
        displayname: "test1",
        dm: false,
        online: false
      }, {
        roomID: "3",
        displayname: "test2",
        dm: false,
        online: false
      }],
      roomID: "12",
      subsections: [{
        sectionName: "Test Subsection",
        rooms: [{
          roomID: "1",
          displayname: "test",
          avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
          dm: true,
          online: true
        }],
        roomID: "14",
        subsections: []
      }]
    }]
  }
}`,...be.parameters?.docs?.source}}};const Qs=["RootList"],eo=Object.freeze(Object.defineProperty({__proto__:null,RootList:be,__namedExportsOrder:Qs,default:Ys},Symbol.toStringTag,{value:"Module"})),to={title:"Chat/RoomList/Item",component:et,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"Displayname",description:"The displayname of the Room"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the room is a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"},active:{required:!1,defaultValue:!1,control:"boolean",name:"Active",description:"Wether the room is currently selected"}}},ve={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!1}},we={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!0}},Se={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!1}},Ee={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!0}},je={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!1}},Ne={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!0}},ke={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!1}},Ie={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!0}},Re={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1,active:!1}},De={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0,active:!1}};ve.parameters={...ve.parameters,docs:{...ve.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: false
  }
}`,...ve.parameters?.docs?.source}}};we.parameters={...we.parameters,docs:{...we.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: true
  }
}`,...we.parameters?.docs?.source}}};Se.parameters={...Se.parameters,docs:{...Se.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: false
  }
}`,...Se.parameters?.docs?.source}}};Ee.parameters={...Ee.parameters,docs:{...Ee.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: true
  }
}`,...Ee.parameters?.docs?.source}}};je.parameters={...je.parameters,docs:{...je.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: false
  }
}`,...je.parameters?.docs?.source}}};Ne.parameters={...Ne.parameters,docs:{...Ne.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: true
  }
}`,...Ne.parameters?.docs?.source}}};ke.parameters={...ke.parameters,docs:{...ke.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: false
  }
}`,...ke.parameters?.docs?.source}}};Ie.parameters={...Ie.parameters,docs:{...Ie.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: true
  }
}`,...Ie.parameters?.docs?.source}}};Re.parameters={...Re.parameters,docs:{...Re.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false,
    active: false
  }
}`,...Re.parameters?.docs?.source}}};De.parameters={...De.parameters,docs:{...De.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true,
    active: false
  }
}`,...De.parameters?.docs?.source}}};const no=["Fallback","FallbackActive","Image","ImageActive","DMOffline","DMOfflineActive","DMOnline","DMOnlineActive","DMNoAvatarOffline","DMNoAvatarOnline"],so=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:Re,DMNoAvatarOnline:De,DMOffline:je,DMOfflineActive:Ne,DMOnline:ke,DMOnlineActive:Ie,Fallback:ve,FallbackActive:we,Image:Se,ImageActive:Ee,__namedExportsOrder:no,default:to},Symbol.toStringTag,{value:"Module"}));function oo(o={}){const{wrapper:e}=Object.assign({},it(),o.components);return e?s.jsx(e,{...o,children:s.jsx(t,{})}):t();function t(){const n=Object.assign({h1:"h1",p:"p"},it(),o.components);return s.jsxs(s.Fragment,{children:[s.jsx(En,{title:"Introduction/Welcome"}),`
`,s.jsx(n.h1,{id:"about-cetirizine",children:"About Cetirizine"}),`
`,s.jsx(n.p,{children:"Welcome to the Cetirizine Design System!"}),`
`,s.jsx(n.p,{children:`This storybook design system describes in depth the components used within the
Cetirizine Matrix Client.`}),`
`,s.jsx(n.p,{children:`The Design heavily leans on the Tailwindcss Design System. However there are speciic
components for some things and Pages are also documented.`})]})}}const Tt=()=>{throw new Error("Docs-only story")};Tt.parameters={docsOnly:!0};const Le={title:"Introduction/Welcome",tags:["stories-mdx"],includeStories:["__page"]};Le.parameters=Le.parameters||{};Le.parameters.docs={...Le.parameters.docs||{},page:oo};const ro=["__page"],ao=Object.freeze(Object.defineProperty({__proto__:null,__namedExportsOrder:ro,__page:Tt,default:Le},Symbol.toStringTag,{value:"Module"}));const Ot=l.memo(()=>{const o=l.useContext(T),[e,t]=l.useState(!1),[n,r]=l.useState(""),[c,a]=l.useState(""),[d,p]=l.useState("");if(o.isLoggedIn)return s.jsx(jn,{to:"/"});const x=async()=>{try{t(!0),await o.passwordLogin(c,d)}catch(m){r(m.toString())}t(!1)};return s.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:m=>{m.preventDefault(),x()},children:[s.jsx(Ye,{children:"Login"}),n?s.jsx("h2",{className:"text-red-500 font-normal text-sm",children:n}):s.jsx("div",{className:"min-h-[1.25rem]"}),s.jsx($e,{readonly:e,value:c,placeholder:"Username",onChange:m=>a(m.target.value)}),s.jsx($e,{readonly:e,value:d,password:!0,placeholder:"Password",onChange:m=>p(m.target.value)}),s.jsx(We,{readonly:e,style:"primary",type:"submit",children:"Login"})]})});Ot.__docgenInfo={description:"",methods:[],displayName:"Login"};const Lt=l.memo(()=>s.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:s.jsx(Ot,{})}));Lt.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const io={title:"Pages/LoginPage",component:Lt},Ce={};Ce.parameters={...Ce.parameters,docs:{...Ce.parameters?.docs,source:{originalSource:"{}",...Ce.parameters?.docs?.source}}};const co=["Default"],lo=Object.freeze(Object.defineProperty({__proto__:null,Default:Ce,__namedExportsOrder:co,default:io},Symbol.toStringTag,{value:"Module"}));const mo=l.memo(({roomID:o,scrollRef:e})=>{const t=P(decodeURIComponent(o||"")),n=l.useContext(T),r=as(t),{pathname:c}=St(),[a,d]=l.useState([]),p=m=>{const _=m?.filter((i,w,u)=>u.findIndex(h=>h.event_id===i.event_id)===w).sort((i,w)=>i.origin_server_ts-w.origin_server_ts);Promise.all(_?.filter(i=>i.type!=="m.reaction"&&i.type!=="m.room.redaction"&&!i.content["m.relates_to"]).map(async(i,w)=>{let u=_?.filter(N=>N.type!=="m.reaction")[w-1];const h=u?.sender===i.sender;let v=u?.type;const g=_?.filter(N=>N.type==="m.reaction"&&N.content["m.relates_to"].event_id===i.event_id),f=_?.find(N=>N.type==="m.room.redaction"&&N.redacts===i.event_id),y=f!==void 0;let S,C;y&&(C=f?.event_id,f.content.reason&&(S=f.content.reason));const b=_?.find(N=>N.content["m.relates_to"]?N.content["m.relates_to"].rel_type==="m.replace"&&N.content["m.relates_to"].event_id===i.event_id:!1);if(b&&(i=b,b.content["m.new_content"]&&(i.content.body=b.content["m.new_content"].body,i.content.formatted_body=b.content["m.new_content"].formatted_body,i.content.format=b.content["m.new_content"].format)),i.type==="m.room.encrypted")try{const N=await n.olmMachine?.decryptRoomEvent(JSON.stringify(i),new j.RoomId(o||""));if(N)i=JSON.parse(N.event),i.content["m.new_content"]&&(i.content.body=i.content["m.new_content"].body,i.content.formatted_body=i.content["m.new_content"].formatted_body,i.content.format=i.content["m.new_content"].format);else return y?s.jsx(Te,{event:i,redacted_because:S,roomID:o,hasPreviousEvent:h},C):s.jsx(H,{event:i,hasPreviousEvent:h,roomID:o},i.event_id)}catch(N){return console.error(N),y?s.jsx(Te,{event:i,redacted_because:S,roomID:o,hasPreviousEvent:h},C):s.jsx(H,{event:i,hasPreviousEvent:h,roomID:o},i.event_id)}if(u?.type==="m.room.encrypted")try{const N=await n.olmMachine?.decryptRoomEvent(JSON.stringify(u),new j.RoomId(o||""));N&&(u=JSON.parse(N.event),v=u.type,u.content["m.new_content"]&&(u.content.body=u.content["m.new_content"].body,u.content.formatted_body=u.content["m.new_content"].formatted_body,u.content.format=u.content["m.new_content"].format))}catch(N){console.error(N)}return x(i,h,v,g,y,S,C)})).then(i=>{d(i)})};l.useEffect(()=>{r&&p(r)},[r]),l.useEffect(()=>{e.current?.scrollTo(0,e.current?.scrollHeight)},[c]);const x=(m,_,i,w,u,h,v)=>{if(u)return s.jsx(Te,{event:m,redacted_because:h,roomID:o,hasPreviousEvent:_},v);switch(m.type){case"m.room.message":return s.jsx(Ge,{reactions:w,event:m,roomID:o,hasPreviousEvent:_&&i==="m.room.message"},m.event_id);case"m.room.member":return s.jsx(Ze,{event:m},m.event_id);default:return s.jsx(Xe,{event:m},m.event_id)}};return s.jsx("div",{className:"max-w-[130ch] flex flex-col",children:a})}),Ut=l.memo(()=>{const o=ps(),e=us(),t=ds(),n=l.useContext(T);let r=Nn();const c=P(decodeURIComponent(r.roomIdOrAlias||""));n.setCurrentRoom(r.roomIdOrAlias?decodeURIComponent(r.roomIdOrAlias):void 0);const a=l.useRef(null),d=[...e].filter(({spaceRoom:u})=>{const h=!u.isTombstoned(),v=![...e].some(({children:f})=>[...f].some(y=>y.roomID===u.roomID)),g=u.getSpaceParentIDs().length===0;return v&&g&&h}),p=[...t].filter(u=>{const h=!u.isTombstoned(),v=![...e].some(({children:y})=>[...y].some(S=>S.roomID===u.roomID)),g=u.getSpaceParentIDs().length===0,f=!u.isSpace();return v&&g&&f&&h}).sort((u,h)=>{const v=u.windowPos.overview,g=h.windowPos.overview;return v===-1?1:g===-1?-1:v-g}),x=d.map(u=>{const h=[...u.children].filter(g=>!g.isSpace()&&!g.isTombstoned()).sort((g,f)=>{const y=g.windowPos[u.spaceRoom.roomID],S=f.windowPos[u.spaceRoom.roomID];return y===-1?1:S===-1?-1:y-S}).map(g=>({roomID:g.roomID,displayname:g.getName(),avatarUrl:g.getAvatarURL(),dm:g.isDM(),online:g.isOnline()})),v=g=>{const f=[...e].find(y=>y.spaceRoom.roomID===g.roomID);if(f){const y=[...f?.children].filter(S=>!S.isSpace()&&!S.isTombstoned()).map(S=>({roomID:S.roomID,displayname:S.getName(),avatarUrl:S.getAvatarURL(),dm:S.isDM(),online:S.isOnline()}));return{sectionName:g.getName(),rooms:y,roomID:g.roomID,subsections:[...f?.children].filter(S=>S.isSpace()&&!S.isTombstoned()).map(v).filter(S=>S!==void 0)}}};return{sectionName:u.spaceRoom.getName(),rooms:h,roomID:u.spaceRoom.roomID,subsections:[...u.children].filter(g=>g.isSpace()).map(v)}}),m=p.filter(u=>!u.isSpace()).map(u=>({roomID:u.roomID,displayname:u.getName(),avatarUrl:u.getAvatarURL(),dm:u.isDM(),online:u.isOnline()})),_=m.map(u=>u.roomID),i=_.filter((u,h)=>_.indexOf(u)!==h);i.length>0&&console.error("otherRooms has duplicates",i);const w={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"};return s.jsxs("div",{className:"flex flex-row gap-2 min-h-screen h-screen",children:[s.jsxs("div",{className:"flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300",children:[s.jsxs("div",{className:"flex flex-row gap-2 m-2 p-1 items-center border-b-2",children:[s.jsx(D,{displayname:o.displayname||n.mxid,avatarUrl:o?.avatar_url,dm:!1,online:!1}),s.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[s.jsx("span",{className:"text-base font-semibold",children:o?.displayname}),s.jsx(kn,{size:28,stroke:"unset",className:"stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer"})]})]}),s.jsx(tt,{sections:x,rooms:m})]}),c&&s.jsxs("div",{className:"flex-1 flex flex-col",children:[s.jsxs("div",{className:"pb-2 flex flex-row items-center border-b-2 mt-4 ml-2",children:[s.jsx(D,{displayname:c.getName(),avatarUrl:c.getAvatarURL(),dm:c.isDM(),online:c.isOnline()}),s.jsxs("div",{className:"flex flex-row items-start",children:[s.jsx("h1",{className:"text-black font-semibold text-lg flex-shrink-0",children:c.getName()}),s.jsx(Oe,{options:w,as:"p",className:"ml-4 text-slate-700 font-normal text-base line-clamp-2 text-ellipsis",children:c.getTopic()})]})]}),s.jsx("div",{ref:a,className:"overflow-y-auto overflow-x-hidden scrollbarSmall mr-2 my-1 flex-1 w-full flex flex-col-reverse",children:s.jsx(mo,{roomID:r.roomIdOrAlias,scrollRef:a})}),s.jsx(Qe,{namespace:"Editor",roomID:decodeURIComponent(r.roomIdOrAlias||"")})]})]})});Ut.__docgenInfo={description:"",methods:[],displayName:"MainPage"};const uo={title:"Pages/MainPage",component:Ut,decorators:[Ke]},Me={};Me.parameters={...Me.parameters,docs:{...Me.parameters?.docs,source:{originalSource:"{}",...Me.parameters?.docs?.source}}};const po=["Default"],go=Object.freeze(Object.defineProperty({__proto__:null,Default:Me,__namedExportsOrder:po,default:uo},Symbol.toStringTag,{value:"Module"}));function At(o){return{"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":Hn,"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":Jn,"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":Zn,"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":xs,"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":vs,"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":Es,"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":ks,"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":Ds,"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":Ts,"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":Xs,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":eo,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":so,"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":ao,"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":lo,"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":go}[o]}Object.assign(At,{keys:()=>["/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx"],resolve:o=>({"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":"./src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":"./src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":"./src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":"./src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":"./src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":"./src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":"./src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":"./src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":"./src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":"./src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":"./src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":"./src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":"./src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":"./src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":"./src/pages/MainPage.stories.tsx"})[o]});function ho(o){o(At,{hot:void 0},!1)}__STORYBOOK_MODULE_CLIENT_LOGGER__;const fo=__STORYBOOK_MODULE_PREVIEW_API__,{addDecorator:yo,addParameters:gt,addLoader:xo,addArgs:_o,addArgTypes:bo,addStepRunner:vo,addArgTypesEnhancer:wo,addArgsEnhancer:So,setGlobalRender:Eo}=fo,jo=[In,Rn,Dn,Cn,Mn,Tn,On,Ln,Un,An,zn].filter(Boolean);jo.map(o=>o.default?o.default:o).forEach(o=>{Object.keys(o).forEach(e=>{const t=o[e];switch(e){case"args":return _o(t);case"argTypes":return bo(t);case"decorators":return t.forEach(n=>yo(n,!1));case"loaders":return t.forEach(n=>xo(n,!1));case"parameters":return gt({...t},!1);case"argTypesEnhancers":return t.forEach(n=>wo(n));case"argsEnhancers":return t.forEach(n=>So(n));case"render":return Eo(t);case"globals":case"globalTypes":{const n={};return n[e]=t,gt(n,!1)}case"decorateStory":case"applyDecorators":case"renderToDOM":case"renderToCanvas":return null;case"runStep":return vo(t);default:return console.log(e+" was not supported :( !")}})});ho($n);
//# sourceMappingURL=iframe-8b318469.js.map
