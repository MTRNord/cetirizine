import"../sb-preview/runtime.js";import{r as m,j as o,m as N,E as Ye,o as Yt,d as Qt,L as $e,W as en,P as tn,a as nn,p as sn,H as mt,l as on,b as rn,c as an,e as b,f as T,g as We,h as L,T as bt,i as wt,k as St,n as Et,q as jt,Q as kt,C as Ze,s as Ve,t as A,u as q,v as P,U as cn,R as ln,w as mn,x as dn,y as un,z as Nt,A as dt,B as pn,I as gn,D as hn,S as fn,F as yn,G as xn,J as _n,K as vn,M as bn,N as wn,O as Sn,V as En,X as Xe,Y as jn,Z as kn,_ as It,$ as Ke,a0 as Nn,a1 as Qe,a2 as Dt,a3 as In,a4 as Dn,a5 as ut,a6 as Rn,a7 as Mn,a8 as On,a9 as Cn,aa as Tn,ab as Un,ac as Ln,ad as An,ae as Pn,af as $n,ag as zn,ah as Fn,ai as qn,aj as Hn,ak as Vn,al as Bn}from"./vendor-0f859d4c.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const Rt="light",Mt=(n,e)=>{const{theme:t}=e.globals;return m.useEffect(()=>{document.documentElement.setAttribute("data-mode",t||Rt)},[t]),o.jsx(n,{})};Mt.__docgenInfo={description:"",methods:[],displayName:"withTailwindTheme"};const Jn={parameters:{actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},options:{storySort:{order:["Introduction","Fundamentals","*"]}}},globalTypes:{theme:{name:"Theme",description:"Global theme for components",defaultValue:Rt,toolbar:{icon:"paintbrush",items:[{value:"light",title:"Light",left:"ðŸŒž"},{value:"dark",title:"Dark",left:"ðŸŒ›"}],dynamicTitle:!0}}},decorators:[Mt]},Kn=Object.freeze(Object.defineProperty({__proto__:null,default:Jn},Symbol.toStringTag,{value:"Module"}));var w=(n=>(n[n.Online=0]="Online",n[n.Offline=1]="Offline",n[n.Unknown=2]="Unknown",n))(w||{});const R=m.memo(({avatarUrl:n,displayname:e,dm:t=!1,online:s=w.Unknown})=>{const[a,i]=m.useState(!1);return n&&!a?o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[o.jsx("img",{className:"rounded-full w-8 h-8 object-cover",alt:e,src:n,onError:()=>{i(!0)}}),t?s===w.Online?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):s===w.Offline?o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx("div",{className:"bg-gray-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx(o.Fragment,{})]}):o.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[e.replace("@","").replace("!","").replace("#","")[0].toUpperCase(),t?s===w.Online?o.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):s===w.Offline?o.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx("div",{className:"bg-gray-500 rounded-full w-3 h-3 absolute right-0 bottom-0"}):o.jsx(o.Fragment,{})]})});R.__docgenInfo={description:"",methods:[],displayName:"Avatar",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"OnlineState.Unknown",computed:!0},required:!1,tsType:{name:"OnlineState"},description:"Wether the user is online. Only used if dm is true."},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the avatar user"}}};const Wn={title:"Chat/Avatar",component:R,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"User ID",description:"The DISPLAY name of the User"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the Avatar is used for a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"}}},B={args:{displayname:"test",dm:!1,online:w.Unknown,avatarUrl:""}},J={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:w.Unknown}},K={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Offline}},W={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Unknown}},Z={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online}},X={args:{displayname:"test",avatarUrl:"",dm:!0,online:w.Offline}},G={args:{displayname:"test",avatarUrl:"",dm:!0,online:w.Unknown}},Y={args:{displayname:"test",avatarUrl:"",dm:!0,online:w.Online}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: OnlineState.Unknown,
    avatarUrl: ""
  }
}`,...B.parameters?.docs?.source}}};J.parameters={...J.parameters,docs:{...J.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: OnlineState.Unknown
  }
}`,...J.parameters?.docs?.source}}};K.parameters={...K.parameters,docs:{...K.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Offline
  }
}`,...K.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Unknown
  }
}`,...W.parameters?.docs?.source}}};Z.parameters={...Z.parameters,docs:{...Z.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Online
  }
}`,...Z.parameters?.docs?.source}}};X.parameters={...X.parameters,docs:{...X.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: OnlineState.Offline
  }
}`,...X.parameters?.docs?.source}}};G.parameters={...G.parameters,docs:{...G.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: OnlineState.Unknown
  }
}`,...G.parameters?.docs?.source}}};Y.parameters={...Y.parameters,docs:{...Y.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: OnlineState.Online
  }
}`,...Y.parameters?.docs?.source}}};const Zn=["Fallback","Image","DMOffline","DMUnknown","DMOnline","DMNoAvatarOffline","DMNoAvatarUnknown","DMNoAvatarOnline"],Xn=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:X,DMNoAvatarOnline:Y,DMNoAvatarUnknown:G,DMOffline:K,DMOnline:Z,DMUnknown:W,Fallback:B,Image:J,__namedExportsOrder:Zn,default:Wn},Symbol.toStringTag,{value:"Module"}));const et=m.memo(({type:n="button",style:e="primary",onClick:t,children:s,readonly:a})=>e==="secondary"?o.jsx("button",{disabled:a,onClick:t,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}):e==="abort"?o.jsx("button",{disabled:a,onClick:t,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}):o.jsx("button",{disabled:a,onClick:t,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:n,children:s}));et.__docgenInfo={description:"",methods:[],displayName:"Button",props:{type:{defaultValue:{value:'"button"',computed:!1},required:!1,tsType:{name:"union",raw:'"button" | "submit" | "reset"',elements:[{name:"literal",value:'"button"'},{name:"literal",value:'"submit"'},{name:"literal",value:'"reset"'}]},description:"The button type"},style:{defaultValue:{value:'"primary"',computed:!1},required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "abort"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"abort"'}]},description:"The button style"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The button onClick handler"},children:{required:!0,tsType:{name:"string"},description:"The button Label"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the button is readonly"}}};const Gn={title:"Fundamentals/Buttons/BasicButton",component:et,argTypes:{children:{required:!0,name:"Label",description:"The button label"},onClick:{description:"The button onClick handler",required:!0},type:{description:"The button type",control:"select",options:["button","submit","reset"],defaultValue:"button"},style:{description:"The button styling",control:"select",options:["primary","secondary","abort"],defaultValue:"primary"}}},Q={args:{children:"Click me",type:"button",style:"primary"}},ee={args:{children:"Submit",type:"submit",style:"primary"}},te={args:{children:"Reset",type:"reset",style:"primary"}},ne={args:{children:"Click me",type:"button",style:"secondary"}},se={args:{children:"Submit",type:"submit",style:"secondary"}},oe={args:{children:"Reset",type:"reset",style:"secondary"}},re={args:{children:"Abort",type:"button",style:"abort"}};Q.parameters={...Q.parameters,docs:{...Q.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'primary'
  }
}`,...Q.parameters?.docs?.source}}};ee.parameters={...ee.parameters,docs:{...ee.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'primary'
  }
}`,...ee.parameters?.docs?.source}}};te.parameters={...te.parameters,docs:{...te.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'primary'
  }
}`,...te.parameters?.docs?.source}}};ne.parameters={...ne.parameters,docs:{...ne.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'secondary'
  }
}`,...ne.parameters?.docs?.source}}};se.parameters={...se.parameters,docs:{...se.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'secondary'
  }
}`,...se.parameters?.docs?.source}}};oe.parameters={...oe.parameters,docs:{...oe.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'secondary'
  }
}`,...oe.parameters?.docs?.source}}};re.parameters={...re.parameters,docs:{...re.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Abort',
    type: 'button',
    style: 'abort'
  }
}`,...re.parameters?.docs?.source}}};const Yn=["Default","Submit","Reset","DefaultSecondary","SubmitSecondary","ResetSecondary","Abort"],Qn=Object.freeze(Object.defineProperty({__proto__:null,Abort:re,Default:Q,DefaultSecondary:ne,Reset:te,ResetSecondary:oe,Submit:ee,SubmitSecondary:se,__namedExportsOrder:Yn,default:Gn},Symbol.toStringTag,{value:"Module"})),tt=m.memo(({event:n})=>(t=>o.jsxs("p",{className:"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out",children:[t.content.displayname?t.content.displayname:t.state_key," ",t.content.membership==="join"?"joined the room":t.content.membership==="leave"?"left the room":t.content.membership==="ban"?"was banned from the room by "+t.sender:t.content.membership==="invite"?"was invited to the room by "+t.sender:t.content.membership==="knock"?"knocked on the room":"changed their membership status to "+t.content.membership]}))(n));tt.__docgenInfo={description:"",methods:[],displayName:"MemberEvent"};const es={title:"Chat/Events/MembershipEvents",component:tt},ae={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ie={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"leave",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},ce={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"invite",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},le={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"knock",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},me={args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"ban",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};ae.parameters={...ae.parameters,docs:{...ae.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ae.parameters?.docs?.source}}};ie.parameters={...ie.parameters,docs:{...ie.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "leave",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ie.parameters?.docs?.source}}};ce.parameters={...ce.parameters,docs:{...ce.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "invite",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ce.parameters?.docs?.source}}};le.parameters={...le.parameters,docs:{...le.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "knock",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...le.parameters?.docs?.source}}};me.parameters={...me.parameters,docs:{...me.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "ban",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...me.parameters?.docs?.source}}};const ts=["JoinEvent","LeaveEvent","InviteEvent","KnockEvent","BanEvent"],ns=Object.freeze(Object.defineProperty({__proto__:null,BanEvent:me,InviteEvent:ce,JoinEvent:ae,KnockEvent:le,LeaveEvent:ie,__namedExportsOrder:ts,default:es},Symbol.toStringTag,{value:"Module"}));function ss(n){return n.type==="m.room.message"&&n.content.msgtype==="m.text"}function os(n){return n.type==="m.room.message"&&n.content.msgtype==="m.notice"}function pt(n){return n.type==="m.room.message"&&n.content.msgtype==="m.image"}function gt(n){return n.type==="m.room.message"&&n.content.msgtype==="m.audio"}function ht(n){return n.state_key!==void 0}function rs(n){return n.type==="m.room.create"}function as(n){return n.type==="m.room.avatar"}function is(n){return n.type==="m.space.child"}function cs(n){return n.type==="m.space.parent"}function ls(n){return n.type==="m.room.topic"}class ms{constructor(e,t){this.client=e,this.user=t}olmMachine;outgoingRequestsBeingProcessed=!1;missingSessionsBeingRequested=!1;async decryptRoomEvent(e,t){return await this.olmMachine?.decryptRoomEvent(JSON.stringify(t),new N.RoomId(e))}async receiveSyncData(e,t,s,a){return await this.olmMachine?.receiveSyncChanges(e,t,s,a)}async encryptRoomEvent(e,t,s){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.olmMachine)throw Error("Olm machine must be set first");return await this.olmMachine?.encryptRoomEvent(e,t,s)}async initOlmMachine(e,t,s){this.olmMachine=await N.OlmMachine.initialize(e,t,"cetirizine-crypto",s)}async updateTrackedUsers(e){await this.olmMachine?.updateTrackedUsers(e)}async sendIdentifyAndOneTimeKeys(){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.user.hostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.outgoingRequestsBeingProcessed)return;this.outgoingRequestsBeingProcessed=!0;const e=await this.olmMachine.outgoingRequests();for(const t of e)await this.processRequest(t);await this.getMissingSessions(),this.outgoingRequestsBeingProcessed=!1}async shareKeysForRoom(e){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.user.hostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");const t=e.getEncryptionSettings();if(t){const s=await this.olmMachine.shareRoomKey(new N.RoomId(e.roomID),e.getJoinedMemberIDs().map(a=>new N.UserId(a)),t);for(const a of s)await this.processRequest(a)}}async getMissingSessions(){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.user.hostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(this.missingSessionsBeingRequested)return;this.missingSessionsBeingRequested=!0;const t=[...this.client.getRooms()].filter(a=>a.isEncrypted()).map(a=>a.getJoinedMemberIDs().map(i=>new N.UserId(i))).flat(),s=await this.olmMachine?.getMissingSessions(t);s&&await this.processRequest(s),this.missingSessionsBeingRequested=!1}async processRequest(e){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.user.hostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");if(e.type===N.RequestType.KeysUpload){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/keys/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to upload keys",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===N.RequestType.KeysQuery){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/keys/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to query keys",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===N.RequestType.KeysClaim){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/keys/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to claim keys",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===N.RequestType.ToDevice){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/sendToDevice/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to send to device",s);return}this.olmMachine.markRequestAsSent(t.id??t.txn_id,t.type,await s.text())}else if(e.type===N.RequestType.SignatureUpload){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/keys/signatures/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to upload signatures",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===N.RequestType.RoomMessage){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/rooms/${t.room_id}/send/${t.event_type}/${t.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to send message",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}else if(e.type===N.RequestType.KeysBackup){const t=e,s=await fetch(`${this.user.hostname}/_matrix/client/v3/room_keys/keys`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:t.body});if(!s.ok){s.status===401&&(await this.client.logout(),console.error(s)),console.error("Failed to backup keys",s);return}this.olmMachine.markRequestAsSent(t.id,t.type,await s.text())}}logoutE2ee(){this.missingSessionsBeingRequested=!1,this.outgoingRequestsBeingProcessed=!1}}class ds{constructor(e){this.client=e,this.e2ee=new ms(this.client,this)}access_token;device_id;mxid;hostname;slidingSyncHostname;e2ee;async logout(){if(!this.mxid){console.log("Not logged in");return}if(!this.access_token)throw Error("Not logged in");if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/logout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`}});if(!e.ok)throw console.error(e),Error("Error logging out. See console for error.");this.access_token=void 0,this.device_id=void 0,this.slidingSyncHostname=void 0}async setHostname(e){if(!e.startsWith("https://"))throw Error("Hostname must start with 'https://'");this.client.database||await this.client.createDatabase();const t=this.client.database?.transaction("loginInfo","readwrite");await t?.store.put({userId:this.mxid,hostname:e,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,device_id:this.device_id}),await t?.done,this.hostname=e}async getLoginFlows(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/login`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async getWellKnown(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/.well-known/matrix/client`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async passwordLogin(e,t,s=5){if(this.client.database||await this.client.createDatabase(),!e)throw Error("Username must be set");if(!t)throw Error("Password must be set");this.mxid=e,await this.setHostname(`https://${e.split(":")[1]}`);try{const l=await this.getWellKnown();if(l["m.homeserver"]?.base_url&&await this.setHostname(l["m.homeserver"].base_url),l["org.matrix.msc3575.proxy"]?.url){const g=this.client.database?.transaction("loginInfo","readwrite");await g?.store.put({userId:this.mxid,hostname:this.hostname,slidingSyncHostname:l["org.matrix.msc3575.proxy"].url,access_token:this.access_token,device_id:this.device_id}),await g?.done,this.slidingSyncHostname=l["org.matrix.msc3575.proxy"].url}else throw Error("No sliding sync proxy found")}catch(l){console.warn(`No well-known found for ${this.hostname}:
${l}`)}if(((await this.getLoginFlows()).flows.filter(l=>l.type==="m.login.password")?.length||0)==0)throw Error("Password login is not supported by this homeserver");const i=await fetch(`${this.hostname}/_matrix/client/r0/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"m.login.password",identifier:{type:"m.id.user",user:e},user:e,password:t})});if(!i.ok)throw console.error(i),Error("Error logging in. See console for error.");const r=await i.json();if(ps(r))throw Error(`Error logging in: ${r.errcode}: ${r.error}`);if(vs(r)&&(console.error(`Rate limited. Retrying in ${r.retry_after_ms}ms. ${s} tries left.`),await this.passwordLogin(e,t,s-1)),us(r)){const l=this.client.database?.transaction("loginInfo","readwrite");await l?.store.put({userId:r.user_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:r.access_token,device_id:r.device_id}),await l?.done,this.access_token=r.access_token,this.device_id=r.device_id,this.mxid=r.user_id,await this.e2ee.initOlmMachine(new N.UserId(this.mxid),new N.DeviceId(this.device_id))}}}function us(n){return n.access_token!==void 0}function ps(n){return n.errcode!==void 0}class F extends Ye{constructor(e,t,s,a){super(),this.roomID=e,this.hostname=t,this.client=s,this.e2ee=a}events=[];pendingEvents=[];stateEvents=[];name;notification_count=0;notification_highlight_count=0;joined_count=0;invited_count=0;is_dm=!1;windowPos={};addEvents(e){console.log("Adding events"),e.forEach(t=>{t.unsigned?.transaction_id&&(this.pendingEvents=this.pendingEvents.filter(s=>s.unsigned?.transaction_id!==t.unsigned?.transaction_id)),this.events.push(t)}),this.emit("events",this.getEvents())}addStateEvents(e){e.forEach(t=>{const s=this.stateEvents.findIndex(a=>a.state_key===t.state_key&&a.type===t.type);s!==-1?this.stateEvents[s]=t:this.stateEvents.push(t)}),this.emit("state_events",this.stateEvents)}getStateEvents(){return this.stateEvents}isTombstoned(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.tombstone"&&(e=!0)}),e}getAvatarURL(){let e;return this.stateEvents.forEach(t=>{if(as(t)){const s=t.content.url;s?.startsWith("mxc://")&&(e=this.client.convertMXC(s))}}),e}isSpace(){let e=!1;return this.stateEvents.forEach(t=>{rs(t)&&(e=t.content.type==="m.space")}),e}setName(e){this.name=e}getName(){return this.name?this.name:this.roomID}getTopic(){let e;return this.stateEvents.forEach(t=>{ls(t)&&(e=t.content.topic)}),e}setNotificationCount(e){this.notification_count=e}getNotificationCount(){return this.notification_count}setNotificationHighlightCount(e){this.notification_highlight_count=e}getNotificationHighlightCount(){return this.notification_highlight_count}setJoinedCount(e){this.joined_count=e}getJoinedCount(){return this.joined_count}setInvitedCount(e){this.invited_count=e}getInvitedCount(){return this.invited_count}getSpaceChildrenIDs(){const e=[];return this.stateEvents.forEach(t=>{is(t)&&e.push(t.state_key)}),e}getSpaceParentIDs(){const e=[];return this.stateEvents.forEach(t=>{cs(t)&&e.push({roomID:t.state_key,canonical:t.content.canonical||!1})}),e}setDM(e){this.is_dm=e}isDM(){return this.is_dm}get presence(){return w.Unknown}getEvents(){return[...this.events,...this.pendingEvents]}getPureEvents(){return this.events}getMemberName(e){let t=e;return this.stateEvents.forEach(s=>{s.type==="m.room.member"&&s.state_key===e&&s.content.membership=="join"&&(t=s.content.displayname)}),t}getMemberAvatar(e,t=32){let s;return this.stateEvents.forEach(a=>{if(a.type==="m.room.member"&&a.state_key===e&&a.content.membership=="join"){const i=a.content.avatar_url;i?.startsWith("mxc://")&&(s=this.client.convertMXC(i,t))}}),s}isEncrypted(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.content.algorithm==="m.megolm.v1.aes-sha2"&&t.state_key===""&&(e=!0)}),e}deletePendingByEventID(e){this.pendingEvents=this.pendingEvents.filter(t=>t.eventID!==e),this.emit("events",this.getEvents())}async sendHtmlMessage(e,t,s){const a=Date.now().toString(),i={type:"m.room.message",unsigned:{transaction_id:a},origin_server_ts:a,sender:this.client.mxid,event_id:a,content:{msgtype:"m.text",body:t,format:"org.matrix.custom.html",formatted_body:e}};if(this.pendingEvents.push(i),this.emit("events",this.getEvents()),s(),this.isEncrypted()){console.log("Sending encrypted message"),await this.e2ee.getMissingSessions(),await this.e2ee.shareKeysForRoom(this);const r=await this.e2ee.encryptRoomEvent(new N.RoomId(this.roomID),"m.room.message",JSON.stringify(i.content)),l=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${i.unsigned?.transaction_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:r});if(!l.ok)throw this.deletePendingByEventID(i.event_id),new Error(`Failed to send message: ${l.status} ${l.statusText}`);const g=await l.json();return this.deletePendingByEventID(i.event_id),g.event_id}else{const r=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${i.unsigned?.transaction_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify(i.content)});if(!r.ok)throw this.deletePendingByEventID(i.event_id),new Error(`Failed to send message: ${r.status} ${r.statusText}`);const l=await r.json();return this.deletePendingByEventID(i.event_id),l.event_id}}async sendTextMessage(e,t){const s=Date.now().toString(),a={type:"m.room.message",unsigned:{transaction_id:s},origin_server_ts:s,event_id:s,sender:this.client.mxid,content:{msgtype:"m.text",body:e}};if(this.pendingEvents.push(a),this.emit("events",this.getEvents()),t(),this.isEncrypted()){console.log("Sending encrypted message2"),await this.e2ee.getMissingSessions(),await this.e2ee.shareKeysForRoom(this);const i=await this.e2ee.encryptRoomEvent(new N.RoomId(this.roomID),"m.room.message",JSON.stringify(a.content)),r=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${a.unsigned?.transaction_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:i});if(!r.ok)throw this.deletePendingByEventID(a.event_id),new Error(`Failed to send message: ${r.status} ${r.statusText}`);const l=await r.json();return this.deletePendingByEventID(a.event_id),l.event_id}else{const i=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${a.unsigned?.transaction_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.client.accessToken}`},body:JSON.stringify(a.content)});if(!i.ok)throw this.deletePendingByEventID(a.event_id),new Error(`Failed to send message: ${i.status} ${i.statusText}`);const r=await i.json();return this.deletePendingByEventID(a.event_id),r.event_id}}getJoinedMemberIDs(){const e=[];return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.content.membership==="join"&&e.push(t.state_key)}),e}getEncryptionSettings(){let e;return this.stateEvents.forEach(t=>{t.type==="m.room.encryption"&&t.state_key===""&&(e||(e=new N.EncryptionSettings),e.algorithm=t.content.algorithm==="m.megolm.v1.aes-sha2"?N.EncryptionAlgorithm.MegolmV1AesSha2:N.EncryptionAlgorithm.OlmV1Curve25519AesSha2,t.content.rotation_period_ms&&(e.rotationPeriod=BigInt(t.content.rotation_period_ms)),t.content.rotation_period_msgs&&(e.rotationPeriodMessages=BigInt(t.content.rotation_period_msgs))),t.type==="m.room.history_visibility"&&t.state_key===""&&(e||(e=new N.EncryptionSettings),e.historyVisibility=t.content.history_visibility)}),e&&(e.onlyAllowTrustedDevices=!1),e}isJoined(){let e=!1;return this.stateEvents.forEach(t=>{t.type==="m.room.member"&&t.state_key===this.client.mxid&&(e=t.content.membership==="join")}),e}}function gs(n){return n.op==="SYNC"}function hs(n){return n.op==="INSERT"}function fs(n){return n.op==="INVALIDATE"}function ys(n){return n.op==="DELETE"}class xs extends Ye{constructor(e,t){super(),this.client=e,this.user=t}syncing=!1;syncPos;initialSync=!0;lastRanges;lastTxnID;to_device_since;mustUpdateTxnID=!0;rooms=new Set;abortController=new AbortController;applyStoredSyncInfo(e){this.syncPos=e.syncPos,this.initialSync=e.initialSync,this.lastRanges=e.lastRanges,this.lastTxnID=e.lastTxnID,this.to_device_since=e.to_device_since}logout(){this.stopSync(),this.abortController.abort(),this.rooms=new Set,this.initialSync=!0,this.syncPos=void 0,this.to_device_since=void 0}resetAbortController(){this.abortController=new AbortController}async startSync(){if(!this.client.isLoggedIn)throw Error("Not logged in");if(this.client.database||await this.client.createDatabase(),!this.syncing)for(this.syncing=!0;this.syncing;)try{await this.sync()}catch(e){console.error(e)}}stopSync(){this.syncing=!1}isIndexInRange(e,t){for(const s of t)if(s[0]<e&&e<=s[1])return!0;return!1}shiftRight(e,t,s,a){for(let i=s-1;i>a-1;i--)if(this.isIndexInRange(i,t)){const r=[...this.rooms].find(l=>l.windowPos[e]===i+1);r&&(r.windowPos[e]=i)}}shiftLeft(e,t,s,a){for(let i=a+1;i<s+1;i++)if(this.isIndexInRange(i,t)){const r=[...this.rooms].find(l=>l.windowPos[e]===i-1);r&&(r.windowPos[e]=i)}}async removeEntry(e,t,s){let a=-1;const i=[...this.rooms].map(r=>r.windowPos[e]);for(const r in i)Number(r)>a&&(a=Number(r));a<0||s>a||this.shiftLeft(e,t,a,s)}addEntry(e,t,s){let a=-1;const i=[...this.rooms].map(r=>r.windowPos[e]);for(const r in i)Number(r)>a&&(a=Number(r));a<0||s>a||this.shiftRight(e,t,a+1,s)}async sync(){if(!this.client.isLoggedIn)throw Error("Not logged in");if(!this.user.slidingSyncHostname)throw Error("Hostname must be set first");Promise.all([this.user.e2ee.sendIdentifyAndOneTimeKeys()]);const e={overview:[[0,20]],spaces:[[0,20]]};for(const u of this.client.spaceOpen)u!=="other"&&u!=="dm"&&(e[u]=[[0,20]]);let t=1,s=10;if(!this.initialSync){for(const u in e){t=10,s=50;let S=new Set([...this.rooms].filter(d=>this.client.roomsInView.includes(d.roomID)).map(d=>d.windowPos[u]).sort().filter(d=>d!=null));if(this.client.getSpaces().find(d=>d.roomID===u)&&(S=new Set([...this.rooms].filter(d=>this.client.spacesInView.includes(d.roomID)).map(d=>d.windowPos[u]).sort().filter(d=>d!=null))),S.size!==0){const d=Math.min(...S),E=Math.max(...S);e[u]=[[Math.max(d-10,0),E+10]]}}e.e2ee=e.overview}this.lastRanges&&Object.entries(e).toString()!==Object.entries(this.lastRanges).toString()&&(console.log("Ranges changed, resetting sync txn_id",e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.lastRanges||(this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.mustUpdateTxnID&&(this.lastTxnID=Date.now().toString(),this.mustUpdateTxnID=!1);let a=`${this.user.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000`;this.syncPos&&(a=`${this.user.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000&pos=${this.syncPos}`);const i={txn_id:this.lastTxnID,lists:{spaces:{ranges:this.lastRanges.spaces,sort:["by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:0,filters:{room_types:["m.space"]}},overview:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"]}},e2ee:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","*"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{not_room_types:["m.space"],is_encrypted:!0}}},bump_event_types:["m.room.message","m.room.encrypted"],extensions:{e2ee:{enabled:!0},to_device:{enabled:!0,since:this.to_device_since},typing:{enabled:!0,lists:["overview","e2ee"]},receipts:{enabled:!0,lists:["overview","e2ee"]}}};for(const u of this.client.spaceOpen)u!=="other"&&u!=="dm"&&(i.lists||(i.lists={}),i.lists[u]={slow_get_all_rooms:!0,ranges:this.lastRanges[u],sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:t,filters:{spaces:[u]}});this.client.currentRoom&&(i.room_subscriptions={},i.room_subscriptions[this.client.currentRoom]={sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.tombstone",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"],["m.room.encryption",""],["m.room.history_visibility",""]],timeline_limit:s,filters:{}});const r=await fetch(a,{method:"POST",signal:this.abortController.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.user.access_token}`},body:JSON.stringify(i)});if(!r.ok)if(r.status===400){if((await r.json()).errcode==="M_UNKNOWN_POS"){this.syncPos=void 0;const u=this.client.database?.transaction("syncInfo","readwrite");await u?.store.put({userId:this.user.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID}),await u?.done}return}else r.status===401&&(await this.logout(),console.error(r),console.error("Error syncing. See console for error."));const l=await r.json();this.syncPos=l.pos,l.extensions?.to_device&&(await this.user.e2ee.receiveSyncData(JSON.stringify(l.extensions.to_device.events||[]),new N.DeviceLists(l.extensions.e2ee?.device_lists?.changed?.map(u=>new N.UserId(u)),l.extensions.e2ee?.device_lists?.left?.map(u=>new N.UserId(u))),new Map(Object.entries(l.extensions.e2ee?.device_one_time_keys_count||[])),new Set(l.extensions.e2ee?.device_unused_fallback_key_types)),this.to_device_since=l.extensions.to_device.next_batch),await this.user.e2ee.sendIdentifyAndOneTimeKeys();const g=this.client.database?.transaction("syncInfo","readwrite");await g?.store.put({userId:this.user.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID,to_device_since:this.to_device_since}),await g?.done;let y=-1;for(const u in l.lists){const S=l.lists[u];if(S.ops){for(const d of S.ops)if(gs(d)){const E=this.client.database?.transaction("rooms","readwrite");for(let c=d.range[0];c<=d.range[1];c++){const h=d.room_ids[c-d.range[0]];if(!h)break;const x=[...this.rooms].find(f=>f.roomID===h);if(x){x.windowPos[u]=c;continue}const p=new F(h,this.user.hostname,this.client,this.user.e2ee);p.setName(h),p.windowPos[u]=c,this.rooms.add(p),await E?.store.put({windowPos:p.windowPos,roomID:p.roomID,name:p.getName(),notification_count:p.getNotificationCount(),highlight_count:p.getNotificationHighlightCount(),joined_count:p.getJoinedCount(),invited_count:p.getInvitedCount(),avatarUrl:p.getAvatarURL(),isSpace:p.isSpace(),isDM:p.isDM(),stateEvents:p.getStateEvents(),events:p.getEvents()})}await E?.done}else if(hs(d)){console.log("Got INSERT OP",d),[...this.rooms].find(f=>f.windowPos[u]===d.index)&&(y<0?this.addEntry(u,this.lastRanges[u],d.index):y>d.index?this.shiftRight(u,this.lastRanges[u],y,d.index):y<d.index&&this.shiftLeft(u,this.lastRanges[u],d.index,y)),y=-1;const c=this.client.database?.transaction("rooms","readwrite"),h=[...this.rooms].find(f=>f.roomID===d.room_id);if(h)h.windowPos[u]=d.index,await c?.store.put({windowPos:h.windowPos,roomID:h.roomID,name:h.getName(),notification_count:h.getNotificationCount(),highlight_count:h.getNotificationHighlightCount(),joined_count:h.getJoinedCount(),invited_count:h.getInvitedCount(),avatarUrl:h.getAvatarURL(),isSpace:h.isSpace(),isDM:h.isDM(),stateEvents:h.getStateEvents(),events:h.getEvents()});else{const f=await c?.store.get(d.room_id);let _=new F(d.room_id,this.user.hostname,this.client,this.user.e2ee);_.setName(d.room_id),_.windowPos[u]=d.index,f&&(console.warn("Room in db but not in obj list.",d.room_id,"Updating obj list."),_=new F(d.room_id,this.user.hostname,this.client,this.user.e2ee),_.setName(f.name),_.setNotificationCount(f.notification_count),_.setNotificationHighlightCount(f.highlight_count),_.setJoinedCount(f.joined_count),_.setInvitedCount(f.invited_count),_.setDM(f.isDM||!1)),this.rooms.add(_),await c?.store.put({windowPos:_.windowPos,roomID:_.roomID,name:_.getName(),notification_count:_.getNotificationCount(),highlight_count:_.getNotificationHighlightCount(),joined_count:_.getJoinedCount(),invited_count:_.getInvitedCount(),avatarUrl:_.getAvatarURL(),isSpace:_.isSpace(),isDM:_.isDM(),stateEvents:_.getStateEvents(),events:_.getEvents()})}const x=[...this.rooms].map(f=>f.roomID),p=x.filter((f,_)=>x.indexOf(f)!=_);p.length>0&&console.error("Duplicates found",p),await c?.done}else ys(d)?(console.log("Got DELETE OP",d),y!==-1&&await this.removeEntry(u,this.lastRanges[u],y),y=d.index):fs(d);y!==-1&&await this.removeEntry(u,this.lastRanges[u],y)}}for(const u in l.rooms){const S=l.rooms[u],d=S.name,E=S.notification_count,c=S.highlight_count,h=S.joined_count,x=S.invited_count,p=S.timeline,f=p?.filter(I=>ht(I)).map(I=>I),_=p?.filter(I=>!ht(I)).map(I=>I),j=S.required_state,O=S.is_dm;let v=[...this.rooms].find(I=>I.roomID===u);if(!v){console.warn("Could not find roomObj for roomID:",u);const I=this.client.database?.transaction("rooms","readwrite"),k=await I?.store.get(u);await I?.done,k?(console.warn("Room in db but not in obj list.",u,"Updating obj list."),v=new F(u,this.user.hostname,this.client,this.user.e2ee),v.setName(k.name),v.setNotificationCount(k.notification_count),v.setNotificationHighlightCount(k.highlight_count),v.setJoinedCount(k.joined_count),v.setInvitedCount(k.invited_count),v.setDM(k.isDM||!1),k.events&&v.addEvents(k.events),k.stateEvents&&v.addStateEvents(k.stateEvents),v.windowPos=k.windowPos):(console.warn("Could not find room in db. Creating new one."),v=new F(u,this.user.hostname,this.client,this.user.e2ee),this.rooms.add(v))}if(d&&v.setName(d),v.setNotificationCount(E),v.setNotificationHighlightCount(c),v.setJoinedCount(h),v.setInvitedCount(x),_&&v.addEvents(_),j&&v.addStateEvents(j),f&&v.addStateEvents(f),(j||f)&&v.isEncrypted()&&v.isJoined()){const k=[...j||[],...f||[]].filter(z=>z.type==="m.room.member"&&z.content.membership==="join").map(z=>new N.UserId(z.state_key));await this.user.e2ee.updateTrackedUsers(k)}O&&v.setDM(O);const $=this.client.database?.transaction("rooms","readwrite");await $?.store.put({windowPos:v.windowPos,roomID:v.roomID,name:v.getName(),notification_count:v.getNotificationCount(),highlight_count:v.getNotificationHighlightCount(),joined_count:v.getJoinedCount(),invited_count:v.getInvitedCount(),events:v.getPureEvents(),stateEvents:v.getStateEvents(),avatarUrl:v.getAvatarURL(),isSpace:v.isSpace(),isDM:v.isDM()}),await $?.done}this.initialSync&&(this.initialSync=!1,console.log("initialSyncComplete")),l.rooms&&Object.keys(l.rooms).length>0&&this.emit("rooms",this.rooms)}}class _s extends Ye{static _instance;roomsInView=[];spacesInView=[];spaceOpen=[];database;profileInfo;currentRoom;user=new ds(this);sync=new xs(this,this.user);get accessToken(){return this.user.access_token}get isLoggedIn(){return this.user.access_token!==void 0}get mxid(){return this.user.mxid}onSyncRooms(e){this.emit("rooms",e)}async passwordLogin(e,t){await this.user.passwordLogin(e,t),this.sync.on("rooms",s=>this.onSyncRooms(s))}convertMXC(e,t){return t?`${this.user.hostname}/_matrix/media/v3/thumbnail/${e.substring(6)}?width=${t}&height=${t}&method=scale`:`${this.user.hostname}/_matrix/media/v3/download/${e.substring(6)}`}setCurrentRoom(e){e!==this.currentRoom&&(this.currentRoom=e,console.log("Current room changed to",e,"restarting sync"),this.sync.mustUpdateTxnID=!0)}static async Instance(){let e=this._instance;if(!e){e=this._instance=new this,e.database||await e.createDatabase();const t=e.database?.transaction("loginInfo","readonly"),s=await t?.store.getAll();if(await t?.done,s&&s.length>0){e.user.mxid=s[0].userId,e.user.hostname=s[0].hostname,e.user.slidingSyncHostname=s[0].slidingSyncHostname,e.user.access_token=s[0].access_token,e.user.device_id=s[0].device_id,e.profileInfo={avatar_url:s[0].avatarUrl,displayname:s[0].displayName},e.user.mxid&&e.user.hostname&&e.user.access_token&&e.user.device_id&&await e.user.e2ee.initOlmMachine(new N.UserId(e.user.mxid),new N.DeviceId(e.user.device_id));const a=e.database?.transaction("syncInfo","readonly"),i=await a?.store.get(e.user.mxid);await a?.done,i&&e.sync.applyStoredSyncInfo(i);const r=e.database?.transaction("rooms","readonly"),l=await r?.store.getAll();await r?.done,l&&(e.sync.rooms=new Set(l.map(g=>{const y=new F(g.roomID,e.user.hostname,e,e.user.e2ee);return y.windowPos=g.windowPos,y.setInvitedCount(g.invited_count),y.setJoinedCount(g.joined_count),y.setNotificationCount(g.notification_count),y.setNotificationHighlightCount(g.highlight_count),y.setName(g.name),g.events&&y.addEvents(g.events),g.stateEvents&&y.addStateEvents(g.stateEvents),g.isDM&&y.setDM(g.isDM),y})),e.emit("rooms",e.sync.rooms))}e.setMaxListeners(60),e.sync.on("rooms",a=>e.onSyncRooms(a))}return e}async createDatabase(){this.database=await Yt("matrix",4,{upgrade(e,t){t<1&&(e.objectStoreNames.contains("rooms")&&e.deleteObjectStore("rooms"),e.objectStoreNames.contains("syncInfo")&&e.deleteObjectStore("syncInfo"),e.createObjectStore("rooms",{keyPath:"roomID"}),e.createObjectStore("loginInfo",{keyPath:"userId"}),e.createObjectStore("syncInfo",{keyPath:"userId"}))}})}async decryptRoomEvent(e,t){if(!this.isLoggedIn)throw Error("Not logged in");return this.user.e2ee.decryptRoomEvent(e,t)}async logout(){if(this.sync.logout(),this.sync.off("rooms",this.onSyncRooms),await this.user.logout(),this.user.e2ee.logoutE2ee(),this.user.mxid){const t=this.database?.transaction("syncInfo","readwrite");await t?.store.delete(this.user.mxid),await t?.done;const s=this.database?.transaction("loginInfo","readwrite");await s?.store.delete(this.user.mxid),await s?.done}const e=this.database?.transaction("rooms","readwrite");await e?.store.clear(),await e?.done,this.user.mxid=void 0,this.sync.resetAbortController(),await Qt("cetirizine-crypto",{blocked(){location.reload()}})}addInViewRoom(e){this.roomsInView.push(e)}removeInViewRoom(e){this.roomsInView=this.roomsInView.filter(t=>t!==e)}addInViewSpace(e){this.spacesInView.push(e)}removeInViewSpace(e){this.spacesInView=this.spacesInView.filter(t=>t!==e)}addSpaceOpen(e){e!=="other"&&(this.spaceOpen.push(e),console.log("Space opened",e,"restarting sync"),this.sync.mustUpdateTxnID=!0)}removeSpaceOpen(e){e!=="other"&&(this.spaceOpen=this.spaceOpen.filter(t=>t!==e),this.sync.mustUpdateTxnID=!0)}getRooms(){return this.sync.rooms}getSpaces(){return[...this.sync.rooms].filter(e=>e.isSpace()&&!e.isTombstoned()).sort((e,t)=>e.getName()<t.getName()?-1:e.getName()>t.getName()?1:0)}getSpacesWithRooms(){const e=this.getSpaces(),t=new Set;for(const s of e){const a=s.getSpaceChildrenIDs(),i=new Set([...this.getRooms()].filter(r=>a.includes(r.roomID)));t.add({spaceRoom:s,children:i})}for(const s of this.getRooms()){if(s.isSpace()||s.isTombstoned())continue;const a=s.getSpaceParentIDs();for(const i of a){const r=[...this.getRooms()].find(g=>g.roomID===i.roomID);if(!r)continue;const l=[...t].find(g=>g.spaceRoom.roomID===r.roomID);if(l){[...l.children].find(g=>g.roomID===s.roomID)||l.children.add(s);continue}t.add({spaceRoom:r,children:new Set([s])})}}return t}async startSync(){await this.sync.startSync()}async fetchProfileInfo(e){if(this.profileInfo)return this.profileInfo;if(!this.user.hostname)throw Error("Hostname must be set first");if(this.database||await this.createDatabase(),!this.user.access_token)throw Error("Access token must be set first");const t=await fetch(`${this.user.hostname}/_matrix/client/r0/profile/${e}`,{headers:{Authorization:`Bearer ${this.user.access_token}`}});if(!t.ok){if(t.status===404||t.status===403)return{};throw console.error(t),Error("Error fetching profile info. See console for error.")}const s=await t.json();s.avatar_url=s.avatar_url?.replace("mxc://",`${this.user.hostname}/_matrix/media/r0/download/`),this.profileInfo=s;const a=this.database?.transaction("loginInfo","readwrite");return await a?.store.put({userId:this.user.mxid,device_id:this.user.device_id,hostname:this.user.hostname,slidingSyncHostname:this.user.slidingSyncHostname,access_token:this.user.access_token,displayName:s.displayname,avatarUrl:s.avatar_url}),await a?.done,s}}function vs(n){return n.retry_after_ms!==void 0}const Ot=await _s.Instance(),C=m.createContext(Ot);function Ct(){const n=m.useContext(C),[e,t]=m.useState(n.getRooms());return m.useEffect(()=>{const s=a=>{t(a)};return n.on("rooms",s),n.startSync(),()=>{n.off("rooms",s)}},[]),e}function bs(n){return[...Ct()].find(t=>t.roomID===n)}function ws(){const n=m.useContext(C),[e,t]=m.useState(n.getSpacesWithRooms());return m.useEffect(()=>{const s=a=>{t(n.getSpacesWithRooms())};return n.on("rooms",s),n.startSync(),()=>{n.off("rooms",s)}},[]),e}function Ss(){const n=m.useContext(C),[e,t]=m.useState({displayname:n.mxid||"Unknown"});return m.useEffect(()=>{n.fetchProfileInfo(n.mxid).then(s=>{s.displayname||(s.displayname=n.mxid||"Unknown"),t(s)})},[]),e}const Tt={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},nt=m.memo(({event:n,room:e,hasPreviousEvent:t})=>o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(n.sender)||n.sender,avatarUrl:e?.getMemberAvatar(n.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(n.sender)||n.sender}),o.jsx($e,{options:Tt,as:"p",className:"whitespace-break-spaces text-black text-base font-normal",children:JSON.stringify(n,null,4)})]})]})),Ae=m.memo(({event:n,room:e,hasPreviousEvent:t})=>o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(n.sender)||n.sender,avatarUrl:e?.getMemberAvatar(n.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(n.sender)||n.sender}),o.jsx($e,{options:Tt,as:"p",className:"whitespace-pre-wrap text-base font-normal text-orange-600",children:"Unable to decrypt event"})]})]})),Be=m.memo(({event:n,redacted_because:e,room:t,hasPreviousEvent:s})=>o.jsxs("div",{className:s?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!s&&o.jsx(R,{displayname:t?.getMemberName(n.sender)||n.sender,avatarUrl:t?.getMemberAvatar(n.sender),online:t?.presence||w.Unknown,dm:t?.isDM()||!1}),o.jsxs("div",{className:s?"ml-[3.7rem]":"flex flex-col gap-1",children:[!s&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:t?.getMemberName(n.sender)||n.sender}),e&&o.jsxs("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:["Message was redacted: ",e]}),!e&&o.jsx("p",{className:"whitespace-pre-wrap text-base font-normal text-blue-600 italic",children:"Message was redacted"})]})]}));nt.__docgenInfo={description:"",methods:[],displayName:"UnknownEvent"};Ae.__docgenInfo={description:"",methods:[],displayName:"UndecryptableEvent"};Be.__docgenInfo={description:"",methods:[],displayName:"RedactedEvent"};const Ut=m.memo(({src_url:n})=>{const[e,t]=m.useState(!1),[s,a]=m.useState(0),[i,r]=m.useState(void 0),l=m.useRef(null);m.useEffect(()=>{l.current&&(l.current.children.length>0&&i&&r(y=>{if(y?.destroy(),l.current)for(const u of l.current.children)u.remove()}),l.current.children.length===0&&r(en.create({barWidth:5,cursorWidth:1,container:l.current,backend:"WebAudio",height:45,progressColor:"#f59e0b",responsive:!0,waveColor:"#cbd5e1",cursorColor:"transparent",barRadius:5,hideScrollbar:!0,normalize:!0})))},[]),m.useEffect(()=>{i&&(i.load(n),i.on("ready",()=>{a(i.getDuration())}))},[i]);const g=()=>{i&&(t(y=>!y),i.playPause())};return o.jsxs("div",{className:"flex w-[min-content] flex-row h-full items-start justify-start gap-3 bg-slate-200 rounded border-2 border-slate-500 p-1",children:[o.jsx("button",{"aria-label":e?"Pause":"Play",className:"text-center flex justify-center items-center w-12 h-12 min-w-12 min-h-12 rounded-full outline-none cursor-pointer pb-1 bg-orange-500 border-orange-600 border hover:bg-orange-600 group",onClick:g,children:e?o.jsx(nn,{size:24,className:"stroke-slate-700 group-hover:stroke-slate-600"}):o.jsx(tn,{viewBox:"0 0 21 24",className:"stroke-slate-50 group-hover:stroke-slate-100"})}),o.jsxs("div",{className:"flex flex-col w-96 gap-2 justify-between",children:[o.jsx("div",{className:"w-full h-12",id:"waveform",ref:l}),o.jsx("span",{className:"w-full text-sm font-medium text-slate-600 text-right",children:Es(s)})]})]})});function Es(n){if(!n)return"00:00";const e=Math.floor(n/3600),t=Math.floor(n%3600/60),s=Math.floor(n%3600%60);return e===0&&t===0&&s===0?"00:00":e===0&&t===0?`00:${s.toString().padStart(2,"0")}`:e===0?`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${e}:${t}:${s}`}Ut.__docgenInfo={description:"",methods:[],displayName:"Waveform"};const Ge={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},ft=(n,e,t,s)=>{console.log("Downloading media:",e.event_id),fetch(n.convertMXC(e.content.file.url),{headers:{Authorization:`Bearer ${n.accessToken}`}}).then(a=>{if(!a.ok){console.log("Unable to decrypt media:",a.text());return}console.log("Downloaded media:",e.event_id),a.arrayBuffer().then(i=>{rn.decryptAttachment(i,e.content.file).then(r=>{let l=e.content.info?.mimetype?e.content.info.mimetype.split(";")[0].trim():"";l=ks(l);const g=new Blob([r],{type:l});t(URL.createObjectURL(g)),console.log("Decrypted media:",e.event_id)}).catch(r=>{console.log("Unable to decrypt media due to decryption error:",r),s(`Unable to decrypt media due to decryption error: ${r}`)})})})},st=m.memo(({event:n,room:e,hasPreviousEvent:t,reactions:s})=>{const a=m.useContext(C);return(r=>{if(ss(r))return o.jsx(yt,{event:r,room:e,hasPreviousEvent:t,reactions:s});if(os(r))return o.jsx(yt,{event:r,room:e,hasPreviousEvent:t,reactions:s,message_type:1});if(pt(r)){const[l,g]=m.useState(void 0),[y,u]=m.useState(r.content.file!==void 0);return m.useEffect(()=>{pt(r)&&(r.content.url?g(a.convertMXC(r.content.url)):r.content.file&&ft(a,r,S=>{g(S),u(!1)},S=>{u(!0)}))},[r]),y?o.jsx(Ae,{event:r,room:e,hasPreviousEvent:t}):o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(r.sender)||r.sender,avatarUrl:e?.getMemberAvatar(r.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(r.sender)||r.sender}),o.jsx("img",{src:l,alt:r.content.body,title:r.content.body,className:"rounded-md object-cover border-slate-400 border-2 max-h-[50rem] max-w-[50rem] h-[unset]"})]})]})}else if(gt(r)){const[l,g]=m.useState(void 0),[y,u]=m.useState(r.content.file!==void 0);return m.useEffect(()=>{gt(r)&&(r.content.url?g(a.convertMXC(r.content.url)):r.content.file&&ft(a,r,S=>{g(S),u(!1)},S=>{u(!0)}))},[r]),y?o.jsx(Ae,{event:r,room:e,hasPreviousEvent:t}):o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(r.sender)||r.sender,avatarUrl:e?.getMemberAvatar(r.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"flex-1 ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(r.sender)||r.sender}),l&&o.jsx(Ut,{src_url:l})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(r.sender)||r.sender,avatarUrl:e?.getMemberAvatar(r.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(r.sender)||r.sender}),o.jsx($e,{options:Ge,as:"p",className:"text-black text-base font-normal",children:r.content.body})]})]})})(n)}),yt=m.memo(({event:n,room:e,hasPreviousEvent:t,message_type:s=0})=>{let a="text-black";if(s===1&&(a="text-slate-500"),n.content.format==="org.matrix.custom.html"){let i=sn.sanitize(n.content.formatted_body,{ADD_TAGS:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","caption","pre","span","img","details","summary"]});const l=/<pre><code (?:class="language-(?<language>.*?)")?.*?>(?<code>[\s\S]*?)<\/code><\/pre>/.exec(i);if(l?.groups?.code)if(l.groups?.language){const y=mt.highlight(l.groups?.code,{language:l.groups?.language}).value;i=i.replace(l.groups?.code,`${y}`)}else{const y=mt.highlightAuto(l.groups?.code).value;i=i.replace(l[0],`${y}`)}const g=on(i,Ge);return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(n.sender)||n.sender,avatarUrl:e?.getMemberAvatar(n.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(n.sender)||n.sender}),o.jsx("p",{className:`${a} text-base font-normal`,dangerouslySetInnerHTML:{__html:g}})]})]})}else return o.jsxs("div",{className:t?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!t&&o.jsx(R,{displayname:e?.getMemberName(n.sender)||n.sender,avatarUrl:e?.getMemberAvatar(n.sender),online:e?.presence||w.Unknown,dm:e?.isDM()||!1}),o.jsxs("div",{className:t?"ml-[3.7rem]":"flex flex-col gap-1",children:[!t&&o.jsx("h2",{className:"text-xl font-medium text-red-500 whitespace-pre-wrap",children:e?.getMemberName(n.sender)||n.sender}),o.jsx($e,{options:Ge,as:"p",className:`${a} text-base font-normal`,children:n.content.body})]})]})}),js=["image/jpeg","image/gif","image/png","image/apng","image/webp","image/avif","video/mp4","video/webm","video/ogg","video/quicktime","audio/mp4","audio/webm","audio/aac","audio/mpeg","audio/ogg","audio/wave","audio/wav","audio/x-wav","audio/x-pn-wav","audio/flac","audio/x-flac"];function ks(n){return js.includes(n)?n:"application/octet-stream"}st.__docgenInfo={description:"",methods:[],displayName:"MessageEvent"};const Ns={title:"Chat/Events/MessageEvents",component:st},de={args:{event:{content:{body:"._.",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},ue={args:{event:{content:{body:"I think it's mostly a matter of doing the right `padding-block` in `.content`",format:"org.matrix.custom.html",formatted_body:"I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",msgtype:"m.text"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};Ot.hostname="https://matrix.org";const pe={args:{event:{content:{body:"image.png",info:{h:680,mimetype:"image/png",size:252133,thumbnail_info:{h:600,mimetype:"image/png",size:223185,w:600},thumbnail_url:"mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",w:680,"xyz.amorgan.blurhash":"UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"},msgtype:"m.image",url:"mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}},ge={args:{event:{content:{body:"mixaund-bright-future.mp3",info:{mimetype:"audio/mpeg",size:9329941},msgtype:"m.audio",url:"mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"},origin_server_ts:1683125956695,sender:"@example:example.org",type:"m.room.message",unsigned:{},event_id:"$143273582443PhrSn:example.org",room_id:"!jEsUZKDJdhlrceRyVU:example.org"}}};de.parameters={...de.parameters,docs:{...de.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "._.",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...de.parameters?.docs?.source}}};ue.parameters={...ue.parameters,docs:{...ue.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "I think it's mostly a matter of doing the right \`padding-block\` in \`.content\`",
        format: "org.matrix.custom.html",
        formatted_body: "I think it's mostly a matter of doing the right <code>padding-block</code> in <code>.content</code>",
        msgtype: "m.text"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...ue.parameters?.docs?.source}}};pe.parameters={...pe.parameters,docs:{...pe.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "image.png",
        info: {
          h: 680,
          mimetype: "image/png",
          size: 252133,
          thumbnail_info: {
            h: 600,
            mimetype: "image/png",
            size: 223185,
            w: 600
          },
          thumbnail_url: "mxc://midnightthoughts.space/9824fd09c998f8304935bf78c047146332fea9f7",
          w: 680,
          "xyz.amorgan.blurhash": "UaQ]+tElbcs,NFR*bIj@_4$ejYWXxas:n$oL"
        },
        msgtype: "m.image",
        url: "mxc://midnightthoughts.space/59ced67d3dfbcc5c129c3e12d3083bf5652f6ff5"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...pe.parameters?.docs?.source}}};ge.parameters={...ge.parameters,docs:{...ge.parameters?.docs,source:{originalSource:`{
  args: {
    event: {
      content: {
        body: "mixaund-bright-future.mp3",
        info: {
          mimetype: "audio/mpeg",
          size: 9329941
        },
        msgtype: "m.audio",
        url: "mxc://midnightthoughts.space/4ffaba6ebc3d29165b4549ef47bbc07b6468aab8"
      },
      origin_server_ts: 1683125956695,
      sender: "@example:example.org",
      type: "m.room.message",
      unsigned: {},
      event_id: "$143273582443PhrSn:example.org",
      room_id: "!jEsUZKDJdhlrceRyVU:example.org"
    }
  }
}`,...ge.parameters?.docs?.source}}};const Is=["TextEvent","FormattedEvent","ImageEvent","AudioEvent"],Ds=Object.freeze(Object.defineProperty({__proto__:null,AudioEvent:ge,FormattedEvent:ue,ImageEvent:pe,TextEvent:de,__namedExportsOrder:Is,default:Ns},Symbol.toStringTag,{value:"Module"})),Rs={title:"Chat/Events/RedactedEvent",component:Be},he={name:"Redacted Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}},fe={name:"Redacted Event with Reason",args:{redacted_because:"Because I can",event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};he.parameters={...he.parameters,docs:{...he.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...he.parameters?.docs?.source}}};fe.parameters={...fe.parameters,docs:{...fe.parameters?.docs,source:{originalSource:`{
  name: "Redacted Event with Reason",
  args: {
    redacted_because: "Because I can",
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...fe.parameters?.docs?.source}}};const Ms=["RedactedEventEvent","RedactedEventReasonEvent"],Os=Object.freeze(Object.defineProperty({__proto__:null,RedactedEventEvent:he,RedactedEventReasonEvent:fe,__namedExportsOrder:Ms,default:Rs},Symbol.toStringTag,{value:"Module"})),Cs={title:"Chat/Events/UndecryptableEvent",component:Ae},ye={name:"Undecryptable Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};ye.parameters={...ye.parameters,docs:{...ye.parameters?.docs,source:{originalSource:`{
  name: "Undecryptable Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...ye.parameters?.docs?.source}}};const Ts=["UndecryptableEventEvent"],Us=Object.freeze(Object.defineProperty({__proto__:null,UndecryptableEventEvent:ye,__namedExportsOrder:Ts,default:Cs},Symbol.toStringTag,{value:"Module"})),Ls={title:"Chat/Events/UnknownEvent",component:nt},xe={name:"Unknown Event",args:{event:{content:{avatar_url:"mxc://example.org/SEsfnsuifSDFSSEF",displayname:"Alice Margatroid",membership:"join",reason:"Looking for support"},event_id:"$143273582443PhrSn:example.org",origin_server_ts:1432735824653,room_id:"!jEsUZKDJdhlrceRyVU:example.org",sender:"@example:example.org",state_key:"@alice:example.org",type:"m.room.member",unsigned:{age:1234}}}};xe.parameters={...xe.parameters,docs:{...xe.parameters?.docs,source:{originalSource:`{
  name: "Unknown Event",
  args: {
    event: {
      content: {
        avatar_url: "mxc://example.org/SEsfnsuifSDFSSEF",
        displayname: "Alice Margatroid",
        membership: "join",
        reason: "Looking for support"
      },
      event_id: "$143273582443PhrSn:example.org",
      origin_server_ts: 1432735824653,
      room_id: "!jEsUZKDJdhlrceRyVU:example.org",
      sender: "@example:example.org",
      state_key: "@alice:example.org",
      type: "m.room.member",
      unsigned: {
        "age": 1234
      }
    }
  }
}`,...xe.parameters?.docs?.source}}};const As=["UnknownEventEvent"],Ps=Object.freeze(Object.defineProperty({__proto__:null,UnknownEventEvent:xe,__namedExportsOrder:As,default:Ls},Symbol.toStringTag,{value:"Module"})),ot=m.memo(({children:n})=>o.jsx("h1",{className:"text-black font-bold text-xl",children:n}));ot.__docgenInfo={description:"",methods:[],displayName:"Header",props:{children:{required:!0,tsType:{name:"string"},description:"The HeaderText"}}};const $s={title:"Fundamentals/Typography/Header",component:ot,argTypes:{children:{required:!0,name:"Content",description:"The Headertext"}}},_e={args:{children:"Header"}};_e.parameters={..._e.parameters,docs:{..._e.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Header'
  }
}`,..._e.parameters?.docs?.source}}};const zs=["Default"],Fs=Object.freeze(Object.defineProperty({__proto__:null,Default:_e,__namedExportsOrder:zs,default:$s},Symbol.toStringTag,{value:"Module"})),He=m.memo(({placeholder:n,password:e=!1,autoFocus:t=!1,value:s,readonly:a,onChange:i})=>o.jsx("input",{disabled:a,className:"text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:s,type:e?"password":"text",autoFocus:t,placeholder:n,onChange:i}));He.__docgenInfo={description:"",methods:[],displayName:"Input",props:{password:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If it is a password input"},autoFocus:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If input should be autofocused"},placeholder:{required:!0,tsType:{name:"string"},description:"The Placeholder text"},value:{required:!0,tsType:{name:"string"},description:"The value of the input field"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the input is readonly"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{name:"e",type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"}}],return:{name:"void"}}},description:"Handler for the onChange event"}}};const qs={title:"Fundamentals/Inputs/BasicInput",component:He,argTypes:{placeholder:{required:!0,name:"Placeholder",description:"The Placeholder for the input field. Shown if it is empty."},password:{required:!1,name:"Password",control:"boolean",defaultValue:!1,description:"If the input field takes a password."},autoFocus:{required:!1,name:"Auto Focus",control:"boolean",defaultValue:!1,description:"If the field should be focused automatically."},value:{required:!0,name:"Value",description:"The current value of the input."},onChange:{description:"The onChange handler of the input field.",required:!0}}},ve={args:{placeholder:"Placeholder",password:!1,autoFocus:!1}};ve.parameters={...ve.parameters,docs:{...ve.parameters?.docs,source:{originalSource:`{
  args: {
    placeholder: "Placeholder",
    password: false,
    autoFocus: false
  }
}`,...ve.parameters?.docs?.source}}};const Hs=["Default"],Vs=Object.freeze(Object.defineProperty({__proto__:null,Default:ve,__namedExportsOrder:Hs,default:qs},Symbol.toStringTag,{value:"Module"})),Bs=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,Js=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,Ks=[n=>{const e=Bs.exec(n);return e&&{index:e.index,length:e[0].length,text:e[0],url:e[0]}},n=>{const e=Js.exec(n);return e&&{index:e.index,length:e[0].length,text:e[0],url:`mailto:${e[0]}`}}];function Lt(){return o.jsx(an.AutoLinkPlugin,{matchers:Ks})}Lt.__docgenInfo={description:"",methods:[],displayName:"PlaygroundAutoLinkPlugin"};class H extends b.ParagraphNode{static getType(){return"custom-paragraph"}static clone(e){return new H(e.__key)}exportDOM(e){const{element:t}=super.exportDOM(e);if(this.isEmpty()){const s=b.$getRoot();let a=!1;for(const i of s.getChildren())i!==this&&(i instanceof H||i instanceof b.ParagraphNode)&&(i.isEmpty()||(a=!0));if(!a)return{element:null}}return{element:t}}exportJSON(){const e=super.exportJSON();return e.type="custom-paragraph",e}static importJSON(e){return super.importJSON(e)}}function Ws(){return b.$applyNodeReplacement(new H)}const Fe=1,Zs=new Set(["custom-paragraph","quote","code","h1","h2","ul","ol"]),Xs={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List","custom-paragraph":"Normal",quote:"Quote",ul:"Bulleted List"},xt=m.memo(()=>o.jsx("div",{className:"divider"}));function _t(n,e){e?(n.style.opacity="1",n.style.top=`${e.top+e.height+window.pageYOffset+10}px`,n.style.left=`${e.left+window.pageXOffset-n.offsetWidth/2+e.width/2}px`):(n.style.opacity="0",n.style.top="-1000px",n.style.left="-1000px")}const Gs=m.memo(({editor:n})=>{const e=m.useRef(null),t=m.useRef(null),s=m.useRef(!1),[a,i]=m.useState(""),[r,l]=m.useState(!1),[g,y]=m.useState(null),u=m.useCallback(()=>{const d=b.$getSelection();if(b.$isRangeSelection(d)){const p=At(d),f=p.getParent();T.$isLinkNode(f)?i(f.getURL()):T.$isLinkNode(p)?i(p.getURL()):i("")}const E=e.current,c=window.getSelection(),h=document.activeElement;if(E===null)return;const x=n.getRootElement();if(d!==null&&!c?.isCollapsed&&x!==null&&x.contains(c?.anchorNode)){const p=c?.getRangeAt(0);let f;if(c?.anchorNode===x){let _=x;for(;_.firstElementChild!=null;)_=_.firstElementChild;f=_.getBoundingClientRect()}else f=p?.getBoundingClientRect();s.current||_t(E,f),y(d)}else(!h||h.className!=="link-input")&&(_t(E,void 0),y(null),l(!1),i(""));return!0},[n]);m.useEffect(()=>We.mergeRegister(n.registerUpdateListener(({editorState:d})=>{d.read(()=>{u()})}),n.registerCommand(b.SELECTION_CHANGE_COMMAND,()=>(u(),!0),Fe)),[n,u]),m.useEffect(()=>{n.getEditorState().read(()=>{u()})},[n,u]),m.useEffect(()=>{r&&t.current&&t.current.focus()},[r]);const S=m.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a);return o.jsx("div",{ref:e,className:"link-editor",children:r?o.jsx("input",{ref:t,className:"link-input",value:a,onChange:d=>{i(d.target.value)},onKeyDown:d=>{d.key==="Enter"?(d.preventDefault(),g!==null&&(a!==""&&n.dispatchCommand(T.TOGGLE_LINK_COMMAND,a),l(!1))):d.key==="Escape"&&(d.preventDefault(),l(!1))}}):o.jsx(o.Fragment,{children:o.jsxs("div",{className:"link-input",children:[S,o.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:d=>d.preventDefault(),onClick:()=>{l(!0)}})]})})})}),Ys=m.memo(({onChange:n,className:e,options:t,value:s})=>o.jsxs("select",{className:e,onChange:n,value:s,children:[o.jsx("option",{hidden:!0,value:""}),t.map(a=>o.jsx("option",{value:a,children:a},a))]}));function At(n){const e=n.anchor,t=n.focus,s=n.anchor.getNode(),a=n.focus.getNode();return s===a?s:n.isBackward()?L.$isAtNodeEnd(t)?s:a:L.$isAtNodeEnd(e)?a:s}const Qs=m.memo(({editor:n,blockType:e,toolbarRef:t,setShowBlockOptionsDropDown:s})=>{const a=m.useRef(null);m.useEffect(()=>{const d=a.current,E=t.current;if(d!==null&&E!==null){const c=document.getElementsByClassName("editor-container")[0];c&&(d.style.bottom=`${c.clientHeight}px`);const h=x=>{const p=x.target;!d.contains(p)&&!E.contains(p)&&s(!1)};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}}},[a,s,t]);const i=()=>{e!=="custom-paragraph"&&n.update(()=>{const d=b.$getSelection();b.$isRangeSelection(d)&&L.$wrapNodes(d,()=>Ws())}),s(!1)},r=()=>{e!=="h1"&&n.update(()=>{const d=b.$getSelection();b.$isRangeSelection(d)&&L.$wrapNodes(d,()=>q.$createHeadingNode("h1"))}),s(!1)},l=()=>{e!=="h2"&&n.update(()=>{const d=b.$getSelection();b.$isRangeSelection(d)&&L.$wrapNodes(d,()=>q.$createHeadingNode("h2"))}),s(!1)},g=()=>{e!=="ul"?n.dispatchCommand(A.INSERT_UNORDERED_LIST_COMMAND,void 0):n.dispatchCommand(A.REMOVE_LIST_COMMAND,void 0),s(!1)},y=()=>{e!=="ol"?n.dispatchCommand(A.INSERT_ORDERED_LIST_COMMAND,void 0):n.dispatchCommand(A.REMOVE_LIST_COMMAND,void 0),s(!1)},u=()=>{e!=="quote"&&n.update(()=>{const d=b.$getSelection();b.$isRangeSelection(d)&&L.$wrapNodes(d,()=>q.$createQuoteNode())}),s(!1)},S=()=>{e!=="code"&&n.update(()=>{const d=b.$getSelection();b.$isRangeSelection(d)&&L.$wrapNodes(d,()=>P.$createCodeNode())}),s(!1)};return o.jsxs("div",{className:"dropdown",ref:a,children:[o.jsxs("button",{className:"item",onClick:i,children:[o.jsx(bt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Normal"}),e==="custom-paragraph"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:r,children:[o.jsx(wt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Large Heading"}),e==="h1"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:l,children:[o.jsx(St,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Small Heading"}),e==="h2"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:g,children:[o.jsx(Et,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Bullet List"}),e==="ul"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:y,children:[o.jsx(jt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Numbered List"}),e==="ol"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:u,children:[o.jsx(kt,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Quote"}),e==="quote"&&o.jsx("span",{className:"active"})]}),o.jsxs("button",{className:"item",onClick:S,children:[o.jsx(Ze,{className:"icon",size:20}),o.jsx("span",{className:"text",children:"Code Block"}),e==="code"&&o.jsx("span",{className:"active"})]})]})}),Pt=m.memo(()=>{const[n]=Ve.useLexicalComposerContext(),e=m.useRef(null),[t,s]=m.useState(!1),[a,i]=m.useState(!1),[r,l]=m.useState("custom-paragraph"),[g,y]=m.useState(null),[u,S]=m.useState(!1),[d,E]=m.useState(""),[c,h]=m.useState(!1),[x,p]=m.useState(!1),[f,_]=m.useState(!1),[j,O]=m.useState(!1),[v,$]=m.useState(!1),[I,k]=m.useState(!1),[z,Vt]=m.useState(!1),Je=m.useCallback(()=>{const D=b.$getSelection();if(b.$isRangeSelection(D)){const M=D.anchor.getNode(),U=M.getKey()==="root"?M:M.getTopLevelElementOrThrow(),ct=U.getKey();if(n.getElementByKey(ct)!==null)if(y(ct),A.$isListNode(U)){const ze=We.$getNearestNodeOfType(M,A.ListNode),Gt=ze?ze.getTag():U.getTag();l(Gt)}else{const ze=q.$isHeadingNode(U)?U.getTag():U.getType();l(ze),P.$isCodeNode(U)&&E(U.getLanguage()||P.getDefaultCodeLanguage())}_(D.hasFormat("bold")),O(D.hasFormat("italic")),$(D.hasFormat("underline")),k(D.hasFormat("strikethrough")),Vt(D.hasFormat("code")),h(L.$isParentElementRTL(D));const lt=At(D),Xt=lt.getParent();T.$isLinkNode(Xt)||T.$isLinkNode(lt)?p(!0):p(!1)}},[n]);m.useEffect(()=>We.mergeRegister(n.registerUpdateListener(({editorState:D})=>{D.read(()=>{Je()})}),n.registerCommand(b.SELECTION_CHANGE_COMMAND,(D,M)=>(Je(),!1),Fe),n.registerCommand(b.CAN_UNDO_COMMAND,D=>(s(D),!1),Fe),n.registerCommand(b.CAN_REDO_COMMAND,D=>(i(D),!1),Fe)),[n,Je]);const Bt=m.useMemo(()=>P.getCodeLanguages(),[]),Jt=m.useCallback(D=>{n.update(()=>{if(g!==null){const M=b.$getNodeByKey(g);P.$isCodeNode(M)&&M.setLanguage(D.target.value)}})},[n,g]),Kt=m.useCallback(()=>{x?n.dispatchCommand(T.TOGGLE_LINK_COMMAND,null):n.dispatchCommand(T.TOGGLE_LINK_COMMAND,"https://")},[n,x]),[Wt,Zt]=m.useState(null);return m.useEffect(()=>{const D=document.getElementById("room-wrapper"),M=document.createElement("div");return D?.prepend(M),Zt(M),()=>{D?.removeChild(M)}},[]),o.jsxs("div",{className:"toolbar",ref:e,children:[o.jsx("button",{disabled:!t,onClick:()=>{n.dispatchCommand(b.UNDO_COMMAND,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:o.jsx(cn,{className:"format",size:20})}),o.jsx("button",{disabled:!a,onClick:()=>{n.dispatchCommand(b.REDO_COMMAND,void 0)},className:"toolbar-item","aria-label":"Redo",children:o.jsx(ln,{className:"format",size:20})}),o.jsx(xt,{}),Zs.has(r)&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"toolbar-item block-controls",onClick:()=>S(!u),"aria-label":"Formatting Options",children:[r==="h1"?o.jsx(wt,{className:"icon",size:20}):r==="h2"?o.jsx(St,{className:"icon",size:20}):r==="h3"?o.jsx(mn,{className:"icon",size:20}):r==="h4"?o.jsx(dn,{className:"icon",size:20}):r==="h5"?o.jsx(un,{className:"icon",size:20}):r==="code"?o.jsx(Ze,{className:"icon",size:20}):r==="custom-paragraph"?o.jsx(bt,{className:"icon",size:20}):r==="ol"?o.jsx(jt,{className:"icon",size:20}):r==="ul"?o.jsx(Et,{className:"icon",size:20}):r==="quote"?o.jsx(kt,{className:"icon",size:20}):o.jsx(o.Fragment,{}),o.jsx("span",{className:"text",children:Xs[r]}),o.jsx(Nt,{size:20})]}),u&&dt.createPortal(o.jsx(Qs,{editor:n,blockType:r,toolbarRef:e,setShowBlockOptionsDropDown:S}),Wt),o.jsx(xt,{})]}),r==="code"?o.jsxs(o.Fragment,{children:[o.jsx(Ys,{className:"toolbar-item code-language",onChange:Jt,options:Bt,value:d}),o.jsx("i",{className:"chevron-down inside"})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{n.dispatchCommand(b.FORMAT_TEXT_COMMAND,"bold")},className:"toolbar-item spaced "+(f?"active":""),"aria-label":"Format Bold",children:o.jsx(pn,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(b.FORMAT_TEXT_COMMAND,"italic")},className:"toolbar-item spaced "+(j?"active":""),"aria-label":"Format Italics",children:o.jsx(gn,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(b.FORMAT_TEXT_COMMAND,"underline")},className:"toolbar-item spaced "+(v?"active":""),"aria-label":"Format Underline",children:o.jsx(hn,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(b.FORMAT_TEXT_COMMAND,"strikethrough")},className:"toolbar-item spaced "+(I?"active":""),"aria-label":"Format Strikethrough",children:o.jsx(fn,{className:"format",size:20})}),o.jsx("button",{onClick:()=>{n.dispatchCommand(b.FORMAT_TEXT_COMMAND,"code")},className:"toolbar-item spaced "+(z?"active":""),"aria-label":"Insert Code",children:o.jsx(Ze,{className:"format",size:20})}),o.jsx("button",{onClick:Kt,className:"toolbar-item spaced "+(x?"active":""),"aria-label":"Insert Link",children:o.jsx(yn,{className:"format",size:20})}),x&&dt.createPortal(o.jsx(Gs,{editor:n}),document.body)," "]})]})});Pt.__docgenInfo={description:"",methods:[],displayName:"ToolbarPlugin"};function eo(){const[n]=Ve.useLexicalComposerContext();return m.useEffect(()=>P.registerCodeHighlighting(n),[n]),null}const to={ltr:"ltr",rtl:"rtl",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough",code:"editor-text-code"},code:"editor-code",codeHighlight:{atrule:"editor-tokenAttr",attr:"editor-tokenAttr",boolean:"editor-tokenProperty",builtin:"editor-tokenSelector",cdata:"editor-tokenComment",char:"editor-tokenSelector",class:"editor-tokenFunction","class-name":"editor-tokenFunction",comment:"editor-tokenComment",constant:"editor-tokenProperty",deleted:"editor-tokenProperty",doctype:"editor-tokenComment",entity:"editor-tokenOperator",function:"editor-tokenFunction",important:"editor-tokenVariable",inserted:"editor-tokenSelector",keyword:"editor-tokenAttr",namespace:"editor-tokenVariable",number:"editor-tokenProperty",operator:"editor-tokenOperator",prolog:"editor-tokenComment",property:"editor-tokenProperty",punctuation:"editor-tokenPunctuation",regex:"editor-tokenVariable",selector:"editor-tokenSelector",string:"editor-tokenSelector",symbol:"editor-tokenProperty",tag:"editor-tokenProperty",url:"editor-tokenOperator",variable:"editor-tokenVariable"}};const V=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",no=V&&"documentMode"in document?document.documentMode:null,so=V&&"InputEvent"in window&&!no?"getTargetRanges"in new window.InputEvent("input"):!1,oo=V&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),ro=V&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,ao=V&&/^(?=.*Chrome).*/i.test(navigator.userAgent),io=V&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!ao;function co(){return o.jsx("div",{className:"editor-placeholder",id:"editor-placeholder",children:"Enter message..."})}const lo=({onStartSending:n,onStopSending:e,room:t})=>{const[s]=Ve.useLexicalComposerContext(),a=i=>{if(!i){console.warn("Got no room");return}s.getEditorState().read(()=>{let r=Nn.$generateHtmlFromNodes(s);const l=/(?<all><code .* (?:data-highlight-language="(?<language>.*?)")(?: .*?)?>(?<code>[\s\S]*?)<\/code>)/;let g=l.exec(r);for(;g!==null;){if(g){const{groups:u}=g;if(u){const{all:S,language:d}=u;let{code:E}=u;const c=/<span(?: class=".*?")?>(?<content>.*?)<\/span>/;let h=c.exec(E);for(;h!==null;){if(h){const{groups:x}=h;if(x){const{content:p}=x;E=E.replaceAll(h[0],p)}}h=c.exec(E)}E=E.replaceAll("<br>",`
`),r=r.replace(S,`<pre><code class="language-${d}">${E}</code></pre>`)}}g=l.exec(r)}const y=Xe.$convertToMarkdownString(Xe.TRANSFORMERS);console.log(r),!(r===""&&y===""||r==='<p class="editor-paragraph"><br></p>')&&(n(),console.log("Sending message to: ",i.roomID),r!=='<p class="editor-paragraph"><br></p>'?i.sendHtmlMessage(r,y,()=>{s.dispatchCommand(b.CLEAR_EDITOR_COMMAND,void 0),s.dispatchCommand(b.CLEAR_HISTORY_COMMAND,void 0),localStorage.removeItem(`editor-${i.roomID}`),e()}).catch(u=>{console.log(u),e()}):i.sendTextMessage(y,()=>{s.dispatchCommand(b.CLEAR_EDITOR_COMMAND,void 0),s.dispatchCommand(b.CLEAR_HISTORY_COMMAND,void 0),localStorage.removeItem(`editor-${i.roomID}`),e()}).catch(u=>{console.log(u),e()}))})};return m.useEffect(()=>{if(!t)return;const i=s.registerCommand(b.KEY_ENTER_COMMAND,r=>{console.log("Room changed",t.roomID);const l=b.$getSelection();if(!b.$isRangeSelection(l))return!1;if(r!=null){if((ro||oo||io)&&so)return!1;if(r.preventDefault(),r.shiftKey)return s.dispatchCommand(b.INSERT_PARAGRAPH_COMMAND,void 0);a(t)}return s.dispatchCommand(b.INSERT_PARAGRAPH_COMMAND,void 0)},b.COMMAND_PRIORITY_CRITICAL);return()=>{console.log("Removing command since room or editor changed"),i()}},[s,t]),o.jsx(kn,{size:45,stroke:"unset",className:"stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer",onClick:()=>{a(t)}})},mo=({room:n})=>{const[e]=Ve.useLexicalComposerContext(),{pathname:t}=It(),[s,a]=m.useState(void 0);return m.useEffect(()=>{if(n){const i=n.roomID;if(i!==s){console.log("Saving editor state");const l=e.getEditorState();localStorage.setItem(`editor-${s}`,JSON.stringify(l.toJSON()))}a(i);const r=localStorage.getItem(`editor-${i}`);if(r){const l=e.parseEditorState(r);e.setEditorState(l)}else e.dispatchCommand(b.CLEAR_EDITOR_COMMAND,void 0),e.dispatchCommand(b.CLEAR_HISTORY_COMMAND,void 0)}},[t,n]),o.jsx(o.Fragment,{})},rt=m.memo(({namespace:n,room:e})=>{const[t,s]=m.useState(!1),a={namespace:n,theme:to,onError:i=>console.error(i),editable:!t,nodes:[q.HeadingNode,A.ListNode,A.ListItemNode,q.QuoteNode,P.CodeNode,P.CodeHighlightNode,Ke.TableNode,Ke.TableCellNode,Ke.TableRowNode,T.AutoLinkNode,T.LinkNode,H,{replace:b.ParagraphNode,with:i=>new H}]};return o.jsx("div",{className:"flex flex-row items-end",children:o.jsxs(xn.LexicalComposer,{initialConfig:a,children:[o.jsxs("div",{className:"editor-container flex-1",children:[o.jsx(Pt,{}),o.jsxs("div",{className:"editor-inner",children:[o.jsx(_n.RichTextPlugin,{contentEditable:o.jsx(vn.ContentEditable,{className:"editor-input",ariaLabelledBy:"editor-placeholder"}),placeholder:o.jsx(co,{}),ErrorBoundary:bn}),o.jsx(wn.HistoryPlugin,{}),o.jsx(Sn.LinkPlugin,{}),o.jsx(eo,{}),o.jsx(Lt,{}),o.jsx(En.MarkdownShortcutPlugin,{transformers:Xe.TRANSFORMERS}),o.jsx(jn.ClearEditorPlugin,{}),o.jsx(mo,{room:e})]})]}),o.jsx(lo,{room:e,onStartSending:()=>{console.log("Sending"),s(!0)},onStopSending:()=>{s(!1)}})]})})});rt.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{namespace:{required:!0,tsType:{name:"string"},description:"The Namespace"},room:{required:!0,tsType:{name:"Room"},description:"The current Room"}}};const uo={title:"Chat/Input",component:rt,decorators:[Qe],argTypes:{namespace:{required:!0,name:"Namespace",description:"The Namespace of the editor."}}},be={args:{namespace:"Editor"}};be.parameters={...be.parameters,docs:{...be.parameters?.docs,source:{originalSource:`{
  args: {
    namespace: "Editor"
  }
}`,...be.parameters?.docs?.source}}};const po=["Default"],go=Object.freeze(Object.defineProperty({__proto__:null,Default:be,__namedExportsOrder:po,default:uo},Symbol.toStringTag,{value:"Module"})),at=m.memo(({roomId:n,avatarUrl:e,displayname:t,dm:s=!1,online:a=w.Unknown,active:i=!1,onClick:r,hidden:l})=>{const g=m.useContext(C),{ref:y,inView:u}=Dt({triggerOnce:!0,skip:l,threshold:1,onChange(S){S?g.addInViewRoom(n):g.removeInViewRoom(n)}});return o.jsx("div",{ref:y,onClick:r,className:"w-full cursor-pointer",children:u&&(i?o.jsxs("div",{className:"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(R,{avatarUrl:e,displayname:t,dm:s,online:a}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}):o.jsxs("div",{className:"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center",children:[o.jsx(R,{avatarUrl:e,displayname:t,dm:s,online:a}),o.jsx("span",{title:t,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:t})]}))})});at.__docgenInfo={description:"",methods:[],displayName:"RoomListItem",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"OnlineState.Unknown",computed:!0},required:!1,tsType:{name:"OnlineState"},description:"Wether the user is online. Only used if dm is true."},active:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the current room is selected"},roomId:{required:!0,tsType:{name:"string"},description:"Room id"},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the room list item"},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The onClick handler"},hidden:{required:!0,tsType:{name:"boolean"},description:"If room is hidden"}}};const ho=m.memo(({sectionID:n,rooms:e,onClick:t,activeRoom:s,hidden:a})=>{const i=e.map(r=>o.jsx(at,{roomId:r.roomID,hidden:a,avatarUrl:r.avatarUrl,displayname:r.displayname,dm:r.dm,online:r.online,active:r.roomID===s,onClick:()=>{t(r.roomID)}},`${r.roomID}+${n}`));return o.jsx(o.Fragment,{children:i})}),qe=m.memo(({section:n,onRoomClick:e,activeRoom:t})=>{const[s,a]=m.useState(!0),i=m.useContext(C),{ref:r,inView:l}=Dt({triggerOnce:!0,threshold:1,onChange(g){n.roomID!=="other"&&(g?i.addInViewRoom(n.roomID):i.removeInViewRoom(n.roomID))}});return m.useEffect(()=>{s?i.removeSpaceOpen(n.roomID):i.addSpaceOpen(n.roomID)},[s]),o.jsxs("div",{ref:r,className:"flex flex-col gap-1 pl-4 select-none",children:[l&&o.jsxs("div",{className:"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600",onClick:()=>a(g=>!g),children:[s?o.jsx(In,{size:14}):o.jsx(Nt,{size:14}),o.jsx("span",{className:"font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:n.sectionName})]}),!s&&l&&o.jsx(ho,{hidden:s,sectionID:n.roomID,rooms:n.rooms,onClick:e,activeRoom:t}),!s&&l&&n.subsections.map(g=>o.jsx(qe,{section:g,onRoomClick:e,activeRoom:t},g.roomID))]},n.roomID)}),it=m.memo(({sections:n,rooms:e,dmRooms:t})=>{const[s,a]=m.useState(void 0),i=Dn();return o.jsxs("div",{className:"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]",children:[o.jsx(qe,{section:{sectionName:"DMs",roomID:"dms",subsections:[],rooms:t},onRoomClick:r=>{a(r),i(`/${encodeURIComponent(r)}`)},activeRoom:s}),n.map(r=>o.jsx(qe,{section:r,onRoomClick:l=>{a(l),i(`/${encodeURIComponent(l)}`)},activeRoom:s},r.roomID)),o.jsx(qe,{section:{sectionName:"Others",roomID:"other",subsections:[],rooms:e},onRoomClick:r=>{a(r),i(`/${encodeURIComponent(r)}`)},activeRoom:s})]})});it.__docgenInfo={description:"",methods:[],displayName:"RoomList",props:{sections:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * Section Name. Can be a Space or a Tag
     */
    sectionName: string
    /**
     * The Rooms within the Section
     */
    rooms: Room[]
    /**
     * The Subsections of the Section
     */
    subsections: Section[]
    /**
     * The roomid of the Space
     */
    roomID: string
}`,signature:{properties:[{key:"sectionName",value:{name:"string",required:!0}},{key:"rooms",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: OnlineState
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"OnlineState",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]",required:!0}},{key:"subsections",value:{name:"Array",elements:[{name:"Section"}],raw:"Section[]",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Section[]"},description:"The Sections available"},rooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: OnlineState
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"OnlineState",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections"},dmRooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: OnlineState
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"OnlineState",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections and DM"}}};const fo={title:"Chat/RoomList",component:it,decorators:[Qe],argTypes:{sections:{required:!0,defaultValue:[],name:"Sections",description:"The Sections available"},rooms:{required:!0,defaultValue:[],name:"Rooms",description:"Rooms outside of any Sections"}}},we={args:{rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online},{roomID:"2",displayname:"test1",dm:!1,online:w.Unknown},{roomID:"3",displayname:"test2",dm:!1,online:w.Unknown}],sections:[{sectionName:"Test Section",rooms:[{roomID:"2",displayname:"test1",dm:!1,online:w.Unknown},{roomID:"3",displayname:"test2",dm:!1,online:w.Unknown}],roomID:"12",subsections:[{sectionName:"Test Subsection",rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online}],roomID:"14",subsections:[]}]}]}};we.parameters={...we.parameters,docs:{...we.parameters?.docs,source:{originalSource:`{
  args: {
    rooms: [{
      roomID: "1",
      displayname: "test",
      avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
      dm: true,
      online: OnlineState.Online
    }, {
      roomID: "2",
      displayname: "test1",
      dm: false,
      online: OnlineState.Unknown
    }, {
      roomID: "3",
      displayname: "test2",
      dm: false,
      online: OnlineState.Unknown
    }],
    sections: [{
      sectionName: "Test Section",
      rooms: [{
        roomID: "2",
        displayname: "test1",
        dm: false,
        online: OnlineState.Unknown
      }, {
        roomID: "3",
        displayname: "test2",
        dm: false,
        online: OnlineState.Unknown
      }],
      roomID: "12",
      subsections: [{
        sectionName: "Test Subsection",
        rooms: [{
          roomID: "1",
          displayname: "test",
          avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
          dm: true,
          online: OnlineState.Online
        }],
        roomID: "14",
        subsections: []
      }]
    }]
  }
}`,...we.parameters?.docs?.source}}};const yo=["RootList"],xo=Object.freeze(Object.defineProperty({__proto__:null,RootList:we,__namedExportsOrder:yo,default:fo},Symbol.toStringTag,{value:"Module"})),_o={title:"Chat/RoomList/Item",component:at,argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"Displayname",description:"The displayname of the Room"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the room is a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"},active:{required:!1,defaultValue:!1,control:"boolean",name:"Active",description:"Wether the room is currently selected"}}},Se={args:{displayname:"test",dm:!1,online:w.Unknown,avatarUrl:"",active:!1}},Ee={args:{displayname:"test",dm:!1,online:w.Unknown,avatarUrl:"",active:!0}},je={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:w.Unknown,active:!1}},ke={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:w.Unknown,active:!0}},Ne={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Offline,active:!1}},Ie={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online,active:!0}},De={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Unknown,active:!1}},Re={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Unknown,active:!0}},Me={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online,active:!1}},Oe={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:w.Online,active:!0}},Ce={args:{displayname:"test",avatarUrl:"",dm:!0,online:w.Offline,active:!1}},Te={args:{displayname:"test",avatarUrl:"",dm:!0,online:w.Online,active:!1}};Se.parameters={...Se.parameters,docs:{...Se.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: OnlineState.Unknown,
    avatarUrl: "",
    active: false
  }
}`,...Se.parameters?.docs?.source}}};Ee.parameters={...Ee.parameters,docs:{...Ee.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: OnlineState.Unknown,
    avatarUrl: "",
    active: true
  }
}`,...Ee.parameters?.docs?.source}}};je.parameters={...je.parameters,docs:{...je.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: OnlineState.Unknown,
    active: false
  }
}`,...je.parameters?.docs?.source}}};ke.parameters={...ke.parameters,docs:{...ke.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: OnlineState.Unknown,
    active: true
  }
}`,...ke.parameters?.docs?.source}}};Ne.parameters={...Ne.parameters,docs:{...Ne.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Offline,
    active: false
  }
}`,...Ne.parameters?.docs?.source}}};Ie.parameters={...Ie.parameters,docs:{...Ie.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Online,
    active: true
  }
}`,...Ie.parameters?.docs?.source}}};De.parameters={...De.parameters,docs:{...De.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Unknown,
    active: false
  }
}`,...De.parameters?.docs?.source}}};Re.parameters={...Re.parameters,docs:{...Re.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Unknown,
    active: true
  }
}`,...Re.parameters?.docs?.source}}};Me.parameters={...Me.parameters,docs:{...Me.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Online,
    active: false
  }
}`,...Me.parameters?.docs?.source}}};Oe.parameters={...Oe.parameters,docs:{...Oe.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: OnlineState.Online,
    active: true
  }
}`,...Oe.parameters?.docs?.source}}};Ce.parameters={...Ce.parameters,docs:{...Ce.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: OnlineState.Offline,
    active: false
  }
}`,...Ce.parameters?.docs?.source}}};Te.parameters={...Te.parameters,docs:{...Te.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: OnlineState.Online,
    active: false
  }
}`,...Te.parameters?.docs?.source}}};const vo=["Fallback","FallbackActive","Image","ImageActive","DMOffline","DMOfflineActive","DMUnknown","DMUnknownActive","DMOnline","DMOnlineActive","DMNoAvatarOffline","DMNoAvatarOnline"],bo=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:Ce,DMNoAvatarOnline:Te,DMOffline:Ne,DMOfflineActive:Ie,DMOnline:Me,DMOnlineActive:Oe,DMUnknown:De,DMUnknownActive:Re,Fallback:Se,FallbackActive:Ee,Image:je,ImageActive:ke,__namedExportsOrder:vo,default:_o},Symbol.toStringTag,{value:"Module"}));function wo(n={}){const{wrapper:e}=Object.assign({},ut(),n.components);return e?o.jsx(e,{...n,children:o.jsx(t,{})}):t();function t(){const s=Object.assign({h1:"h1",p:"p"},ut(),n.components);return o.jsxs(o.Fragment,{children:[o.jsx(Rn,{title:"Introduction/Welcome"}),`
`,o.jsx(s.h1,{id:"about-cetirizine",children:"About Cetirizine"}),`
`,o.jsx(s.p,{children:"Welcome to the Cetirizine Design System!"}),`
`,o.jsx(s.p,{children:`This storybook design system describes in depth the components used within the
Cetirizine Matrix Client.`}),`
`,o.jsx(s.p,{children:`The Design heavily leans on the Tailwindcss Design System. However there are speciic
components for some things and Pages are also documented.`})]})}}const $t=()=>{throw new Error("Docs-only story")};$t.parameters={docsOnly:!0};const Pe={title:"Introduction/Welcome",tags:["stories-mdx"],includeStories:["__page"]};Pe.parameters=Pe.parameters||{};Pe.parameters.docs={...Pe.parameters.docs||{},page:wo};const So=["__page"],Eo=Object.freeze(Object.defineProperty({__proto__:null,__namedExportsOrder:So,__page:$t,default:Pe},Symbol.toStringTag,{value:"Module"}));const zt=m.memo(()=>{const n=m.useContext(C),[e,t]=m.useState(!1),[s,a]=m.useState(""),[i,r]=m.useState(""),[l,g]=m.useState("");if(n.isLoggedIn)return o.jsx(Mn,{to:"/"});const y=async()=>{try{t(!0),await n.passwordLogin(i,l)}catch(u){a(u.toString())}t(!1)};return o.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:u=>{u.preventDefault(),y()},children:[o.jsx(ot,{children:"Login"}),s?o.jsx("h2",{className:"text-red-500 font-normal text-sm",children:s}):o.jsx("div",{className:"min-h-[1.25rem]"}),o.jsx(He,{readonly:e,value:i,placeholder:"Username",onChange:u=>r(u.target.value)}),o.jsx(He,{readonly:e,value:l,password:!0,placeholder:"Password",onChange:u=>g(u.target.value)}),o.jsx(et,{readonly:e,style:"primary",type:"submit",children:"Login"})]})});zt.__docgenInfo={description:"",methods:[],displayName:"Login"};const Ft=m.memo(()=>{const n=m.useContext(C),[e,t]=m.useState(!0);return m.useEffect(()=>{e&&n.logout().then(()=>{t(!1)})},[e,n]),e?o.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:o.jsx("div",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",children:o.jsx("h1",{className:"text-2xl font-bold text-center",children:"Loading..."})})}):o.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:o.jsx(zt,{})})});Ft.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const jo={title:"Pages/LoginPage",component:Ft},Ue={};Ue.parameters={...Ue.parameters,docs:{...Ue.parameters?.docs,source:{originalSource:"{}",...Ue.parameters?.docs?.source}}};const ko=["Default"],No=Object.freeze(Object.defineProperty({__proto__:null,Default:Ue,__namedExportsOrder:ko,default:jo},Symbol.toStringTag,{value:"Module"}));const Io=m.memo(({room:n})=>{const e=m.useContext(C),[t,s]=m.useState([]),[a,i]=m.useState([]),{pathname:r}=It(),[l,g]=m.useState(void 0),[y,u]=m.useState(void 0),S=async(E,c,h)=>{const p=h?.[E-1]?.sender===c.sender,f=h?.find(v=>v.type==="m.room.redaction"&&v.redacts===c.event_id),_=f!==void 0;let j,O;if(_&&(O=f?.event_id,f.content.reason&&(j=f.content.reason)),c.type==="m.room.encrypted"&&n?.roomID)try{const v=await e.decryptRoomEvent(n.roomID,c);if(v)c=JSON.parse(v.event),c.content["m.new_content"]&&(c.content.body=c.content["m.new_content"].body,c.content.formatted_body=c.content["m.new_content"].formatted_body,c.content.format=c.content["m.new_content"].format);else return _?{...c,unsigned:{...c.unsigned,redacted:!0,redacted_because:j,hasPreviousEvent:p,redaction_id:O}}:{...c,unsigned:{...c.unsigned,undecryptable:!0,key:c.event_id,hasPreviousEvent:p}}}catch{return _?{...c,unsigned:{...c.unsigned,redacted:!0,redacted_because:j,hasPreviousEvent:p,redaction_id:O}}:{...c,unsigned:{...c.unsigned,undecryptable:!0,hasPreviousEvent:p}}}return c};m.useEffect(()=>{if(l!==r&&(console.log("Resetting events because we changed rooms"),s([]),i([]),u(0),g(r)),a.length===0&&n){const E=n?.getEvents().filter((c,h,x)=>x.findIndex(p=>p.event_id===c.event_id)===h).sort((c,h)=>h.origin_server_ts-c.origin_server_ts).reverse();Promise.all(E.map(async(c,h)=>await S(h,c,E))).then(c=>{const h=c.filter(x=>x.type!=="m.reaction"&&x.type!=="m.room.redaction"&&x.content["m.relates_to"]?.rel_type!=="m.replace");if(h.length>0){const x=[...h];i(()=>[...c]),s(()=>x),u(x.length)}})}},[n,t,s,a,i,r,l,y,u]),m.useEffect(()=>{if(n){const E=c=>{const h=c.filter((x,p,f)=>f.findIndex(_=>_.event_id===x.event_id)===p).sort((x,p)=>p.origin_server_ts-x.origin_server_ts).reverse();Promise.all(h.map(async(x,p)=>await S(p,x,h))).then(x=>{const p=x.filter(f=>f.type!=="m.reaction"&&f.type!=="m.room.redaction"&&f.content["m.relates_to"]?.rel_type!=="m.replace");if(p.length>0&&t.length>0){const f=[...p];(x.length!==a.length||f.length!==t.length)&&(i(()=>[...x]),s(()=>f))}})};return console.log("Adding listener for events"),n.on("events",E),()=>{console.log("Removing listener for events"),n.off("events",E)}}},[n,a,t,i,s,r]);const d=m.useCallback((E,c)=>{const h=a.findIndex(k=>k.event_id===c.event_id);if(c.unsigned?.redacted)return o.jsx(Be,{event:c,redacted_because:c.unsigned.redacted_because,room:n,hasPreviousEvent:c.unsigned.hasPreviousEvent},c.unsigned.redaction_id);if(c.unsigned?.undecryptable)return o.jsx(Ae,{event:c,hasPreviousEvent:c.unsigned.hasPreviousEvent,room:n},c.event_id);let x=a?.[h-1];const p=x?.sender===c.sender;let f=x?.type;const _=a?.filter(k=>k.type==="m.reaction"&&k.content["m.relates_to"].event_id===c.event_id),j=a?.find(k=>k.type==="m.room.redaction"&&k.redacts===c.event_id),O=j!==void 0;let v,$;O&&($=j?.event_id,j.content.reason&&(v=j.content.reason));const I=a?.find(k=>k.content["m.relates_to"]?k.content["m.relates_to"].rel_type==="m.replace"&&k.content["m.relates_to"].event_id===c.event_id:!1);return I&&(c=I,I.content["m.new_content"]&&(c.content.body=I.content["m.new_content"].body,c.content.formatted_body=I.content["m.new_content"].formatted_body,c.content.format=I.content["m.new_content"].format)),o.jsx("div",{className:"max-w-[130ch]",children:Ro(c,p,f,_,O,v,$,n)})},[a]);return t.length===0||!n||a.length===0?o.jsx(o.Fragment,{}):o.jsx(On,{alignToBottom:!0,className:"flex overflow-y-auto overflow-x-hidden scrollbarSmall",data:t,firstItemIndex:y,initialTopMostItemIndex:t.length-1,overscan:200,itemContent:d,components:{Header:Do},followOutput:E=>E?"smooth":!1})}),Do=()=>o.jsx("div",{style:{padding:"2rem",display:"flex",justifyContent:"center"},children:"Loading..."}),Ro=(n,e,t,s,a,i,r,l)=>{if(a)return o.jsx(Be,{event:n,redacted_because:i,room:l,hasPreviousEvent:e},r);switch(n.type){case"m.room.message":return o.jsx(st,{reactions:s,event:n,room:l,hasPreviousEvent:e&&t==="m.room.message"},n.event_id);case"m.room.member":return o.jsx(tt,{event:n},n.event_id);default:return o.jsx(nt,{event:n},n.event_id)}},qt=m.memo(()=>{const n=Ss(),e=ws(),t=Ct(),s=m.useContext(C),a=Cn(),i=bs(decodeURIComponent(a.roomIdOrAlias||""));s.setCurrentRoom(a.roomIdOrAlias?decodeURIComponent(a.roomIdOrAlias):void 0);const r=[...e].filter(({spaceRoom:c})=>{const h=!c.isTombstoned(),x=![...e].some(({children:f})=>[...f].some(_=>_.roomID===c.roomID)),p=c.getSpaceParentIDs().length===0;return x&&p&&h}),l=[...t].filter(c=>{const h=!c.isTombstoned(),x=![...e].some(({children:_})=>[..._].some(j=>j.roomID===c.roomID)),p=c.getSpaceParentIDs().length===0,f=!c.isSpace();return x&&p&&f&&h}).sort((c,h)=>{const x=c.windowPos.overview,p=h.windowPos.overview;return x===-1?1:p===-1?-1:x-p}),g=r.map(c=>{const h=[...c.children].filter(p=>!p.isSpace()&&!p.isTombstoned()&&!p.isDM()).sort((p,f)=>{const _=p.windowPos[c.spaceRoom.roomID],j=f.windowPos[c.spaceRoom.roomID];return _===-1?1:j===-1?-1:_-j}).map(p=>({roomID:p.roomID,displayname:p.getName(),avatarUrl:p.getAvatarURL(),dm:p.isDM(),online:p.presence})),x=p=>{const f=[...e].find(_=>_.spaceRoom.roomID===p.roomID);if(f){const _=[...f?.children].filter(j=>!j.isSpace()&&!j.isTombstoned()&&!j.isDM()).map(j=>({roomID:j.roomID,displayname:j.getName(),avatarUrl:j.getAvatarURL(),dm:j.isDM(),online:j.presence}));return{sectionName:p.getName(),rooms:_,roomID:p.roomID,subsections:[...f?.children].filter(j=>j.isSpace()&&!j.isTombstoned()).map(x).filter(j=>j!==void 0)}}};return{sectionName:c.spaceRoom.getName(),rooms:h,roomID:c.spaceRoom.roomID,subsections:[...c.children].filter(p=>p.isSpace()).map(x)}}),y=l.filter(c=>!c.isSpace()&&!c.isDM()).map(c=>({roomID:c.roomID,displayname:c.getName(),avatarUrl:c.getAvatarURL(),dm:c.isDM(),online:c.presence})),u=l.filter(c=>!c.isSpace()&&c.isDM()).map(c=>({roomID:c.roomID,displayname:c.getName(),avatarUrl:c.getAvatarURL(),dm:c.isDM(),online:c.presence})),S=y.map(c=>c.roomID),d=S.filter((c,h)=>S.indexOf(c)!==h);d.length>0&&console.error("otherRooms has duplicates",d);const E={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"};return o.jsxs("div",{className:"flex flex-row gap-2 min-h-screen h-screen",children:[o.jsxs("div",{className:"flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300",children:[o.jsxs("div",{className:"flex flex-row gap-2 m-2 p-1 items-center border-b-2",children:[o.jsx(R,{displayname:n.displayname||s.mxid,avatarUrl:n?.avatar_url,dm:!1,online:w.Unknown}),o.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[o.jsx("span",{className:"text-base font-semibold",children:n?.displayname}),o.jsx(Tn,{size:28,stroke:"unset",className:"stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer"})]})]}),o.jsx(it,{sections:g,rooms:y,dmRooms:u})]}),i?o.jsxs("div",{className:"flex-1 flex flex-col",id:"room-wrapper",children:[o.jsxs("div",{className:"pb-2 flex flex-row items-center border-b-2 mt-4 ml-2",children:[o.jsx(R,{displayname:i.getName(),avatarUrl:i.getAvatarURL(),dm:i.isDM(),online:i.presence}),o.jsxs("div",{className:"flex flex-row items-start",children:[o.jsx("h1",{className:"text-black font-semibold text-lg flex-shrink-0",children:i.getName()}),o.jsx($e,{options:E,as:"p",className:"ml-4 text-slate-700 font-normal text-base line-clamp-2 text-ellipsis",children:i.getTopic()})]})]}),o.jsx("div",{className:"my-1 flex-1 flex flex-col",children:o.jsx(Io,{room:i})}),o.jsx(rt,{namespace:"Editor",room:i})]}):o.jsx(o.Fragment,{})]})});qt.__docgenInfo={description:"",methods:[],displayName:"MainPage"};const Mo={title:"Pages/MainPage",component:qt,decorators:[Qe]},Le={};Le.parameters={...Le.parameters,docs:{...Le.parameters?.docs,source:{originalSource:"{}",...Le.parameters?.docs?.source}}};const Oo=["Default"],Co=Object.freeze(Object.defineProperty({__proto__:null,Default:Le,__namedExportsOrder:Oo,default:Mo},Symbol.toStringTag,{value:"Module"}));function Ht(n){return{"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":Xn,"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":Qn,"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":ns,"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":Ds,"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":Os,"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":Us,"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":Ps,"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":Fs,"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":Vs,"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":go,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":xo,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":bo,"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":Eo,"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":No,"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":Co}[n]}Object.assign(Ht,{keys:()=>["/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx"],resolve:n=>({"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":"./src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":"./src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx":"./src/components/events/memberEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx":"./src/components/events/messageEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx":"./src/components/events/redactedEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx":"./src/components/events/undecryptableEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx":"./src/components/events/unknownEvent.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":"./src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":"./src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":"./src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":"./src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":"./src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":"./src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":"./src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":"./src/pages/MainPage.stories.tsx"})[n]});function To(n){n(Ht,{hot:void 0},!1)}__STORYBOOK_MODULE_CLIENT_LOGGER__;const Uo=__STORYBOOK_MODULE_PREVIEW_API__,{addDecorator:Lo,addParameters:vt,addLoader:Ao,addArgs:Po,addArgTypes:$o,addStepRunner:zo,addArgTypesEnhancer:Fo,addArgsEnhancer:qo,setGlobalRender:Ho}=Uo,Vo=[Un,Ln,An,Pn,$n,zn,Fn,qn,Hn,Vn,Kn].filter(Boolean);Vo.map(n=>n.default?n.default:n).forEach(n=>{Object.keys(n).forEach(e=>{const t=n[e];switch(e){case"args":return Po(t);case"argTypes":return $o(t);case"decorators":return t.forEach(s=>Lo(s,!1));case"loaders":return t.forEach(s=>Ao(s,!1));case"parameters":return vt({...t},!1);case"argTypesEnhancers":return t.forEach(s=>Fo(s));case"argsEnhancers":return t.forEach(s=>qo(s));case"render":return Ho(t);case"globals":case"globalTypes":{const s={};return s[e]=t,vt(s,!1)}case"decorateStory":case"applyDecorators":case"renderToDOM":case"renderToCanvas":return null;case"runStep":return zo(t);default:return console.log(e+" was not supported :( !")}})});To(Bn);
//# sourceMappingURL=iframe-bd5696d8.js.map
