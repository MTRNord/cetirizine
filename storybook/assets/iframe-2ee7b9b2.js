import"../sb-preview/runtime.mjs";import{$ as xt,j as t,r as c,e as z,L as vt,a as N,b as R,c as Ne,d as O,T as $e,H as qe,f as He,g as Fe,h as Ve,Q as Be,C as Se,i as We,k as M,l as $,m as P,U as bt,R as _t,n as wt,o as Nt,p as St,q as Ke,s as Oe,B as jt,I as It,t as Et,S as kt,u as Ct,v as Dt,w as Rt,x as Tt,y as Lt,z as Ot,A as Mt,D as Pt,E as At,F as ge,G as we,J as Xe,K as zt,M as I,N as Ut,O as $t,P as qt,V as Ht,W as Je,X as Me,Y as Ft,Z as Vt,_ as Bt,a0 as Ge,a1 as Wt,a2 as Kt,a3 as Xt,a4 as Jt,a5 as Gt,a6 as Zt,a7 as Qt,a8 as Yt,a9 as es,aa as ts,ab as ss,ac as ns,ad as os,ae as as,af as rs,ag as is}from"./vendor-dbf4afb8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const cs={parameters:{actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},options:{storySort:{order:["Introduction","Fundamentals","*"]}}},decorators:[xt({themes:{light:"light",dark:"dark"},defaultTheme:"light",attributeName:"data-mode"}),o=>t.jsx(o,{})]},ls=Object.freeze(Object.defineProperty({__proto__:null,default:cs},Symbol.toStringTag,{value:"Module"})),A=c.memo(({avatarUrl:o,displayname:e,dm:n=!1,online:s=!1})=>o?t.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[t.jsx("img",{className:"rounded-full w-8 h-8",alt:e,src:o}),n?s?t.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):t.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):t.jsx(t.Fragment,{})]}):t.jsxs("div",{className:"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white",children:[e.replace("@","")[0].toUpperCase(),n?s?t.jsx("div",{className:"bg-green-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):t.jsx("div",{className:"bg-red-500 rounded-full w-3 h-3 absolute bottom-0 right-0"}):t.jsx(t.Fragment,{})]}));A.__docgenInfo={description:"",methods:[],displayName:"Avatar",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the avatar user"}}};const ds={title:"Chat/Avatar",tags:["autodocs"],component:A,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"User ID",description:"The DISPLAY name of the User"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the Avatar is used for a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"}}},q={args:{displayname:"test",dm:!1,online:!1,avatarUrl:""}},H={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1}},F={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1}},V={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}},B={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1}},W={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0}};q.parameters={...q.parameters,docs:{...q.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: ""
  }
}`,...q.parameters?.docs?.source}}};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false
  }
}`,...H.parameters?.docs?.source}}};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false
  }
}`,...F.parameters?.docs?.source}}};V.parameters={...V.parameters,docs:{...V.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true
  }
}`,...V.parameters?.docs?.source}}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false
  }
}`,...B.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true
  }
}`,...W.parameters?.docs?.source}}};const ms=["Fallback","Image","DMOffline","DMOnline","DMNoAvatarOffline","DMNoAvatarOnline"],us=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:B,DMNoAvatarOnline:W,DMOffline:F,DMOnline:V,Fallback:q,Image:H,__namedExportsOrder:ms,default:ds},Symbol.toStringTag,{value:"Module"}));const Ie=c.memo(({type:o="button",style:e="primary",onClick:n,children:s,readonly:a})=>e==="secondary"?t.jsx("button",{disabled:a,onClick:n,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:s}):e==="abort"?t.jsx("button",{disabled:a,onClick:n,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:s}):t.jsx("button",{disabled:a,onClick:n,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:o,children:s}));Ie.__docgenInfo={description:"",methods:[],displayName:"Button",props:{type:{defaultValue:{value:'"button"',computed:!1},required:!1,tsType:{name:"union",raw:'"button" | "submit" | "reset"',elements:[{name:"literal",value:'"button"'},{name:"literal",value:'"submit"'},{name:"literal",value:'"reset"'}]},description:"The button type"},style:{defaultValue:{value:'"primary"',computed:!1},required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "abort"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"abort"'}]},description:"The button style"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The button onClick handler"},children:{required:!0,tsType:{name:"string"},description:"The button Label"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the button is readonly"}}};const ps={title:"Fundamentals/Buttons/BasicButton",tags:["autodocs"],component:Ie,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{children:{required:!0,name:"Label",description:"The button label"},onClick:{description:"The button onClick handler",required:!0},type:{description:"The button type",control:"select",options:["button","submit","reset"],defaultValue:"button"},style:{description:"The button styling",control:"select",options:["primary","secondary","abort"],defaultValue:"primary"}}},K={args:{children:"Click me",type:"button",style:"primary"}},X={args:{children:"Submit",type:"submit",style:"primary"}},J={args:{children:"Reset",type:"reset",style:"primary"}},G={args:{children:"Click me",type:"button",style:"secondary"}},Z={args:{children:"Submit",type:"submit",style:"secondary"}},Q={args:{children:"Reset",type:"reset",style:"secondary"}},Y={args:{children:"Abort",type:"button",style:"abort"}};K.parameters={...K.parameters,docs:{...K.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'primary'
  }
}`,...K.parameters?.docs?.source}}};X.parameters={...X.parameters,docs:{...X.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'primary'
  }
}`,...X.parameters?.docs?.source}}};J.parameters={...J.parameters,docs:{...J.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'primary'
  }
}`,...J.parameters?.docs?.source}}};G.parameters={...G.parameters,docs:{...G.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Click me',
    type: 'button',
    style: 'secondary'
  }
}`,...G.parameters?.docs?.source}}};Z.parameters={...Z.parameters,docs:{...Z.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Submit',
    type: 'submit',
    style: 'secondary'
  }
}`,...Z.parameters?.docs?.source}}};Q.parameters={...Q.parameters,docs:{...Q.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Reset',
    type: 'reset',
    style: 'secondary'
  }
}`,...Q.parameters?.docs?.source}}};Y.parameters={...Y.parameters,docs:{...Y.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Abort',
    type: 'button',
    style: 'abort'
  }
}`,...Y.parameters?.docs?.source}}};const hs=["Default","Submit","Reset","DefaultSecondary","SubmitSecondary","ResetSecondary","Abort"],fs=Object.freeze(Object.defineProperty({__proto__:null,Abort:Y,Default:K,DefaultSecondary:G,Reset:J,ResetSecondary:Q,Submit:X,SubmitSecondary:Z,__namedExportsOrder:hs,default:ps},Symbol.toStringTag,{value:"Module"})),Ee=c.memo(({children:o})=>t.jsx("h1",{className:"text-black font-bold text-xl",children:o}));Ee.__docgenInfo={description:"",methods:[],displayName:"Header",props:{children:{required:!0,tsType:{name:"string"},description:"The HeaderText"}}};const gs={title:"Fundamentals/Typography/Header",tags:["autodocs"],component:Ee,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{children:{required:!0,name:"Content",description:"The Headertext"}}},ee={args:{children:"Header"}};ee.parameters={...ee.parameters,docs:{...ee.parameters?.docs,source:{originalSource:`{
  args: {
    children: 'Header'
  }
}`,...ee.parameters?.docs?.source}}};const ys=["Default"],xs=Object.freeze(Object.defineProperty({__proto__:null,Default:ee,__namedExportsOrder:ys,default:gs},Symbol.toStringTag,{value:"Module"})),be=c.memo(({placeholder:o,password:e=!1,autoFocus:n=!1,value:s,readonly:a,onChange:r})=>t.jsx("input",{disabled:a,className:"text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:s,type:e?"password":"text",autoFocus:n,placeholder:o,onChange:r}));be.__docgenInfo={description:"",methods:[],displayName:"Input",props:{password:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If it is a password input"},autoFocus:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"If input should be autofocused"},placeholder:{required:!0,tsType:{name:"string"},description:"The Placeholder text"},value:{required:!0,tsType:{name:"string"},description:"The value of the input field"},readonly:{required:!0,tsType:{name:"boolean"},description:"If the input is readonly"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{name:"e",type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"}}],return:{name:"void"}}},description:"Handler for the onChange event"}}};const vs={title:"Fundamentals/Inputs/BasicInput",tags:["autodocs"],component:be,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{placeholder:{required:!0,name:"Placeholder",description:"The Placeholder for the input field. Shown if it is empty."},password:{required:!1,name:"Password",control:"boolean",defaultValue:!1,description:"If the input field takes a password."},autoFocus:{required:!1,name:"Auto Focus",control:"boolean",defaultValue:!1,description:"If the field should be focused automatically."},value:{required:!0,name:"Value",description:"The current value of the input."},onChange:{description:"The onChange handler of the input field.",required:!0}}},te={args:{placeholder:"Placeholder",password:!1,autoFocus:!1}};te.parameters={...te.parameters,docs:{...te.parameters?.docs,source:{originalSource:`{
  args: {
    placeholder: "Placeholder",
    password: false,
    autoFocus: false
  }
}`,...te.parameters?.docs?.source}}};const bs=["Default"],_s=Object.freeze(Object.defineProperty({__proto__:null,Default:te,__namedExportsOrder:bs,default:vs},Symbol.toStringTag,{value:"Module"})),ws=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,Ns=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/,Ss=[o=>{const e=ws.exec(o);return e&&{index:e.index,length:e[0].length,text:e[0],url:e[0]}},o=>{const e=Ns.exec(o);return e&&{index:e.index,length:e[0].length,text:e[0],url:`mailto:${e[0]}`}}];function Ze(){return t.jsx(vt.AutoLinkPlugin,{matchers:Ss})}Ze.__docgenInfo={description:"",methods:[],displayName:"PlaygroundAutoLinkPlugin"};const ve=1,js=new Set(["paragraph","quote","code","h1","h2","ul","ol"]),Is={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List",paragraph:"Normal",quote:"Quote",ul:"Bulleted List"},Pe=c.memo(()=>t.jsx("div",{className:"divider"}));function Ae(o,e){e?(o.style.opacity="1",o.style.top=`${e.top+e.height+window.pageYOffset+10}px`,o.style.left=`${e.left+window.pageXOffset-o.offsetWidth/2+e.width/2}px`):(o.style.opacity="0",o.style.top="-1000px",o.style.left="-1000px")}const Es=c.memo(({editor:o})=>{const e=c.useRef(null),n=c.useRef(null),s=c.useRef(!1),[a,r]=c.useState(""),[i,d]=c.useState(!1),[x,p]=c.useState(null),f=c.useCallback(()=>{const m=N.$getSelection();if(N.$isRangeSelection(m)){const v=Qe(m),l=v.getParent();R.$isLinkNode(l)?r(l.getURL()):R.$isLinkNode(v)?r(v.getURL()):r("")}const _=e.current,u=window.getSelection(),b=document.activeElement;if(_===null)return;const y=o.getRootElement();if(m!==null&&!u?.isCollapsed&&y!==null&&y.contains(u?.anchorNode)){const v=u?.getRangeAt(0);let l;if(u?.anchorNode===y){let S=y;for(;S.firstElementChild!=null;)S=S.firstElementChild;l=S.getBoundingClientRect()}else l=v?.getBoundingClientRect();s.current||Ae(_,l),p(m)}else(!b||b.className!=="link-input")&&(Ae(_,void 0),p(null),d(!1),r(""));return!0},[o]);c.useEffect(()=>Ne.mergeRegister(o.registerUpdateListener(({editorState:m})=>{m.read(()=>{f()})}),o.registerCommand(N.SELECTION_CHANGE_COMMAND,()=>(f(),!0),ve)),[o,f]),c.useEffect(()=>{o.getEditorState().read(()=>{f()})},[o,f]),c.useEffect(()=>{i&&n.current&&n.current.focus()},[i]);const g=c.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a);return t.jsx("div",{ref:e,className:"link-editor",children:i?t.jsx("input",{ref:n,className:"link-input",value:a,onChange:m=>{r(m.target.value)},onKeyDown:m=>{m.key==="Enter"?(m.preventDefault(),x!==null&&(a!==""&&o.dispatchCommand(R.TOGGLE_LINK_COMMAND,a),d(!1))):m.key==="Escape"&&(m.preventDefault(),d(!1))}}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"link-input",children:[g,t.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:m=>m.preventDefault(),onClick:()=>{d(!0)}})]})})})}),ks=c.memo(({onChange:o,className:e,options:n,value:s})=>t.jsxs("select",{className:e,onChange:o,value:s,children:[t.jsx("option",{hidden:!0,value:""}),n.map(a=>t.jsx("option",{value:a,children:a},a))]}));function Qe(o){const e=o.anchor,n=o.focus,s=o.anchor.getNode(),a=o.focus.getNode();return s===a?s:o.isBackward()?O.$isAtNodeEnd(n)?s:a:O.$isAtNodeEnd(e)?a:s}const Cs=c.memo(({editor:o,blockType:e,toolbarRef:n,setShowBlockOptionsDropDown:s})=>{const a=c.useRef(null);c.useEffect(()=>{const m=a.current,_=n.current;if(m!==null&&_!==null){const u=b=>{const y=b.target;!m.contains(y)&&!_.contains(y)&&s(!1)};return document.addEventListener("click",u),()=>{document.removeEventListener("click",u)}}},[a,s,n]);const r=()=>{e!=="paragraph"&&o.update(()=>{const m=N.$getSelection();N.$isRangeSelection(m)&&O.$wrapNodes(m,()=>N.$createParagraphNode())}),s(!1)},i=()=>{e!=="h1"&&o.update(()=>{const m=N.$getSelection();N.$isRangeSelection(m)&&O.$wrapNodes(m,()=>$.$createHeadingNode("h1"))}),s(!1)},d=()=>{e!=="h2"&&o.update(()=>{const m=N.$getSelection();N.$isRangeSelection(m)&&O.$wrapNodes(m,()=>$.$createHeadingNode("h2"))}),s(!1)},x=()=>{e!=="ul"?o.dispatchCommand(M.INSERT_UNORDERED_LIST_COMMAND,void 0):o.dispatchCommand(M.REMOVE_LIST_COMMAND,void 0),s(!1)},p=()=>{e!=="ol"?o.dispatchCommand(M.INSERT_ORDERED_LIST_COMMAND,void 0):o.dispatchCommand(M.REMOVE_LIST_COMMAND,void 0),s(!1)},f=()=>{e!=="quote"&&o.update(()=>{const m=N.$getSelection();N.$isRangeSelection(m)&&O.$wrapNodes(m,()=>$.$createQuoteNode())}),s(!1)},g=()=>{e!=="code"&&o.update(()=>{const m=N.$getSelection();N.$isRangeSelection(m)&&O.$wrapNodes(m,()=>P.$createCodeNode())}),s(!1)};return t.jsxs("div",{className:"dropdown",ref:a,children:[t.jsxs("button",{className:"item",onClick:r,children:[t.jsx($e,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Normal"}),e==="paragraph"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:i,children:[t.jsx(qe,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Large Heading"}),e==="h1"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:d,children:[t.jsx(He,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Small Heading"}),e==="h2"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:x,children:[t.jsx(Fe,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Bullet List"}),e==="ul"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:p,children:[t.jsx(Ve,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Numbered List"}),e==="ol"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:f,children:[t.jsx(Be,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Quote"}),e==="quote"&&t.jsx("span",{className:"active"})]}),t.jsxs("button",{className:"item",onClick:g,children:[t.jsx(Se,{className:"icon",size:20}),t.jsx("span",{className:"text",children:"Code Block"}),e==="code"&&t.jsx("span",{className:"active"})]})]})}),Ye=c.memo(()=>{const[o]=We.useLexicalComposerContext(),e=c.useRef(null),[n,s]=c.useState(!1),[a,r]=c.useState(!1),[i,d]=c.useState("paragraph"),[x,p]=c.useState(null),[f,g]=c.useState(!1),[m,_]=c.useState(""),[u,b]=c.useState(!1),[y,v]=c.useState(!1),[l,S]=c.useState(!1),[k,h]=c.useState(!1),[w,D]=c.useState(!1),[E,ct]=c.useState(!1),[lt,dt]=c.useState(!1),_e=c.useCallback(()=>{const j=N.$getSelection();if(N.$isRangeSelection(j)){const C=j.anchor.getNode(),L=C.getKey()==="root"?C:C.getTopLevelElementOrThrow(),Te=L.getKey();if(o.getElementByKey(Te)!==null)if(p(Te),M.$isListNode(L)){const xe=Ne.$getNearestNodeOfType(C,M.ListNode),yt=xe?xe.getTag():L.getTag();d(yt)}else{const xe=$.$isHeadingNode(L)?L.getTag():L.getType();d(xe),P.$isCodeNode(L)&&_(L.getLanguage()||P.getDefaultCodeLanguage())}S(j.hasFormat("bold")),h(j.hasFormat("italic")),D(j.hasFormat("underline")),ct(j.hasFormat("strikethrough")),dt(j.hasFormat("code")),b(O.$isParentElementRTL(j));const Le=Qe(j),gt=Le.getParent();R.$isLinkNode(gt)||R.$isLinkNode(Le)?v(!0):v(!1)}},[o]);c.useEffect(()=>Ne.mergeRegister(o.registerUpdateListener(({editorState:j})=>{j.read(()=>{_e()})}),o.registerCommand(N.SELECTION_CHANGE_COMMAND,(j,C)=>(_e(),!1),ve),o.registerCommand(N.CAN_UNDO_COMMAND,j=>(s(j),!1),ve),o.registerCommand(N.CAN_REDO_COMMAND,j=>(r(j),!1),ve)),[o,_e]);const mt=c.useMemo(()=>P.getCodeLanguages(),[]),ut=c.useCallback(j=>{o.update(()=>{if(x!==null){const C=N.$getNodeByKey(x);P.$isCodeNode(C)&&C.setLanguage(j.target.value)}})},[o,x]),pt=c.useCallback(()=>{y?o.dispatchCommand(R.TOGGLE_LINK_COMMAND,null):o.dispatchCommand(R.TOGGLE_LINK_COMMAND,"https://")},[o,y]),[ht,ft]=c.useState(null);return c.useEffect(()=>{const j=document.getElementsByClassName("editor-container")[0],C=document.createElement("div");return j.prepend(C),ft(C),()=>{j.removeChild(C)}},[]),t.jsxs("div",{className:"toolbar",ref:e,children:[t.jsx("button",{disabled:!n,onClick:()=>{o.dispatchCommand(N.UNDO_COMMAND,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:t.jsx(bt,{className:"format",size:20})}),t.jsx("button",{disabled:!a,onClick:()=>{o.dispatchCommand(N.REDO_COMMAND,void 0)},className:"toolbar-item","aria-label":"Redo",children:t.jsx(_t,{className:"format",size:20})}),t.jsx(Pe,{}),js.has(i)&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"toolbar-item block-controls",onClick:()=>g(!f),"aria-label":"Formatting Options",children:[i==="h1"?t.jsx(qe,{className:"icon",size:20}):i==="h2"?t.jsx(He,{className:"icon",size:20}):i==="h3"?t.jsx(wt,{className:"icon",size:20}):i==="h4"?t.jsx(Nt,{className:"icon",size:20}):i==="h5"?t.jsx(St,{className:"icon",size:20}):i==="code"?t.jsx(Se,{className:"icon",size:20}):i==="paragraph"?t.jsx($e,{className:"icon",size:20}):i==="ol"?t.jsx(Ve,{className:"icon",size:20}):i==="ul"?t.jsx(Fe,{className:"icon",size:20}):i==="quote"?t.jsx(Be,{className:"icon",size:20}):t.jsx(t.Fragment,{}),t.jsx("span",{className:"text",children:Is[i]}),t.jsx(Ke,{size:20})]}),f&&Oe.createPortal(t.jsx(Cs,{editor:o,blockType:i,toolbarRef:e,setShowBlockOptionsDropDown:g}),ht),t.jsx(Pe,{})]}),i==="code"?t.jsxs(t.Fragment,{children:[t.jsx(ks,{className:"toolbar-item code-language",onChange:ut,options:mt,value:m}),t.jsx("i",{className:"chevron-down inside"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{o.dispatchCommand(N.FORMAT_TEXT_COMMAND,"bold")},className:"toolbar-item spaced "+(l?"active":""),"aria-label":"Format Bold",children:t.jsx(jt,{className:"format",size:20})}),t.jsx("button",{onClick:()=>{o.dispatchCommand(N.FORMAT_TEXT_COMMAND,"italic")},className:"toolbar-item spaced "+(k?"active":""),"aria-label":"Format Italics",children:t.jsx(It,{className:"format",size:20})}),t.jsx("button",{onClick:()=>{o.dispatchCommand(N.FORMAT_TEXT_COMMAND,"underline")},className:"toolbar-item spaced "+(w?"active":""),"aria-label":"Format Underline",children:t.jsx(Et,{className:"format",size:20})}),t.jsx("button",{onClick:()=>{o.dispatchCommand(N.FORMAT_TEXT_COMMAND,"strikethrough")},className:"toolbar-item spaced "+(E?"active":""),"aria-label":"Format Strikethrough",children:t.jsx(kt,{className:"format",size:20})}),t.jsx("button",{onClick:()=>{o.dispatchCommand(N.FORMAT_TEXT_COMMAND,"code")},className:"toolbar-item spaced "+(lt?"active":""),"aria-label":"Insert Code",children:t.jsx(Se,{className:"format",size:20})}),t.jsx("button",{onClick:pt,className:"toolbar-item spaced "+(y?"active":""),"aria-label":"Insert Link",children:t.jsx(Ct,{className:"format",size:20})}),y&&Oe.createPortal(t.jsx(Es,{editor:o}),document.body)," "]})]})});Ye.__docgenInfo={description:"",methods:[],displayName:"ToolbarPlugin"};function Ds(){const[o]=We.useLexicalComposerContext();return c.useEffect(()=>P.registerCodeHighlighting(o),[o]),null}const Rs={ltr:"ltr",rtl:"rtl",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough",code:"editor-text-code"},code:"editor-code",codeHighlight:{atrule:"editor-tokenAttr",attr:"editor-tokenAttr",boolean:"editor-tokenProperty",builtin:"editor-tokenSelector",cdata:"editor-tokenComment",char:"editor-tokenSelector",class:"editor-tokenFunction","class-name":"editor-tokenFunction",comment:"editor-tokenComment",constant:"editor-tokenProperty",deleted:"editor-tokenProperty",doctype:"editor-tokenComment",entity:"editor-tokenOperator",function:"editor-tokenFunction",important:"editor-tokenVariable",inserted:"editor-tokenSelector",keyword:"editor-tokenAttr",namespace:"editor-tokenVariable",number:"editor-tokenProperty",operator:"editor-tokenOperator",prolog:"editor-tokenComment",property:"editor-tokenProperty",punctuation:"editor-tokenPunctuation",regex:"editor-tokenVariable",selector:"editor-tokenSelector",string:"editor-tokenSelector",symbol:"editor-tokenProperty",tag:"editor-tokenProperty",url:"editor-tokenOperator",variable:"editor-tokenVariable"}};function Ts(){return t.jsx("div",{className:"editor-placeholder",id:"editor-placeholder",children:"Enter message..."})}const ke=c.memo(({namespace:o,onChange:e,onError:n})=>{const s={namespace:o,theme:Rs,onError:n,nodes:[$.HeadingNode,M.ListNode,M.ListItemNode,$.QuoteNode,P.CodeNode,P.CodeHighlightNode,we.TableNode,we.TableCellNode,we.TableRowNode,R.AutoLinkNode,R.LinkNode]};return t.jsx(Dt.LexicalComposer,{initialConfig:s,children:t.jsxs("div",{className:"editor-container flex-1",children:[t.jsx(Ye,{}),t.jsxs("div",{className:"editor-inner",children:[t.jsx(Rt.RichTextPlugin,{contentEditable:t.jsx(Tt.ContentEditable,{className:"editor-input",ariaLabelledBy:"editor-placeholder"}),placeholder:t.jsx(Ts,{}),ErrorBoundary:Lt}),t.jsx(Ot.OnChangePlugin,{onChange:e}),t.jsx(Mt.HistoryPlugin,{}),t.jsx(Pt.LinkPlugin,{}),t.jsx(Ds,{}),t.jsx(Ze,{}),t.jsx(At.MarkdownShortcutPlugin,{transformers:ge.TRANSFORMERS})]})]})})});ke.__docgenInfo={description:"",methods:[],displayName:"ChatInput",props:{namespace:{required:!0,tsType:{name:"string"},description:"The Namespace"},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(editorState: EditorState, editor: LexicalEditor, tags: Set<string>) => void",signature:{arguments:[{name:"editorState",type:{name:"EditorState"}},{name:"editor",type:{name:"LexicalEditor"}},{name:"tags",type:{name:"Set",elements:[{name:"string"}],raw:"Set<string>"}}],return:{name:"void"}}},description:"Handler for the onChange event"},onError:{required:!0,tsType:{name:"signature",type:"function",raw:"(error: Error, editor: LexicalEditor) => void",signature:{arguments:[{name:"error",type:{name:"Error"}},{name:"editor",type:{name:"LexicalEditor"}}],return:{name:"void"}}},description:"Handler for the onError event"}}};const Ls={title:"Chat/Input",tags:["autodocs"],component:ke,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{namespace:{required:!0,name:"Namespace",description:"The Namespace of the editor."},onChange:{description:"The onChange handler of the editor.",required:!0},onError:{description:"The error handler of the editor.",required:!0}}},se={args:{onChange:(o,e)=>{o.read(()=>{const n=N.$getRoot(),s=ge.$convertToMarkdownString(ge.TRANSFORMERS,n),a=Xe.$generateHtmlFromNodes(e,null);console.log(s),console.log(a)})},onError:o=>{console.error(o)},namespace:"Editor"}};se.parameters={...se.parameters,docs:{...se.parameters?.docs,source:{originalSource:`{
  args: {
    onChange: (editorState: EditorState, editor: LexicalEditor) => {
      editorState.read(() => {
        // Read the contents of the EditorState here.
        const root = $getRoot();
        // make it markdown
        const markdown = $convertToMarkdownString(TRANSFORMERS, root);
        const html = $generateHtmlFromNodes(editor, null);
        console.log(markdown);
        console.log(html);
      });
    },
    onError: error => {
      console.error(error);
    },
    namespace: "Editor"
  }
}`,...se.parameters?.docs?.source}}};const Os=["Default"],Ms=Object.freeze(Object.defineProperty({__proto__:null,Default:se,__namedExportsOrder:Os,default:Ls},Symbol.toStringTag,{value:"Module"}));function Ps(o){return o.op==="SYNC"}function As(o){return o.op==="INSERT"}function zs(o){return o.op==="INVALIDATE"}function Us(o){return o.op==="DELETE"}function $s(o){return o.type==="m.room.message"&&o.content.msgtype==="m.text"}function ze(o){return o.state_key!==void 0}function qs(o){return o.type==="m.room.create"}function Hs(o){return o.type==="m.room.avatar"}function Fs(o){return o.type==="m.space.child"}function Vs(o){return o.type==="m.space.parent"}function Bs(o){return o.type==="m.room.topic"}class U{constructor(e,n){this.roomID=e,this.hostname=n}events=[];stateEvents=[];name;notification_count=0;notification_highlight_count=0;joined_count=0;invited_count=0;is_dm=!1;windowPos={};addEvents(e){e.forEach(n=>{const s=this.events.findIndex(a=>a.event_id===n.event_id);s!==-1?this.events[s]=n:this.events.push(n)})}addStateEvents(e){e.forEach(n=>{const s=this.stateEvents.findIndex(a=>a.event_id===n.event_id);s!==-1?this.stateEvents[s]=n:this.stateEvents.push(n)})}getStateEvents(){return this.stateEvents}getAvatarURL(){let e;return this.stateEvents.forEach(n=>{if(Hs(n)){const s=n.content.url;s?.startsWith("mxc://")&&(e=`${this.hostname}/_matrix/media/r0/download/${s.substring(6)}`)}}),e}isSpace(){let e=!1;return this.stateEvents.forEach(n=>{qs(n)&&(e=n.content.type==="m.space")}),e}setName(e){this.name=e}getName(){return this.name?this.name:this.roomID}getTopic(){let e;return this.stateEvents.forEach(n=>{Bs(n)&&(e=n.content.topic)}),e}setNotificationCount(e){this.notification_count=e}getNotificationCount(){return this.notification_count}setNotificationHighlightCount(e){this.notification_highlight_count=e}getNotificationHighlightCount(){return this.notification_highlight_count}setJoinedCount(e){this.joined_count=e}getJoinedCount(){return this.joined_count}setInvitedCount(e){this.invited_count=e}getInvitedCount(){return this.invited_count}getSpaceChildrenIDs(){const e=[];return this.stateEvents.forEach(n=>{Fs(n)&&e.push(n.state_key)}),e}getSpaceParentIDs(){const e=[];return this.stateEvents.forEach(n=>{Vs(n)&&e.push({roomID:n.state_key,canonical:n.content.canonical||!1})}),e}setDM(e){this.is_dm=e}isDM(){return this.is_dm}isOnline(){return!1}getEvents(){return this.events}getMemberName(e){let n=e;return this.stateEvents.forEach(s=>{s.type==="m.room.member"&&s.state_key===e&&s.content.membership=="join"&&(n=s.content.displayname)}),n}getMemberAvatar(e){let n;return this.stateEvents.forEach(s=>{if(s.type==="m.room.member"&&s.state_key===e&&s.content.membership=="join"){const a=s.content.avatar_url;a?.startsWith("mxc://")&&(n=`${this.hostname}/_matrix/media/r0/download/${a.substring(6)}`)}}),n}isEncrypted(){let e=!1;return this.stateEvents.forEach(n=>{n.type==="m.room.encryption"&&n.content.algorithm==="m.megolm.v1.aes-sha2"&&n.state_key===""&&(e=!0)}),e}}class Ws extends zt{static _instance;access_token;device_id;mxid;hostname;slidingSyncHostname;syncing=!1;roomsInView=[];spaceOpen=[];rooms=new Set;syncPos;initialSync=!0;database;profileInfo;lastRanges;lastTxnID;to_device_since;olmMachine;get isLoggedIn(){return this.access_token!==void 0}static async Instance(){let e=this._instance;if(!e){e=this._instance=new this,e.database||await e.createDatabase();const n=e.database?.transaction("loginInfo","readonly"),s=await n?.store.getAll();if(await n?.done,s&&s.length>0){e.mxid=s[0].userId,e.hostname=s[0].hostname,e.slidingSyncHostname=s[0].slidingSyncHostname,e.access_token=s[0].access_token,e.device_id=s[0].device_id,e.profileInfo={avatar_url:s[0].avatarUrl,displayname:s[0].displayName},e.olmMachine=await I.OlmMachine.initialize(new I.UserId(e.mxid),new I.DeviceId(e.device_id),"cetirizine-crypto");const a=e.database?.transaction("syncInfo","readonly"),r=await a?.store.get(e.mxid);await a?.done,r&&(e.syncPos=r.syncPos,e.initialSync=r.initialSync,e.lastRanges=r.lastRanges,e.lastTxnID=r.lastTxnID,console.log("to_device_since:",r.to_device_since),e.to_device_since=r.to_device_since);const i=e.database?.transaction("rooms","readonly"),d=await i?.store.getAll();await i?.done,d&&(e.rooms=new Set(d.map(x=>{const p=new U(x.roomID,e.hostname);return p.windowPos=x.windowPos,p.setInvitedCount(x.invited_count),p.setJoinedCount(x.joined_count),p.setNotificationCount(x.notification_count),p.setNotificationHighlightCount(x.highlight_count),p.setName(x.name),x.events&&p.addEvents(x.events),x.stateEvents&&p.addStateEvents(x.stateEvents),x.isDM&&p.setDM(x.isDM),p})),e.emit("rooms",e.rooms))}}return e}async createDatabase(){this.database=await Ut("matrix",4,{upgrade(e,n){n<1&&(e.objectStoreNames.contains("rooms")&&e.deleteObjectStore("rooms"),e.objectStoreNames.contains("syncInfo")&&e.deleteObjectStore("syncInfo"),e.createObjectStore("rooms",{keyPath:"roomID"}),e.createObjectStore("loginInfo",{keyPath:"userId"}),e.createObjectStore("syncInfo",{keyPath:"userId"}))}})}async setHostname(e){if(!e.startsWith("https://"))throw Error("Hostname must start with 'https://'");this.database||await this.createDatabase();const n=this.database?.transaction("loginInfo","readwrite");await n?.store.put({userId:this.mxid,hostname:e,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,device_id:this.device_id}),await n?.done,this.hostname=e}async startSync(){if(!this.isLoggedIn)throw Error("Not logged in");if(this.database||await this.createDatabase(),!this.syncing)for(this.syncing=!0;this.syncing;)try{await this.sync()}catch(e){console.error(e);return}}stopSync(){this.syncing=!1}isIndexInRange(e,n){for(const s of n)if(s[0]<e&&e<=s[1])return!0;return!1}shiftRight(e,n,s,a){for(let r=s-1;r>a-1;r--)if(this.isIndexInRange(r,n)){const i=[...this.rooms].find(d=>d.windowPos[e]===r+1);i&&(i.windowPos[e]=r)}}shiftLeft(e,n,s,a){for(let r=a+1;r<s+1;r++)if(this.isIndexInRange(r,n)){const i=[...this.rooms].find(d=>d.windowPos[e]===r-1);i&&(i.windowPos[e]=r)}}async removeEntry(e,n,s){let a=-1;const r=[...this.rooms].map(d=>d.windowPos[e]);for(const d in r)Number(d)>a&&(a=Number(d));const i=[...this.rooms].find(d=>d.windowPos[e]===s);if(i){const d=this.database?.transaction("rooms","readwrite");await d?.store.delete(i.roomID),await d?.done,this.rooms.delete(i)}a<0||s>a||this.shiftLeft(e,n,a,s)}addEntry(e,n,s){let a=-1;const r=[...this.rooms].map(i=>i.windowPos[e]);for(const i in r)Number(i)>a&&(a=Number(i));a<0||s>a||this.shiftRight(e,n,a+1,s)}async sendIdentifyAndOneTimeKeys(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");if(!this.olmMachine)throw Error("Olm machine must be set first");const e=await this.olmMachine.outgoingRequests();for(const n of e)if(n.type===I.RequestType.KeysUpload){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/keys/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to upload keys",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.KeysQuery){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/keys/query`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to query keys",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.KeysClaim){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/keys/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to claim keys",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.ToDevice){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/sendToDevice/${s.event_type}/${s.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to send to device",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.SignatureUpload){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/keys/signatures/upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to upload signatures",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.RoomMessage){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/rooms/${s.room_id}/send/${s.event_type}/${s.txn_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to send message",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}else if(n.type===I.RequestType.KeysBackup){const s=n,a=await fetch(`${this.hostname}/_matrix/client/v3/room_keys/keys`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.access_token}`},body:s.body});a.ok||console.error("Failed to backup keys",a),this.olmMachine.markRequestAsSent(s.id,s.type,await a.text())}}async sync(){if(!this.isLoggedIn)throw Error("Not logged in");if(!this.slidingSyncHostname)throw Error("Hostname must be set first");await this.sendIdentifyAndOneTimeKeys();let e={overview:[[0,10]],spaces:[[0,Number.MAX_SAFE_INTEGER]]},n=1;if(!this.initialSync)for(const p in e){n=10;const f=new Set([...this.rooms].filter(u=>this.roomsInView.includes(u.roomID)).map(u=>u.windowPos[p]).sort());if(f.size===0)continue;f.add([...f][f.size-1]+1);const _=[...f].reduce((u,b,y,v)=>y===0?(u.push([b,b]),u):b===v[y-1]+1?(u[u.length-1][1]=b,u):(u.push([b,b]),u),[]).sort((u,b)=>u[0]-b[0]).reduce((u,b,y,v)=>y===0?(u.push(b),u):(b[0]===v[y-1][0]&&b[1]===v[y-1][1]||u.push(b),u),[]);e[p]=_}this.lastRanges&&Object.entries(e).toString()!==Object.entries(this.lastRanges).toString()&&(console.log("Ranges changed, resetting sync txn_id",e),this.lastRanges=e,this.lastTxnID=Date.now().toString()),this.lastRanges||(console.log(e),this.lastRanges=e,this.lastTxnID=Date.now().toString());let s=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=30000`;this.syncPos&&(s=`${this.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=30000&pos=${this.syncPos}`),console.log("to_device_since:",this.to_device_since);const a=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${this.access_token}`},body:JSON.stringify({txn_id:this.lastTxnID,lists:{spaces:{slow_get_all_rooms:!0,sort:["by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"]],timeline_limit:n,filters:{room_types:["m.space"]}},overview:{ranges:this.lastRanges.overview,sort:["by_notification_level","by_recency","by_name"],required_state:[["m.space.child","*"],["m.space.parent","*"],["m.room.create",""],["m.room.avatar","*"],["m.room.topic","*"],["m.room.member","$LAZY"]],timeline_limit:n,filters:{}}},bump_event_types:["m.room.message","m.room.encrypted"],extensions:{e2ee:{enabled:!0},to_device:{enabled:!0,since:this.to_device_since||null}}})});if(!a.ok){if(a.status===400&&(await a.json()).errcode==="M_UNKNOWN_POS"){this.syncPos=void 0;const p=this.database?.transaction("syncInfo","readwrite");await p?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID}),await p?.done}console.error(a),console.error("Error syncing. See console for error.")}const r=await a.json();this.syncPos=r.pos,r.extensions?.to_device&&(console.log("Processing to_device events"),await this.olmMachine?.receiveSyncChanges(JSON.stringify(r.extensions.to_device.events||[]),new I.DeviceLists(r.extensions.e2ee?.device_lists?.changed?.map(p=>new I.UserId(p)),r.extensions.e2ee?.device_lists?.left?.map(p=>new I.UserId(p))),new Map(Object.entries(r.extensions.e2ee?.device_one_time_keys_count||[])),new Set(r.extensions.e2ee?.device_unused_fallback_key_types)),this.to_device_since=r.extensions.to_device.next_batch),await this.sendIdentifyAndOneTimeKeys();const i=this.database?.transaction("syncInfo","readwrite");await i?.store.put({userId:this.mxid,syncPos:this.syncPos,initialSync:this.initialSync,lastRanges:this.lastRanges,lastTxnID:this.lastTxnID,to_device_since:this.to_device_since}),await i?.done;let d=-1;for(const p in r.lists){const f=r.lists[p];if(f.ops){for(const g of f.ops)if(Ps(g)){const m=this.database?.transaction("rooms","readwrite");for(let _=g.range[0];_<=g.range[1];_++){const u=g.room_ids[_-g.range[0]];if(!u)break;const b=[...this.rooms].find(v=>v.roomID===u);if(b){b.windowPos[p]=_;continue}const y=new U(u,this.hostname);y.setName(u),y.windowPos[p]=_,this.rooms.add(y),await m?.store.put({windowPos:y.windowPos,roomID:y.roomID,name:y.getName(),notification_count:y.getNotificationCount(),highlight_count:y.getNotificationHighlightCount(),joined_count:y.getJoinedCount(),invited_count:y.getInvitedCount(),avatarUrl:y.getAvatarURL(),isSpace:y.isSpace(),isDM:y.isDM(),stateEvents:y.getStateEvents(),events:y.getEvents()})}await m?.done}else if(As(g)){console.log("Got INSERT OP",g),[...this.rooms].find(v=>v.windowPos[p]===g.index)&&(d<0?this.addEntry(p,this.lastRanges[p],g.index):d>g.index?this.shiftRight(p,this.lastRanges[p],d,g.index):d<g.index&&this.shiftLeft(p,this.lastRanges[p],g.index,d)),d=-1;const _=this.database?.transaction("rooms","readwrite"),u=[...this.rooms].find(v=>v.roomID===g.room_id);if(u)u.windowPos[p]=g.index,await _?.store.put({windowPos:u.windowPos,roomID:u.roomID,name:u.getName(),notification_count:u.getNotificationCount(),highlight_count:u.getNotificationHighlightCount(),joined_count:u.getJoinedCount(),invited_count:u.getInvitedCount(),avatarUrl:u.getAvatarURL(),isSpace:u.isSpace(),isDM:u.isDM(),stateEvents:u.getStateEvents(),events:u.getEvents()});else{const v=await _?.store.get(g.room_id);let l=new U(g.room_id,this.hostname);l.setName(g.room_id),l.windowPos[p]=g.index,v&&(console.warn("Room in db but not in obj list.",g.room_id,"Updating obj list."),l=new U(g.room_id,this.hostname),l.setName(v.name),l.setNotificationCount(v.notification_count),l.setNotificationHighlightCount(v.highlight_count),l.setJoinedCount(v.joined_count),l.setInvitedCount(v.invited_count),l.setDM(v.isDM||!1)),this.rooms.add(l),await _?.store.put({windowPos:l.windowPos,roomID:l.roomID,name:l.getName(),notification_count:l.getNotificationCount(),highlight_count:l.getNotificationHighlightCount(),joined_count:l.getJoinedCount(),invited_count:l.getInvitedCount(),avatarUrl:l.getAvatarURL(),isSpace:l.isSpace(),isDM:l.isDM(),stateEvents:l.getStateEvents(),events:l.getEvents()})}const b=[...this.rooms].map(v=>v.roomID),y=b.filter((v,l)=>b.indexOf(v)!=l);y.length>0&&console.error("Duplicates found",y),await _?.done}else if(Us(g))console.log("Got DELETE OP",g),d!==-1&&await this.removeEntry(p,this.lastRanges[p],d),d=g.index;else if(zs(g)){const m=this.database?.transaction("rooms","readwrite");for(let _=g.range[0];_<=g.range[1];_++){const u=[...this.rooms].find(b=>b.windowPos[p]===_);u&&(await m?.store.delete(u.roomID),this.rooms.delete(u))}await m?.done}d!==-1&&await this.removeEntry(p,this.lastRanges[p],d)}}const x=this.database?.transaction("rooms","readwrite");for(const p in r.rooms){const f=r.rooms[p],g=f.name,m=f.notification_count,_=f.highlight_count,u=f.joined_count,b=f.invited_count,y=f.timeline,v=y?.filter(w=>ze(w)).map(w=>w),l=y?.filter(w=>!ze(w)).map(w=>w),S=f.required_state,k=f.is_dm;let h=[...this.rooms].find(w=>w.roomID===p);if(!h){console.warn("Could not find roomObj for roomID:",p);const w=await x?.store.get(p);w?(console.warn("Room in db but not in obj list.",p,"Updating obj list."),h=new U(p,this.hostname),h.setName(w.name),h.setNotificationCount(w.notification_count),h.setNotificationHighlightCount(w.highlight_count),h.setJoinedCount(w.joined_count),h.setInvitedCount(w.invited_count),h.setDM(w.isDM||!1),w.events&&h.addEvents(w.events),w.stateEvents&&h.addStateEvents(w.stateEvents),h.windowPos=w.windowPos):(console.warn("Could not find room in db. Creating new one."),h=new U(p,this.hostname),this.rooms.add(h))}if(g&&h.setName(g),h.setNotificationCount(m),h.setNotificationHighlightCount(_),h.setJoinedCount(u),h.setInvitedCount(b),l&&h.addEvents(l),S&&h.addStateEvents(S),v&&h.addStateEvents(v),(S||v)&&h.isEncrypted()){const D=[...S||[],...v||[]].filter(E=>E.type==="m.room.member"&&E.content.membership==="join").map(E=>new I.UserId(E.state_key));await this.olmMachine?.updateTrackedUsers(D)}k&&h.setDM(k),await x?.store.put({windowPos:h.windowPos,roomID:h.roomID,name:h.getName(),notification_count:h.getNotificationCount(),highlight_count:h.getNotificationHighlightCount(),joined_count:h.getJoinedCount(),invited_count:h.getInvitedCount(),events:h.getEvents(),stateEvents:h.getStateEvents(),avatarUrl:h.getAvatarURL(),isSpace:h.isSpace(),isDM:h.isDM()})}await x?.done,this.initialSync&&(this.initialSync=!1,console.log("initialSyncComplete")),r.rooms&&Object.keys(r.rooms).length>0&&this.emit("rooms",this.rooms)}addInViewRoom(e){this.roomsInView.push(e)}removeInViewRoom(e){this.roomsInView=this.roomsInView.filter(n=>n!==e)}addSpaceOpen(e){this.spaceOpen.push(e)}removeSpaceOpen(e){this.spaceOpen=this.spaceOpen.filter(n=>n!==e)}getRooms(){return this.rooms}getSpaces(){return[...this.rooms].filter(e=>e.isSpace()).sort((e,n)=>e.getName()<n.getName()?-1:e.getName()>n.getName()?1:0)}getSpacesWithRooms(){const e=this.getSpaces(),n=new Set;for(const s of e){const a=s.getSpaceChildrenIDs(),r=new Set([...this.getRooms()].filter(i=>a.includes(i.roomID)));n.add({spaceRoom:s,children:r})}for(const s of this.getRooms()){const a=s.getSpaceParentIDs();for(const r of a){const i=[...this.getRooms()].find(x=>x.roomID===r.roomID);if(!i)continue;const d=[...n].find(x=>x.spaceRoom.roomID===i.roomID);if(d){[...d.children].find(x=>x.roomID===s.roomID)||d.children.add(s);continue}n.add({spaceRoom:i,children:new Set([s])})}}return n}async getLoginFlows(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/_matrix/client/v3/login`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async getWellKnown(){if(!this.hostname)throw Error("Hostname must be set first");const e=await fetch(`${this.hostname}/.well-known/matrix/client`);if(!e.ok)throw console.error(e),Error("Error requesting login flows. See console for error.");return await e.json()}async passwordLogin(e,n,s=5){if(this.database||await this.createDatabase(),!e)throw Error("Username must be set");if(!n)throw Error("Password must be set");this.mxid=e,await this.setHostname(`https://${e.split(":")[1]}`);try{const d=await this.getWellKnown();if(d["m.homeserver"]?.base_url&&await this.setHostname(d["m.homeserver"].base_url),d["org.matrix.msc3575.proxy"]?.url){const x=this.database?.transaction("loginInfo","readwrite");await x?.store.put({userId:this.mxid,hostname:this.hostname,slidingSyncHostname:d["org.matrix.msc3575.proxy"].url,access_token:this.access_token,device_id:this.device_id}),await x?.done,this.slidingSyncHostname=d["org.matrix.msc3575.proxy"].url}else throw Error("No sliding sync proxy found")}catch(d){console.warn(`No well-known found for ${this.hostname}:
${d}`)}if(((await this.getLoginFlows()).flows.filter(d=>d.type==="m.login.password")?.length||0)==0)throw Error("Password login is not supported by this homeserver");const r=await fetch(`${this.hostname}/_matrix/client/r0/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"m.login.password",identifier:{type:"m.id.user",user:e},user:e,password:n})});if(!r.ok)throw console.error(r),Error("Error logging in. See console for error.");const i=await r.json();if(Js(i))throw Error(`Error logging in: ${i.errcode}: ${i.error}`);if(Ks(i)&&(console.error(`Rate limited. Retrying in ${i.retry_after_ms}ms. ${s} tries left.`),await this.passwordLogin(e,n,s-1)),Xs(i)){const d=this.database?.transaction("loginInfo","readwrite");await d?.store.put({userId:i.user_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:i.access_token,device_id:i.device_id}),await d?.done,this.access_token=i.access_token,this.device_id=i.device_id,this.mxid=i.user_id,this.olmMachine=await I.OlmMachine.initialize(new I.UserId(this.mxid),new I.DeviceId(this.device_id),"cetirizine-crypto")}}async fetchProfileInfo(e){if(this.profileInfo)return this.profileInfo;if(!this.hostname)throw Error("Hostname must be set first");if(this.database||await this.createDatabase(),!this.access_token)throw Error("Access token must be set first");const n=await fetch(`${this.hostname}/_matrix/client/r0/profile/${e}`,{headers:{Authorization:`Bearer ${this.access_token}`}});if(!n.ok){if(n.status===404||n.status===403)return{};throw console.error(n),Error("Error fetching profile info. See console for error.")}const s=await n.json();s.avatar_url=s.avatar_url?.replace("mxc://",`${this.hostname}/_matrix/media/r0/download/`),this.profileInfo=s;const a=this.database?.transaction("loginInfo","readwrite");return await a?.store.put({userId:this.mxid,device_id:this.device_id,hostname:this.hostname,slidingSyncHostname:this.slidingSyncHostname,access_token:this.access_token,displayName:s.displayname,avatarUrl:s.avatar_url}),await a?.done,s}}function Ks(o){return o.retry_after_ms!==void 0}function Xs(o){return o.access_token!==void 0}function Js(o){return o.errcode!==void 0}const Gs=await Ws.Instance(),T=c.createContext(Gs);function Zs(){const o=c.useContext(T),[e,n]=c.useState(o.getRooms());return c.useEffect(()=>{const s=a=>{n(a)};return o.on("rooms",s),o.startSync(),()=>{o.removeListener("rooms",s)}},[]),e}function Ce(o){return[...c.useContext(T).getRooms()].find(n=>n.roomID===o)}function Qs(){const o=c.useContext(T),[e,n]=c.useState(o.getSpacesWithRooms());return c.useEffect(()=>{const s=a=>{n(o.getSpacesWithRooms())};return o.on("rooms",s),o.startSync(),()=>{o.removeListener("rooms",s)}},[]),e}function Ys(){const o=c.useContext(T),[e,n]=c.useState({displayname:o.mxid||"Unknown"});return c.useEffect(()=>{o.fetchProfileInfo(o.mxid).then(s=>{s.displayname||(s.displayname=o.mxid||"Unknown"),n(s)})},[]),e}const De=c.memo(({roomId:o,avatarUrl:e,displayname:n,dm:s=!1,online:a=!1,active:r=!1,onClick:i,hidden:d})=>{const x=c.useContext(T),{ref:p,inView:f}=$t({triggerOnce:!0,rootMargin:"200px 0px",skip:d,onChange(g){g?x.addInViewRoom(o):x.removeInViewRoom(o)}});return t.jsx("div",{ref:p,onClick:i,className:"w-full cursor-pointer",children:f&&(r?t.jsxs("div",{className:"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center",children:[t.jsx(A,{avatarUrl:e,displayname:n,dm:s,online:a}),t.jsx("span",{title:n,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:n})]}):t.jsxs("div",{className:"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center",children:[t.jsx(A,{avatarUrl:e,displayname:n,dm:s,online:a}),t.jsx("span",{title:n,className:"text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:n})]}))})});De.__docgenInfo={description:"",methods:[],displayName:"RoomListItem",props:{dm:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether it is a DM or not"},online:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the user is online. Only used if dm is true."},active:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:"Wether the current room is selected"},roomId:{required:!0,tsType:{name:"string"},description:"Room id"},avatarUrl:{required:!1,tsType:{name:"string"},description:"The URL of the Avatar image"},displayname:{required:!0,tsType:{name:"string"},description:"The displayname of the room list item"},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"The onClick handler"},hidden:{required:!0,tsType:{name:"boolean"},description:"If room is hidden"}}};const en=c.memo(({sectionID:o,rooms:e,onClick:n,activeRoom:s,hidden:a})=>{const r=e.map(i=>t.jsx(De,{roomId:i.roomID,hidden:a,avatarUrl:i.avatarUrl,displayname:i.displayname,dm:i.dm,online:i.online,active:i.roomID===s,onClick:()=>{n(i.roomID)}},`${i.roomID}+${o}`));return t.jsx(t.Fragment,{children:r})}),je=c.memo(({section:o,onRoomClick:e,activeRoom:n})=>{const[s,a]=c.useState(!0),r=c.useContext(T);return s?r.removeSpaceOpen(o.roomID):r.addSpaceOpen(o.roomID),t.jsxs("div",{className:"flex flex-col gap-1 pl-4 select-none",children:[t.jsxs("div",{className:"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600",onClick:()=>a(i=>!i),children:[s?t.jsx(qt,{size:14}):t.jsx(Ke,{size:14}),t.jsx("span",{className:"font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap",children:o.sectionName})]}),!s&&t.jsx(en,{hidden:s,sectionID:o.roomID,rooms:o.rooms,onClick:e,activeRoom:n}),!s&&o.subsections.map(i=>t.jsx(je,{section:i,onRoomClick:e,activeRoom:n},i.roomID))]},o.roomID)}),Re=c.memo(({sections:o,rooms:e})=>{const[n,s]=c.useState(void 0),a=Ht();return t.jsxs("div",{className:"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]",children:[o.map(r=>t.jsx(je,{section:r,onRoomClick:i=>{s(i),a(`/${encodeURIComponent(i)}`)},activeRoom:n},r.roomID)),t.jsx(je,{section:{sectionName:"Others",roomID:"other",subsections:[],rooms:e},onRoomClick:r=>{s(r),a(`/${encodeURIComponent(r)}`)},activeRoom:n})]})});Re.__docgenInfo={description:"",methods:[],displayName:"RoomList",props:{sections:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * Section Name. Can be a Space or a Tag
     */
    sectionName: string
    /**
     * The Rooms within the Section
     */
    rooms: Room[]
    /**
     * The Subsections of the Section
     */
    subsections: Section[]
    /**
     * The roomid of the Space
     */
    roomID: string
}`,signature:{properties:[{key:"sectionName",value:{name:"string",required:!0}},{key:"rooms",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]",required:!0}},{key:"subsections",value:{name:"Array",elements:[{name:"Section"}],raw:"Section[]",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Section[]"},description:"The Sections available"},rooms:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    /**
     * The URL of the Avatar image
     */
    avatarUrl?: string
    /**
     * The displayname of the room list item
     */
    displayname: string
    /**
     * Wether it is a DM or not
     */
    dm: boolean
    /**
     * Wether the user is online. Only used if dm is true.
     */
    online: boolean
    /**
     * The roomid of the Room
     */
    roomID: string
}`,signature:{properties:[{key:"avatarUrl",value:{name:"string",required:!1}},{key:"displayname",value:{name:"string",required:!0}},{key:"dm",value:{name:"boolean",required:!0}},{key:"online",value:{name:"boolean",required:!0}},{key:"roomID",value:{name:"string",required:!0}}]}}],raw:"Room[]"},description:"Rooms outside of any Sections"}}};const tn={title:"Chat/RoomList",tags:["autodocs"],component:Re,decorators:[Je],parameters:{badges:[z.EXPERIMENTAL]},argTypes:{sections:{required:!0,defaultValue:[],name:"Sections",description:"The Sections available"},rooms:{required:!0,defaultValue:[],name:"Rooms",description:"Rooms outside of any Sections"}}},ne={args:{rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0},{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],sections:[{sectionName:"Test Section",rooms:[{roomID:"2",displayname:"test1",dm:!1,online:!1},{roomID:"3",displayname:"test2",dm:!1,online:!1}],roomID:"12",subsections:[{sectionName:"Test Subsection",rooms:[{roomID:"1",displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0}],roomID:"14",subsections:[]}]}]}};ne.parameters={...ne.parameters,docs:{...ne.parameters?.docs,source:{originalSource:`{
  args: {
    rooms: [{
      roomID: "1",
      displayname: "test",
      avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
      dm: true,
      online: true
    }, {
      roomID: "2",
      displayname: "test1",
      dm: false,
      online: false
    }, {
      roomID: "3",
      displayname: "test2",
      dm: false,
      online: false
    }],
    sections: [{
      sectionName: "Test Section",
      rooms: [{
        roomID: "2",
        displayname: "test1",
        dm: false,
        online: false
      }, {
        roomID: "3",
        displayname: "test2",
        dm: false,
        online: false
      }],
      roomID: "12",
      subsections: [{
        sectionName: "Test Subsection",
        rooms: [{
          roomID: "1",
          displayname: "test",
          avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
          dm: true,
          online: true
        }],
        roomID: "14",
        subsections: []
      }]
    }]
  }
}`,...ne.parameters?.docs?.source}}};const sn=["RootList"],nn=Object.freeze(Object.defineProperty({__proto__:null,RootList:ne,__namedExportsOrder:sn,default:tn},Symbol.toStringTag,{value:"Module"})),on={title:"Chat/RoomList/Item",tags:["autodocs"],component:De,parameters:{badges:[z.EXPERIMENTAL]},argTypes:{avatarUrl:{required:!1,name:"Avatar URL",description:"The URL of the avatar image"},displayname:{required:!0,name:"Displayname",description:"The displayname of the Room"},dm:{required:!1,defaultValue:!1,control:"boolean",name:"DM",description:"Wether the room is a DM"},online:{required:!1,defaultValue:!1,control:"boolean",name:"Online",description:"Wether the user is online. Only used if dm is true"},active:{required:!1,defaultValue:!1,control:"boolean",name:"Active",description:"Wether the room is currently selected"}}},oe={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!1}},ae={args:{displayname:"test",dm:!1,online:!1,avatarUrl:"",active:!0}},re={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!1}},ie={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!1,online:!1,active:!0}},ce={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!1}},le={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!1,active:!0}},de={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!1}},me={args:{displayname:"test",avatarUrl:"https://randomuser.me/api/portraits/men/62.jpg",dm:!0,online:!0,active:!0}},ue={args:{displayname:"test",avatarUrl:"",dm:!0,online:!1,active:!1}},pe={args:{displayname:"test",avatarUrl:"",dm:!0,online:!0,active:!1}};oe.parameters={...oe.parameters,docs:{...oe.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: false
  }
}`,...oe.parameters?.docs?.source}}};ae.parameters={...ae.parameters,docs:{...ae.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    dm: false,
    online: false,
    avatarUrl: "",
    active: true
  }
}`,...ae.parameters?.docs?.source}}};re.parameters={...re.parameters,docs:{...re.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: false
  }
}`,...re.parameters?.docs?.source}}};ie.parameters={...ie.parameters,docs:{...ie.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: false,
    online: false,
    active: true
  }
}`,...ie.parameters?.docs?.source}}};ce.parameters={...ce.parameters,docs:{...ce.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: false
  }
}`,...ce.parameters?.docs?.source}}};le.parameters={...le.parameters,docs:{...le.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: false,
    active: true
  }
}`,...le.parameters?.docs?.source}}};de.parameters={...de.parameters,docs:{...de.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: false
  }
}`,...de.parameters?.docs?.source}}};me.parameters={...me.parameters,docs:{...me.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "https://randomuser.me/api/portraits/men/62.jpg",
    dm: true,
    online: true,
    active: true
  }
}`,...me.parameters?.docs?.source}}};ue.parameters={...ue.parameters,docs:{...ue.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: false,
    active: false
  }
}`,...ue.parameters?.docs?.source}}};pe.parameters={...pe.parameters,docs:{...pe.parameters?.docs,source:{originalSource:`{
  args: {
    displayname: "test",
    avatarUrl: "",
    dm: true,
    online: true,
    active: false
  }
}`,...pe.parameters?.docs?.source}}};const an=["Fallback","FallbackActive","Image","ImageActive","DMOffline","DMOfflineActive","DMOnline","DMOnlineActive","DMNoAvatarOffline","DMNoAvatarOnline"],rn=Object.freeze(Object.defineProperty({__proto__:null,DMNoAvatarOffline:ue,DMNoAvatarOnline:pe,DMOffline:ce,DMOfflineActive:le,DMOnline:de,DMOnlineActive:me,Fallback:oe,FallbackActive:ae,Image:re,ImageActive:ie,__namedExportsOrder:an,default:on},Symbol.toStringTag,{value:"Module"}));function cn(o={}){const{wrapper:e}=Object.assign({},Me(),o.components);return e?t.jsx(e,{...o,children:t.jsx(n,{})}):n();function n(){const s=Object.assign({h1:"h1",p:"p"},Me(),o.components);return t.jsxs(t.Fragment,{children:[t.jsx(Ft,{title:"Introduction/Welcome"}),`
`,t.jsx(s.h1,{id:"about-cetirizine",children:"About Cetirizine"}),`
`,t.jsx(s.p,{children:"Welcome to the Cetirizine Design System!"}),`
`,t.jsx(s.p,{children:`This storybook design system describes in depth the components used within the
Cetirizine Matrix Client.`}),`
`,t.jsx(s.p,{children:`The Design heavily leans on the Tailwindcss Design System. However there are speciic
components for some things and Pages are also documented.`})]})}}const et=()=>{throw new Error("Docs-only story")};et.parameters={docsOnly:!0};const ye={title:"Introduction/Welcome",tags:["stories-mdx"],includeStories:["__page"]};ye.parameters=ye.parameters||{};ye.parameters.docs={...ye.parameters.docs||{},page:cn};const ln=["__page"],dn=Object.freeze(Object.defineProperty({__proto__:null,__namedExportsOrder:ln,__page:et,default:ye},Symbol.toStringTag,{value:"Module"}));const tt=c.memo(()=>{const o=c.useContext(T),[e,n]=c.useState(!1),[s,a]=c.useState(""),[r,i]=c.useState(""),[d,x]=c.useState("");if(o.isLoggedIn)return t.jsx(Vt,{to:"/"});const p=async()=>{try{n(!0),await o.passwordLogin(r,d)}catch(f){a(f.toString())}n(!1)};return t.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:f=>{f.preventDefault(),p()},children:[t.jsx(Ee,{children:"Login"}),s?t.jsx("h2",{className:"text-red-500 font-normal text-sm",children:s}):t.jsx("div",{className:"min-h-[1.25rem]"}),t.jsx(be,{readonly:e,value:r,placeholder:"Username",onChange:f=>i(f.target.value)}),t.jsx(be,{readonly:e,value:d,password:!0,placeholder:"Password",onChange:f=>x(f.target.value)}),t.jsx(Ie,{readonly:e,style:"primary",type:"submit",children:"Login"})]})});tt.__docgenInfo={description:"",methods:[],displayName:"Login"};const st=c.memo(()=>t.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:t.jsx(tt,{})}));st.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const mn={title:"Pages/LoginPage",tags:["autodocs"],component:st},he={};he.parameters={...he.parameters,docs:{...he.parameters?.docs,source:{originalSource:"{}",...he.parameters?.docs?.source}}};const un=["Default"],pn=Object.freeze(Object.defineProperty({__proto__:null,Default:he,__namedExportsOrder:un,default:mn},Symbol.toStringTag,{value:"Module"}));const hn={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"},nt=c.memo(({event:o,roomID:e,hasPreviousEvent:n})=>{const s=Ce(e);return(r=>{if($s(r))if(r.content.format==="org.matrix.custom.html"){const i=Bt.sanitize(r.content.formatted_body,{ADD_TAGS:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","caption","pre","span","img","details","summary"]});return t.jsxs("div",{className:n?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!n&&t.jsx(A,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),t.jsxs("div",{className:n?"ml-[3.7rem]":"flex flex-col gap-1",children:[!n&&t.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),t.jsx("p",{className:"whitespace-normal text-black text-base font-normal",dangerouslySetInnerHTML:{__html:i}})]})]})}else return t.jsxs("div",{className:n?"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out":"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start",children:[!n&&t.jsx(A,{displayname:s?.getMemberName(r.sender)||"",avatarUrl:s?.getMemberAvatar(r.sender),online:s?.isOnline()||!1,dm:s?.isDM()||!1}),t.jsxs("div",{className:n?"ml-[3.7rem]":"flex flex-col gap-1",children:[!n&&t.jsx("h2",{className:"text-sm font-medium text-red-500 whitespace-normal",children:s?.getMemberName(r.sender)}),t.jsx(Ge,{options:hn,as:"p",className:"whitespace-normal text-black text-base font-normal",children:r.content.body})]})]});else return t.jsx("p",{className:"ml-[4.3rem] whitespace-normal text-black text-base font-normal",children:r.content.body})})(o)});nt.__docgenInfo={description:"",methods:[],displayName:"MessageEvent"};const ot=c.memo(({event:o})=>t.jsx("p",{className:"whitespace-break-spaces",children:JSON.stringify(o,null,4)}));ot.__docgenInfo={description:"",methods:[],displayName:"UnknownEvent"};const at=c.memo(({event:o})=>(n=>t.jsxs("p",{className:"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out",children:[n.content.displayname?n.content.displayname:n.state_key," ",n.content.membership==="join"?"joined the room":n.content.membership==="leave"?"left the room":n.content.membership==="ban"?"was banned from the room by "+n.sender:n.content.membership==="invite"?"was invited to the room by "+n.sender:n.content.membership==="knock"?"knocked on the room":"changed their membership status to "+n.content.membership]}))(o));at.__docgenInfo={description:"",methods:[],displayName:"MemberEvent"};const fn=c.memo(({roomID:o,scrollRef:e})=>{const n=Ce(decodeURIComponent(o||"")),s=c.useContext(T),a=n?.getEvents(),{pathname:r}=Wt(),[i,d]=c.useState([]),x=f=>{const g=f?.filter((m,_,u)=>u.findIndex(b=>b.event_id===m.event_id)===_);Promise.all(g?.filter(m=>m.type!=="m.reaction").map(async(m,_)=>{const u=g?.filter(l=>l.type!=="m.reaction")[_-1],b=u?.sender===m.sender;let y=u?.type;const v=g?.filter(l=>l.type==="m.reaction"&&l.content["m.relates_to"].event_id===m.event_id);if(m.type==="m.room.encrypted")try{const l=await s.olmMachine?.decryptRoomEvent(JSON.stringify(m),new I.RoomId(o||""));if(l)m=JSON.parse(l.event),y=m.type;else return t.jsx("p",{children:"Unable to decrypt event"})}catch(l){console.error(l)}return p(m,b,y,v)})).then(m=>{d(m)})};c.useEffect(()=>{a&&x(a)},[a]),c.useEffect(()=>{e.current?.scrollTo(0,e.current?.scrollHeight)},[r]);const p=(f,g,m,_)=>{switch(f.type){case"m.room.message":return t.jsx(nt,{reactions:_,event:f,roomID:o,hasPreviousEvent:g&&m==="m.room.message"},f.event_id);case"m.room.member":return t.jsx(at,{event:f},f.event_id);case"m.room.redaction":return t.jsx(t.Fragment,{});default:return t.jsx(ot,{event:f},f.event_id)}};return t.jsx("div",{className:"max-w-[130ch] flex flex-col",children:i})}),rt=c.memo(()=>{const o=Ys(),e=Qs(),n=Zs(),s=c.useContext(T);let a=Kt();const r=Ce(decodeURIComponent(a.roomIdOrAlias||"")),[i,d]=c.useState(""),[x,p]=c.useState(""),f=c.useRef(null),g=[...e].filter(({spaceRoom:l})=>{const S=![...e].some(({children:h})=>[...h].some(w=>w.roomID===l.roomID)),k=l.getSpaceParentIDs().length===0;return S&&k}),m=[...n].filter(l=>{const S=![...e].some(({children:w})=>[...w].some(D=>D.roomID===l.roomID)),k=l.getSpaceParentIDs().length===0,h=!l.isSpace();return S&&k&&h}),_=g.map(l=>{const S=[...l.children].filter(h=>!h.isSpace()).map(h=>({roomID:h.roomID,displayname:h.getName(),avatarUrl:h.getAvatarURL(),dm:h.isDM(),online:h.isOnline()})),k=h=>{const w=[...e].find(D=>D.spaceRoom.roomID===h.roomID);if(w){const D=[...w?.children].map(E=>({roomID:E.roomID,displayname:E.getName(),avatarUrl:E.getAvatarURL(),dm:E.isDM(),online:E.isOnline()}));return{sectionName:h.getName(),rooms:D,roomID:h.roomID,subsections:[...w?.children].filter(E=>E.isSpace()).map(k).filter(E=>E!==void 0)}}};return{sectionName:l.spaceRoom.getName(),rooms:S,roomID:l.spaceRoom.roomID,subsections:[...l.children].filter(h=>h.isSpace()).map(k)}}),u=m.filter(l=>!l.isSpace()).map(l=>({roomID:l.roomID,displayname:l.getName(),avatarUrl:l.getAvatarURL(),dm:l.isDM(),online:l.isOnline()})),b=u.map(l=>l.roomID),y=b.filter((l,S)=>b.indexOf(l)!==S);y.length>0&&console.error("otherRooms has duplicates",y);const v={defaultProtocol:"https",rel:"noopener",target:"_blank",className:"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500"};return t.jsxs("div",{className:"flex flex-row gap-2 min-h-screen h-screen",children:[t.jsxs("div",{className:"flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300",children:[t.jsxs("div",{className:"flex flex-row gap-2 m-2 p-1 items-center border-b-2",children:[t.jsx(A,{displayname:o.displayname||s.mxid,avatarUrl:o?.avatar_url,dm:!1,online:!1}),t.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[t.jsx("span",{className:"text-base font-semibold",children:o?.displayname}),t.jsx(Xt,{size:28,stroke:"unset",className:"stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer"})]})]}),t.jsx(Re,{sections:_,rooms:u})]}),r&&t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsxs("div",{className:"pb-2 flex flex-row items-center border-b-2 mt-4 ml-2",children:[t.jsx(A,{displayname:r.getName(),avatarUrl:r.getAvatarURL(),dm:r.isDM(),online:r.isOnline()}),t.jsxs("div",{className:"flex flex-row items-center",children:[t.jsx("h1",{className:"text-black font-semibold text-lg flex-shrink-0",children:r.getName()}),t.jsx(Ge,{options:v,as:"p",className:"ml-4 text-slate-700 font-normal text-base",children:r.getTopic()})]})]}),t.jsx("div",{ref:f,className:"overflow-y-auto overflow-x-hidden scrollbarSmall mr-2 my-1 flex-1 w-full flex flex-col-reverse",children:t.jsx(fn,{roomID:a.roomIdOrAlias,scrollRef:f})}),t.jsxs("div",{className:"flex flex-row items-end",children:[t.jsx(ke,{namespace:"Editor",onChange:(l,S)=>{l.read(()=>{const k=Xe.$generateHtmlFromNodes(S);d(k),console.log(k);const h=ge.$convertToMarkdownString(ge.TRANSFORMERS);p(h),console.log(h)})},onError:l=>console.error(l)}),t.jsx(Jt,{size:45,stroke:"unset",className:"stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer",onClick:()=>{}})]})]})]})});rt.__docgenInfo={description:"",methods:[],displayName:"MainPage"};const gn={title:"Pages/MainPage",tags:["autodocs"],component:rt,decorators:[Je]},fe={};fe.parameters={...fe.parameters,docs:{...fe.parameters?.docs,source:{originalSource:"{}",...fe.parameters?.docs?.source}}};const yn=["Default"],xn=Object.freeze(Object.defineProperty({__proto__:null,Default:fe,__namedExportsOrder:yn,default:gn},Symbol.toStringTag,{value:"Module"}));function it(o){return{"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":us,"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":fs,"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":xs,"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":_s,"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":Ms,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":nn,"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":rn,"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":dn,"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":pn,"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":xn}[o]}Object.assign(it,{keys:()=>["/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx"],resolve:o=>({"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx":"./src/components/avatar/avatar.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx":"./src/components/button/button.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx":"./src/components/header/header.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx":"./src/components/input/basic/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx":"./src/components/input/chat/input.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx":"./src/components/roomList/roomList.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx":"./src/components/roomList/roomListItem/roomListItem.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx":"./src/documentation/Welcome.stories.mdx","/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx":"./src/pages/LoginPage.stories.tsx","/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx":"./src/pages/MainPage.stories.tsx"})[o]});function vn(o){o(it,{hot:void 0},!1)}__STORYBOOK_MODULE_CLIENT_LOGGER__;const bn=__STORYBOOK_MODULE_PREVIEW_API__,{addDecorator:_n,addParameters:Ue,addLoader:wn,addArgs:Nn,addArgTypes:Sn,addStepRunner:jn,addArgTypesEnhancer:In,addArgsEnhancer:En,setGlobalRender:kn}=bn,Cn=[Gt,Zt,Qt,Yt,es,ts,ss,ns,os,as,rs,ls].filter(Boolean);Cn.map(o=>o.default?o.default:o).forEach(o=>{Object.keys(o).forEach(e=>{const n=o[e];switch(e){case"args":return Nn(n);case"argTypes":return Sn(n);case"decorators":return n.forEach(s=>_n(s,!1));case"loaders":return n.forEach(s=>wn(s,!1));case"parameters":return Ue({...n},!1);case"argTypesEnhancers":return n.forEach(s=>In(s));case"argsEnhancers":return n.forEach(s=>En(s));case"render":return kn(n);case"globals":case"globalTypes":{const s={};return s[e]=n,Ue(s,!1)}case"decorateStory":case"applyDecorators":case"renderToDOM":case"renderToCanvas":return null;case"runStep":return jn(n);default:return console.log(e+" was not supported :( !")}})});vn(is);
//# sourceMappingURL=iframe-2ee7b9b2.js.map
