{"version":3,"file":"iframe-b88c21e9.js","sources":["../../../.storybook/withTailwindTheme.decorator.tsx","../../../.storybook/preview.tsx","../../../src/app/sdk/api/otherEnums.ts","../../../src/components/avatar/avatar.tsx","../../../src/components/button/button.tsx","../../../src/components/events/memberEvent.tsx","../../../src/app/sdk/api/events.ts","../../../src/app/sdk/e2ee.ts","../../../src/app/sdk/ownUser.ts","../../../src/app/sdk/room.ts","../../../src/app/sdk/api/slidingSync.ts","../../../src/app/sdk/slidingSync.ts","../../../src/app/sdk/client.ts","../../../src/components/events/unknownEvent.tsx","../../../src/components/events/helpers/Waveform.tsx","../../../src/components/events/messageEvent.tsx","../../../src/components/header/header.tsx","../../../src/components/input/basic/input.tsx","../../../src/components/input/chat/plugins/AutoLinkPlugin.tsx","../../../src/components/input/chat/customNodes/CustomParagraphNode.ts","../../../src/components/input/chat/plugins/ToolbarPlugin.tsx","../../../src/components/input/chat/plugins/CodeHighlightPlugin.ts","../../../src/components/input/chat/theme.ts","../../../src/components/input/chat/input.tsx","../../../src/components/roomList/roomListItem/roomListItem.tsx","../../../src/components/roomList/roomList.tsx","../../../src/documentation/Welcome.stories.mdx","../../../src/components/login/login.tsx","../../../src/pages/LoginPage.tsx","../../../src/pages/MainPage.tsx","../../../../../../../../virtual:/@storybook/builder-vite/storybook-stories.js","../../../../../../../../virtual:/@storybook/builder-vite/vite-app.js"],"sourcesContent":["\nimport { useEffect } from \"react\";\n\nexport const DEFAULT_THEME = \"light\";\n\nexport const withTailwindTheme = (Story: any, context) => {\n    const { theme } = context.globals;\n\n    useEffect(() => {\n        const htmlTag = document.documentElement;\n\n        // Set the \"data-mode\" attribute on the iFrame html tag\n        htmlTag.setAttribute(\"data-mode\", theme || DEFAULT_THEME);\n    }, [theme]);\n\n    // @ts-ignore\n    return <Story />;\n};","import type { Preview } from \"@storybook/react\";\nimport \"../src/index.scss\";\nimport \"./tailwindcss.scss\";\nimport { DEFAULT_THEME, withTailwindTheme } from \"./withTailwindTheme.decorator\";\n\nconst preview: Preview = {\n  parameters: {\n    actions: { argTypesRegex: \"^on[A-Z].*\" },\n    controls: {\n      matchers: {\n        color: /(background|color)$/i,\n        date: /Date$/,\n      },\n    },\n    options: {\n      storySort: {\n        order: ['Introduction', 'Fundamentals', '*'],\n      },\n    },\n  },\n  globalTypes: {\n    theme: {\n      name: \"Theme\",\n      description: \"Global theme for components\",\n      defaultValue: DEFAULT_THEME,\n      toolbar: {\n        icon: \"paintbrush\",\n        // Array of plain string values or MenuItem shape (see below)\n        items: [\n          { value: \"light\", title: \"Light\", left: \"ðŸŒž\" },\n          { value: \"dark\", title: \"Dark\", left: \"ðŸŒ›\" },\n        ],\n        // Change title based on selected value\n        dynamicTitle: true,\n      },\n    },\n  },\n  decorators: [\n    withTailwindTheme\n  ]\n};\n\nexport default preview;\n","export enum OnlineState {\n    Online,\n    Offline,\n    Unknown\n}\n","import { FC, memo, useState } from \"react\";\nimport { OnlineState } from \"../../app/sdk/api/otherEnums\";\n\ntype AvatarProps = {\n    /**\n     * The URL of the Avatar image\n     */\n    avatarUrl?: string\n    /**\n     * The displayname of the avatar user\n     */\n    displayname: string\n    /**\n     * Wether it is a DM or not\n     */\n    dm: boolean\n    /**\n     * Wether the user is online. Only used if dm is true.\n     */\n    online: OnlineState\n};\n\nconst Avatar: FC<AvatarProps> = memo(({ avatarUrl, displayname, dm = false, online = OnlineState.Unknown }: AvatarProps) => {\n    const [error, setError] = useState(false);\n\n    if (avatarUrl && !error) {\n        return (\n            <div className=\"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] justify-center items-center m-0 mr-3 text-xl rounded-full text-white\">\n                <img className=\"rounded-full w-8 h-8 object-cover\" alt={displayname} src={avatarUrl} onError={() => { setError(true) }} />\n                {\n                    dm ?\n                        (\n                            online === OnlineState.Online ?\n                                <div className=\"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div> :\n                                (online === OnlineState.Offline ? <div className=\"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div> :\n                                    <div className=\"bg-gray-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div>)\n                        ) :\n                        <></>\n                }\n            </div>\n        );\n    }\n    return (\n        <div className=\"flex relative min-w-[2rem] min-h-[2rem] w-[2rem] h-[2rem] bg-orange-500 justify-center items-center m-0 mr-3 text-xl rounded-full text-white\">\n            {displayname.replace('@', '').replace('!', '').replace('#', '')[0].toUpperCase()}\n            {\n                dm ?\n                    (\n                        online === OnlineState.Online ?\n                            <div className=\"bg-green-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div> :\n                            (online === OnlineState.Offline ? <div className=\"bg-red-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div> :\n                                <div className=\"bg-gray-500 rounded-full w-3 h-3 absolute right-0 bottom-0\"></div>)\n                    ) :\n                    <></>\n            }\n        </div>\n    );\n})\n\nexport default Avatar;","import { FC, memo } from \"react\";\nimport \"./button.scss\";\n\ntype ButtonProps = {\n    /**\n     * The button type\n     */\n    type?: \"button\" | \"submit\" | \"reset\";\n    /**\n     * The button style\n     */\n    style?: \"primary\" | \"secondary\" | \"abort\";\n    /**\n     * The button onClick handler\n     */\n    onClick?: () => void;\n    /**\n     * The button Label\n     */\n    children: string\n\n    /**\n     * If the button is readonly\n     */\n    readonly: boolean\n};\n\nconst Button: FC<ButtonProps> = memo(({ type = \"button\", style = \"primary\", onClick, children, readonly }: ButtonProps) => {\n    if (style === \"secondary\") {\n        return <button disabled={readonly} onClick={onClick} className=\"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed\" type={type}>{children}</button>;\n    } else if (style === \"abort\") {\n        return <button disabled={readonly} onClick={onClick} className=\"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed\" type={type}>{children}</button>;\n    } else {\n        return <button disabled={readonly} onClick={onClick} className=\"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed\" type={type}>{children}</button>;\n    }\n})\nexport default Button;","import { memo } from \"react\";\nimport { IRoomMemberEvent } from \"../../app/sdk/api/events\";\nimport { FC } from \"react\";\n\ntype MemberEventProps = {\n    /**\n     * The event to render\n     */\n    event: IRoomMemberEvent;\n};\n\nconst MemberEvent: FC<MemberEventProps> = memo(({ event }) => {\n    const renderCorrectMessage = (event: IRoomMemberEvent) => {\n        // TODO: Make sure we render avatar and name changes correctly\n\n        return <p className=\"p-2 hover:bg-gray-200 rounded-md duration-200 ease-in-out\">\n            {\n                event.content.displayname ?\n                    event.content.displayname :\n                    event.state_key\n            } {\n                event.content.membership === \"join\" ?\n                    \"joined the room\" :\n                    (\n                        event.content.membership === \"leave\" ?\n                            // TODO: Handle kick\n                            \"left the room\" :\n                            (\n                                event.content.membership === \"ban\" ?\n                                    \"was banned from the room by \" + event.sender :\n                                    (\n                                        event.content.membership === \"invite\" ?\n                                            \"was invited to the room by \" + event.sender :\n                                            (\n                                                event.content.membership === \"knock\" ?\n                                                    \"knocked on the room\" :\n                                                    \"changed their membership status to \" + event.content.membership\n                                            )\n                                    )\n                            )\n                    )\n            }\n        </p>\n    }\n\n    return renderCorrectMessage(event);\n});\n\nexport default MemberEvent;","\nexport interface IRoomEvent<Content = any> {\n    content: Content;\n    event_id: string;\n    origin_server_ts: number;\n    sender: string;\n    type: string;\n    unsigned?: {\n        transaction_id?: string;\n        age?: number;\n    };\n    \"m.relates.to\"?: any;\n    [key: string]: any;\n}\n\nexport interface IRoomMessageContent<MsgType = any> {\n    body: string;\n    msgtype: MsgType;\n}\n\nexport interface IRoomMessageTextContent extends IRoomMessageContent<\"m.text\"> {\n    format?: string;\n    formatted_body?: string;\n}\n\nexport interface IRoomMessageImageContent extends IRoomMessageContent<\"m.image\"> {\n    info?: IImageInfo;\n    url?: string;\n    file?: IEncryptedFile;\n}\n\nexport interface IRoomMessageAudioContent extends IRoomMessageContent<\"m.audio\"> {\n    info?: IAudioInfo;\n    url?: string;\n    file?: IEncryptedFile;\n}\n\nexport interface IRoomMessageEvent<Content = any> extends IRoomEvent<Content> { }\n\nexport interface IRoomMessageTextEvent extends IRoomMessageEvent<IRoomMessageTextContent> { }\n\nexport function isRoomMessageTextEvent(event: IRoomEvent): event is IRoomMessageTextEvent {\n    return event.type === \"m.room.message\" && event.content.msgtype === \"m.text\";\n}\n\nexport interface IRoomMessageNoticeEvent extends IRoomMessageEvent<IRoomMessageTextContent> { }\n\nexport function isRoomMessageNoticeEvent(event: IRoomEvent): event is IRoomMessageNoticeEvent {\n    return event.type === \"m.room.message\" && event.content.msgtype === \"m.notice\";\n}\n\nexport function isRoomMessageImageEvent(event: IRoomEvent): event is IRoomMessageEvent<IRoomMessageImageContent> {\n    return event.type === \"m.room.message\" && event.content.msgtype === \"m.image\";\n}\n\nexport function isRoomMessageAudioEvent(event: IRoomEvent): event is IRoomMessageEvent<IRoomMessageAudioContent> {\n    return event.type === \"m.room.message\" && event.content.msgtype === \"m.audio\";\n}\n\nexport function isRoomMessageEvent(event: IRoomEvent): event is IRoomMessageEvent {\n    return event.type === \"m.room.message\";\n}\n\nexport interface IRoomStateEvent<Content = any> extends IRoomEvent<Content> {\n    state_key: string;\n}\n\nexport function isRoomStateEvent(event: IRoomEvent): event is IRoomStateEvent {\n    return event.state_key !== undefined;\n}\n\nexport interface IRoomMemberContent {\n    avatar_url?: string;\n    displayname?: string;\n    membership: \"invite\" | \"join\" | \"knock\" | \"leave\" | \"ban\";\n    is_direct?: boolean;\n    reason?: string;\n}\n\nexport interface IRoomMemberEvent extends IRoomStateEvent<IRoomMemberContent> { }\n\nexport function isRoomMemberEvent(event: IRoomEvent): event is IRoomMemberEvent {\n    return event.type === \"m.room.member\";\n}\n\nexport interface IRoomCreateContent {\n    creator: string;\n    \"m.federate\"?: boolean;\n    predecessor?: {\n        room_id: string;\n        event_id: string;\n    };\n    room_version?: string;\n    type?: string;\n}\n\nexport interface IRoomCreateEvent extends IRoomStateEvent<IRoomCreateContent> { }\n\nexport function isRoomCreateEvent(event: IRoomEvent): event is IRoomCreateEvent {\n    return event.type === \"m.room.create\";\n}\n\nexport interface IThumbnailInfo {\n    h: number;\n    mimetype: string;\n    size: number;\n    w: number;\n}\n\nexport interface IEncryptedFile {\n    v: string;\n    key: {\n        alg: string;\n        ext: boolean;\n        k: string;\n        key_ops: string[];\n        kty: string;\n    };\n    iv: string;\n    hashes: {\n        [key: string]: string;\n    };\n    url: string;\n}\n\nexport interface IImageInfo {\n    h: number;\n    mimetype: string;\n    size: number;\n    thumbnail_info?: IThumbnailInfo;\n    thumbnail_url?: string;\n    thumbnail_file?: IEncryptedFile;\n    w: number;\n}\n\nexport interface IAudioInfo {\n    duration?: number;\n    mimetype?: string;\n    size?: number;\n}\n\nexport interface IRoomAvatarContent {\n    info: IImageInfo;\n    url?: string;\n}\n\nexport interface IRoomAvatarEvent extends IRoomStateEvent<IRoomAvatarContent> { }\n\nexport function isRoomAvatarEvent(event: IRoomEvent): event is IRoomAvatarEvent {\n    return event.type === \"m.room.avatar\";\n}\n\nexport interface ISpaceChildContent {\n    via: string[];\n    order?: string;\n    suggested?: boolean;\n}\n\nexport interface ISpaceChildEvent extends IRoomStateEvent<ISpaceChildContent> { }\n\nexport function isSpaceChildEvent(event: IRoomEvent): event is ISpaceChildEvent {\n    return event.type === \"m.space.child\";\n}\n\nexport interface ISpaceParentContent {\n    via: string[];\n    canonical?: boolean;\n}\n\nexport interface ISpaceParentEvent extends IRoomStateEvent<ISpaceParentContent> { }\n\nexport function isSpaceParentEvent(event: IRoomEvent): event is ISpaceParentEvent {\n    return event.type === \"m.space.parent\";\n}\n\nexport interface IRoomTopicContent {\n    topic: string;\n}\n\nexport interface IRoomTopicEvent extends IRoomStateEvent<IRoomTopicContent> { }\n\nexport function isRoomTopicEvent(event: IRoomEvent): event is IRoomTopicEvent {\n    return event.type === \"m.room.topic\";\n}","import {\n    DeviceId,\n    DeviceLists,\n    KeysBackupRequest,\n    KeysClaimRequest,\n    KeysQueryRequest,\n    KeysUploadRequest,\n    OlmMachine,\n    RequestType,\n    RoomId,\n    RoomMessageRequest,\n    SignatureUploadRequest,\n    ToDeviceRequest,\n    UserId\n} from \"@mtrnord/matrix-sdk-crypto-js\";\nimport { MatrixClient } from \"./client\";\nimport { OwnUser } from \"./ownUser\";\nimport { Room } from \"./room\";\nimport { IRoomEvent } from \"./api/events\";\n\nexport class MatrixE2EE {\n    private olmMachine?: OlmMachine;\n    private outgoingRequestsBeingProcessed = false;\n    private missingSessionsBeingRequested = false;\n\n    constructor(private client: MatrixClient, private user: OwnUser) { }\n\n    public async decryptRoomEvent(roomID: string, event: IRoomEvent<any>) {\n        return await this.olmMachine?.decryptRoomEvent(JSON.stringify(event), new RoomId(roomID));\n    }\n\n    public async receiveSyncData(\n        to_device_events: string,\n        changed_devices: DeviceLists,\n        one_time_key_counts: Map<any, any>,\n        unused_fallback_keys?: Set<any>\n    ) {\n        await this.olmMachine?.receiveSyncChanges(\n            to_device_events,\n            changed_devices,\n            one_time_key_counts,\n            unused_fallback_keys\n        );\n    }\n\n    public async encryptRoomEvent(roomID: RoomId, type: string, content: any): Promise<any> {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.hostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.olmMachine) {\n            throw Error(\"Olm machine must be set first\");\n        }\n        await this.olmMachine?.encryptRoomEvent(roomID, type, content);\n    }\n\n    public async initOlmMachine(userID: UserId, deviceID: DeviceId, storePassphrase?: string) {\n        this.olmMachine = await OlmMachine.initialize(userID, deviceID, \"cetirizine-crypto\", storePassphrase);\n    }\n\n    public async updateTrackedUsers(users: any[]) {\n        await this.olmMachine?.updateTrackedUsers(users);\n    }\n\n    public async sendIdentifyAndOneTimeKeys() {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.slidingSyncHostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.olmMachine) {\n            throw Error(\"Olm machine must be set first\");\n        }\n\n        if (this.outgoingRequestsBeingProcessed) {\n            return;\n        }\n        this.outgoingRequestsBeingProcessed = true;\n\n        const outgoing_requests = await this.olmMachine.outgoingRequests();\n\n        for (const request of outgoing_requests) {\n            await this.processRequest(request);\n        }\n\n        await this.getMissingSessions();\n        this.outgoingRequestsBeingProcessed = false;\n    }\n\n    public async shareKeysForRoom(room: Room) {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.slidingSyncHostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.olmMachine) {\n            throw Error(\"Olm machine must be set first\");\n        }\n        const encryptionSettings = room.getEncryptionSettings();\n        if (encryptionSettings) {\n            const requests = await this.olmMachine.shareRoomKey(new RoomId(room.roomID), room.getJoinedMemberIDs().map(id => new UserId(id)), encryptionSettings);\n            for (const request of requests) {\n                await this.processRequest(request);\n            }\n        }\n    }\n\n    public async getMissingSessions() {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.slidingSyncHostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.olmMachine) {\n            throw Error(\"Olm machine must be set first\");\n        }\n\n        if (this.missingSessionsBeingRequested) {\n            return;\n        }\n        this.missingSessionsBeingRequested = true;\n\n        const encryptedRooms = [...this.client.getRooms()].filter(room => room.isEncrypted());\n        const users = encryptedRooms.map(room => room.getJoinedMemberIDs().map(id => new UserId(id))).flat();\n        const request = await this.olmMachine?.getMissingSessions(users);\n        if (request) {\n            await this.processRequest(request);\n        }\n\n        this.missingSessionsBeingRequested = false;\n    }\n\n    private async processRequest(request: any) {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.slidingSyncHostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.olmMachine) {\n            throw Error(\"Olm machine must be set first\");\n        }\n        // Check which type the request is\n        if (request.type === RequestType.KeysUpload) {\n            // Send the key\n            const request_typed = request as KeysUploadRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/keys/upload`,\n                {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to upload keys\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        } else if (request.type === RequestType.KeysQuery) {\n            const request_typed = request as KeysQueryRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/keys/query`,\n                {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to query keys\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        } else if (request.type === RequestType.KeysClaim) {\n            const request_typed = request as KeysClaimRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/keys/claim`,\n                {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to claim keys\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        } else if (request.type === RequestType.ToDevice) {\n            const request_typed = request as ToDeviceRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/sendToDevice/${request_typed.event_type}/${request_typed.txn_id}`,\n                {\n                    method: \"PUT\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to send to device\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id ?? request_typed.txn_id, request_typed.type, await response.text());\n        } else if (request.type === RequestType.SignatureUpload) {\n            const request_typed = request as SignatureUploadRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/keys/signatures/upload`,\n                {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to upload signatures\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        } else if (request.type === RequestType.RoomMessage) {\n            const request_typed = request as RoomMessageRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/rooms/${request_typed.room_id}/send/${request_typed.event_type}/${request_typed.txn_id}`,\n                {\n                    method: \"PUT\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to send message\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        } else if (request.type === RequestType.KeysBackup) {\n            const request_typed = request as KeysBackupRequest;\n            const response = await fetch(\n                `${this.user.hostname}/_matrix/client/v3/room_keys/keys`,\n                {\n                    method: \"PUT\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.user.access_token}`\n                    },\n                    body: request_typed.body\n                }\n            )\n            if (!response.ok) {\n                if (response.status === 401) {\n                    await this.client.logout();\n                    console.error(response);\n                }\n                console.error(\"Failed to backup keys\", response);\n                return;\n            }\n            this.olmMachine.markRequestAsSent(request_typed.id!, request_typed.type, await response.text());\n        }\n    }\n\n    public logoutE2ee() {\n        this.missingSessionsBeingRequested = false;\n        this.outgoingRequestsBeingProcessed = false;\n    }\n}","import { DeviceId, UserId } from \"@mtrnord/matrix-sdk-crypto-js\";\nimport { IErrorResp, ILoginFlows, ILoginResponse, IWellKnown } from \"./api/apiTypes\";\nimport { MatrixClient, isRateLimitError } from \"./client\";\nimport { MatrixE2EE } from \"./e2ee\";\n\nexport class OwnUser {\n    public access_token?: string;\n    public device_id?: string;\n    public mxid?: string;\n    // Hostname including \"https://\"\n    public hostname?: string;\n    public slidingSyncHostname?: string;\n    public e2ee: MatrixE2EE;\n\n    constructor(private client: MatrixClient) {\n        this.e2ee = new MatrixE2EE(this.client, this);\n    }\n\n    // TODO: call logout endpoint on logout\n    public async logout() {\n        if (!this.mxid) {\n            console.log(\"Not logged in\");\n            return;\n        }\n        if (!this.access_token) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.hostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        const resp = await fetch(`${this.hostname}/_matrix/client/v3/logout`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${this.access_token}`\n            },\n        });\n        if (!resp.ok) {\n            console.error(resp);\n            throw Error(\"Error logging out. See console for error.\");\n        }\n\n        this.access_token = undefined;\n        this.device_id = undefined;\n        this.slidingSyncHostname = undefined;\n    }\n\n\n\n    public async setHostname(hostname: string) {\n        if (!hostname.startsWith(\"https://\")) {\n            throw Error(\"Hostname must start with 'https://'\");\n        }\n        if (!this.client.database) {\n            await this.client.createDatabase();\n        }\n\n        // Write to database\n        const tx = this.client.database?.transaction('loginInfo', 'readwrite');\n        await tx?.store.put({\n            userId: this.mxid!,\n            hostname: hostname,\n            slidingSyncHostname: this.slidingSyncHostname,\n            access_token: this.access_token,\n            device_id: this.device_id,\n        });\n        await tx?.done\n\n        // Set in memory\n        this.hostname = hostname;\n    }\n\n    private async getLoginFlows(): Promise<ILoginFlows> {\n        if (!this.hostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        const resp = await fetch(`${this.hostname}/_matrix/client/v3/login`);\n        if (!resp.ok) {\n            console.error(resp);\n            throw Error(\"Error requesting login flows. See console for error.\");\n        }\n        const json = await resp.json() as ILoginFlows;\n        return json;\n    }\n\n    private async getWellKnown(): Promise<IWellKnown> {\n        if (!this.hostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        const resp = await fetch(`${this.hostname}/.well-known/matrix/client`);\n        if (!resp.ok) {\n            console.error(resp);\n            throw Error(\"Error requesting login flows. See console for error.\");\n        }\n        const json = await resp.json() as IWellKnown;\n        return json;\n    }\n\n    public async passwordLogin(username: string, password: string, triesLeft = 5) {\n        if (!this.client.database) {\n            await this.client.createDatabase();\n        }\n        if (!username) {\n            throw Error(\"Username must be set\");\n        }\n        if (!password) {\n            throw Error(\"Password must be set\");\n        }\n        this.mxid = username;\n        await this.setHostname(`https://${username.split(':')[1]}`);\n\n        try {\n            const well_known = await this.getWellKnown();\n            if (well_known[\"m.homeserver\"]?.base_url) {\n                await this.setHostname(well_known[\"m.homeserver\"].base_url);\n            }\n            if (well_known[\"org.matrix.msc3575.proxy\"]?.url) {\n                // Write to database\n                const tx = this.client.database?.transaction('loginInfo', 'readwrite');\n                await tx?.store.put({\n                    userId: this.mxid!,\n                    hostname: this.hostname,\n                    slidingSyncHostname: well_known[\"org.matrix.msc3575.proxy\"].url,\n                    access_token: this.access_token,\n                    device_id: this.device_id,\n                });\n                await tx?.done\n\n                // Set the sliding sync proxy\n                this.slidingSyncHostname = well_known[\"org.matrix.msc3575.proxy\"].url;\n            } else {\n                throw Error(\"No sliding sync proxy found\");\n            }\n        } catch (e: any) {\n            console.warn(`No well-known found for ${this.hostname}:\\n${e}`);\n        }\n\n        const loginFlows = await this.getLoginFlows();\n        if ((loginFlows.flows.filter((flow) => flow.type === 'm.login.password')?.length || 0) == 0) {\n            throw Error(\"Password login is not supported by this homeserver\");\n        }\n\n        const resp = await fetch(`${this.hostname}/_matrix/client/r0/login`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                type: \"m.login.password\",\n                identifier: {\n                    type: 'm.id.user',\n                    user: username,\n                },\n                user: username,\n                password: password\n            })\n        });\n        if (!resp.ok) {\n            console.error(resp);\n            throw Error(\"Error logging in. See console for error.\");\n        }\n        const json = await resp.json();\n        if (isErrorResp(json)) {\n            throw Error(`Error logging in: ${json.errcode}: ${json.error}`);\n        }\n        if (isRateLimitError(json)) {\n            console.error(`Rate limited. Retrying in ${json.retry_after_ms}ms. ${triesLeft} tries left.`);\n            await this.passwordLogin(username, password, triesLeft - 1);\n        }\n        if (isLoginResponse(json)) {\n            // Write to database\n            const tx = this.client.database?.transaction('loginInfo', 'readwrite');\n            await tx?.store.put({\n                userId: json.user_id!,\n                hostname: this.hostname,\n                slidingSyncHostname: this.slidingSyncHostname,\n                access_token: json.access_token,\n                device_id: json.device_id,\n            });\n            await tx?.done\n            this.access_token = json.access_token;\n            this.device_id = json.device_id;\n            this.mxid = json.user_id;\n\n            await this.e2ee.initOlmMachine(new UserId(this.mxid), new DeviceId(this.device_id));\n        }\n    }\n}\n\nfunction isLoginResponse(arg: any): arg is ILoginResponse {\n    return arg.access_token !== undefined;\n}\n\nfunction isErrorResp(arg: any): arg is IErrorResp {\n    return arg.errcode !== undefined;\n}","import EventEmitter from \"events\";\nimport {\n    IRoomEvent,\n    IRoomStateEvent,\n    isRoomAvatarEvent,\n    isRoomCreateEvent,\n    isRoomTopicEvent,\n    isSpaceChildEvent,\n    isSpaceParentEvent\n} from \"./api/events\";\nimport { MatrixClient } from \"./client\";\nimport { useEffect, useState } from \"react\";\nimport { EncryptionAlgorithm, EncryptionSettings, RoomId } from \"@mtrnord/matrix-sdk-crypto-js\";\nimport { OnlineState } from \"./api/otherEnums\";\nimport { MatrixE2EE } from \"./e2ee\";\n\nexport interface RoomEvents {\n    // Used to notify about changes to the event list\n    'events': (events: IRoomEvent[]) => void;\n    'state_events': (stateEvents: IRoomStateEvent[]) => void;\n}\n\nexport declare interface Room {\n    on<U extends keyof RoomEvents>(\n        event: U, listener: RoomEvents[U]\n    ): this;\n\n    emit<U extends keyof RoomEvents>(\n        event: U, ...args: Parameters<RoomEvents[U]>\n    ): boolean;\n}\n\nexport class Room extends EventEmitter {\n    private events: IRoomEvent[] = [];\n    private pendingEvents: IRoomEvent[] = [];\n    private stateEvents: IRoomStateEvent[] = [];\n    private name?: string;\n\n    private notification_count: number = 0;\n    private notification_highlight_count: number = 0;\n    private joined_count: number = 0;\n    private invited_count: number = 0;\n    private is_dm: boolean = false;\n\n    public windowPos: {\n        [list: string]: number\n    } = {}\n\n\n    constructor(public roomID: string, private hostname: string, private client: MatrixClient, private e2ee: MatrixE2EE) {\n        super();\n    }\n\n    public addEvents(events: IRoomEvent[]) {\n        events.forEach((newEvent) => {\n            console.log(\"newEvent\", newEvent)\n            if (newEvent.unsigned?.transaction_id) {\n                console.log(\"Found transaction id. Trying to remove pending event\")\n                this.pendingEvents = this.pendingEvents.filter((event) => event.unsigned?.transaction_id !== newEvent.unsigned?.transaction_id);\n            }\n\n            this.events.push(newEvent);\n        });\n\n        this.emit(\"events\", this.getEvents());\n    }\n\n    public addStateEvents(state: IRoomStateEvent[]) {\n        // if the state event id is already known then we update the event instead of pushing it on to the Array\n        state.forEach((newEvent) => {\n            const index = this.stateEvents.findIndex((oldEvent) => oldEvent.state_key === newEvent.state_key && oldEvent.type === newEvent.type);\n            if (index !== -1) {\n                this.stateEvents[index] = newEvent;\n            } else {\n                this.stateEvents.push(newEvent);\n            }\n        });\n        this.emit(\"state_events\", this.stateEvents);\n    }\n\n    public getStateEvents(): IRoomStateEvent[] {\n        return this.stateEvents;\n    }\n\n    public isTombstoned(): boolean {\n        let isTombstoned: boolean = false;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.tombstone\") {\n                isTombstoned = true;\n            }\n        });\n        return isTombstoned;\n    }\n\n    public getAvatarURL(): string | undefined {\n        let avatarURL: string | undefined = undefined;\n        this.stateEvents.forEach((event) => {\n            if (isRoomAvatarEvent(event)) {\n                const rawAvatarURL = event.content.url;\n                if (rawAvatarURL?.startsWith(\"mxc://\")) {\n                    avatarURL = this.client.convertMXC(rawAvatarURL);\n                }\n            }\n        });\n        return avatarURL;\n    }\n\n    public isSpace(): boolean {\n        let isSpace: boolean = false;\n        this.stateEvents.forEach((event) => {\n            if (isRoomCreateEvent(event)) {\n                isSpace = event.content.type === \"m.space\";\n            }\n        });\n        return isSpace;\n    }\n\n    public setName(name: string) {\n        this.name = name;\n    }\n\n    public getName(): string {\n        if (!this.name) {\n            return this.roomID;\n        }\n        return this.name;\n    }\n\n    public getTopic(): string | undefined {\n        let topic: string | undefined = undefined;\n        this.stateEvents.forEach((event) => {\n            if (isRoomTopicEvent(event)) {\n                topic = event.content.topic;\n            }\n        });\n        return topic;\n    }\n\n    public setNotificationCount(count: number) {\n        this.notification_count = count;\n    }\n\n    public getNotificationCount(): number {\n        return this.notification_count;\n    }\n\n    public setNotificationHighlightCount(count: number) {\n        this.notification_highlight_count = count;\n    }\n\n    public getNotificationHighlightCount(): number {\n        return this.notification_highlight_count;\n    }\n\n    public setJoinedCount(count: number) {\n        this.joined_count = count;\n    }\n\n    public getJoinedCount(): number {\n        return this.joined_count;\n    }\n\n    public setInvitedCount(count: number) {\n        this.invited_count = count;\n    }\n\n    public getInvitedCount(): number {\n        return this.invited_count;\n    }\n\n    public getSpaceChildrenIDs(): string[] {\n        const children: string[] = [];\n        this.stateEvents.forEach((event) => {\n            if (isSpaceChildEvent(event)) {\n                children.push(event.state_key);\n            }\n        });\n        return children;\n    }\n\n    public getSpaceParentIDs(): { roomID: string, canonical: boolean }[] {\n        const parents: { roomID: string, canonical: boolean }[] = [];\n        this.stateEvents.forEach((event) => {\n            if (isSpaceParentEvent(event)) {\n                parents.push({ roomID: event.state_key, canonical: event.content.canonical || false });\n            }\n        });\n        return parents;\n    }\n\n    public setDM(isDM: boolean) {\n        this.is_dm = isDM;\n    }\n\n    public isDM(): boolean {\n        return this.is_dm;\n    }\n\n    public get presence(): OnlineState {\n        // TODO: Implement this\n        return OnlineState.Unknown;\n    }\n\n    public getEvents(): IRoomEvent[] {\n        return [...this.events, ...this.pendingEvents];\n    }\n\n    public getPureEvents(): IRoomEvent[] {\n        return this.events;\n    }\n\n    public getMemberName(userID: string): string {\n        let name: string = userID;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.member\") {\n                if (event.state_key === userID && event.content.membership == \"join\") {\n                    name = event.content.displayname;\n                }\n            }\n        });\n        return name;\n    }\n\n    public getMemberAvatar(userID: string): string | undefined {\n        let avatarURL: string | undefined = undefined;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.member\") {\n                if (event.state_key === userID && event.content.membership == \"join\") {\n                    const rawAvatarURL = event.content.avatar_url;\n                    if (rawAvatarURL?.startsWith(\"mxc://\")) {\n                        avatarURL = this.client.convertMXC(rawAvatarURL);\n                    }\n                }\n            }\n        });\n        return avatarURL;\n    }\n\n    public isEncrypted(): boolean {\n        let isEncrypted: boolean = false;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.encryption\" && event.content.algorithm === \"m.megolm.v1.aes-sha2\" && event.state_key === \"\") {\n                isEncrypted = true;\n            }\n        });\n        return isEncrypted;\n    }\n\n    // TODO: Workaround since txn id doesnt come down sync\n    private deletePendingByEventID(eventID: string) {\n        this.pendingEvents = this.pendingEvents.filter((event) => event.eventID !== eventID);\n    }\n\n    public async sendHtmlMessage(html: string, plainText: string, callbackLocalEcho: () => void): Promise<string> {\n        const txn_id = Date.now().toString();\n        // @ts-ignore: Intentionally incomplete\n        const event = {\n            type: \"m.room.message\",\n            unsigned: {\n                transaction_id: txn_id\n            },\n            origin_server_ts: txn_id,\n            sender: this.client.mxid,\n            event_id: txn_id,\n            content: {\n                \"msgtype\": \"m.text\",\n                \"body\": plainText,\n                \"format\": \"org.matrix.custom.html\",\n                \"formatted_body\": html\n            }\n        } as IRoomEvent;\n        this.pendingEvents.push(event);\n        this.emit(\"events\", this.getEvents());\n        callbackLocalEcho();\n\n        if (!this.isEncrypted()) {\n            const resp = await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${event.unsigned?.transaction_id}`, {\n                method: \"PUT\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": `Bearer ${this.client.accessToken}`\n                },\n                body: JSON.stringify(event.content)\n            });\n            if (!resp.ok) {\n                throw new Error(`Failed to send message: ${resp.status} ${resp.statusText}`);\n            }\n            const json = await resp.json();\n            this.deletePendingByEventID(event.event_id);\n            return json.event_id;\n        } else {\n            console.log(\"Sending encrypted message\");\n            await this.e2ee.getMissingSessions();\n            await this.e2ee.shareKeysForRoom(this);\n            const encrypted = await this.e2ee.encryptRoomEvent(\n                new RoomId(this.roomID),\n                \"m.room.message\",\n                JSON.stringify(event.content)\n            );\n            const resp = await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${event.unsigned?.transaction_id}`, {\n                method: \"PUT\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": `Bearer ${this.client.accessToken}`\n                },\n                body: encrypted\n            });\n            if (!resp.ok) {\n                throw new Error(`Failed to send message: ${resp.status} ${resp.statusText}`);\n            }\n            const json = await resp.json();\n            this.deletePendingByEventID(event.event_id);\n            return json.event_id;\n        }\n    }\n\n    public async sendTextMessage(text: string, callbackLocalEcho: () => void): Promise<string> {\n        const txn_id = Date.now().toString();\n        // @ts-ignore: Intentionally incomplete\n        const event = {\n            type: \"m.room.message\",\n            unsigned: {\n                transaction_id: txn_id\n            },\n            origin_server_ts: txn_id,\n            event_id: txn_id,\n            sender: this.client.mxid,\n            content: {\n                \"msgtype\": \"m.text\",\n                \"body\": text,\n            }\n        } as IRoomEvent;\n        this.pendingEvents.push(event);\n        this.emit(\"events\", this.getEvents());\n        callbackLocalEcho();\n\n        if (!this.isEncrypted()) {\n            const resp = await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.message/${event.unsigned?.transaction_id}`, {\n                method: \"PUT\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": `Bearer ${this.client.accessToken}`\n                },\n                body: JSON.stringify(event.content)\n            });\n            if (!resp.ok) {\n                throw new Error(`Failed to send message: ${resp.status} ${resp.statusText}`);\n            }\n            const json = await resp.json();\n            this.deletePendingByEventID(event.event_id);\n            return json.event_id;\n        } else {\n            console.log(\"Sending encrypted message2\");\n            await this.e2ee.getMissingSessions();\n            await this.e2ee.shareKeysForRoom(this);\n            const encrypted = await this.e2ee.encryptRoomEvent(\n                new RoomId(this.roomID),\n                \"m.room.message\",\n                JSON.stringify(event.content)\n            );\n            const resp = await fetch(`${this.hostname}/_matrix/client/v3/rooms/${this.roomID}/send/m.room.encrypted/${event.unsigned?.transaction_id}`, {\n                method: \"PUT\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": `Bearer ${this.client.accessToken}`\n                },\n                body: encrypted\n            });\n            if (!resp.ok) {\n                throw new Error(`Failed to send message: ${resp.status} ${resp.statusText}`);\n            }\n            const json = await resp.json();\n            this.deletePendingByEventID(event.event_id);\n            return json.event_id;\n        }\n    }\n\n    public getJoinedMemberIDs(): string[] {\n        const members: string[] = [];\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.member\" && event.content.membership === \"join\") {\n                members.push(event.state_key);\n            }\n        });\n        return members;\n    }\n\n    public getEncryptionSettings(): EncryptionSettings | undefined {\n        let settings: EncryptionSettings | undefined = undefined;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.encryption\" && event.state_key === \"\") {\n                if (!settings) {\n                    settings = new EncryptionSettings();\n                }\n                settings.algorithm = event.content.algorithm === \"m.megolm.v1.aes-sha2\" ? EncryptionAlgorithm.MegolmV1AesSha2 : EncryptionAlgorithm.OlmV1Curve25519AesSha2;\n                if (event.content.rotation_period_ms) {\n                    settings.rotationPeriod = BigInt(event.content.rotation_period_ms);\n                }\n                if (event.content.rotation_period_msgs) {\n                    settings.rotationPeriodMessages = BigInt(event.content.rotation_period_msgs);\n                }\n            }\n            if (event.type === \"m.room.history_visibility\" && event.state_key === \"\") {\n                if (!settings) {\n                    settings = new EncryptionSettings();\n                }\n                settings.historyVisibility = event.content.history_visibility;\n            }\n        });\n        if (settings) {\n            (settings as EncryptionSettings).onlyAllowTrustedDevices = false;\n        }\n        return settings;\n    }\n\n    public isJoined(): boolean {\n        let isJoined: boolean = false;\n        this.stateEvents.forEach((event) => {\n            if (event.type === \"m.room.member\" && event.state_key === this.client.mxid) {\n                isJoined = event.content.membership === \"join\";\n            }\n        });\n        return isJoined;\n    }\n}\n\nexport function useEvents(room?: Room) {\n    const [events, setEvents] = useState<IRoomEvent[]>(room?.getEvents() || []);\n\n    useEffect(() => {\n        if (room) {\n            setEvents(room?.getEvents() || []);\n            // Listen for event updates\n            const listenForEvents = (events: IRoomEvent[]) => {\n                setEvents(events);\n            };\n            room.on(\"events\", listenForEvents);\n            return () => {\n                room.removeListener(\"events\", listenForEvents);\n            }\n        } else {\n            setEvents([]);\n        }\n    }, [room])\n    return events;\n}\n\nexport function useStateEvents(room?: Room) {\n    const [events, setEvents] = useState<IRoomStateEvent[]>(room?.getStateEvents() || []);\n\n    useEffect(() => {\n        if (room) {\n            setEvents(room?.getStateEvents() || []);\n            // Listen for event updates\n            const listenForStateEvents = (events: IRoomStateEvent[]) => {\n                setEvents(events);\n            };\n            room.on(\"state_events\", listenForStateEvents);\n            return () => {\n                room.removeListener(\"state_events\", listenForStateEvents);\n            }\n        } else {\n            setEvents([]);\n        }\n    }, [room])\n    return events;\n}","import { IRoomEvent, IRoomStateEvent } from \"./events\";\n\nexport interface ISlidingSyncReq {\n    txn_id?: string;\n    lists?: {\n        [key: string]: {\n            ranges?: number[][];\n            slow_get_all_rooms?: boolean;\n            sort?: string[];\n            required_state?: string[][];\n            timeline_limit?: number;\n            filters?: {\n                [key: string]: any;\n            };\n        };\n    }\n    bump_event_types?: string[];\n    extensions?: {\n        [key: string]: any;\n    };\n    room_subscriptions?: {\n        [key: string]: {\n            sort?: string[];\n            required_state?: string[][];\n            timeline_limit?: number;\n            filters?: {\n                [key: string]: any;\n            };\n        };\n    };\n};\n\n\nexport interface ISlidingSyncResp {\n    lists?: {\n        [key: string]: List;\n    };\n    rooms?: {\n        [key: string]: RoomJson;\n    };\n    extensions?: Extensions;\n    pos: string;\n    txn_id: string;\n}\n\nexport interface Extensions {\n    e2ee?: E2EEExtension;\n    to_device?: ToDeviceExtension;\n}\n\nexport interface E2EEExtension {\n    device_one_time_keys_count?: {\n        [key: string]: number;\n    };\n    device_lists?: {\n        changed?: string[];\n        left?: string[];\n    };\n    device_unused_fallback_key_types?: string[];\n}\n\nexport interface ToDeviceExtension {\n    next_batch: string;\n    events?: any[];\n}\n\nexport interface List {\n    ops?: (SYNC_OP | INSERT_OP | INVALIDATE_OP | DELETE_OP)[];\n    count: number;\n}\n\nexport function isSyncOp(op: any): op is SYNC_OP {\n    return op.op === \"SYNC\";\n}\n\nexport function isInsertOp(op: any): op is INSERT_OP {\n    return op.op === \"INSERT\";\n}\n\nexport function isInvalidateOp(op: any): op is INVALIDATE_OP {\n    return op.op === \"INVALIDATE\";\n}\n\nexport function isDeleteOp(op: any): op is DELETE_OP {\n    return op.op === \"DELETE\";\n}\n\nexport interface DELETE_OP {\n    op: string;\n    index: number;\n}\n\nexport interface INVALIDATE_OP {\n    op: string;\n    range: number[];\n}\n\nexport interface INSERT_OP {\n    op: string;\n    index: number;\n    room_id: string;\n}\n\nexport interface SYNC_OP {\n    op: string;\n    range: number[];\n    room_ids: string[];\n}\n\nexport interface RoomJson {\n    name?: string,\n    // List of events\n    timeline?: IRoomEvent[],\n    required_state?: IRoomStateEvent[],\n    notification_count: number,\n    highlight_count: number,\n    initial: boolean,\n    joined_count: number,\n    invited_count: number,\n    prev_batch: string,\n    is_dm?: boolean,\n}","import { MatrixClient } from \"./client\";\nimport { ISlidingSyncReq, ISlidingSyncResp, isDeleteOp, isInsertOp, isInvalidateOp, isSyncOp } from './api/slidingSync';\nimport EventEmitter from \"events\";\nimport { Room } from \"./room\";\nimport { OwnUser } from \"./ownUser\";\nimport { DeviceLists, UserId } from \"@mtrnord/matrix-sdk-crypto-js\";\nimport { IRoomEvent, IRoomStateEvent, isRoomStateEvent } from \"./api/events\";\n\nexport interface MatrixSlidingSyncEvents {\n    // Used to notify about changes to the room list\n    'rooms': (rooms: Set<Room>) => void;\n    //'delete': (changedCount: number) => void;\n}\n\nexport declare interface MatrixSlidingSync {\n    on<U extends keyof MatrixSlidingSyncEvents>(\n        event: U, listener: MatrixSlidingSyncEvents[U]\n    ): this;\n\n    emit<U extends keyof MatrixSlidingSyncEvents>(\n        event: U, ...args: Parameters<MatrixSlidingSyncEvents[U]>\n    ): boolean;\n}\n\nexport class MatrixSlidingSync extends EventEmitter {\n    private syncing = false;\n    private syncPos?: string;\n    private initialSync = true;\n    private lastRanges?: { [key: string]: number[][] };\n    private lastTxnID?: string;\n    private to_device_since?: string;\n    public mustUpdateTxnID = true;\n    public rooms: Set<Room> = new Set();\n    private abortController = new AbortController();\n\n    constructor(private client: MatrixClient, private user: OwnUser) { super() }\n\n    public applyStoredSyncInfo(syncInfo: {\n        userId: string;\n        syncPos?: string;\n        initialSync: boolean;\n        lastRanges?: {\n            [key: string]: number[][];\n        };\n        lastTxnID?: string;\n        to_device_since?: string;\n    }) {\n        this.syncPos = syncInfo.syncPos;\n        this.initialSync = syncInfo.initialSync;\n        this.lastRanges = syncInfo.lastRanges;\n        this.lastTxnID = syncInfo.lastTxnID;\n        this.to_device_since = syncInfo.to_device_since;\n    }\n\n    public logout() {\n        this.stopSync();\n        this.abortController.abort();\n        this.rooms = new Set();\n        this.initialSync = true;\n        this.syncPos = undefined;\n        this.to_device_since = undefined;\n    }\n\n    public resetAbortController() {\n        this.abortController = new AbortController();\n    }\n\n    public async startSync() {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.client.database) {\n            await this.client.createDatabase();\n        }\n        if (this.syncing) {\n            return;\n        }\n        this.syncing = true;\n        while (this.syncing) {\n            try {\n                await this.sync();\n            } catch (e) {\n                console.error(e);\n            }\n        }\n    }\n\n    public stopSync() {\n        this.syncing = false;\n    }\n\n    private isIndexInRange(index: number, ranges: number[][]): boolean {\n        for (const r of ranges) {\n            if (r[0] < index && index <= r[1]) {\n                return true\n            }\n        }\n        return false\n    }\n\n    private shiftRight(listKey: string, ranges: number[][], hi: number, low: number) {\n        //     l   h\n        // 0,1,2,3,4 <- before\n        // 0,1,2,2,3 <- after, hi is deleted and low is duplicated\n        for (let i = hi - 1; i > low - 1; i--) {\n            if (this.isIndexInRange(i, ranges)) {\n                const roomObj = [...this.rooms].find(room => room.windowPos[listKey] === i + 1);\n                if (roomObj) {\n                    roomObj.windowPos[listKey] = (i);\n                }\n            }\n        }\n    }\n\n    private shiftLeft(listKey: string, ranges: number[][], hi: number, low: number) {\n        //     l   h\n        // 0,1,2,3,4 <- before\n        // 0,1,3,4,4 <- after, low is deleted and hi is duplicated\n        for (let i = low + 1; i < hi + 1; i++) {\n            if (this.isIndexInRange(i, ranges)) {\n                const roomObj = [...this.rooms].find(room => room.windowPos[listKey] === i - 1);\n                if (roomObj) {\n                    roomObj.windowPos[listKey] = (i);\n                }\n            }\n        }\n\n    }\n\n    private async removeEntry(listKey: string, ranges: number[][], index: number) {\n        // work out the max index\n        let max = -1;\n        const indexes = [...this.rooms].map(room => room.windowPos[listKey]);\n        for (const n in indexes) {\n            if (Number(n) > max) {\n                max = Number(n);\n            }\n        }\n        // TODO: Unclear if this is needed or working. Probably wrong?\n        // const roomObj = [...this.rooms].find(room => room.windowPos[listKey] === index);\n        // if (roomObj) {\n        //     const tx = this.database?.transaction('rooms', 'readwrite');\n        //     await tx?.store.delete(roomObj.roomID);\n        //     await tx?.done;\n        //     this.rooms.delete(roomObj)\n        // }\n        if (max < 0 || index > max) {\n            return;\n        }\n        // Everything higher than the gap needs to be shifted left.\n        this.shiftLeft(listKey, ranges, max, index);\n    }\n\n    private addEntry(listKey: string, ranges: number[][], index: number): void {\n        // work out the max index\n        let max = -1;\n        const indexes = [...this.rooms].map(room => room.windowPos[listKey]);\n        for (const n in indexes) {\n            if (Number(n) > max) {\n                max = Number(n);\n            }\n        }\n        if (max < 0 || index > max) {\n            return;\n        }\n        // Everything higher than the gap needs to be shifted right, +1 so we don't delete the highest element\n        this.shiftRight(listKey, ranges, max + 1, index);\n    }\n\n    private async sync() {\n        if (!this.client.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        if (!this.user.slidingSyncHostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n\n        // TODO: This might cause future issues\n        Promise.all([this.user.e2ee.sendIdentifyAndOneTimeKeys()]);\n\n        // This is the initial sync case for each list\n        let lists_ranges: {\n            \"overview\": number[][];\n            \"spaces\": number[][];\n            [key: string]: number[][];\n        } = {\n            \"overview\": [[0, 20]],\n            \"spaces\": [[0, 20]]\n        };\n        for (const space of this.client.spaceOpen) {\n            if (space === \"other\") { continue }\n            if (space === \"dm\") { continue }\n            lists_ranges[space] = [[0, 20]];\n        }\n\n        let timeline_limit = 1;\n        let subscription_limit = 10;\n        if (!this.initialSync) {\n            for (const list in lists_ranges) {\n                // Set higher timeline limit for subsequent syncs\n                timeline_limit = 10;\n                subscription_limit = 50;\n                // Calculate overlap between this.roomsInView and this.roomToRoomID and then\n                // calculate the ranges for each list\n                let rawRangeInView = new Set([...this.rooms]\n                    .filter(room => this.client.roomsInView.includes(room.roomID))\n                    .map(room => room.windowPos[list]).sort().filter(x => x !== undefined && x !== null))\n\n                if (this.client.getSpaces().find(r => r.roomID === list)) {\n                    // If we are syncing the spaces list, we need to use the spaceInView list instead\n                    rawRangeInView = new Set([...this.rooms]\n                        .filter(room => this.client.spacesInView.includes(room.roomID))\n                        .map(room => room.windowPos[list]).sort().filter(x => x !== undefined && x !== null))\n                }\n\n                if (rawRangeInView.size !== 0) {\n                    const minimum = Math.min(...rawRangeInView);\n                    const maximum = Math.max(...rawRangeInView);\n\n                    lists_ranges[list] = [[Math.max(minimum - 10, 0), maximum + 10]];\n                }\n            }\n            lists_ranges[\"e2ee\"] = lists_ranges[\"overview\"];\n        }\n\n\n        if (this.lastRanges && Object.entries(lists_ranges).toString() !== Object.entries(this.lastRanges).toString()) {\n            console.log(\"Ranges changed, resetting sync txn_id\", lists_ranges)\n            this.lastRanges = lists_ranges;\n            this.lastTxnID = Date.now().toString();\n        }\n\n        if (!this.lastRanges) {\n            this.lastRanges = lists_ranges;\n            this.lastTxnID = Date.now().toString();\n        }\n\n        if (this.mustUpdateTxnID) {\n            this.lastTxnID = Date.now().toString();\n            this.mustUpdateTxnID = false;\n        }\n\n\n        let url = `${this.user.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000`;\n        if (this.syncPos) {\n            url = `${this.user.slidingSyncHostname}/_matrix/client/unstable/org.matrix.msc3575/sync?timeout=5000&pos=${this.syncPos}`\n        }\n\n        const body: ISlidingSyncReq = {\n            // allows clients to know what request params reached the server,\n            // functionally similar to txn IDs on /send for events.\n            txn_id: this.lastTxnID,\n\n            // a delta token to remember information between sessions.\n            // See \"Bandwidth optimisations for persistent clients\" for more information.\n            // TODO: This isnt implemented anywhere yet\n            //delta_token: \"opaque-server-provided-string\",\n\n            // Sliding Window API\n            lists: {\n                \"spaces\": {\n                    ranges: this.lastRanges[\"spaces\"],\n                    // slow_get_all_rooms: true,\n                    sort: [\"by_name\"],\n                    required_state: [\n                        // needed to build sections\n                        [\"m.space.child\", \"*\"],\n                        [\"m.space.parent\", \"*\"],\n                        [\"m.room.create\", \"\"],\n                        [\"m.room.tombstone\", \"\"],\n                        // Room Avatar\n                        [\"m.room.avatar\", \"*\"],\n                        // Room Topic\n                        [\"m.room.topic\", \"*\"],\n                        // Request only the m.room.member events required to render events in the timeline.\n                        // The \"$LAZY\" value is a special sentinel value meaning \"lazy loading\" and is only valid for\n                        // the \"m.room.member\" event type. For more information on the semantics, see \"Lazy-Loading Room Members\".\n                        [\"m.room.member\", \"$LAZY\"],\n                        // E2EE\n                        [\"m.room.encryption\", \"\"],\n                        [\"m.room.history_visibility\", \"\"],\n                    ],\n                    timeline_limit: 0,\n                    filters: {\n                        room_types: [\"m.space\"]\n                    }\n                },\n                \"overview\": {\n                    ranges: this.lastRanges[\"overview\"],\n                    sort: [\"by_notification_level\", \"by_recency\", \"by_name\"],\n                    required_state: [\n                        // needed to build sections\n                        [\"m.space.child\", \"*\"],\n                        [\"m.space.parent\", \"*\"],\n                        [\"m.room.create\", \"\"],\n                        [\"m.room.tombstone\", \"\"],\n                        // Room Avatar\n                        [\"m.room.avatar\", \"*\"],\n                        // Room Topic\n                        [\"m.room.topic\", \"*\"],\n                        // Request only the m.room.member events required to render events in the timeline.\n                        // The \"$LAZY\" value is a special sentinel value meaning \"lazy loading\" and is only valid for\n                        // the \"m.room.member\" event type. For more information on the semantics, see \"Lazy-Loading Room Members\".\n                        [\"m.room.member\", \"$LAZY\"],\n                        // E2EE\n                        [\"m.room.encryption\", \"\"],\n                        [\"m.room.history_visibility\", \"\"],\n                    ],\n                    timeline_limit: timeline_limit,\n                    filters: {\n                        not_room_types: [\"m.space\"],\n                    }\n                },\n                \"e2ee\": {\n                    ranges: this.lastRanges[\"overview\"],\n                    sort: [\"by_notification_level\", \"by_recency\", \"by_name\"],\n                    required_state: [\n                        // needed to build sections\n                        [\"m.space.child\", \"*\"],\n                        [\"m.space.parent\", \"*\"],\n                        [\"m.room.create\", \"\"],\n                        [\"m.room.tombstone\", \"\"],\n                        // Room Avatar\n                        [\"m.room.avatar\", \"*\"],\n                        // Room Topic\n                        [\"m.room.topic\", \"*\"],\n                        [\"m.room.member\", \"*\"],\n                        // E2EE\n                        [\"m.room.encryption\", \"\"],\n                        [\"m.room.history_visibility\", \"\"],\n                    ],\n                    timeline_limit: timeline_limit,\n                    filters: {\n                        not_room_types: [\"m.space\"],\n                        is_encrypted: true,\n                    }\n                },\n            },\n            bump_event_types: [\"m.room.message\", \"m.room.encrypted\"],\n\n            extensions: {\n                e2ee: {\n                    enabled: true,\n                },\n                to_device: {\n                    enabled: true,\n                    since: this.to_device_since\n                },\n                typing: {\n                    enabled: true,\n                    lists: [\"overview\", \"e2ee\"],\n                },\n                receipts: {\n                    enabled: true,\n                    lists: [\"overview\", \"e2ee\"],\n                }\n            },\n        };\n\n        for (const space of this.client.spaceOpen) {\n            if (space === \"other\") { continue }\n            if (space === \"dm\") { continue }\n            if (!body.lists) {\n                body.lists = {};\n            }\n            body.lists[space] = {\n                slow_get_all_rooms: true,\n                ranges: this.lastRanges[space],\n                sort: [\"by_notification_level\", \"by_recency\", \"by_name\"],\n                required_state: [\n                    // needed to build sections\n                    [\"m.space.child\", \"*\"],\n                    [\"m.space.parent\", \"*\"],\n                    [\"m.room.create\", \"\"],\n                    [\"m.room.tombstone\", \"\"],\n                    // Room Avatar\n                    [\"m.room.avatar\", \"*\"],\n                    // Room Topic\n                    [\"m.room.topic\", \"*\"],\n                    // Request only the m.room.member events required to render events in the timeline.\n                    // The \"$LAZY\" value is a special sentinel value meaning \"lazy loading\" and is only valid for\n                    // the \"m.room.member\" event type. For more information on the semantics, see \"Lazy-Loading Room Members\".\n                    [\"m.room.member\", \"$LAZY\"],\n                    // E2EE\n                    [\"m.room.encryption\", \"\"],\n                    [\"m.room.history_visibility\", \"\"],\n                ],\n                timeline_limit: timeline_limit,\n                filters: {\n                    \"spaces\": [space]\n                }\n            }\n        }\n\n        if (this.client.currentRoom) {\n            body.room_subscriptions = {};\n            body.room_subscriptions[this.client.currentRoom] = {\n                sort: [\"by_notification_level\", \"by_recency\", \"by_name\"],\n                required_state: [\n                    // needed to build sections\n                    [\"m.space.child\", \"*\"],\n                    [\"m.space.parent\", \"*\"],\n                    [\"m.room.create\", \"\"],\n                    [\"m.room.tombstone\", \"\"],\n                    // Room Avatar\n                    [\"m.room.avatar\", \"*\"],\n                    // Room Topic\n                    [\"m.room.topic\", \"*\"],\n                    // Request only the m.room.member events required to render events in the timeline.\n                    // The \"$LAZY\" value is a special sentinel value meaning \"lazy loading\" and is only valid for\n                    // the \"m.room.member\" event type. For more information on the semantics, see \"Lazy-Loading Room Members\".\n                    [\"m.room.member\", \"$LAZY\"],\n                    // E2EE\n                    [\"m.room.encryption\", \"\"],\n                    [\"m.room.history_visibility\", \"\"],\n                ],\n                timeline_limit: subscription_limit,\n                filters: {}\n            }\n        }\n\n        const resp = await fetch(url, {\n            method: \"POST\",\n            signal: this.abortController.signal,\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${this.user.access_token}`\n            },\n            body: JSON.stringify(body)\n        });\n        if (!resp.ok) {\n            if (resp.status === 400) {\n                if ((await resp.json()).errcode === \"M_UNKNOWN_POS\") {\n                    this.syncPos = undefined;\n                    const syncInfoTX = this.client.database?.transaction('syncInfo', 'readwrite');\n                    await syncInfoTX?.store.put({\n                        userId: this.user.mxid!,\n                        syncPos: this.syncPos,\n                        initialSync: this.initialSync,\n                        lastRanges: this.lastRanges,\n                        lastTxnID: this.lastTxnID,\n                    });\n                    await syncInfoTX?.done;\n                }\n                return;\n            } else if (resp.status === 401) {\n                await this.logout();\n                console.error(resp);\n                console.error(\"Error syncing. See console for error.\");\n            }\n        }\n        const json = await resp.json() as ISlidingSyncResp;\n        this.syncPos = json.pos;\n\n        if (json.extensions?.to_device) {\n            await this.user.e2ee.receiveSyncData(\n                JSON.stringify(json.extensions.to_device.events || []),\n                new DeviceLists(\n                    json.extensions.e2ee?.device_lists?.changed?.map(\n                        user_id => new UserId(user_id)\n                    ),\n                    json.extensions.e2ee?.device_lists?.left?.map(\n                        user_id => new UserId(user_id)\n                    )\n                ),\n                new Map(Object.entries(json.extensions.e2ee?.device_one_time_keys_count || [])),\n                new Set(json.extensions.e2ee?.device_unused_fallback_key_types)\n            )\n            this.to_device_since = json.extensions.to_device.next_batch;\n        }\n\n        await this.user.e2ee.sendIdentifyAndOneTimeKeys();\n\n\n        const syncInfoTX = this.client.database?.transaction('syncInfo', 'readwrite');\n        await syncInfoTX?.store.put({\n            userId: this.user.mxid!,\n            syncPos: this.syncPos,\n            initialSync: this.initialSync,\n            lastRanges: this.lastRanges,\n            lastTxnID: this.lastTxnID,\n            to_device_since: this.to_device_since,\n        });\n        await syncInfoTX?.done;\n\n        let gapIndex = -1;\n        for (const listKey in json.lists) {\n            const list = json.lists[listKey];\n            if (list.ops) {\n                for (const op of list.ops) {\n                    if (isSyncOp(op)) {\n                        const tx = this.client.database?.transaction('rooms', 'readwrite');\n                        for (let i = op.range[0]; i <= op.range[1]; i++) {\n                            const roomID = op.room_ids[i - op.range[0]];\n                            if (!roomID) {\n                                break; // we are at the end of list\n                            }\n\n                            // Check if we already know this room and skip if we do. This is needed since we have 2 lists.\n                            // The db would already do this but the obj list doesn't (even though its a Set. Thats a mystery yet to solve)\n                            const roomObj = [...this.rooms].find(room => room.roomID === roomID);\n                            if (roomObj) {\n                                roomObj.windowPos[listKey] = i;\n                                continue;\n                            }\n\n                            const newRoom = new Room(roomID, this.user.hostname!, this.client, this.user.e2ee);\n                            // We start to remember the Room now.\n                            newRoom.setName(roomID);\n                            newRoom.windowPos[listKey] = i;\n\n                            this.rooms.add(newRoom);\n                            await tx?.store.put({\n                                windowPos: newRoom.windowPos,\n                                roomID: newRoom.roomID,\n                                name: newRoom.getName(),\n                                notification_count: newRoom.getNotificationCount(),\n                                highlight_count: newRoom.getNotificationHighlightCount(),\n                                joined_count: newRoom.getJoinedCount(),\n                                invited_count: newRoom.getInvitedCount(),\n                                avatarUrl: newRoom.getAvatarURL(),\n                                isSpace: newRoom.isSpace(),\n                                isDM: newRoom.isDM(),\n                                stateEvents: newRoom.getStateEvents(),\n                                events: newRoom.getEvents(),\n                            });\n                        }\n                        await tx?.done;\n                    } else if (isInsertOp(op)) {\n                        console.log(\"Got INSERT OP\", op);\n                        const roomObj = [...this.rooms].find(room => room.windowPos[listKey] === op.index);\n                        if (roomObj) {\n                            if (gapIndex < 0) {\n                                // we haven't been told where to shift from, so make way for a new room entry.\n                                this.addEntry(listKey, this.lastRanges[listKey], op.index);\n                            } else if (gapIndex > op.index) {\n                                // the gap is further down the list, shift every element to the right\n                                // starting at the gap so we can just shift each element in turn:\n                                // [A,B,C,_] gapIndex=3, op.index=0\n                                // [A,B,C,C] i=3\n                                // [A,B,B,C] i=2\n                                // [A,A,B,C] i=1\n                                // Terminate. We'll assign into op.index next.\n                                this.shiftRight(listKey, this.lastRanges[listKey], gapIndex, op.index);\n                            } else if (gapIndex < op.index) {\n                                // the gap is further up the list, shift every element to the left\n                                // starting at the gap so we can just shift each element in turn\n                                this.shiftLeft(listKey, this.lastRanges[listKey], op.index, gapIndex);\n                            }\n                        }\n                        gapIndex = -1;\n                        const tx = this.client.database?.transaction('rooms', 'readwrite');\n                        // We start to remember the Room now.\n                        const foundRoom = [...this.rooms].find(room => room.roomID === op.room_id);\n                        if (foundRoom) {\n                            foundRoom.windowPos[listKey] = op.index;\n                            await tx?.store.put({\n                                windowPos: foundRoom.windowPos,\n                                roomID: foundRoom.roomID,\n                                name: foundRoom.getName(),\n                                notification_count: foundRoom.getNotificationCount(),\n                                highlight_count: foundRoom.getNotificationHighlightCount(),\n                                joined_count: foundRoom.getJoinedCount(),\n                                invited_count: foundRoom.getInvitedCount(),\n                                avatarUrl: foundRoom.getAvatarURL(),\n                                isSpace: foundRoom.isSpace(),\n                                isDM: foundRoom.isDM(),\n                                stateEvents: foundRoom.getStateEvents(),\n                                events: foundRoom.getEvents(),\n                            });\n                        } else {\n                            const roomFromDB = await tx?.store.get(op.room_id);\n                            let newRoom = new Room(op.room_id, this.user.hostname!, this.client, this.user.e2ee);\n                            newRoom.setName(op.room_id);\n                            newRoom.windowPos[listKey] = op.index;\n                            if (roomFromDB) {\n                                console.warn(\"Room in db but not in obj list.\", op.room_id, \"Updating obj list.\");\n                                newRoom = new Room(op.room_id, this.user.hostname!, this.client, this.user.e2ee)\n                                newRoom.setName(roomFromDB.name);\n                                newRoom.setNotificationCount(roomFromDB.notification_count);\n                                newRoom.setNotificationHighlightCount(roomFromDB.highlight_count);\n                                newRoom.setJoinedCount(roomFromDB.joined_count);\n                                newRoom.setInvitedCount(roomFromDB.invited_count);\n                                newRoom.setDM(roomFromDB.isDM || false);\n                            }\n                            this.rooms.add(newRoom);\n                            await tx?.store.put({\n                                windowPos: newRoom.windowPos,\n                                roomID: newRoom.roomID,\n                                name: newRoom.getName(),\n                                notification_count: newRoom.getNotificationCount(),\n                                highlight_count: newRoom.getNotificationHighlightCount(),\n                                joined_count: newRoom.getJoinedCount(),\n                                invited_count: newRoom.getInvitedCount(),\n                                avatarUrl: newRoom.getAvatarURL(),\n                                isSpace: newRoom.isSpace(),\n                                isDM: newRoom.isDM(),\n                                stateEvents: newRoom.getStateEvents(),\n                                events: newRoom.getEvents(),\n                            });\n                        }\n\n                        const roomIDs2 = [...this.rooms].map(room => room.roomID);\n                        // Check if we generated any duplicates and log them.\n                        const duplicates = roomIDs2.filter((item, index) => roomIDs2.indexOf(item) != index);\n                        if (duplicates.length > 0) {\n                            console.error(\"Duplicates found\", duplicates);\n                        }\n                        await tx?.done;\n                    } else if (isDeleteOp(op)) {\n                        console.log(\"Got DELETE OP\", op);\n\n                        if (gapIndex !== -1) {\n                            // we already have a DELETE operation to process, so process it.\n                            await this.removeEntry(listKey, this.lastRanges[listKey], gapIndex);\n                        }\n                        gapIndex = op.index;\n                    } else if (isInvalidateOp(op)) {\n                        // TODO: Figure out if this is needed in reality\n                        // const tx = this.database?.transaction('rooms', 'readwrite');\n                        // for (let i = op.range[0]; i <= op.range[1]; i++) {\n                        //     // We shall first forget about these and \"startover\"\n                        //     const roomObj = [...this.rooms].find(room => room.windowPos[listKey] === i);\n                        //     if (roomObj) {\n                        //         await tx?.store.delete(roomObj.roomID);\n                        //         this.rooms.delete(roomObj)\n                        //     }\n                        // }\n                        // await tx?.done;\n                    }\n                }\n                if (gapIndex !== -1) {\n                    // we already have a DELETE operation to process, so process it\n                    // Everything higher than the gap needs to be shifted left.\n                    await this.removeEntry(listKey, this.lastRanges[listKey], gapIndex);\n                }\n            }\n        }\n        for (const roomID in json.rooms) {\n            const room = json.rooms[roomID];\n            const name = room.name;\n            const notification_count = room.notification_count;\n            const notification_highlight_count = room.highlight_count;\n            const joined_count = room.joined_count;\n            const invited_count = room.invited_count;\n            const events = room.timeline;\n            const state_events = events?.filter(event => isRoomStateEvent(event)).map(event => event as IRoomStateEvent);\n            const normal_events = events?.filter(event => !isRoomStateEvent(event)).map(event => event as IRoomEvent);\n            const required_state = room.required_state;\n            const is_dm = room.is_dm;\n\n            let roomObj = [...this.rooms].find(room => room.roomID === roomID);\n            if (!roomObj) {\n                // Warn, check in the db and if that fails, create a new one.\n                console.warn(\"Could not find roomObj for roomID:\", roomID);\n\n                const tx = this.client.database?.transaction('rooms', 'readwrite');\n                const roomFromDB = await tx?.store.get(roomID);\n                await tx?.done;\n\n                if (roomFromDB) {\n                    console.warn(\"Room in db but not in obj list.\", roomID, \"Updating obj list.\");\n\n                    roomObj = new Room(roomID, this.user.hostname!, this.client, this.user.e2ee);\n                    roomObj.setName(roomFromDB.name);\n                    roomObj.setNotificationCount(roomFromDB.notification_count);\n                    roomObj.setNotificationHighlightCount(roomFromDB.highlight_count);\n                    roomObj.setJoinedCount(roomFromDB.joined_count);\n                    roomObj.setInvitedCount(roomFromDB.invited_count);\n                    roomObj.setDM(roomFromDB.isDM || false);\n                    if (roomFromDB.events) {\n                        roomObj.addEvents(roomFromDB.events);\n                    }\n                    if (roomFromDB.stateEvents) {\n                        roomObj.addStateEvents(roomFromDB.stateEvents);\n                    }\n                    roomObj.windowPos = roomFromDB.windowPos;\n                } else {\n                    console.warn(\"Could not find room in db. Creating new one.\");\n                    roomObj = new Room(roomID, this.user.hostname!, this.client, this.user.e2ee);\n                    this.rooms.add(roomObj);\n                }\n            }\n\n            if (name) {\n                roomObj.setName(name);\n            }\n            roomObj.setNotificationCount(notification_count);\n            roomObj.setNotificationHighlightCount(notification_highlight_count);\n            roomObj.setJoinedCount(joined_count);\n            roomObj.setInvitedCount(invited_count);\n            if (normal_events) {\n                roomObj.addEvents(normal_events);\n            }\n            if (required_state) {\n                roomObj.addStateEvents(required_state);\n            }\n            if (state_events) {\n                roomObj.addStateEvents(state_events);\n            }\n            if (required_state || state_events) {\n                if (roomObj.isEncrypted() && roomObj.isJoined()) {\n                    const joinEvents = [...(required_state || []), ...(state_events || [])]\n                        .filter(event => event.type === \"m.room.member\" && event.content.membership === \"join\");\n                    const memberIds = joinEvents.map(event => new UserId(event.state_key));\n                    await this.user.e2ee.updateTrackedUsers(memberIds);\n                }\n            }\n            if (is_dm) {\n                roomObj.setDM(is_dm);\n            }\n\n\n            const tx = this.client.database?.transaction('rooms', 'readwrite');\n            // Write to database\n            await tx?.store.put({\n                windowPos: roomObj.windowPos,\n                roomID: roomObj.roomID,\n                name: roomObj.getName(),\n                notification_count: roomObj.getNotificationCount(),\n                highlight_count: roomObj.getNotificationHighlightCount(),\n                joined_count: roomObj.getJoinedCount(),\n                invited_count: roomObj.getInvitedCount(),\n                events: roomObj.getPureEvents(),\n                stateEvents: roomObj.getStateEvents(),\n                avatarUrl: roomObj.getAvatarURL(),\n                isSpace: roomObj.isSpace(),\n                isDM: roomObj.isDM(),\n            });\n            await tx?.done\n        }\n\n        if (this.initialSync) {\n            this.initialSync = false;\n            console.log(\"initialSyncComplete\");\n        }\n        if (json.rooms && Object.keys(json.rooms).length > 0) {\n            this.emit(\"rooms\", this.rooms);\n        }\n    }\n}","import {\n    createContext,\n    useContext,\n    useEffect,\n    useState\n} from \"react\";\nimport { OwnUser } from \"./ownUser\";\nimport {\n    IProfileInfo,\n    IRateLimitError,\n} from \"./api/apiTypes\";\nimport { IRoomEvent, IRoomStateEvent } from './api/events';\nimport { Room } from \"./room\";\nimport EventEmitter from \"events\";\nimport {\n    DBSchema,\n    IDBPDatabase,\n    deleteDB,\n    openDB\n} from \"idb\";\nimport { DeviceId, UserId } from \"@mtrnord/matrix-sdk-crypto-js\";\nimport { MatrixSlidingSync } from \"./slidingSync\";\n\nexport interface MatrixClientEvents {\n    // Used to notify about changes to the room list\n    'rooms': (rooms: Set<Room>) => void;\n    //'delete': (changedCount: number) => void;\n}\n\nexport declare interface MatrixClient {\n    on<U extends keyof MatrixClientEvents>(\n        event: U, listener: MatrixClientEvents[U]\n    ): this;\n\n    emit<U extends keyof MatrixClientEvents>(\n        event: U, ...args: Parameters<MatrixClientEvents[U]>\n    ): boolean;\n}\n\ninterface MatrixDB extends DBSchema {\n    rooms: {\n        // Same as roomToRoom map\n        key: string;\n        value: {\n            windowPos: {\n                [list: string]: number;\n            };\n            roomID: string;\n            name: string;\n            notification_count: number;\n            highlight_count: number;\n            joined_count: number;\n            invited_count: number;\n            events?: IRoomEvent[];\n            stateEvents?: IRoomStateEvent[];\n            avatarUrl?: string;\n            isSpace: boolean;\n            isDM?: boolean;\n        };\n    };\n    loginInfo: {\n        // login info\n        value: {\n            userId: string;\n            device_id?: string;\n            hostname?: string;\n            slidingSyncHostname?: string;\n            access_token?: string;\n            displayName?: string;\n            avatarUrl?: string;\n        };\n        // User ID\n        key: string;\n    };\n    syncInfo: {\n        // sync info\n        value: {\n            userId: string;\n            syncPos?: string;\n            initialSync: boolean;\n            lastRanges?: { [key: string]: number[][] }; // [start, end]\n            lastTxnID?: string;\n            to_device_since?: string;\n        };\n        // User ID\n        key: string;\n    }\n}\n\nexport class MatrixClient extends EventEmitter {\n    private static _instance: MatrixClient;\n    public roomsInView: string[] = [];\n    public spacesInView: string[] = [];\n    public spaceOpen: string[] = [];\n    public database?: IDBPDatabase<MatrixDB>;\n    private profileInfo?: IProfileInfo;\n    public currentRoom?: string;\n    private user: OwnUser = new OwnUser(this);\n    private sync: MatrixSlidingSync = new MatrixSlidingSync(this, this.user);\n\n    public get accessToken(): string | undefined {\n        return this.user.access_token;\n    }\n\n    public get isLoggedIn(): boolean {\n        return this.user.access_token !== undefined;\n    }\n\n    public get mxid(): string | undefined {\n        return this.user.mxid;\n    }\n\n    public async passwordLogin(username: string, password: string) {\n        await this.user.passwordLogin(username, password);\n    }\n\n    public convertMXC(url: string): string {\n        return `${this.user.hostname}/_matrix/media/r0/download/${url.substring(6)}`;\n    }\n\n    public setCurrentRoom(roomID?: string) {\n        if (roomID !== this.currentRoom) {\n            this.currentRoom = roomID;\n            console.log(\"Current room changed to\", roomID, \"restarting sync\");\n            this.sync.mustUpdateTxnID = true;\n            //this.abortController.abort();\n            //this.abortController = new AbortController();\n        }\n    }\n\n    public static async Instance() {\n        let instance = this._instance;\n        // Load from database if not done\n        if (!instance) {\n            instance = (this._instance = new this());\n            if (!instance.database) {\n                await instance.createDatabase();\n            }\n            const tx = instance.database?.transaction('loginInfo', 'readonly');\n            // We dont know the mxid so we just get all and use the first. In theory this allows for multiple accounts\n            const loginInfo = await tx?.store.getAll();\n            await tx?.done;\n            if (loginInfo && loginInfo.length > 0) {\n                instance.user.mxid = loginInfo[0].userId;\n                instance.user.hostname = loginInfo[0].hostname;\n                instance.user.slidingSyncHostname = loginInfo[0].slidingSyncHostname;\n                instance.user.access_token = loginInfo[0].access_token;\n                instance.user.device_id = loginInfo[0].device_id;\n                instance.profileInfo = {\n                    avatar_url: loginInfo[0].avatarUrl,\n                    displayname: loginInfo[0].displayName,\n                };\n                if (instance.user.mxid && instance.user.hostname && instance.user.access_token && instance.user.device_id) {\n                    await instance.user.e2ee.initOlmMachine(new UserId(instance.user.mxid), new DeviceId(instance.user.device_id));\n                }\n\n                // Load sync info\n                const syncTx = instance.database?.transaction('syncInfo', 'readonly');\n                const syncInfo = await syncTx?.store.get(instance.user.mxid!);\n                await syncTx?.done;\n\n                if (syncInfo) {\n                    instance.sync.applyStoredSyncInfo(syncInfo);\n                }\n\n                // Load rooms\n                const roomTx = instance.database?.transaction('rooms', 'readonly');\n                const rooms = await roomTx?.store.getAll();\n                await roomTx?.done;\n\n                if (rooms) {\n                    instance.sync.rooms = new Set(rooms.map(room => {\n                        const roomObj = new Room(room.roomID, instance.user.hostname!, instance, instance.user.e2ee);\n                        roomObj.windowPos = room.windowPos;\n                        roomObj.setInvitedCount(room.invited_count);\n                        roomObj.setJoinedCount(room.joined_count);\n                        roomObj.setNotificationCount(room.notification_count);\n                        roomObj.setNotificationHighlightCount(room.highlight_count);\n                        roomObj.setName(room.name);\n                        if (room.events) {\n                            roomObj.addEvents(room.events);\n                        }\n                        if (room.stateEvents) {\n                            roomObj.addStateEvents(room.stateEvents);\n                        }\n                        if (room.isDM) {\n                            roomObj.setDM(room.isDM);\n                        }\n                        return roomObj;\n                    }))\n                    instance.emit(\"rooms\", instance.sync.rooms);\n                }\n            }\n            instance.sync.on(\"rooms\", (rooms) => {\n                instance.emit(\"rooms\", rooms);\n            });\n        }\n\n\n        return instance;\n    }\n\n    public async createDatabase() {\n        this.database = await openDB<MatrixDB>(\"matrix\", 4, {\n            upgrade(db, oldVersion) {\n                if (oldVersion < 1) {\n                    if (db.objectStoreNames.contains(\"rooms\")) {\n                        db.deleteObjectStore(\"rooms\");\n                    }\n                    //if (db.objectStoreNames.contains(\"loginInfo\")) {\n                    //    db.deleteObjectStore(\"loginInfo\");\n                    //}\n                    if (db.objectStoreNames.contains(\"syncInfo\")) {\n                        db.deleteObjectStore(\"syncInfo\");\n                    }\n                    db.createObjectStore('rooms', { keyPath: 'roomID' });\n                    db.createObjectStore('loginInfo', { keyPath: 'userId' });\n                    db.createObjectStore('syncInfo', { keyPath: 'userId' });\n                }\n            }\n        });\n    }\n\n    public async decryptRoomEvent(roomID: string, event: IRoomEvent): Promise<IRoomEvent> {\n        if (!this.isLoggedIn) {\n            throw Error(\"Not logged in\");\n        }\n        const decryptedEvent = this.user.e2ee.decryptRoomEvent(roomID, event);\n        return decryptedEvent;\n    }\n\n    public async logout() {\n        this.sync.logout();\n        await this.user.logout();\n        this.user.e2ee.logoutE2ee();\n        if (this.user.mxid) {\n            const syncInfoTX = this.database?.transaction('syncInfo', 'readwrite');\n            await syncInfoTX?.store.delete(this.user.mxid);\n            await syncInfoTX?.done;\n            const loginInfoTX = this.database?.transaction('loginInfo', 'readwrite');\n            await loginInfoTX?.store.delete(this.user.mxid);\n            await loginInfoTX?.done;\n        }\n        const roomTX = this.database?.transaction('rooms', 'readwrite');\n        await roomTX?.store.clear();\n        await roomTX?.done;\n        this.user.mxid = undefined;\n        this.sync.resetAbortController();\n        await deleteDB(\"cetirizine-crypto\", {\n            blocked() {\n                location.reload();\n            },\n        });\n    }\n\n    /**\n     * addInViewRoom\n     * \n     * Tells the sync that a room with a certain roomID is inView.\n     */\n    public addInViewRoom(roomID: string) {\n        this.roomsInView.push(roomID);\n    }\n\n    /**\n     * removeInViewRoom\n     * \n     * Tells the sync that a room isn't in the room anymore\n     */\n    public removeInViewRoom(roomID: string) {\n        this.roomsInView = this.roomsInView.filter(room => room !== roomID);\n    }\n\n    public addInViewSpace(roomID: string) {\n        this.spacesInView.push(roomID);\n    }\n\n    public removeInViewSpace(roomID: string) {\n        this.spacesInView = this.spacesInView.filter(room => room !== roomID);\n    }\n\n    public addSpaceOpen(roomID: string) {\n        if (roomID === \"other\") {\n            return;\n        }\n        this.spaceOpen.push(roomID);\n\n        console.log(\"Space opened\", roomID, \"restarting sync\");\n        this.sync.mustUpdateTxnID = true;\n        //this.abortController.abort();\n        //this.abortController = new AbortController();\n    }\n\n    public removeSpaceOpen(roomID: string) {\n        if (roomID === \"other\") {\n            return;\n        }\n        this.spaceOpen = this.spaceOpen.filter(room => room !== roomID);\n        this.sync.mustUpdateTxnID = true;\n\n        // We intentionally do not restart the sync here since it will update in the next sync anyway.\n    }\n\n    public getRooms(): Set<Room> {\n        return this.sync.rooms;\n    }\n\n    public getSpaces(): Room[] {\n        return [...this.sync.rooms].filter(room => room.isSpace() && !room.isTombstoned()).sort((a: Room, b: Room) => {\n            if (a.getName() < b.getName()) {\n                return -1;\n            }\n            if (a.getName() > b.getName()) {\n                return 1;\n            }\n            return 0;\n        });\n    }\n\n    public getSpacesWithRooms(): Set<{\n        spaceRoom: Room, children: Set<Room>\n    }> {\n        const spaces = this.getSpaces();\n        const result: Set<{\n            spaceRoom: Room, children: Set<Room>\n        }> = new Set();\n        // Find children of spaces\n        for (const space of spaces) {\n            const childrenIDs = space.getSpaceChildrenIDs();\n\n            const children = new Set([...this.getRooms()].filter(room => childrenIDs.includes(room.roomID)));\n\n            result.add({\n                spaceRoom: space,\n                children: children,\n            });\n        }\n        // Find spaces of parents\n        // Check parents of each room and if we have a parent make sure to add it to the result unless already added\n        for (const room of this.getRooms()) {\n            if (room.isSpace() || room.isTombstoned()) {\n                continue;\n            }\n            const parents = room.getSpaceParentIDs();\n            for (const parent of parents) {\n                const parentObj = [...this.getRooms()].find(room => room.roomID === parent.roomID);\n                if (!parentObj) {\n                    continue;\n                }\n                const alreadyAddedSpace = [...result].find(space => space.spaceRoom.roomID === parentObj.roomID);\n                if (alreadyAddedSpace) {\n                    // Check if room in children\n                    if (![...alreadyAddedSpace.children].find(child => child.roomID === room.roomID)) {\n                        alreadyAddedSpace.children.add(room);\n                    }\n                    continue;\n                }\n                // If space not added yet, add it\n                result.add({\n                    spaceRoom: parentObj,\n                    children: new Set([room]),\n                });\n            }\n        }\n\n        return result;\n    }\n\n    public async startSync() {\n        await this.sync.startSync();\n    }\n\n    public async fetchProfileInfo(userId: string): Promise<IProfileInfo> {\n        if (this.profileInfo) {\n            return this.profileInfo;\n        }\n        if (!this.user.hostname) {\n            throw Error(\"Hostname must be set first\");\n        }\n        if (!this.database) {\n            await this.createDatabase();\n        }\n        if (!this.user.access_token) {\n            throw Error(\"Access token must be set first\");\n        }\n        const resp = await fetch(`${this.user.hostname}/_matrix/client/r0/profile/${userId}`, {\n            headers: {\n                \"Authorization\": `Bearer ${this.user.access_token}`\n            }\n        });\n        if (!resp.ok) {\n            if (resp.status === 404 || resp.status === 403) {\n                return {} as IProfileInfo;\n            }\n            console.error(resp);\n            throw Error(\"Error fetching profile info. See console for error.\");\n        }\n        const json = await resp.json() as IProfileInfo;\n        json.avatar_url = json.avatar_url?.replace(\"mxc://\", `${this.user.hostname}/_matrix/media/r0/download/`);\n        this.profileInfo = json;\n        const tx = this.database?.transaction('loginInfo', 'readwrite');\n        await tx?.store.put({\n            userId: this.user.mxid!,\n            device_id: this.user.device_id!,\n            hostname: this.user.hostname,\n            slidingSyncHostname: this.user.slidingSyncHostname,\n            access_token: this.user.access_token,\n            displayName: json.displayname,\n            avatarUrl: json.avatar_url,\n        });\n        await tx?.done\n\n        return json;\n    }\n}\n\nexport function isRateLimitError(arg: any): arg is IRateLimitError {\n    return arg.retry_after_ms !== undefined;\n}\n\nexport const defaultMatrixClient: MatrixClient = await MatrixClient.Instance();\nexport const MatrixContext = createContext<MatrixClient>(defaultMatrixClient);\n\n// List of rooms\nexport function useRooms() {\n    const client = useContext(MatrixContext);\n    const [rooms, setRooms] = useState<Set<Room>>(client.getRooms());\n\n    useEffect(() => {\n        // Listen for room updates\n        const listenForRooms = (rooms: Set<Room>) => {\n            setRooms(rooms);\n        };\n        client.on(\"rooms\", listenForRooms);\n        // This is a no-op if there is already a sync\n        client.startSync();\n        return () => {\n            client.removeListener(\"rooms\", listenForRooms);\n        }\n    }, [])\n    return rooms;\n}\n\nexport function useRoom(roomID?: string): Room | undefined {\n    const client = useContext(MatrixContext);\n    return [...client.getRooms()].find(room => room.roomID === roomID);\n}\n\nexport function useSpaces() {\n    const client = useContext(MatrixContext);\n    const [spacesWithRooms, setSpacesWithRooms] = useState<Set<{\n        spaceRoom: Room, children: Set<Room>\n    }>>(client.getSpacesWithRooms());\n\n    useEffect(() => {\n        // Listen for room updates\n        const listenForRooms = (_rooms: Set<Room>) => {\n            setSpacesWithRooms(client.getSpacesWithRooms());\n        };\n        client.on(\"rooms\", listenForRooms);\n        // This is a no-op if there is already a sync\n        client.startSync();\n        return () => {\n            client.removeListener(\"rooms\", listenForRooms);\n        }\n    }, [])\n    return spacesWithRooms;\n}\n\n\nexport function useProfile() {\n    const client = useContext(MatrixContext);\n    const [profile, setProfile] = useState<IProfileInfo>({\n        displayname: client.mxid || \"Unknown\",\n    });\n\n    useEffect(() => {\n        client.fetchProfileInfo(client.mxid!).then((profile) => {\n            if (!profile.displayname) {\n                profile.displayname = client.mxid || \"Unknown\";\n            }\n            setProfile(profile);\n        })\n    }, [])\n    return profile;\n}","import { memo } from \"react\";\nimport { IRoomEvent } from \"../../app/sdk/api/events\";\nimport { FC } from \"react\";\nimport { useRoom } from \"../../app/sdk/client\";\nimport Linkify from \"linkify-react\";\nimport Avatar from \"../avatar/avatar\";\nimport { OnlineState } from \"../../app/sdk/api/otherEnums\";\n\ntype UnknownEventProps = {\n    /**\n     * The event to render\n     */\n    event: IRoomEvent;\n    /**\n     * The roomID of the event to display\n     */\n    roomID?: string;\n    /**\n     * If the previous event was sent by the same user\n     */\n    hasPreviousEvent?: boolean;\n};\n\nconst linkifyOptions = {\n    defaultProtocol: \"https\",\n    rel: \"noopener\",\n    target: \"_blank\",\n    className: \"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500\"\n}\n\nconst UnknownEvent: FC<UnknownEventProps> = memo(({ event, roomID, hasPreviousEvent }) => {\n    const room = useRoom(roomID);\n\n    return (\n        <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n            {!hasPreviousEvent && <Avatar\n                displayname={room?.getMemberName(event.sender) || event.sender}\n                avatarUrl={room?.getMemberAvatar(event.sender)}\n                online={room?.presence || OnlineState.Unknown}\n                dm={room?.isDM() || false}\n            />}\n            <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                <Linkify options={linkifyOptions} as='p' className=\"whitespace-break-spaces text-black text-base font-normal\">{JSON.stringify(event, null, 4)}</Linkify>\n            </div>\n        </div>\n    )\n});\n\nexport default UnknownEvent;\n\ntype UndecryptableEventProps = {\n    /**\n     * The event to render\n     */\n    event: IRoomEvent;\n    /**\n     * The roomID of the event to display\n     */\n    roomID?: string;\n    /**\n     * If the previous event was sent by the same user\n     */\n    hasPreviousEvent?: boolean;\n};\n\nexport const UndecryptableEvent: FC<UndecryptableEventProps> = memo(({ event, roomID, hasPreviousEvent }) => {\n    const room = useRoom(roomID);\n\n    return (\n        <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n            {!hasPreviousEvent && <Avatar\n                displayname={room?.getMemberName(event.sender) || event.sender}\n                avatarUrl={room?.getMemberAvatar(event.sender)}\n                online={room?.presence || OnlineState.Unknown}\n                dm={room?.isDM() || false}\n            />}\n            <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                <Linkify options={linkifyOptions} as='p' className=\"whitespace-pre-wrap text-base font-normal text-orange-600\">Unable to decrypt event</Linkify>\n            </div>\n        </div>\n    )\n});\n\ntype RedactedEventProps = {\n    /**\n     * The original event\n     */\n    event: IRoomEvent;\n    /**\n     * The event to render\n     */\n    redacted_because?: string;\n    /**\n     * The roomID of the event to display\n     */\n    roomID?: string;\n    /**\n     * If the previous event was sent by the same user\n     */\n    hasPreviousEvent?: boolean;\n};\n\nexport const RedactedEvent: FC<RedactedEventProps> = memo(({ event, redacted_because, roomID, hasPreviousEvent }) => {\n    const room = useRoom(roomID);\n\n    return (\n        <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n            {!hasPreviousEvent && <Avatar\n                displayname={room?.getMemberName(event.sender) || event.sender}\n                avatarUrl={room?.getMemberAvatar(event.sender)}\n                online={room?.presence || OnlineState.Unknown}\n                dm={room?.isDM() || false}\n            />}\n            <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                {redacted_because && <p className=\"whitespace-pre-wrap text-base font-normal text-blue-600 italic\">Message was redacted: {redacted_because}</p>}\n                {!redacted_because && <p className=\"whitespace-pre-wrap text-base font-normal text-blue-600 italic\">Message was redacted</p>}\n            </div>\n        </div>\n    )\n});\n\n","import { FC, memo, useEffect, useRef, useState } from \"react\";\nimport { Pause, Play } from 'lucide-react';\nimport WaveSurfer from 'wavesurfer.js';\n\ntype WaveformProps = {\n    /**\n     * The media url to render\n     */\n    src_url: string;\n};\n\nconst Waveform: FC<WaveformProps> = memo(({ src_url }) => {\n    const [playing, setPlaying] = useState(false);\n    const [duration, setDuration] = useState(0);\n    const [waveform, setWaveform] = useState<WaveSurfer | undefined>(undefined);\n    const waveformRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        if (waveformRef.current) {\n            if (waveformRef.current.children.length > 0) {\n                if (waveform) {\n                    setWaveform(prev => {\n                        prev?.destroy();\n                        if (waveformRef.current) {\n                            for (const child of waveformRef.current.children) {\n                                child.remove();\n                            }\n                        }\n                        return undefined;\n                    });\n                }\n            }\n            if (waveformRef.current.children.length === 0) {\n                setWaveform(WaveSurfer.create({\n                    barWidth: 5,\n                    cursorWidth: 1,\n                    container: waveformRef.current,\n                    backend: 'WebAudio',\n                    height: 45,\n                    progressColor: '#f59e0b',\n                    responsive: true,\n                    waveColor: '#cbd5e1',\n                    cursorColor: 'transparent',\n                    barRadius: 5,\n                    hideScrollbar: true,\n                    normalize: true,\n                }));\n            }\n        }\n    }, []);\n\n\n    useEffect(() => {\n        if (waveform) {\n            waveform.load(src_url);\n            waveform.on('ready', () => {\n                setDuration(waveform.getDuration());\n            });\n        }\n    }, [waveform])\n\n    const handlePlay = () => {\n        if (waveform) {\n            setPlaying((prev) => !prev);\n            waveform.playPause();\n        }\n    };\n\n    return (\n        <div className=\"flex w-[min-content] flex-row h-full items-start justify-start gap-3 bg-slate-200 rounded border-2 border-slate-500 p-1\">\n            <button className=\"text-center flex justify-center items-center w-12 h-12 min-w-12 min-h-12 rounded-full outline-none cursor-pointer pb-1 bg-orange-500 border-orange-600 border hover:bg-orange-600 group\" onClick={handlePlay}>\n                {!playing ? <Play viewBox=\"0 0 21 24\" className=\"stroke-slate-50 group-hover:stroke-slate-100\" /> : <Pause size={24} className=\"stroke-slate-700 group-hover:stroke-slate-600\" />}\n            </button>\n            <div className=\"flex flex-col w-96 gap-2 justify-between\">\n                <div className=\"w-full h-12\" id=\"waveform\" ref={waveformRef}></div>\n                <span className=\"w-full text-sm font-medium text-slate-600 text-right\">{secondsToHms(duration)}</span>\n            </div>\n        </div>\n    );\n})\n\nfunction secondsToHms(d?: number) {\n    if (!d) {\n        return \"00:00\";\n    }\n    const h = Math.floor(d / 3600);\n    const m = Math.floor(d % 3600 / 60);\n    const s = Math.floor(d % 3600 % 60);\n\n    if (h === 0 && m === 0 && s === 0) {\n        return \"00:00\";\n    } else if (h === 0 && m === 0) {\n        return `00:${s.toString().padStart(2, \"0\")}`;\n    } else if (h === 0) {\n        return `${m.toString().padStart(2, \"0\")}:${s.toString().padStart(2, \"0\")}`;\n    }\n    return `${h}:${m}:${s}`;\n}\n\nexport default Waveform;","import { memo, useContext, useEffect, useState } from \"react\";\nimport { IRoomEvent, isRoomMessageAudioEvent, isRoomMessageImageEvent, isRoomMessageNoticeEvent, isRoomMessageTextEvent } from \"../../app/sdk/api/events\";\nimport { FC } from \"react\";\nimport Avatar from \"../avatar/avatar\";\nimport { MatrixClient, MatrixContext, useRoom } from \"../../app/sdk/client\";\nimport Linkify from \"linkify-react\";\nimport linkifyHtml from 'linkify-html';\nimport DOMPurify from \"dompurify\";\nimport { UndecryptableEvent } from \"./unknownEvent\";\nimport { decryptAttachment } from \"matrix-encrypt-attachment\";\nimport Waveform from './helpers/Waveform';\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/base16/solarized-dark.css';\nimport { OnlineState } from \"../../app/sdk/api/otherEnums\";\n\ntype MessageEventProps = {\n    /**\n     * The event to render\n     */\n    event: IRoomEvent;\n    /**\n     * The roomID of the event to display\n     */\n    roomID?: string;\n    /**\n     * If the previous event was sent by the same user\n     */\n    hasPreviousEvent?: boolean;\n    /**\n     * Reactions to the event\n     */\n    reactions?: IRoomEvent[];\n};\n\nconst linkifyOptions = {\n    defaultProtocol: \"https\",\n    rel: \"noopener\",\n    target: \"_blank\",\n    className: \"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500\"\n}\n\nconst decryptMedia = (client: MatrixClient, event: IRoomEvent, decryptedCallback: (url: string) => void, failureCallback: (error: string) => void) => {\n    console.log(\"Downloading media:\", event.event_id);\n    fetch(client.convertMXC(event.content.file.url), {\n        headers: {\n            Authorization: `Bearer ${client.accessToken}`\n        }\n    }).then((response) => {\n        if (!response.ok) {\n            // TODO: display error?\n            console.log(\"Unable to decrypt media:\", response.text());\n            return;\n        }\n        console.log(\"Downloaded media:\", event.event_id);\n        response.arrayBuffer().then((responseData) => {\n            // Decrypt the array buffer using the information taken from the event content.\n            decryptAttachment(responseData, event.content.file).then((dataArray) => {\n                // Turn the array into a Blob and give it the correct MIME-type.\n\n                // IMPORTANT: we must not allow scriptable mime-types into Blobs otherwise\n                // they introduce XSS attacks if the Blob URI is viewed directly in the\n                // browser (e.g. by copying the URI into a new tab or window.)\n                // See warning at top of file.\n                let mimetype = event.content.info?.mimetype ? event.content.info.mimetype.split(\";\")[0].trim() : \"\";\n                mimetype = getBlobSafeMimeType(mimetype);\n\n                const blob = new Blob([dataArray], { type: mimetype });\n                // TODO: Cache media in indexeddb\n                decryptedCallback(URL.createObjectURL(blob));\n                console.log(\"Decrypted media:\", event.event_id);\n            }).catch((e: any) => {\n                console.log(\"Unable to decrypt media due to decryption error:\", e);\n                failureCallback(`Unable to decrypt media due to decryption error: ${e}`);\n            });\n        });\n    });\n}\n\nconst MessageEvent: FC<MessageEventProps> = memo(({ event, roomID, hasPreviousEvent, reactions }) => {\n    const client = useContext(MatrixContext);\n    const room = useRoom(roomID);\n\n\n    const renderCorrectMessage = (event: IRoomEvent) => {\n        if (isRoomMessageTextEvent(event)) {\n            return (<TextMessage event={event} roomID={roomID} hasPreviousEvent={hasPreviousEvent} reactions={reactions} />)\n        } else if (isRoomMessageNoticeEvent(event)) {\n            return (<TextMessage event={event} roomID={roomID} hasPreviousEvent={hasPreviousEvent} reactions={reactions} message_type={MessageType.Notice} />)\n        } else if (isRoomMessageImageEvent(event)) {\n            const [url, setUrl] = useState<string | undefined>(undefined);\n            const [unableToDecrypt, setUnableToDecrypt] = useState<boolean>(event.content.file !== undefined);\n\n            useEffect(() => {\n                if (isRoomMessageImageEvent(event)) {\n                    if (event.content.url) {\n                        setUrl(client.convertMXC(event.content.url));\n                    } else {\n                        // Image is encrypted and we need to download and decrypt it\n                        if (event.content.file) {\n                            decryptMedia(\n                                client,\n                                event,\n                                (url) => {\n                                    setUrl(url);\n                                    setUnableToDecrypt(false);\n                                },\n                                (_error) => {\n                                    setUnableToDecrypt(true);\n                                }\n                            );\n                        }\n                    }\n                }\n            }, [event])\n\n            if (unableToDecrypt) {\n                return (<UndecryptableEvent event={event} roomID={roomID} hasPreviousEvent={hasPreviousEvent} />)\n            }\n\n            return (\n                <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n                    {!hasPreviousEvent && <Avatar\n                        displayname={room?.getMemberName(event.sender) || event.sender}\n                        avatarUrl={room?.getMemberAvatar(event.sender)}\n                        online={room?.presence || OnlineState.Unknown}\n                        dm={room?.isDM() || false}\n                    />}\n                    <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                        {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                        {/* TODO: Loading circle while image is loading */}\n                        <img\n                            src={url}\n                            alt={event.content.body}\n                            title={event.content.body}\n                            className=\"rounded-md object-cover border-slate-400 border-2 max-h-[23.333rem] max-w-[23.333rem] h-[unset]\"\n                        />\n                    </div>\n                </div>\n            )\n        } else if (isRoomMessageAudioEvent(event)) {\n            const [url, setUrl] = useState<string | undefined>(undefined);\n            const [unableToDecrypt, setUnableToDecrypt] = useState<boolean>(event.content.file !== undefined);\n\n\n            useEffect(() => {\n                if (isRoomMessageAudioEvent(event)) {\n                    if (event.content.url) {\n                        setUrl(client.convertMXC(event.content.url));\n                    } else {\n                        // Audio is encrypted and we need to download and decrypt it\n                        if (event.content.file) {\n                            decryptMedia(\n                                client,\n                                event,\n                                (url) => {\n                                    setUrl(url);\n                                    setUnableToDecrypt(false);\n                                },\n                                (_error) => {\n                                    setUnableToDecrypt(true);\n                                }\n                            );\n                        }\n                    }\n                }\n            }, [event])\n\n            if (unableToDecrypt) {\n                return (<UndecryptableEvent event={event} roomID={roomID} hasPreviousEvent={hasPreviousEvent} />)\n            }\n\n            return (\n                <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n                    {!hasPreviousEvent && <Avatar\n                        displayname={room?.getMemberName(event.sender) || event.sender}\n                        avatarUrl={room?.getMemberAvatar(event.sender)}\n                        online={room?.presence || OnlineState.Unknown}\n                        dm={room?.isDM() || false}\n                    />}\n                    <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"flex-1 ml-[3.7rem]\"}>\n                        {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                        {url && <Waveform src_url={url} />}\n                    </div>\n                </div>\n            )\n        } else {\n            return (\n                <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n                    {!hasPreviousEvent && <Avatar\n                        displayname={room?.getMemberName(event.sender) || event.sender}\n                        avatarUrl={room?.getMemberAvatar(event.sender)}\n                        online={room?.presence || OnlineState.Unknown}\n                        dm={room?.isDM() || false}\n                    />}\n                    <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                        {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                        <Linkify options={linkifyOptions} as='p' className=\"whitespace-pre-wrap text-black text-base font-normal\">{event.content.body}</Linkify>\n                    </div>\n                </div>\n            )\n        }\n    }\n\n    return renderCorrectMessage(event);\n});\n\nexport default MessageEvent;\n\nenum MessageType {\n    Text,\n    Notice,\n    Emote\n}\n\ninterface TextMessage extends MessageEventProps {\n    /**\n     * Which type the message is\n     */\n    message_type?: MessageType;\n}\n\nconst TextMessage: FC<TextMessage> = memo(({ event, roomID, hasPreviousEvent, message_type = MessageType.Text }) => {\n    const room = useRoom(roomID);\n\n    let text_color = \"text-black\";\n    if (message_type === MessageType.Notice) {\n        text_color = \"text-slate-500\"\n    }\n\n    if (event.content.format === \"org.matrix.custom.html\") {\n        let sanitized = DOMPurify.sanitize(event.content.formatted_body!, {\n            ADD_TAGS: [\n                \"font\",\n                \"del\",\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\",\n                \"blockquote\",\n                \"p\",\n                \"a\",\n                \"ul\",\n                \"ol\",\n                \"sup\",\n                \"sub\",\n                \"li\",\n                \"b\",\n                \"i\",\n                \"u\",\n                \"strong\",\n                \"em\",\n                \"strike\",\n                \"code\",\n                \"hr\",\n                \"br\",\n                \"div\",\n                \"table\",\n                \"thead\",\n                \"tbody\",\n                \"tr\",\n                \"th\",\n                \"td\",\n                \"caption\",\n                \"pre\",\n                \"span\",\n                \"img\",\n                \"details\",\n                \"summary\"\n            ]\n        })\n        // Extract code and language from the html\n        const codeRegex = /<pre><code (?:class=\"language-(?<language>.*?)\")?.*?>(?<code>[\\s\\S]*?)<\\/code><\\/pre>/;\n        const code = codeRegex.exec(sanitized);\n\n        if (code?.groups?.[\"code\"]) {\n            if (code.groups?.[\"language\"]) {\n                // Highlight the code\n                const highlighted = hljs.highlight(code.groups?.[\"code\"], { language: code.groups?.[\"language\"] }).value;\n                sanitized = sanitized.replace(code.groups?.[\"code\"], `${highlighted}`);\n            } else {\n                // Highlight the code\n                const highlighted = hljs.highlightAuto(code.groups?.[\"code\"]).value;\n                sanitized = sanitized.replace(code[0], `${highlighted}`);\n            }\n        }\n        const linkified = linkifyHtml(sanitized, linkifyOptions);\n        // TODO: sanitize the attributes allowed by matrix spec\n\n        return (\n            <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n                {!hasPreviousEvent && <Avatar\n                    displayname={room?.getMemberName(event.sender) || event.sender}\n                    avatarUrl={room?.getMemberAvatar(event.sender)}\n                    online={room?.presence || OnlineState.Unknown}\n                    dm={room?.isDM() || false}\n                />}\n                <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                    {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                    {/* TODO: Fixme */}\n                    <p className={`whitespace-pre-wrap ${text_color} text-base font-normal`} dangerouslySetInnerHTML={{ __html: linkified }}></p>\n                </div>\n            </div>\n        )\n    } else {\n        return (\n            <div className={!hasPreviousEvent ? \"flex flex-row gap-4 p-2 pb-1 hover:bg-gray-200 rounded-md duration-200 ease-in-out items-start\" : \"flex flex-row p-2 pb-1 pt-0 hover:bg-gray-200 rounded-md duration-200 ease-in-out\"}>\n                {!hasPreviousEvent && <Avatar\n                    displayname={room?.getMemberName(event.sender) || event.sender}\n                    avatarUrl={room?.getMemberAvatar(event.sender)}\n                    online={room?.presence || OnlineState.Unknown}\n                    dm={room?.isDM() || false}\n                />}\n                <div className={!hasPreviousEvent ? \"flex flex-col gap-1\" : \"ml-[3.7rem]\"}>\n                    {!hasPreviousEvent && <h2 className=\"text-sm font-medium text-red-500 whitespace-pre-wrap\">{room?.getMemberName(event.sender) || event.sender}</h2>}\n                    <Linkify options={linkifyOptions} as='p' className={`whitespace-pre-wrap ${text_color} text-base font-normal`}>{event.content.body}</Linkify>\n                </div>\n            </div>\n        )\n    }\n})\n\n\n// WARNING: We have to be very careful about what mime-types we allow into blobs,\n// as for performance reasons these are now rendered via URL.createObjectURL()\n// rather than by converting into data: URIs.\n//\n// This means that the content is rendered using the origin of the script which\n// called createObjectURL(), and so if the content contains any scripting then it\n// will pose a XSS vulnerability when the browser renders it.  This is particularly\n// bad if the user right-clicks the URI and pastes it into a new window or tab,\n// as the blob will then execute with access to Element's full JS environment(!)\n//\n// See https://github.com/matrix-org/matrix-react-sdk/pull/1820#issuecomment-385210647\n// for details.\n//\n// We mitigate this by only allowing mime-types into blobs which we know don't\n// contain any scripting, and instantiate all others as application/octet-stream\n// regardless of what mime-type the event claimed.  Even if the payload itself\n// is some malicious HTML, the fact we instantiate it with a media mimetype or\n// application/octet-stream means the browser doesn't try to render it as such.\n//\n// One interesting edge case is image/svg+xml, which empirically *is* rendered\n// correctly if the blob is set to the src attribute of an img tag (for thumbnails)\n// *even if the mimetype is application/octet-stream*.  However, empirically JS\n// in the SVG isn't executed in this scenario, so we seem to be okay.\n//\n// Tested on Chrome 65 and Firefox 60\n//\n// The list below is taken mainly from\n// https://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats\n// N.B. Matrix doesn't currently specify which mimetypes are valid in given\n// events, so we pick the ones which HTML5 browsers should be able to display\n//\n// For the record, mime-types which must NEVER enter this list below include:\n//   text/html, text/xhtml, image/svg, image/svg+xml, image/pdf, and similar.\n\nconst ALLOWED_BLOB_MIMETYPES = [\n    \"image/jpeg\",\n    \"image/gif\",\n    \"image/png\",\n    \"image/apng\",\n    \"image/webp\",\n    \"image/avif\",\n\n    \"video/mp4\",\n    \"video/webm\",\n    \"video/ogg\",\n    \"video/quicktime\",\n\n    \"audio/mp4\",\n    \"audio/webm\",\n    \"audio/aac\",\n    \"audio/mpeg\",\n    \"audio/ogg\",\n    \"audio/wave\",\n    \"audio/wav\",\n    \"audio/x-wav\",\n    \"audio/x-pn-wav\",\n    \"audio/flac\",\n    \"audio/x-flac\",\n];\n\nexport function getBlobSafeMimeType(mimetype: string): string {\n    if (!ALLOWED_BLOB_MIMETYPES.includes(mimetype)) {\n        return \"application/octet-stream\";\n    }\n    return mimetype;\n}","import { FC, memo } from \"react\";\n\ntype HeaderProps = {\n    /**\n     * The HeaderText\n     */\n    children: string\n};\n\nconst Header: FC<HeaderProps> = memo(({ children }: HeaderProps) => {\n    return <h1 className='text-black font-bold text-xl'>{children}</h1>;\n})\n\nexport default Header","import { ChangeEvent, FC, memo } from 'react';\n\ntype InputProps = {\n    /**\n     * The Placeholder text\n     */\n    placeholder: string\n    /**\n     * If it is a password input\n     */\n    password?: boolean\n    /**\n     * If input should be autofocused\n     */\n    autoFocus?: boolean\n    /**\n     * The value of the input field\n     */\n    value: string\n    /**\n     * If the input is readonly\n     */\n    readonly: boolean\n    /**\n     * Handler for the onChange event\n     */\n    onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Input: FC<InputProps> = memo(({ placeholder, password = false, autoFocus = false, value, readonly, onChange }: InputProps) => {\n    return (\n        <input\n            disabled={readonly}\n            className='text-base form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150'\n            value={value}\n            type={password ? \"password\" : \"text\"}\n            autoFocus={autoFocus}\n            placeholder={placeholder}\n            onChange={onChange}\n        />\n    );\n})\nexport default Input;","import { AutoLinkPlugin, LinkMatcher } from \"@lexical/react/LexicalAutoLinkPlugin\";\n\nconst URL_MATCHER = /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER = /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS: LinkMatcher[] = [\n    (text) => {\n        const match = URL_MATCHER.exec(text);\n        return (\n            match && {\n                index: match.index,\n                length: match[0].length,\n                text: match[0],\n                url: match[0]\n            }\n        );\n    },\n    (text) => {\n        const match = EMAIL_MATCHER.exec(text);\n        return (\n            match && {\n                index: match.index,\n                length: match[0].length,\n                text: match[0],\n                url: `mailto:${match[0]}`\n            }\n        );\n    }\n];\n\nexport default function PlaygroundAutoLinkPlugin() {\n    return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","import { $applyNodeReplacement, $getRoot, DOMExportOutput, LexicalEditor, ParagraphNode, SerializedElementNode, SerializedParagraphNode } from \"lexical\";\n\nexport class CustomParagraphNode extends ParagraphNode {\n    static getType(): string {\n        return \"custom-paragraph\";\n    }\n\n    static clone(node: CustomParagraphNode): CustomParagraphNode {\n        return new CustomParagraphNode(node.__key);\n    }\n\n    exportDOM(editor: LexicalEditor): DOMExportOutput {\n        const { element } = super.exportDOM(editor);\n\n        if (this.isEmpty()) {\n            const root = $getRoot();\n            let foundFurtherText = false;\n            for (const child of root.getChildren()) {\n                if (child === this) {\n                    continue;\n                }\n                if (child instanceof CustomParagraphNode || child instanceof ParagraphNode) {\n                    if (!child.isEmpty()) {\n                        foundFurtherText = true;\n                    }\n                }\n            }\n            if (!foundFurtherText) {\n                return { element: null };\n            }\n        }\n\n        return { element };\n    }\n\n    exportJSON(): SerializedElementNode {\n        const node = super.exportJSON();\n        node.type = \"custom-paragraph\";\n        return node;\n    }\n\n    static importJSON(node: SerializedParagraphNode): CustomParagraphNode {\n        return super.importJSON(node);\n    }\n}\n\nexport function $createCustomParagraphNode(): CustomParagraphNode {\n    return $applyNodeReplacement(new CustomParagraphNode());\n}","import { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n    useCallback,\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n    ChangeEventHandler,\n    ChangeEvent,\n    MutableRefObject,\n    Dispatch,\n    SetStateAction,\n    createElement,\n    memo\n} from \"react\";\nimport {\n    CAN_REDO_COMMAND,\n    CAN_UNDO_COMMAND,\n    REDO_COMMAND,\n    UNDO_COMMAND,\n    SELECTION_CHANGE_COMMAND,\n    FORMAT_TEXT_COMMAND,\n    $getSelection,\n    $isRangeSelection,\n    $getNodeByKey,\n    LexicalEditor,\n    RangeSelection,\n    NodeSelection,\n    GridSelection\n} from \"lexical\";\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from \"@lexical/link\";\nimport {\n    $isParentElementRTL,\n    $wrapNodes,\n    $isAtNodeEnd\n} from \"@lexical/selection\";\nimport { $getNearestNodeOfType, mergeRegister } from \"@lexical/utils\";\nimport {\n    INSERT_ORDERED_LIST_COMMAND,\n    INSERT_UNORDERED_LIST_COMMAND,\n    REMOVE_LIST_COMMAND,\n    $isListNode,\n    ListNode\n} from \"@lexical/list\";\nimport { createPortal } from \"react-dom\";\nimport {\n    $createHeadingNode,\n    $createQuoteNode,\n    $isHeadingNode\n} from \"@lexical/rich-text\";\nimport {\n    $createCodeNode,\n    $isCodeNode,\n    getDefaultCodeLanguage,\n    getCodeLanguages\n} from \"@lexical/code\";\nimport { Bold, ChevronDown, Code, Heading1, Heading2, Heading4, Heading5, Italic, Link, List, ListOrdered, Quote, Redo, Strikethrough, Text, Underline, Undo } from \"lucide-react\";\nimport { Heading3 } from \"lucide-react\";\nimport { $createCustomParagraphNode } from \"../customNodes/CustomParagraphNode\";\n\nconst LowPriority = 1;\n\nconst supportedBlockTypes = new Set([\n    \"custom-paragraph\",\n    \"quote\",\n    \"code\",\n    \"h1\",\n    \"h2\",\n    \"ul\",\n    \"ol\"\n]);\n\ninterface BlockTypes {\n    \"code\": string,\n    h1: string,\n    h2: string,\n    h3: string,\n    h4: string,\n    h5: string,\n    ol: string,\n    \"custom-paragraph\": string,\n    quote: string,\n    ul: string\n}\n\nconst blockTypeToBlockName: BlockTypes = {\n    \"code\": \"Code Block\",\n    h1: \"Large Heading\",\n    h2: \"Small Heading\",\n    h3: \"Heading\",\n    h4: \"Heading\",\n    h5: \"Heading\",\n    ol: \"Numbered List\",\n    \"custom-paragraph\": \"Normal\",\n    quote: \"Quote\",\n    ul: \"Bulleted List\"\n} as const;\n\ntype BlockType = keyof typeof blockTypeToBlockName;\n\nconst Divider = memo(() => {\n    return <div className=\"divider\" />;\n})\n\nfunction positionEditorElement(editor: HTMLDivElement, rect: DOMRect | undefined) {\n    if (!rect) {\n        editor.style.opacity = \"0\";\n        editor.style.top = \"-1000px\";\n        editor.style.left = \"-1000px\";\n    } else {\n        editor.style.opacity = \"1\";\n        editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n        editor.style.left = `${rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n            }px`;\n    }\n}\n\nconst FloatingLinkEditor = memo(({ editor }: { editor: LexicalEditor }) => {\n    const editorRef: MutableRefObject<HTMLDivElement | null> = useRef(null);\n    const inputRef: MutableRefObject<HTMLInputElement | null> = useRef(null);\n    const mouseDownRef = useRef(false);\n    const [linkUrl, setLinkUrl] = useState(\"\");\n    const [isEditMode, setEditMode] = useState(false);\n    const [lastSelection, setLastSelection] = useState<RangeSelection | GridSelection | NodeSelection | null>(null);\n\n    const updateLinkEditor = useCallback(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n            const node = getSelectedNode(selection);\n            const parent = node.getParent();\n            if ($isLinkNode(parent)) {\n                setLinkUrl(parent.getURL());\n            } else if ($isLinkNode(node)) {\n                setLinkUrl(node.getURL());\n            } else {\n                setLinkUrl(\"\");\n            }\n        }\n        const editorElem = editorRef.current;\n        const nativeSelection = window.getSelection();\n        const activeElement = document.activeElement;\n\n        if (editorElem === null) {\n            return;\n        }\n\n        const rootElement = editor.getRootElement();\n        if (\n            selection !== null &&\n            !nativeSelection?.isCollapsed &&\n            rootElement !== null &&\n            rootElement.contains(nativeSelection?.anchorNode as (Node | null))\n        ) {\n            const domRange = nativeSelection?.getRangeAt(0);\n            let rect;\n            if (nativeSelection?.anchorNode === rootElement) {\n                let inner = rootElement;\n                while (inner.firstElementChild != null) {\n                    inner = inner.firstElementChild as HTMLElement;\n                }\n                rect = inner.getBoundingClientRect();\n            } else {\n                rect = domRange?.getBoundingClientRect();\n            }\n\n            if (!mouseDownRef.current) {\n                positionEditorElement(editorElem, rect);\n            }\n            setLastSelection(selection);\n        } else if (!activeElement || activeElement.className !== \"link-input\") {\n            positionEditorElement(editorElem, undefined);\n            setLastSelection(null);\n            setEditMode(false);\n            setLinkUrl(\"\");\n        }\n\n        return true;\n    }, [editor]);\n\n    useEffect(() => {\n        return mergeRegister(\n            editor.registerUpdateListener(({ editorState }) => {\n                editorState.read(() => {\n                    updateLinkEditor();\n                });\n            }),\n\n            editor.registerCommand(\n                SELECTION_CHANGE_COMMAND,\n                () => {\n                    updateLinkEditor();\n                    return true;\n                },\n                LowPriority\n            )\n        );\n    }, [editor, updateLinkEditor]);\n\n    useEffect(() => {\n        editor.getEditorState().read(() => {\n            updateLinkEditor();\n        });\n    }, [editor, updateLinkEditor]);\n\n    useEffect(() => {\n        if (isEditMode && inputRef.current) {\n            inputRef.current.focus();\n        }\n    }, [isEditMode]);\n\n    const safeLink = createElement(\"a\", { href: linkUrl, target: \"_blank\", rel: \"noopener noreferrer\" }, linkUrl);\n\n    return (\n        <div ref={editorRef} className=\"link-editor\">\n            {isEditMode ? (\n                <input\n                    ref={inputRef}\n                    className=\"link-input\"\n                    value={linkUrl}\n                    onChange={(event) => {\n                        setLinkUrl(event.target.value);\n                    }}\n                    onKeyDown={(event) => {\n                        if (event.key === \"Enter\") {\n                            event.preventDefault();\n                            if (lastSelection !== null) {\n                                if (linkUrl !== \"\") {\n                                    editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                                }\n                                setEditMode(false);\n                            }\n                        } else if (event.key === \"Escape\") {\n                            event.preventDefault();\n                            setEditMode(false);\n                        }\n                    }}\n                />\n            ) : (\n                <>\n                    <div className=\"link-input\">\n                        {safeLink}\n                        <div\n                            className=\"link-edit\"\n                            role=\"button\"\n                            tabIndex={0}\n                            onMouseDown={(event) => event.preventDefault()}\n                            onClick={() => {\n                                setEditMode(true);\n                            }}\n                        />\n                    </div>\n                </>\n            )}\n        </div>\n    );\n})\n\nconst Select = memo(({ onChange, className, options, value }: { onChange: ChangeEventHandler<HTMLSelectElement>, className: string, options: string[], value: string | ReadonlyArray<string> | number }) => {\n    return (\n        <select className={className} onChange={onChange} value={value}>\n            <option hidden={true} value=\"\" />\n            {options.map((option) => (\n                <option key={option} value={option}>\n                    {option}\n                </option>\n            ))}\n        </select>\n    );\n})\n\nfunction getSelectedNode(selection: RangeSelection | GridSelection) {\n    const anchor = selection.anchor;\n    const focus = selection.focus;\n    const anchorNode = selection.anchor.getNode();\n    const focusNode = selection.focus.getNode();\n    if (anchorNode === focusNode) {\n        return anchorNode;\n    }\n    const isBackward = selection.isBackward();\n    if (isBackward) {\n        return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n    } else {\n        return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n    }\n}\n\nconst BlockOptionsDropdownList = memo(({\n    editor,\n    blockType,\n    toolbarRef,\n    setShowBlockOptionsDropDown\n}: { editor: LexicalEditor, blockType: BlockType, toolbarRef: MutableRefObject<HTMLDivElement | null>, setShowBlockOptionsDropDown: Dispatch<SetStateAction<boolean>> }) => {\n    const dropDownRef: MutableRefObject<HTMLDivElement | null> = useRef(null);\n\n    useEffect(() => {\n        const dropDown = dropDownRef.current;\n        const toolbar = toolbarRef.current;\n\n        if (dropDown !== null && toolbar !== null) {\n            const editorContainer = document.getElementsByClassName(\"editor-container\")[0];\n            if (editorContainer) {\n                dropDown.style.bottom = `${editorContainer.clientHeight}px`;\n            }\n\n            const handle = (event: MouseEvent) => {\n                const target = event.target;\n\n                if (!dropDown.contains(target as Node) && !toolbar.contains(target as Node)) {\n                    setShowBlockOptionsDropDown(false);\n                }\n            };\n            document.addEventListener(\"click\", handle);\n\n            return () => {\n                document.removeEventListener(\"click\", handle);\n            };\n        }\n    }, [dropDownRef, setShowBlockOptionsDropDown, toolbarRef]);\n\n    const formatParagraph = () => {\n        if (blockType !== \"custom-paragraph\") {\n            editor.update(() => {\n                const selection = $getSelection();\n\n                if ($isRangeSelection(selection)) {\n                    $wrapNodes(selection, () => $createCustomParagraphNode());\n                }\n            });\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatLargeHeading = () => {\n        if (blockType !== \"h1\") {\n            editor.update(() => {\n                const selection = $getSelection();\n\n                if ($isRangeSelection(selection)) {\n                    $wrapNodes(selection, () => $createHeadingNode(\"h1\"));\n                }\n            });\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatSmallHeading = () => {\n        if (blockType !== \"h2\") {\n            editor.update(() => {\n                const selection = $getSelection();\n\n                if ($isRangeSelection(selection)) {\n                    $wrapNodes(selection, () => $createHeadingNode(\"h2\"));\n                }\n            });\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatBulletList = () => {\n        if (blockType !== \"ul\") {\n            editor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n        } else {\n            editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatNumberedList = () => {\n        if (blockType !== \"ol\") {\n            editor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n        } else {\n            editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatQuote = () => {\n        if (blockType !== \"quote\") {\n            editor.update(() => {\n                const selection = $getSelection();\n\n                if ($isRangeSelection(selection)) {\n                    $wrapNodes(selection, () => $createQuoteNode());\n                }\n            });\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    const formatCode = () => {\n        if (blockType !== \"code\") {\n            editor.update(() => {\n                const selection = $getSelection();\n\n                if ($isRangeSelection(selection)) {\n                    $wrapNodes(selection, () => $createCodeNode());\n                }\n            });\n        }\n        setShowBlockOptionsDropDown(false);\n    };\n\n    return (\n        <div className=\"dropdown\" ref={dropDownRef}>\n            <button className=\"item\" onClick={formatParagraph}>\n                <Text className=\"icon\" size={20} />\n                <span className=\"text\">Normal</span>\n                {blockType === \"custom-paragraph\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatLargeHeading}>\n                <Heading1 className=\"icon\" size={20} />\n                <span className=\"text\">Large Heading</span>\n                {blockType === \"h1\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatSmallHeading}>\n                <Heading2 className=\"icon\" size={20} />\n                <span className=\"text\">Small Heading</span>\n                {blockType === \"h2\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatBulletList}>\n                <List className=\"icon\" size={20} />\n                <span className=\"text\">Bullet List</span>\n                {blockType === \"ul\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatNumberedList}>\n                <ListOrdered className=\"icon\" size={20} />\n                <span className=\"text\">Numbered List</span>\n                {blockType === \"ol\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatQuote}>\n                <Quote className=\"icon\" size={20} />\n                <span className=\"text\">Quote</span>\n                {blockType === \"quote\" && <span className=\"active\" />}\n            </button>\n            <button className=\"item\" onClick={formatCode}>\n                <Code className=\"icon\" size={20} />\n                <span className=\"text\">Code Block</span>\n                {blockType === \"code\" && <span className=\"active\" />}\n            </button>\n        </div>\n    );\n})\n\nconst ToolbarPlugin = memo(() => {\n    const [editor] = useLexicalComposerContext();\n    const toolbarRef = useRef(null);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [blockType, setBlockType] = useState<BlockType>(\"custom-paragraph\");\n    const [selectedElementKey, setSelectedElementKey] = useState(null);\n    const [showBlockOptionsDropDown, setShowBlockOptionsDropDown] = useState(\n        false\n    );\n    const [codeLanguage, setCodeLanguage] = useState(\"\");\n    const [_isRTL, setIsRTL] = useState(false);\n    const [isLink, setIsLink] = useState(false);\n    const [isBold, setIsBold] = useState(false);\n    const [isItalic, setIsItalic] = useState(false);\n    const [isUnderline, setIsUnderline] = useState(false);\n    const [isStrikethrough, setIsStrikethrough] = useState(false);\n    const [isCode, setIsCode] = useState(false);\n\n    const updateToolbar = useCallback(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n            const element =\n                anchorNode.getKey() === \"root\"\n                    ? anchorNode\n                    : anchorNode.getTopLevelElementOrThrow();\n            const elementKey = element.getKey();\n            const elementDOM = editor.getElementByKey(elementKey);\n            if (elementDOM !== null) {\n                setSelectedElementKey(elementKey);\n                if ($isListNode(element)) {\n                    const parentList = $getNearestNodeOfType(anchorNode, ListNode);\n                    const type = parentList ? parentList.getTag() : element.getTag();\n                    setBlockType(type);\n                } else {\n                    const type = $isHeadingNode(element)\n                        ? element.getTag()\n                        : element.getType();\n                    setBlockType(type);\n                    if ($isCodeNode(element)) {\n                        setCodeLanguage(element.getLanguage() || getDefaultCodeLanguage());\n                    }\n                }\n            }\n            // Update text format\n            setIsBold(selection.hasFormat(\"bold\"));\n            setIsItalic(selection.hasFormat(\"italic\"));\n            setIsUnderline(selection.hasFormat(\"underline\"));\n            setIsStrikethrough(selection.hasFormat(\"strikethrough\"));\n            setIsCode(selection.hasFormat(\"code\"));\n            setIsRTL($isParentElementRTL(selection));\n\n            // Update links\n            const node = getSelectedNode(selection);\n            const parent = node.getParent();\n            if ($isLinkNode(parent) || $isLinkNode(node)) {\n                setIsLink(true);\n            } else {\n                setIsLink(false);\n            }\n        }\n    }, [editor]);\n\n    useEffect(() => {\n        return mergeRegister(\n            editor.registerUpdateListener(({ editorState }) => {\n                editorState.read(() => {\n                    updateToolbar();\n                });\n            }),\n            editor.registerCommand(\n                SELECTION_CHANGE_COMMAND,\n                (_payload, _newEditor) => {\n                    updateToolbar();\n                    return false;\n                },\n                LowPriority\n            ),\n            editor.registerCommand(\n                CAN_UNDO_COMMAND,\n                (payload) => {\n                    setCanUndo(payload);\n                    return false;\n                },\n                LowPriority\n            ),\n            editor.registerCommand(\n                CAN_REDO_COMMAND,\n                (payload) => {\n                    setCanRedo(payload);\n                    return false;\n                },\n                LowPriority\n            )\n        );\n    }, [editor, updateToolbar]);\n\n    const codeLanguges = useMemo(() => getCodeLanguages(), []);\n    const onCodeLanguageSelect = useCallback(\n        (e: ChangeEvent<HTMLSelectElement>) => {\n            editor.update(() => {\n                if (selectedElementKey !== null) {\n                    const node = $getNodeByKey(selectedElementKey);\n                    if ($isCodeNode(node)) {\n                        node.setLanguage(e.target.value);\n                    }\n                }\n            });\n        },\n        [editor, selectedElementKey]\n    );\n\n    const insertLink = useCallback(() => {\n        if (!isLink) {\n            editor.dispatchCommand(TOGGLE_LINK_COMMAND, \"https://\");\n        } else {\n            editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n        }\n    }, [editor, isLink]);\n\n    const [portalContainer, setPortalContainer] = useState<HTMLDivElement | null>(null);\n    useEffect(() => {\n        const container = document.getElementById(\"room-wrapper\");\n        const portalContainer = document.createElement('div');\n        container?.prepend(portalContainer)\n        setPortalContainer(portalContainer)\n        return () => {\n            container?.removeChild(portalContainer)\n        }\n    }, [])\n\n    return (\n        <div className=\"toolbar\" ref={toolbarRef}>\n            <button\n                disabled={!canUndo}\n                onClick={() => {\n                    editor.dispatchCommand(UNDO_COMMAND, undefined);\n                }}\n                className=\"toolbar-item spaced\"\n                aria-label=\"Undo\"\n            >\n                <Undo className=\"format\" size={20} />\n            </button>\n            <button\n                disabled={!canRedo}\n                onClick={() => {\n                    editor.dispatchCommand(REDO_COMMAND, undefined);\n                }}\n                className=\"toolbar-item\"\n                aria-label=\"Redo\"\n            >\n                <Redo className=\"format\" size={20} />\n            </button>\n            <Divider />\n            {supportedBlockTypes.has(blockType) && (\n                <>\n                    <button\n                        className=\"toolbar-item block-controls\"\n                        onClick={() =>\n                            setShowBlockOptionsDropDown(!showBlockOptionsDropDown)\n                        }\n                        aria-label=\"Formatting Options\"\n                    >\n                        {\n                            blockType === \"h1\" ?\n                                <Heading1 className=\"icon\" size={20} /> :\n                                blockType === \"h2\" ?\n                                    <Heading2 className=\"icon\" size={20} /> :\n                                    blockType === \"h3\" ?\n                                        <Heading3 className=\"icon\" size={20} /> :\n                                        blockType === \"h4\" ?\n                                            <Heading4 className=\"icon\" size={20} /> :\n                                            blockType === \"h5\" ?\n                                                <Heading5 className=\"icon\" size={20} /> :\n                                                blockType === \"code\" ?\n                                                    <Code className=\"icon\" size={20} /> :\n                                                    blockType === \"custom-paragraph\" ?\n                                                        <Text className=\"icon\" size={20} /> :\n                                                        blockType === \"ol\" ?\n                                                            <ListOrdered className=\"icon\" size={20} /> :\n                                                            blockType === \"ul\" ?\n                                                                <List className=\"icon\" size={20} /> :\n                                                                blockType === \"quote\" ?\n                                                                    <Quote className=\"icon\" size={20} /> :\n                                                                    <></>\n                        }\n                        <span className=\"text\">{blockTypeToBlockName[blockType]}</span>\n                        <ChevronDown size={20} />\n                    </button>\n                    {showBlockOptionsDropDown &&\n                        createPortal(\n                            <BlockOptionsDropdownList\n                                editor={editor}\n                                blockType={blockType}\n                                toolbarRef={toolbarRef}\n                                setShowBlockOptionsDropDown={setShowBlockOptionsDropDown}\n                            />,\n                            portalContainer!!\n                        )}\n                    <Divider />\n                </>\n            )}\n            {blockType === \"code\" ? (\n                <>\n                    <Select\n                        className=\"toolbar-item code-language\"\n                        onChange={onCodeLanguageSelect}\n                        options={codeLanguges}\n                        value={codeLanguage}\n                    />\n                    <i className=\"chevron-down inside\" />\n                </>\n            ) : (\n                <>\n                    <button\n                        onClick={() => {\n                            editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"bold\");\n                        }}\n                        className={\"toolbar-item spaced \" + (isBold ? \"active\" : \"\")}\n                        aria-label=\"Format Bold\"\n                    >\n                        <Bold className=\"format\" size={20} />\n                    </button>\n                    <button\n                        onClick={() => {\n                            editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"italic\");\n                        }}\n                        className={\"toolbar-item spaced \" + (isItalic ? \"active\" : \"\")}\n                        aria-label=\"Format Italics\"\n                    >\n                        <Italic className=\"format\" size={20} />\n                    </button>\n                    <button\n                        onClick={() => {\n                            editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"underline\");\n                        }}\n                        className={\"toolbar-item spaced \" + (isUnderline ? \"active\" : \"\")}\n                        aria-label=\"Format Underline\"\n                    >\n                        <Underline className=\"format\" size={20} />\n                    </button>\n                    <button\n                        onClick={() => {\n                            editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"strikethrough\");\n                        }}\n                        className={\n                            \"toolbar-item spaced \" + (isStrikethrough ? \"active\" : \"\")\n                        }\n                        aria-label=\"Format Strikethrough\"\n                    >\n                        <Strikethrough className=\"format\" size={20} />\n                    </button>\n                    <button\n                        onClick={() => {\n                            editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"code\");\n                        }}\n                        className={\"toolbar-item spaced \" + (isCode ? \"active\" : \"\")}\n                        aria-label=\"Insert Code\"\n                    >\n                        <Code className=\"format\" size={20} />\n                    </button>\n                    <button\n                        onClick={insertLink}\n                        className={\"toolbar-item spaced \" + (isLink ? \"active\" : \"\")}\n                        aria-label=\"Insert Link\"\n                    >\n                        <Link className=\"format\" size={20} />\n                    </button>\n                    {isLink &&\n                        createPortal(<FloatingLinkEditor editor={editor} />, document.body)}\n                    {\" \"}\n                </>\n            )}\n        </div>\n    );\n})\n\nexport default ToolbarPlugin;","import { registerCodeHighlighting } from \"@lexical/code\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport { useEffect } from \"react\";\n\nexport default function CodeHighlightPlugin() {\n    const [editor] = useLexicalComposerContext();\n    useEffect(() => {\n        return registerCodeHighlighting(editor);\n    }, [editor]);\n    return null;\n}\n","const editorTheme = {\n    ltr: \"ltr\",\n    rtl: \"rtl\",\n    placeholder: \"editor-placeholder\",\n    paragraph: \"editor-paragraph\",\n    quote: \"editor-quote\",\n    heading: {\n        h1: \"editor-heading-h1\",\n        h2: \"editor-heading-h2\",\n        h3: \"editor-heading-h3\",\n        h4: \"editor-heading-h4\",\n        h5: \"editor-heading-h5\"\n    },\n    list: {\n        nested: {\n            listitem: \"editor-nested-listitem\"\n        },\n        ol: \"editor-list-ol\",\n        ul: \"editor-list-ul\",\n        listitem: \"editor-listitem\"\n    },\n    image: \"editor-image\",\n    link: \"editor-link\",\n    text: {\n        bold: \"editor-text-bold\",\n        italic: \"editor-text-italic\",\n        overflowed: \"editor-text-overflowed\",\n        hashtag: \"editor-text-hashtag\",\n        underline: \"editor-text-underline\",\n        strikethrough: \"editor-text-strikethrough\",\n        underlineStrikethrough: \"editor-text-underlineStrikethrough\",\n        code: \"editor-text-code\"\n    },\n    code: \"editor-code\",\n    codeHighlight: {\n        atrule: \"editor-tokenAttr\",\n        attr: \"editor-tokenAttr\",\n        boolean: \"editor-tokenProperty\",\n        builtin: \"editor-tokenSelector\",\n        cdata: \"editor-tokenComment\",\n        char: \"editor-tokenSelector\",\n        class: \"editor-tokenFunction\",\n        \"class-name\": \"editor-tokenFunction\",\n        comment: \"editor-tokenComment\",\n        constant: \"editor-tokenProperty\",\n        deleted: \"editor-tokenProperty\",\n        doctype: \"editor-tokenComment\",\n        entity: \"editor-tokenOperator\",\n        function: \"editor-tokenFunction\",\n        important: \"editor-tokenVariable\",\n        inserted: \"editor-tokenSelector\",\n        keyword: \"editor-tokenAttr\",\n        namespace: \"editor-tokenVariable\",\n        number: \"editor-tokenProperty\",\n        operator: \"editor-tokenOperator\",\n        prolog: \"editor-tokenComment\",\n        property: \"editor-tokenProperty\",\n        punctuation: \"editor-tokenPunctuation\",\n        regex: \"editor-tokenVariable\",\n        selector: \"editor-tokenSelector\",\n        string: \"editor-tokenSelector\",\n        symbol: \"editor-tokenProperty\",\n        tag: \"editor-tokenProperty\",\n        url: \"editor-tokenOperator\",\n        variable: \"editor-tokenVariable\"\n    }\n};\n\nexport default editorTheme;\n","\nimport { $generateHtmlFromNodes, } from '@lexical/html';\nimport { InitialConfigType, LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { HeadingNode, QuoteNode } from \"@lexical/rich-text\";\nimport { TableCellNode, TableNode, TableRowNode } from \"@lexical/table\";\nimport { ListItemNode, ListNode } from \"@lexical/list\";\nimport { CodeHighlightNode, CodeNode } from \"@lexical/code\";\nimport { AutoLinkNode, LinkNode } from \"@lexical/link\";\nimport { MarkdownShortcutPlugin } from \"@lexical/react/LexicalMarkdownShortcutPlugin\";\nimport { ClearEditorPlugin } from \"@lexical/react/LexicalClearEditorPlugin\";\nimport { TRANSFORMERS, $convertToMarkdownString } from \"@lexical/markdown\";\n\nimport AutoLinkPlugin from \"./plugins/AutoLinkPlugin\";\nimport ToolbarPlugin from \"./plugins/ToolbarPlugin\";\n//import TreeViewPlugin from \"./plugins/DebugPlugin\";\nimport { CustomParagraphNode } from './customNodes/CustomParagraphNode';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport EditorTheme from './theme';\n\nimport './input.scss';\nimport { FC, memo, useCallback, useEffect, useState } from 'react';\nimport { Send } from 'lucide-react';\nimport { useRoom } from '../../../app/sdk/client';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getSelection, $isRangeSelection, CLEAR_EDITOR_COMMAND, CLEAR_HISTORY_COMMAND, COMMAND_PRIORITY_CRITICAL, INSERT_PARAGRAPH_COMMAND, KEY_ENTER_COMMAND, ParagraphNode } from 'lexical';\nimport { useLocation } from 'react-router-dom';\n\nexport const CAN_USE_DOM: boolean =\n    typeof window !== 'undefined' &&\n    typeof window.document !== 'undefined' &&\n    typeof window.document.createElement !== 'undefined';\n\n\ndeclare global {\n    interface Document {\n        documentMode?: unknown;\n    }\n\n    interface Window {\n        MSStream?: unknown;\n    }\n}\n\nconst documentMode =\n    CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n    CAN_USE_DOM && 'InputEvent' in window && !documentMode\n        ? 'getTargetRanges' in new window.InputEvent('input')\n        : false;\n\nexport const IS_SAFARI: boolean =\n    CAN_USE_DOM && /Version\\/[\\d.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n    CAN_USE_DOM &&\n    /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n    !window.MSStream;\n\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\nexport const IS_CHROME: boolean =\n    CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n\nexport const IS_APPLE_WEBKIT =\n    CAN_USE_DOM && /AppleWebKit\\/[\\d.]+/.test(navigator.userAgent) && !IS_CHROME;\n\ntype ChatInputProps = {\n    /**\n     * The Namespace\n     */\n    namespace: string\n    /**\n     * The current Room\n     */\n    roomID?: string\n};\n\nfunction Placeholder() {\n    return <div className=\"editor-placeholder\" id=\"editor-placeholder\">Enter message...</div>;\n}\n\ntype SendButtonProps = {\n    /**\n     * The current Room\n     */\n    roomID?: string\n    /**\n     * Callback when sending starts\n     */\n    onStartSending: () => void\n    /**\n     * Callback when sending stops\n     */\n    onStopSending: () => void\n};\n\nconst SendButton: FC<SendButtonProps> = memo(({ roomID, onStartSending, onStopSending }: SendButtonProps) => {\n    const room = useRoom(roomID || \"\");\n    const [editor] = useLexicalComposerContext();\n\n    const sendMessage = useCallback(() => {\n        // TODO: Sanitize the html and send message to room\n        if (!room) {\n            return;\n        }\n\n        editor.getEditorState().read(() => {\n            let htmlMessage = $generateHtmlFromNodes(editor);\n            // TODO: Make sure that we strip any non matrix stuff\n            const codeRegex = /(?<all><code .* (?:data-highlight-language=\"(?<language>.*?)\")(?: .*?)?>(?<code>[\\s\\S]*?)<\\/code>)/;\n            let matched = codeRegex.exec(htmlMessage);\n            while (matched !== null) {\n                if (matched) {\n                    const { groups } = matched;\n                    if (groups) {\n                        let { all, language, code } = groups;\n\n                        const spanRegex = /<span(?: class=\".*?\")?>(?<content>.*?)<\\/span>/;\n                        let matchedspans = spanRegex.exec(code);\n                        while (matchedspans !== null) {\n                            if (matchedspans) {\n                                const { groups } = matchedspans;\n                                if (groups) {\n                                    const { content } = groups;\n\n                                    code = code.replaceAll(matchedspans[0], content)\n                                }\n                            }\n                            matchedspans = spanRegex.exec(code)\n                        }\n\n                        code = code.replaceAll(\"<br>\", \"\\n\")\n                        htmlMessage = htmlMessage.replace(all, `<pre><code class=\"language-${language}\">${code}</code></pre>`)\n                    }\n                }\n                matched = codeRegex.exec(htmlMessage)\n            }\n            const plainMessage = $convertToMarkdownString(TRANSFORMERS);\n\n            console.log(htmlMessage)\n            // TODO: local echo\n            if ((htmlMessage === \"\" && plainMessage === \"\") || htmlMessage === '<p class=\"editor-paragraph\"><br></p>') {\n                return;\n            }\n            onStartSending();\n            console.log(\"Sending message to: \", roomID)\n\n            if (htmlMessage !== '<p class=\"editor-paragraph\"><br></p>') {\n                room.sendHtmlMessage(htmlMessage, plainMessage, () => {\n                    editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n                    editor.dispatchCommand(CLEAR_HISTORY_COMMAND, undefined);\n                    localStorage.removeItem(`editor-${roomID}`);\n                    onStopSending();\n                }).catch((e) => {\n                    console.log(e);\n                    onStopSending();\n                })\n            } else {\n                room.sendTextMessage(plainMessage, () => {\n                    editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n                    editor.dispatchCommand(CLEAR_HISTORY_COMMAND, undefined);\n                    localStorage.removeItem(`editor-${roomID}`);\n                    onStopSending();\n                }).catch((e) => {\n                    console.log(e);\n                    onStopSending();\n                })\n            }\n        })\n    }, [room, roomID, editor]);\n\n    useEffect(() => {\n        editor.registerCommand<KeyboardEvent | null>(\n            KEY_ENTER_COMMAND,\n            (event) => {\n                const selection = $getSelection();\n                if (!$isRangeSelection(selection)) {\n                    return false;\n                }\n                if (event !== null) {\n                    // If we have beforeinput, then we can avoid blocking\n                    // the default behavior. This ensures that the iOS can\n                    // intercept that we're actually inserting a paragraph,\n                    // and autocomplete, autocapitalize etc work as intended.\n                    // This can also cause a strange performance issue in\n                    // Safari, where there is a noticeable pause due to\n                    // preventing the key down of enter.\n                    if (\n                        (IS_IOS || IS_SAFARI || IS_APPLE_WEBKIT) &&\n                        CAN_USE_BEFORE_INPUT\n                    ) {\n                        return false;\n                    }\n                    event.preventDefault();\n                    if (event.shiftKey) {\n                        return editor.dispatchCommand(INSERT_PARAGRAPH_COMMAND, undefined);\n                    }\n                }\n                sendMessage();\n                return editor.dispatchCommand(INSERT_PARAGRAPH_COMMAND, undefined);\n            },\n            COMMAND_PRIORITY_CRITICAL,\n        )\n    }, [editor])\n\n    return <Send\n        size={45}\n        stroke='unset'\n        className='stroke-slate-600 rounded m-4 hover:bg-slate-300 hover:stroke-slate-500 p-2 cursor-pointer'\n        onClick={sendMessage} />\n});\n\n\ntype RoomChangeProps = {\n    /**\n     * The current Room\n     */\n    roomID?: string\n};\n\nconst RoomChangePlugin: FC<RoomChangeProps> = ({ roomID }) => {\n    const [editor] = useLexicalComposerContext();\n    const { pathname } = useLocation();\n    const [prevRoom, setPrevRoom] = useState<string | undefined>(undefined);\n\n    useEffect(() => {\n        if (roomID) {\n            if (roomID !== prevRoom) {\n                console.log(\"Saving editor state\")\n                // Save the editor state to local storage\n                const editorState = editor.getEditorState();\n                localStorage.setItem(`editor-${prevRoom}`, JSON.stringify(editorState.toJSON()));\n            }\n            setPrevRoom(roomID);\n            const savedHtml = localStorage.getItem(`editor-${roomID}`);\n            if (savedHtml) {\n                const initialEditorState = editor.parseEditorState(savedHtml)\n                editor.setEditorState(initialEditorState)\n            } else {\n                editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n                editor.dispatchCommand(CLEAR_HISTORY_COMMAND, undefined);\n            }\n        }\n    }, [pathname, roomID]);\n\n    return <></>\n}\n\nconst ChatInput: FC<ChatInputProps> = memo(({ namespace, roomID }: ChatInputProps) => {\n    const [sending, setSending] = useState(false);\n\n    const initialConfig: InitialConfigType = {\n        namespace: namespace,\n        theme: EditorTheme,\n        onError: (e) => console.error(e),\n        editable: !sending,\n        nodes: [\n            HeadingNode,\n            ListNode,\n            ListItemNode,\n            QuoteNode,\n            CodeNode,\n            CodeHighlightNode,\n            TableNode,\n            TableCellNode,\n            TableRowNode,\n            AutoLinkNode,\n            LinkNode,\n            CustomParagraphNode,\n            {\n                replace: ParagraphNode,\n                with: (_node: ParagraphNode) => {\n                    return new CustomParagraphNode();\n                }\n            }\n        ]\n    }\n    return (\n        <div className='flex flex-row items-end'>\n            <LexicalComposer initialConfig={initialConfig}>\n                <div className=\"editor-container flex-1\">\n                    <ToolbarPlugin />\n                    <div className=\"editor-inner\">\n                        <RichTextPlugin\n                            contentEditable={<ContentEditable className=\"editor-input\" ariaLabelledBy='editor-placeholder' />}\n                            placeholder={<Placeholder />}\n                            ErrorBoundary={LexicalErrorBoundary}\n                        />\n                        <HistoryPlugin />\n                        <LinkPlugin />\n                        <CodeHighlightPlugin />\n                        <AutoLinkPlugin />\n                        <MarkdownShortcutPlugin transformers={TRANSFORMERS} />\n                        <ClearEditorPlugin />\n                        <RoomChangePlugin roomID={roomID} />\n                        {/*<TreeViewPlugin />*/}\n                    </div>\n                </div>\n                <SendButton roomID={roomID} onStartSending={() => { console.log(\"Sending\"); setSending(true) }} onStopSending={() => { setSending(false) }} />\n            </LexicalComposer>\n\n        </div>\n    );\n})\n\nexport default ChatInput;","import { useInView } from \"react-intersection-observer\";\nimport Avatar from \"../../avatar/avatar\";\nimport { FC, memo, useContext } from \"react\";\nimport { MatrixContext } from \"../../../app/sdk/client\";\nimport { OnlineState } from \"../../../app/sdk/api/otherEnums\";\n\ntype RoomListItemProps = {\n    /**\n     * Room id\n     */\n    roomId: string\n    /**\n     * The URL of the Avatar image\n     */\n    avatarUrl?: string\n    /**\n     * The displayname of the room list item\n     */\n    displayname: string\n    /**\n     * Wether it is a DM or not\n     */\n    dm: boolean\n    /**\n     * Wether the user is online. Only used if dm is true.\n     */\n    online: OnlineState\n    /**\n     * Wether the current room is selected\n     */\n    active: boolean\n    /**\n     * The onClick handler\n     */\n    onClick: () => void;\n    /**\n     * If room is hidden\n     */\n    hidden: boolean\n};\n\nconst RoomListItem: FC<RoomListItemProps> = memo(({ roomId, avatarUrl, displayname, dm = false, online = OnlineState.Unknown, active = false, onClick, hidden }: RoomListItemProps) => {\n    const matrixClient = useContext(MatrixContext);\n    const { ref, inView } = useInView({\n        triggerOnce: true,\n        skip: hidden,\n        threshold: 1,\n        onChange(inView) {\n            if (inView) {\n                matrixClient.addInViewRoom(roomId)\n            } else {\n                matrixClient.removeInViewRoom(roomId)\n            }\n        },\n    });\n    return (\n        <div ref={ref} onClick={onClick} className=\"w-full cursor-pointer\">\n            {\n                inView && (active ? (\n                    <div className=\"flex flex-row gap-2 p-1 bg-gray-300 hover:bg-gray-400 rounded-lg duration-200 ease-in-out items-center\">\n                        <Avatar avatarUrl={avatarUrl} displayname={displayname} dm={dm} online={online} />\n                        <span title={displayname} className='text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap'>{displayname}</span>\n                    </div>\n                ) : (\n                    <div className=\"flex flex-row gap-2 p-1 hover:bg-gray-300 rounded-lg duration-200 ease-in-out items-center\">\n                        <Avatar avatarUrl={avatarUrl} displayname={displayname} dm={dm} online={online} />\n                        <span title={displayname} className='text-slate-900 font-normal text-base max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap'>{displayname}</span>\n                    </div>\n                ))\n            }\n        </div>\n    );\n})\n\nexport default RoomListItem","import { FC, memo, useContext, useEffect, useState } from \"react\";\nimport RoomListItem from \"./roomListItem/roomListItem\";\nimport { ChevronDown, ChevronRight } from \"lucide-react\";\nimport './roomList.scss';\nimport { useNavigate } from \"react-router-dom\";\nimport { MatrixContext } from \"../../app/sdk/client\";\nimport { useInView } from \"react-intersection-observer\";\nimport { OnlineState } from \"../../app/sdk/api/otherEnums\";\n\ntype Room = {\n    /**\n     * The URL of the Avatar image\n     */\n    avatarUrl?: string\n    /**\n     * The displayname of the room list item\n     */\n    displayname: string\n    /**\n     * Wether it is a DM or not\n     */\n    dm: boolean\n    /**\n     * Wether the user is online. Only used if dm is true.\n     */\n    online: OnlineState\n    /**\n     * The roomid of the Room\n     */\n    roomID: string\n};\n\nexport type Section = {\n    /**\n     * Section Name. Can be a Space or a Tag\n     */\n    sectionName: string\n    /**\n     * The Rooms within the Section\n     */\n    rooms: Room[]\n    /**\n     * The Subsections of the Section\n     */\n    subsections: Section[]\n    /**\n     * The roomid of the Space\n     */\n    roomID: string\n}\n\ntype RoomListProps = {\n    /**\n     * The Sections available\n     */\n    sections: Section[]\n    /**\n     * Rooms outside of any Sections\n     */\n    rooms: Room[]\n    /**\n     * Rooms outside of any Sections and DM\n     */\n    dmRooms: Room[]\n};\n\ntype RoomListRoomsProps = {\n    /**\n     * The roomid of the Space\n     */\n    sectionID: string\n    /**\n     * Rooms\n     */\n    rooms: Room[]\n    /**\n     * The onClick handler\n     */\n    onClick: (roomID: string) => void;\n    /**\n     * The activeRoom\n     */\n    activeRoom?: string;\n    /**\n     * If rooms are hidden\n     */\n    hidden: boolean\n};\n\nconst RoomListRooms: FC<RoomListRoomsProps> = memo(({ sectionID, rooms, onClick, activeRoom, hidden }: RoomListRoomsProps) => {\n    // Get room ids of rooms\n    const roomsRendered = rooms.map(room => {\n        return (\n            <RoomListItem\n                roomId={room.roomID}\n                hidden={hidden}\n                key={`${room.roomID}+${sectionID}`}\n                avatarUrl={room.avatarUrl}\n                displayname={room.displayname}\n                dm={room.dm}\n                online={room.online}\n                active={room.roomID === activeRoom}\n                onClick={() => { onClick(room.roomID) }}\n            />\n        );\n    });\n    return (\n        <>\n            {roomsRendered}\n        </>\n    );\n})\n\nconst RoomSection: FC<{ section: Section, onRoomClick: (roomID: string) => void, activeRoom: string | undefined }> = memo(({ section, onRoomClick, activeRoom }: { section: Section, onRoomClick: (roomID: string) => void, activeRoom: string | undefined }) => {\n    const [hidden, setHidden] = useState<boolean>(true);\n    const matrixClient = useContext(MatrixContext);\n    const { ref, inView } = useInView({\n        triggerOnce: true,\n        threshold: 1,\n        onChange(inView) {\n            if (section.roomID !== \"other\") {\n                if (inView) {\n                    matrixClient.addInViewRoom(section.roomID)\n                } else {\n                    matrixClient.removeInViewRoom(section.roomID)\n                }\n            }\n        },\n    });\n    useEffect(() => {\n        if (hidden) {\n            matrixClient.removeSpaceOpen(section.roomID);\n        } else {\n            matrixClient.addSpaceOpen(section.roomID);\n        }\n    }, [hidden])\n    return (\n        <div ref={ref} key={section.roomID} className=\"flex flex-col gap-1 pl-4 select-none\">\n            {\n                inView && <div className=\"flex flex-row gap-2 py-1 items-center justify-start cursor-pointer h-8 text-slate-600\" onClick={() => setHidden(prev => !prev)}>\n                    {hidden ? <ChevronRight size={14} /> : <ChevronDown size={14} />}\n                    <span className='font-normal text-base capitalize max-w-[32ch] overflow-hidden text-ellipsis w-full whitespace-nowrap'>{section.sectionName}</span>\n                </div >}\n            {!hidden && inView && (<RoomListRooms\n                hidden={hidden}\n                sectionID={section.roomID}\n                rooms={section.rooms}\n                onClick={onRoomClick}\n                activeRoom={activeRoom}\n            />)}\n            {!hidden && inView && (\n                section.subsections.map(section => {\n                    return (\n                        <RoomSection\n                            key={section.roomID}\n                            section={section}\n                            onRoomClick={onRoomClick}\n                            activeRoom={activeRoom}\n                        />\n                    );\n                })\n            )}\n        </div>\n    );\n})\n\nconst RoomList: FC<RoomListProps> = memo(({ sections, rooms, dmRooms }: RoomListProps) => {\n    const [activeRoom, setActiveRoom] = useState<string | undefined>(undefined);\n    const navigate = useNavigate();\n\n    return (\n        <div className=\"flex flex-col gap-1 flex-1 p-2 min-w-[30ch] overflow-y-auto overflow-x-hidden scrollbarSmall max-w-[33ch]\">\n            <RoomSection\n                section={{\n                    sectionName: \"DMs\",\n                    roomID: \"dms\",\n                    subsections: [],\n                    rooms: dmRooms\n                }}\n                onRoomClick={(roomID: string) => {\n                    setActiveRoom(roomID);\n                    navigate(`/${encodeURIComponent(roomID)}`);\n                }}\n                activeRoom={activeRoom}\n            />\n            {\n                sections.map(section => {\n                    return (\n                        <RoomSection\n                            key={section.roomID}\n                            section={section}\n                            onRoomClick={(roomID: string) => {\n                                setActiveRoom(roomID);\n                                navigate(`/${encodeURIComponent(roomID)}`);\n                            }}\n                            activeRoom={activeRoom}\n                        />\n                    );\n                })\n            }\n            <RoomSection\n                section={{\n                    sectionName: \"Others\",\n                    roomID: \"other\",\n                    subsections: [],\n                    rooms: rooms\n                }}\n                onRoomClick={(roomID: string) => {\n                    setActiveRoom(roomID);\n                    navigate(`/${encodeURIComponent(roomID)}`);\n                }}\n                activeRoom={activeRoom}\n            />\n\n        </div>\n    );\n})\n\nexport default RoomList","import { Meta } from \"@storybook/addon-docs\";\n\n<Meta title=\"Introduction/Welcome\" />\n\n# About Cetirizine\n\nWelcome to the Cetirizine Design System!\n\nThis storybook design system describes in depth the components used within the\nCetirizine Matrix Client.\n\nThe Design heavily leans on the Tailwindcss Design System. However there are speciic\ncomponents for some things and Pages are also documented.\n","import { memo, useContext, useState } from 'react';\nimport Button from '../button/button';\nimport Header from '../header/header';\nimport Input from '../input/basic/input';\nimport { Navigate } from 'react-router-dom';\nimport { MatrixContext } from '../../app/sdk/client';\n\nconst Login = memo(() => {\n    const matrixClient = useContext(MatrixContext);\n    const [loginPending, setLoginPending] = useState(false);\n    const [loginError, setLoginError] = useState('');\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    if (matrixClient.isLoggedIn) {\n        return <Navigate to=\"/\" />;\n    }\n    const startLogin = async () => {\n        try {\n            setLoginPending(true);\n            await matrixClient.passwordLogin(username, password);\n        } catch (e: any) {\n            setLoginError(e.toString());\n        }\n        setLoginPending(false);\n    }\n    return (\n        <form className=\"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]\" onSubmit={(e) => {\n            e.preventDefault();\n            startLogin();\n        }}>\n            <Header>Login</Header>\n            {loginError ? <h2 className='text-red-500 font-normal text-sm'>{loginError}</h2> : <div className='min-h-[1.25rem]'></div>}\n            <Input\n                readonly={loginPending}\n                value={username}\n                placeholder=\"Username\"\n                onChange={e => setUsername(e.target.value)}\n            />\n            <Input\n                readonly={loginPending}\n                value={password}\n                password={true}\n                placeholder=\"Password\"\n                onChange={e => setPassword(e.target.value)}\n            />\n            <Button\n                readonly={loginPending}\n                style=\"primary\"\n                type=\"submit\"\n            >\n                Login\n            </Button>\n        </form>\n    );\n})\n\nexport default Login;","import './LoginPage.scss';\nimport Login from '../components/login/login';\nimport { memo, useContext, useEffect, useState } from 'react';\nimport { MatrixContext } from '../app/sdk/client';\n\nconst LoginPage = memo(() => {\n    const matrixClient = useContext(MatrixContext);\n    const [loading, setLoading] = useState(true)\n\n    useEffect(() => {\n        if (loading) {\n            // Ensure logout worked\n            matrixClient.logout().then(() => {\n                setLoading(false)\n            });\n        }\n    }, [loading, matrixClient])\n\n    if (loading) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-screen bg-img\">\n                <div className=\"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]\">\n                    <h1 className=\"text-2xl font-bold text-center\">Loading...</h1>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen bg-img\">\n            <Login />\n        </div>\n    );\n})\n\nexport default LoginPage;\n","import { Settings } from 'lucide-react';\nimport Avatar from '../components/avatar/avatar';\nimport ChatInput from '../components/input/chat/input';\nimport RoomList, { Section } from '../components/roomList/roomList';\nimport './MainPage.scss';\nimport { useProfile, useRoom, useRooms, useSpaces } from '../app/sdk/client';\nimport { Room, useEvents } from '../app/sdk/room';\nimport { FC, memo, useContext, useEffect, useRef, useState } from 'react';\nimport { MatrixContext } from '../app/sdk/client';\nimport { useLocation, useParams } from 'react-router-dom';\nimport MessageEvent from '../components/events/messageEvent';\nimport UnknownEvent, { RedactedEvent, UndecryptableEvent } from '../components/events/unknownEvent';\nimport MemberEvent from '../components/events/memberEvent';\nimport { IRoomEvent, IRoomMemberEvent } from '../app/sdk/api/events';\nimport Linkify from 'linkify-react';\nimport { OnlineState } from '../app/sdk/api/otherEnums';\n\ntype ChatViewProps = {\n    /**\n     * The roomID of the room to display\n     * If the roomID is empty, the ChatView will be empty\n     * If the roomID is invalid, the ChatView will be empty\n     * If the roomID is valid, the ChatView will display the room\n     * If the roomID is valid, but the room is not joined, the ChatView will display a placeholder\n     * If the roomID is valid, but the room is not loaded, the ChatView will display a placeholder\n     */\n    roomID?: string\n    /**\n     * Ref of the Scroll Container\n     */\n    scrollRef: React.RefObject<HTMLDivElement>\n};\n\nconst ChatView: FC<ChatViewProps> = memo(({ roomID, scrollRef }) => {\n    const room = useRoom(decodeURIComponent(roomID || \"\"));\n    const client = useContext(MatrixContext);\n    const events = useEvents(room);\n    const { pathname } = useLocation();\n    const [renderedEvents, setRenderedEvents] = useState<JSX.Element[]>([]);\n\n    // Map events to components but also tell components if the previous event was from the same sender and which type it was\n    const renderEvents = (events: IRoomEvent[]) => {\n        const dedupedEvents = events?.filter((event, index, self) => {\n            return self.findIndex(e => e.event_id === event.event_id) === index;\n        }).sort((a, b) => {\n            return a.origin_server_ts - b.origin_server_ts;\n        })\n        const no_relations = dedupedEvents.filter(event => event.type !== \"m.reaction\" &&\n            event.type !== \"m.room.redaction\" &&\n            event.content[\"m.relates_to\"]?.[\"rel_type\"] !== \"m.replace\"\n        );\n\n\n        Promise.all(no_relations?.map(async (event, index) => {\n            let previousEvent = no_relations?.[index - 1];\n            const previousEventIsFromSameSender = previousEvent?.sender === event.sender;\n            let previousEventType = previousEvent?.type;\n\n            // Make a list of events which are reactions for the current event we want to render\n            const reactions = dedupedEvents?.filter((e) => {\n                return e.type === \"m.reaction\" && e.content[\"m.relates_to\"].event_id === event.event_id;\n            });\n\n            // Check if event is redacted\n            const redaction = dedupedEvents?.find((e) => {\n                return e.type === \"m.room.redaction\" && e.redacts === event.event_id;\n            });\n            const redacted = redaction !== undefined;\n            let redacted_because = undefined;\n            let redaction_id = undefined;\n            if (redacted) {\n                redaction_id = redaction?.event_id;\n                if (redaction.content.reason) {\n                    redacted_because = redaction.content.reason;\n                }\n            }\n\n            // Check if there is an edit (m.relates_to with rel_type of \"m.replace\")\n            const edit = dedupedEvents?.find((e) => {\n                if (!e.content[\"m.relates_to\"]) {\n                    return false;\n                }\n                return e.content[\"m.relates_to\"].rel_type === \"m.replace\" && e.content[\"m.relates_to\"].event_id === event.event_id;\n            });\n\n            // If there is an edit, use the edited event instead of the original event\n            if (edit) {\n                event = edit;\n                if (edit.content[\"m.new_content\"]) {\n                    event.content.body = edit.content[\"m.new_content\"].body;\n                    event.content.formatted_body = edit.content[\"m.new_content\"].formatted_body;\n                    event.content.format = edit.content[\"m.new_content\"].format;\n                }\n            }\n\n\n            // Decrypt the event if it is encrypte\n            if (event.type === \"m.room.encrypted\" && roomID) {\n                try {\n                    const decrypted_event = await client.decryptRoomEvent(roomID, event);\n                    if (decrypted_event) {\n                        event = JSON.parse(decrypted_event.event) as IRoomEvent;\n                        if (event.content[\"m.new_content\"]) {\n                            event.content.body = event.content[\"m.new_content\"].body;\n                            event.content.formatted_body = event.content[\"m.new_content\"].formatted_body;\n                            event.content.format = event.content[\"m.new_content\"].format;\n                        }\n                    } else {\n                        if (redacted) {\n                            return (<RedactedEvent event={event} redacted_because={redacted_because} key={redaction_id} roomID={roomID} hasPreviousEvent={previousEventIsFromSameSender} />)\n                        }\n                        return (<UndecryptableEvent key={event.event_id} event={event} hasPreviousEvent={previousEventIsFromSameSender} roomID={roomID}></UndecryptableEvent>)\n                    }\n                } catch (e: any) {\n                    console.error(e);\n                    if (redacted) {\n                        return (<RedactedEvent event={event} redacted_because={redacted_because} key={redaction_id} roomID={roomID} hasPreviousEvent={previousEventIsFromSameSender} />)\n                    }\n                    return (<UndecryptableEvent key={event.event_id} event={event} hasPreviousEvent={previousEventIsFromSameSender} roomID={roomID}></UndecryptableEvent>)\n                }\n            }\n\n            // Decrypt previousEvent if it is encrypted\n            if (previousEvent?.type === \"m.room.encrypted\" && roomID) {\n                try {\n                    const decrypted_event = await client.decryptRoomEvent(roomID, event);\n                    if (decrypted_event) {\n                        previousEvent = JSON.parse(decrypted_event.event) as IRoomEvent;\n                        previousEventType = previousEvent.type;\n                        if (previousEvent.content[\"m.new_content\"]) {\n                            previousEvent.content.body = previousEvent.content[\"m.new_content\"].body;\n                            previousEvent.content.formatted_body = previousEvent.content[\"m.new_content\"].formatted_body;\n                            previousEvent.content.format = previousEvent.content[\"m.new_content\"].format;\n                        }\n                    }\n                } catch (e: any) {\n                    console.error(e);\n                }\n            }\n\n            return renderEvent(event, previousEventIsFromSameSender, previousEventType, reactions, redacted, redacted_because, redaction_id);\n        })).then((renderedEvents) => {\n            setRenderedEvents(renderedEvents);\n        });\n    }\n\n    useEffect(() => {\n        if (events) {\n            renderEvents(events);\n        }\n    }, [events]);\n\n    useEffect(() => {\n        scrollRef.current?.scrollTo(0, scrollRef.current?.scrollHeight);\n    }, [pathname]);\n\n    // Render events based on the event type and content\n    const renderEvent = (event: IRoomEvent, previousEventIsFromSameSender: boolean, previousEventType: string, reactions: IRoomEvent[], redacted: boolean, redacted_because: string, redaction_id?: string) => {\n        if (redacted) {\n            return (<RedactedEvent event={event} redacted_because={redacted_because} roomID={roomID} hasPreviousEvent={previousEventIsFromSameSender} key={redaction_id} />)\n        }\n        switch (event.type) {\n            case \"m.room.message\":\n                return <MessageEvent reactions={reactions} event={event} roomID={roomID} key={event.event_id} hasPreviousEvent={previousEventIsFromSameSender && previousEventType === \"m.room.message\"} />\n            case \"m.room.member\":\n                return <MemberEvent event={event as IRoomMemberEvent} key={event.event_id} />\n            default:\n                return <UnknownEvent event={event} key={event.event_id} />\n        }\n    }\n\n    return <div className='max-w-[130ch] flex flex-col'>{renderedEvents}</div>;\n});\n\n\nconst MainPage = memo(() => {\n    const profile = useProfile();\n    const spacesWithRooms = useSpaces();\n    const rooms = useRooms();\n    const client = useContext(MatrixContext);\n    let params = useParams();\n    const room = useRoom(decodeURIComponent(params.roomIdOrAlias || \"\"));\n    client.setCurrentRoom(params.roomIdOrAlias ? decodeURIComponent(params.roomIdOrAlias) : undefined)\n\n    const scrollRef = useRef<HTMLDivElement>(null);\n\n    // Filter toplevel spaces.\n    // A toplevel space is a space that is not a child of another space.\n    // We can not rely only on the parent. We need to check in both directions.\n    const toplevelSpaces = [...spacesWithRooms].filter(({ spaceRoom }) => {\n        const not_tombstoned = !spaceRoom.isTombstoned();\n        const not_a_child = ![...spacesWithRooms].some(({ children: otherChildren }) => {\n            return [...otherChildren].some(room => room.roomID === spaceRoom.roomID);\n        });\n        // Also check if there are no parents set\n        const no_parents = spaceRoom.getSpaceParentIDs().length === 0;\n        return not_a_child && no_parents && not_tombstoned;\n    });\n\n    // Filter rooms which are not part of any space and are not a space.\n    // A room is not part of any space if it is not a child of any space.\n    // A room is not a space if it has not any space as parent.\n    const leftOverRooms = [...rooms].filter(room => {\n        const not_tombstoned = !room.isTombstoned();\n        const not_a_child = ![...spacesWithRooms].some(({ children }) => {\n            return [...children].some(otherRoom => otherRoom.roomID === room.roomID);\n        });\n        const no_parents = room.getSpaceParentIDs().length === 0;\n        const not_a_space = !room.isSpace();\n        return not_a_child && no_parents && not_a_space && not_tombstoned;\n    }).sort((a, b) => {\n        // Sort rooms by sliding sync list order of overview list,\n\n        // Get the index of the room in the sync list.\n        const a_index = a.windowPos[\"overview\"];\n        const b_index = b.windowPos[\"overview\"];\n\n        // If the room is not in the sync list, it will be at the end of the list.\n        // This is the same as the index being -1.\n        // So we need to check for that.\n        if (a_index === -1) {\n            return 1;\n        }\n        if (b_index === -1) {\n            return -1;\n        }\n\n        // If the room is in the sync list, we can compare the indexes.\n        return a_index - b_index;\n    });\n\n\n    // Generate a list of sections.\n    // Each section apart from special toplevel ones is a space.\n    // Each space has a list of rooms and subsections.\n    // Each subsection has a list of rooms and subsections.\n    // Subsections can nest infinitely.\n    // Rooms are always within a section.\n    // A section represents a space.\n    // If a room is not within a space it is in the toplevel section \"Other\" which is at the end of the list.\n    // The toplevel section \"Other\" is always present.\n    // The toplevel section \"Other\" is always the last section.\n    const sections = toplevelSpaces.map(space => {\n        const rooms = [...space.children].filter(room => !room.isSpace() && !room.isTombstoned() && !room.isDM()).sort((a, b) => {\n            // Sort rooms by sliding sync list order of the spaces list,\n\n            // Get the index of the room in the sync list.\n            const a_index = a.windowPos[space.spaceRoom.roomID];\n            const b_index = b.windowPos[space.spaceRoom.roomID];\n\n            // If the room is not in the sync list, it will be at the end of the list.\n            // This is the same as the index being -1.\n            // So we need to check for that.\n            if (a_index === -1) {\n                return 1;\n            }\n            if (b_index === -1) {\n                return -1;\n            }\n\n            // If the room is in the sync list, we can compare the indexes.\n            return a_index - b_index;\n        }).map(room => {\n            return {\n                roomID: room.roomID,\n                displayname: room.getName(),\n                avatarUrl: room.getAvatarURL(),\n                dm: room.isDM(),\n                online: room.presence,\n            }\n        });\n\n        const generateSubsections = (subspace: Room): Section | undefined => {\n            const subspaceMeta = [...spacesWithRooms].find(space => space.spaceRoom.roomID === subspace.roomID);\n            if (subspaceMeta) {\n                const rooms = [...subspaceMeta?.children].filter(room => !room.isSpace() && !room.isTombstoned() && !room.isDM()).map(room => {\n                    return {\n                        roomID: room.roomID,\n                        displayname: room.getName(),\n                        avatarUrl: room.getAvatarURL(),\n                        dm: room.isDM(),\n                        online: room.presence,\n                    }\n                });\n\n                return {\n                    sectionName: subspace.getName(),\n                    rooms: rooms,\n                    roomID: subspace.roomID,\n                    subsections: [...subspaceMeta?.children]\n                        .filter(room => room.isSpace() && !room.isTombstoned()).map(generateSubsections)\n                        .filter(section => section !== undefined) as Section[],\n                }\n            }\n        }\n\n        // Its a little weird sicne there are no children attached to the room object. Only to spacesWithRooms.\n        // Each subsection can have further subsections and rooms.\n        return {\n            sectionName: space.spaceRoom.getName(),\n            rooms: rooms,\n            roomID: space.spaceRoom.roomID,\n            subsections: [...space.children]\n                .filter(room => room.isSpace())\n                .map(generateSubsections),\n        } as Section;\n    });\n\n    // Add the toplevel section \"Other\" to the end of the list.\n    const otherRooms = leftOverRooms.filter(room => !room.isSpace() && !room.isDM()).map(room => {\n        return {\n            roomID: room.roomID,\n            displayname: room.getName(),\n            avatarUrl: room.getAvatarURL(),\n            dm: room.isDM(),\n            online: room.presence,\n        }\n    });\n\n    const dmRooms = leftOverRooms.filter(room => !room.isSpace() && room.isDM()).map(room => {\n        return {\n            roomID: room.roomID,\n            displayname: room.getName(),\n            avatarUrl: room.getAvatarURL(),\n            dm: room.isDM(),\n            online: room.presence,\n        }\n    });\n\n\n    // Check and print if otherRooms has duplicates.\n    const otherRoomsIDs = otherRooms.map(room => room.roomID);\n    const otherRoomsDuplicates = otherRoomsIDs.filter((id, index) => otherRoomsIDs.indexOf(id) !== index);\n    if (otherRoomsDuplicates.length > 0) {\n        console.error('otherRooms has duplicates', otherRoomsDuplicates);\n    }\n\n    const linkifyOptions = {\n        defaultProtocol: \"https\",\n        rel: \"noopener\",\n        target: \"_blank\",\n        className: \"text-blue-500 hover:text-blue-700 active:text-blue-700 visited:text-blue-500\"\n    }\n\n    return <div className='flex flex-row gap-2 min-h-screen h-screen'>\n        <div className='flex flex-col bg-gradient-to-br from-slate-100 via-gray-200 to-orange-200 border-r-[1px] border-slate-300'>\n            <div className='flex flex-row gap-2 m-2 p-1 items-center border-b-2'>\n                <Avatar displayname={profile.displayname || client.mxid!} avatarUrl={profile?.avatar_url} dm={false} online={OnlineState.Unknown} />\n                <div className='flex flex-row justify-between items-center w-full'>\n                    <span className='text-base font-semibold'>{profile?.displayname}</span>\n                    <Settings size={28} stroke='unset' className='stroke-slate-600 rounded-full hover:bg-slate-300 p-1 cursor-pointer' />\n                </div>\n            </div>\n            <RoomList sections={sections} rooms={otherRooms} dmRooms={dmRooms} />\n        </div>\n        {\n            room && <div className='flex-1 flex flex-col' id='room-wrapper'>\n                <div className='pb-2 flex flex-row items-center border-b-2 mt-4 ml-2'>\n                    <Avatar displayname={room.getName()} avatarUrl={room.getAvatarURL()} dm={room.isDM()} online={room.presence} />\n                    <div className='flex flex-row items-start'>\n                        <h1 className='text-black font-semibold text-lg flex-shrink-0'>{room.getName()}</h1>\n                        <Linkify options={linkifyOptions} as='p' className=\"ml-4 text-slate-700 font-normal text-base line-clamp-2 text-ellipsis\">{room.getTopic()}</Linkify>\n                    </div>\n                </div>\n                <div ref={scrollRef} className='overflow-y-auto overflow-x-hidden scrollbarSmall mr-2 my-1 flex-1 w-full flex flex-col-reverse'>\n                    <ChatView roomID={params.roomIdOrAlias} scrollRef={scrollRef} />\n                </div>\n                <ChatInput namespace='Editor' roomID={decodeURIComponent(params.roomIdOrAlias || \"\")} />\n            </div>\n        }\n    </div >\n})\n\nexport default MainPage;","import * as story_0 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx'\nimport * as story_1 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx'\nimport * as story_2 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx'\nimport * as story_3 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx'\nimport * as story_4 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx'\nimport * as story_5 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx'\nimport * as story_6 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx'\nimport * as story_7 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx'\nimport * as story_8 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx'\nimport * as story_9 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx'\nimport * as story_10 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx'\nimport * as story_11 from '/@fs//home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx'\nimport * as story_12 from '/@fs//home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx'\nimport * as story_13 from '/@fs//home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx'\nimport * as story_14 from '/@fs//home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx'\n\n    function loadable(key) {\n      return {\"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx\": story_0,\"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx\": story_1,\"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx\": story_2,\"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx\": story_3,\"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx\": story_4,\"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx\": story_5,\"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx\": story_6,\"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx\": story_7,\"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx\": story_8,\"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx\": story_9,\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx\": story_10,\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx\": story_11,\"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx\": story_12,\"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx\": story_13,\"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx\": story_14}[key];\n    }\n    \n    Object.assign(loadable, {\n      keys: () => ([\"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx\",\"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx\"]),\n      resolve: (key) => ({\"/home/runner/work/cetirizine/cetirizine/src/components/avatar/avatar.stories.tsx\":\"./src/components/avatar/avatar.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/button/button.stories.tsx\":\"./src/components/button/button.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/memberEvent.stories.tsx\":\"./src/components/events/memberEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/messageEvent.stories.tsx\":\"./src/components/events/messageEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/redactedEvent.stories.tsx\":\"./src/components/events/redactedEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/undecryptableEvent.stories.tsx\":\"./src/components/events/undecryptableEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/events/unknownEvent.stories.tsx\":\"./src/components/events/unknownEvent.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/header/header.stories.tsx\":\"./src/components/header/header.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/input/basic/input.stories.tsx\":\"./src/components/input/basic/input.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/input/chat/input.stories.tsx\":\"./src/components/input/chat/input.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomList.stories.tsx\":\"./src/components/roomList/roomList.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/components/roomList/roomListItem/roomListItem.stories.tsx\":\"./src/components/roomList/roomListItem/roomListItem.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/documentation/Welcome.stories.mdx\":\"./src/documentation/Welcome.stories.mdx\",\"/home/runner/work/cetirizine/cetirizine/src/pages/LoginPage.stories.tsx\":\"./src/pages/LoginPage.stories.tsx\",\"/home/runner/work/cetirizine/cetirizine/src/pages/MainPage.stories.tsx\":\"./src/pages/MainPage.stories.tsx\"}[key])\n    });\n\n    export function configStories(configure) {\n      configure(loadable, { hot: import.meta.hot }, false);\n    }","// Ensure that the client API is initialized by the framework before any other iframe code\n    // is loaded. That way our client-apis can assume the existence of the API+store\n    import { configure } from '/home/runner/work/cetirizine/cetirizine/node_modules/@storybook/react';\n\n    import { logger } from '@storybook/client-logger';\n    import * as previewApi from \"@storybook/preview-api\";\n    import * as config_0 from '@storybook/react/preview'\nimport * as config_1 from '@storybook/addon-links/preview'\nimport * as config_2 from '@storybook/addon-essentials/docs/preview'\nimport * as config_3 from '@storybook/addon-essentials/actions/preview'\nimport * as config_4 from '@storybook/addon-essentials/backgrounds/preview'\nimport * as config_5 from '@storybook/addon-essentials/measure/preview'\nimport * as config_6 from '@storybook/addon-essentials/outline/preview'\nimport * as config_7 from '@storybook/addon-essentials/highlight/preview'\nimport * as config_8 from '@storybook/addon-interactions/preview'\nimport * as config_9 from '@storybook/addon-a11y/preview'\n\n    import * as preview from '/virtual:/@storybook/builder-vite/preview-entry.js';\n    import { configStories } from '/virtual:/@storybook/builder-vite/storybook-stories.js';\n\n    const {\n      addDecorator,\n      addParameters,\n      addLoader,\n      addArgs,\n      addArgTypes,\n      addStepRunner,\n      addArgTypesEnhancer,\n      addArgsEnhancer,\n      setGlobalRender,\n    } = previewApi;\n\n    const configs = [config_0,config_1,config_2,config_3,config_4,config_5,config_6,config_7,config_8,config_9,preview.default].filter(Boolean)\n\n    configs.map(config => config.default ? config.default : config).forEach(config => {\n      Object.keys(config).forEach((key) => {\n        const value = config[key];\n        switch (key) {\n          case 'args': {\n            return addArgs(value);\n          }\n          case 'argTypes': {\n            return addArgTypes(value);\n          }\n          case 'decorators': {\n            return value.forEach((decorator) => addDecorator(decorator, false));\n          }\n          case 'loaders': {\n            return value.forEach((loader) => addLoader(loader, false));\n          }\n          case 'parameters': {\n            return addParameters({ ...value }, false);\n          }\n          case 'argTypesEnhancers': {\n            return value.forEach((enhancer) => addArgTypesEnhancer(enhancer));\n          }\n          case 'argsEnhancers': {\n            return value.forEach((enhancer) => addArgsEnhancer(enhancer))\n          }\n          case 'render': {\n            return setGlobalRender(value)\n          }\n          case 'globals':\n          case 'globalTypes': {\n            const v = {};\n            v[key] = value;\n            return addParameters(v, false);\n          }\n          case 'decorateStory':\n          case 'applyDecorators':\n          case 'renderToDOM': // deprecated\n          case 'renderToCanvas': {\n            return null; // This key is not handled directly in v6 mode.\n          }\n          case 'runStep': {\n            return addStepRunner(value);\n          }\n          default: {\n            // eslint-disable-next-line prefer-template\n            return console.log(key + ' was not supported :( !');\n          }\n        }\n      });\n    })\n    \n    /* TODO: not quite sure what to do with this, to fix HMR\n    if (import.meta.hot) {\n        import.meta.hot.accept();    \n    }\n    */\n\n    configStories(configure);"],"names":["DEFAULT_THEME","withTailwindTheme","Story","context","theme","useEffect","preview","OnlineState","OnlineState2","Avatar","memo","avatarUrl","displayname","dm","online","error","setError","useState","jsxs","jsx","Fragment","Button","type","style","onClick","children","readonly","MemberEvent","event","isRoomMessageTextEvent","isRoomMessageNoticeEvent","isRoomMessageImageEvent","isRoomMessageAudioEvent","isRoomStateEvent","isRoomCreateEvent","isRoomAvatarEvent","isSpaceChildEvent","isSpaceParentEvent","isRoomTopicEvent","MatrixE2EE","client","user","roomID","RoomId","to_device_events","changed_devices","one_time_key_counts","unused_fallback_keys","content","userID","deviceID","storePassphrase","OlmMachine","users","outgoing_requests","request","room","encryptionSettings","requests","id","UserId","RequestType","request_typed","response","OwnUser","resp","hostname","tx","username","password","triesLeft","well_known","e","flow","json","isErrorResp","isRateLimitError","isLoginResponse","DeviceId","arg","Room","EventEmitter","e2ee","events","newEvent","state","index","oldEvent","isTombstoned","avatarURL","rawAvatarURL","isSpace","name","topic","count","parents","isDM","isEncrypted","eventID","html","plainText","callbackLocalEcho","txn_id","encrypted","text","members","settings","EncryptionSettings","EncryptionAlgorithm","isJoined","useEvents","setEvents","listenForEvents","isSyncOp","op","isInsertOp","isInvalidateOp","isDeleteOp","MatrixSlidingSync","syncInfo","ranges","r","listKey","hi","low","i","roomObj","max","indexes","n","lists_ranges","space","timeline_limit","subscription_limit","list","rawRangeInView","x","minimum","maximum","url","body","syncInfoTX","DeviceLists","user_id","gapIndex","newRoom","foundRoom","roomFromDB","roomIDs2","duplicates","item","notification_count","notification_highlight_count","joined_count","invited_count","state_events","normal_events","required_state","is_dm","memberIds","MatrixClient","instance","loginInfo","syncTx","roomTx","rooms","openDB","db","oldVersion","loginInfoTX","roomTX","deleteDB","a","b","spaces","result","childrenIDs","parent","parentObj","alreadyAddedSpace","child","userId","defaultMatrixClient","MatrixContext","createContext","useRooms","useContext","setRooms","listenForRooms","useRoom","useSpaces","spacesWithRooms","setSpacesWithRooms","_rooms","useProfile","profile","setProfile","linkifyOptions","UnknownEvent","hasPreviousEvent","Linkify","UndecryptableEvent","RedactedEvent","redacted_because","Waveform","src_url","playing","setPlaying","duration","setDuration","waveform","setWaveform","waveformRef","useRef","prev","WaveSurfer","handlePlay","Pause","Play","secondsToHms","d","h","m","decryptMedia","decryptedCallback","failureCallback","responseData","decryptAttachment","dataArray","mimetype","getBlobSafeMimeType","blob","MessageEvent","reactions","TextMessage","setUrl","unableToDecrypt","setUnableToDecrypt","_error","message_type","text_color","sanitized","DOMPurify","code","highlighted","hljs","linkified","linkifyHtml","ALLOWED_BLOB_MIMETYPES","Header","Input","placeholder","autoFocus","value","onChange","URL_MATCHER","EMAIL_MATCHER","MATCHERS","match","PlaygroundAutoLinkPlugin","AutoLinkPlugin","CustomParagraphNode","ParagraphNode","node","editor","element","root","$getRoot","foundFurtherText","$createCustomParagraphNode","$applyNodeReplacement","LowPriority","supportedBlockTypes","blockTypeToBlockName","Divider","positionEditorElement","rect","FloatingLinkEditor","editorRef","inputRef","mouseDownRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","useCallback","selection","$getSelection","$isRangeSelection","getSelectedNode","$isLinkNode","editorElem","nativeSelection","activeElement","rootElement","domRange","inner","mergeRegister","editorState","SELECTION_CHANGE_COMMAND","safeLink","createElement","TOGGLE_LINK_COMMAND","Select","className","options","option","anchor","focus","anchorNode","focusNode","$isAtNodeEnd","BlockOptionsDropdownList","blockType","toolbarRef","setShowBlockOptionsDropDown","dropDownRef","dropDown","toolbar","editorContainer","handle","target","formatParagraph","$wrapNodes","formatLargeHeading","$createHeadingNode","formatSmallHeading","formatBulletList","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","formatNumberedList","INSERT_ORDERED_LIST_COMMAND","formatQuote","$createQuoteNode","formatCode","$createCodeNode","Text","Heading1","Heading2","List","ListOrdered","Quote","Code","ToolbarPlugin","useLexicalComposerContext","canUndo","setCanUndo","canRedo","setCanRedo","setBlockType","selectedElementKey","setSelectedElementKey","showBlockOptionsDropDown","codeLanguage","setCodeLanguage","_isRTL","setIsRTL","isLink","setIsLink","isBold","setIsBold","isItalic","setIsItalic","isUnderline","setIsUnderline","isStrikethrough","setIsStrikethrough","isCode","setIsCode","updateToolbar","elementKey","$isListNode","parentList","$getNearestNodeOfType","ListNode","$isHeadingNode","$isCodeNode","getDefaultCodeLanguage","$isParentElementRTL","_payload","_newEditor","CAN_UNDO_COMMAND","payload","CAN_REDO_COMMAND","codeLanguges","useMemo","getCodeLanguages","onCodeLanguageSelect","$getNodeByKey","insertLink","portalContainer","setPortalContainer","container","UNDO_COMMAND","Undo","REDO_COMMAND","Redo","Heading3","Heading4","Heading5","ChevronDown","createPortal","FORMAT_TEXT_COMMAND","Bold","Italic","Underline","Strikethrough","Link","CodeHighlightPlugin","registerCodeHighlighting","editorTheme","CAN_USE_DOM","documentMode","CAN_USE_BEFORE_INPUT","IS_SAFARI","IS_IOS","IS_CHROME","IS_APPLE_WEBKIT","Placeholder","SendButton","onStartSending","onStopSending","sendMessage","htmlMessage","$generateHtmlFromNodes","codeRegex","matched","groups","all","language","spanRegex","matchedspans","plainMessage","$convertToMarkdownString","TRANSFORMERS","CLEAR_EDITOR_COMMAND","CLEAR_HISTORY_COMMAND","KEY_ENTER_COMMAND","INSERT_PARAGRAPH_COMMAND","COMMAND_PRIORITY_CRITICAL","Send","RoomChangePlugin","pathname","useLocation","prevRoom","setPrevRoom","savedHtml","initialEditorState","ChatInput","namespace","sending","setSending","initialConfig","EditorTheme","HeadingNode","ListItemNode","QuoteNode","CodeNode","CodeHighlightNode","TableNode","TableCellNode","TableRowNode","AutoLinkNode","LinkNode","_node","LexicalComposer","RichTextPlugin","ContentEditable","LexicalErrorBoundary","HistoryPlugin","LinkPlugin","MarkdownShortcutPlugin","ClearEditorPlugin","RoomListItem","roomId","active","hidden","matrixClient","ref","inView","useInView","RoomListRooms","sectionID","activeRoom","roomsRendered","RoomSection","section","onRoomClick","setHidden","ChevronRight","RoomList","sections","dmRooms","setActiveRoom","navigate","useNavigate","MDXContent","props","MDXLayout","_provideComponents","_jsx","_createMdxContent","_components","_jsxs","_Fragment","Meta","__page","componentMeta","__namedExportsOrder","Login","loginPending","setLoginPending","loginError","setLoginError","setUsername","setPassword","Navigate","startLogin","LoginPage","loading","setLoading","ChatView","scrollRef","renderedEvents","setRenderedEvents","renderEvents","dedupedEvents","self","no_relations","previousEvent","previousEventIsFromSameSender","previousEventType","redaction","redacted","redaction_id","edit","decrypted_event","renderEvent","MainPage","params","useParams","toplevelSpaces","spaceRoom","not_tombstoned","not_a_child","otherChildren","no_parents","leftOverRooms","otherRoom","not_a_space","a_index","b_index","generateSubsections","subspace","subspaceMeta","otherRooms","otherRoomsIDs","otherRoomsDuplicates","Settings","loadable","key","story_0","story_1","story_2","story_3","story_4","story_5","story_6","story_7","story_8","story_9","story_10","story_11","story_12","story_13","story_14","configStories","configure","previewApi","addDecorator","addParameters","addLoader","addArgs","addArgTypes","addStepRunner","addArgTypesEnhancer","addArgsEnhancer","setGlobalRender","configs","config_0","config_1","config_2","config_3","config_4","config_5","config_6","config_7","config_8","config_9","preview.default","config","decorator","loader","enhancer","v"],"mappings":"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"}