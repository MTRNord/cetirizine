import{c as O,a as S,b as L,f as R,d as g,A as b,t as _,p as d,e as U,s as A,g as B,u as T,h as D,r as f,j as s,N as F,B as G,R as M,i as v,k,l as $,P as H}from"./vendor-f48a33f4.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const W="modulepreload",q=function(e){return"/cetirizine/"+e},I={},z=function(t,o,a){if(!o||o.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(o.map(n=>{if(n=q(n),n in I)return;I[n]=!0;const i=n.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(!!a)for(let u=r.length-1;u>=0;u--){const h=r[u];if(h.href===n&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":W,i||(l.as="script",l.crossOrigin=""),l.href=n,document.head.appendChild(l),i)return new Promise((u,h)=>{l.addEventListener("load",u),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},y="api/LOGIN",N=S("api/LOGIN_REQUEST"),P=S("api/LOGIN_SUCCESS"),m=S("api/LOGIN_FAILURE"),j={loginPending:!1},Q=O(j,e=>{e.addCase(N,(t,o)=>{t.loginPending=!0,t.error=void 0}).addCase(P,(t,o)=>{t=j,t.client=o.payload}).addCase(m,(t,o)=>{t.loginPending=!1,t.error=o.payload})});function K(e){return e.login.error}async function V(e,t,o){const a=await C(e,t,void 0,o);return window.localStorage.setItem("accessToken",a.getAccessToken()),window.localStorage.setItem("baseUrl",a.baseUrl),window.localStorage.setItem("userId",a.getUserId()),a}function*J(e){if(yield d(N()),!e.baseUrl.startsWith("https://")){yield d(m("Homeserver url must start with https://"));return}if(!e.username){yield d(m("Username must be a non empty string"));return}if(!e.password){yield d(m("Password must be a non empty string"));return}try{const t=yield U(V,e.baseUrl,e.username,e.password);yield d(P(t))}catch(t){yield d(m(t.toString()));return}}function*X(){yield _(y,J)}function*Y(){yield L([R(X)])}async function C(e,t,o,a){let r;try{r=global.indexedDB}catch{}let n=new g.MemoryStore({localStorage:window.localStorage});r&&(g.setCryptoStoreFactory(()=>new g.IndexedDBCryptoStore(r,"matrix-js-sdk:crypto")),n=new g.IndexedDBStore({indexedDB:r,localStorage:window.localStorage}),await n.startup());const i=await b.findClientConfig(e.replace("https://",""));if(i["m.homeserver"].state===b.FAIL_PROMPT)throw Error(i["m.homeserver"].error?.toString());i["m.homeserver"].state!==b.FAIL_ERROR&&i["m.homeserver"].base_url&&(e=i["m.homeserver"].base_url);const c=g.createClient({baseUrl:e,accessToken:o,userId:o?t:void 0,useAuthorizationHeader:!0,store:n});if(!o&&!a)throw Error("Missing password and accessToken. Unable to proceed");return o||await c.loginWithPassword(t,a),await c.initCrypto(),c}function*Z(){yield L([Y()])}const E=A(),ee=[E],te=B({reducer:{login:Q},middleware:e=>[...e(),...ee],preloadedState:await re()});E.run(Z);async function re(){const e=window.localStorage,t=e.getItem("accessToken"),o=e.getItem("baseUrl"),a=e.getItem("userId");if(t&&o&&a)return{login:{client:await C(o,a,t),loginPending:!1}}}const oe=()=>D(),x=T;const ne=({type:e="button",style:t="primary",onClick:o,children:a,readonly:r})=>t==="secondary"?s.jsx("button",{disabled:r,onClick:o,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:e,children:a}):t==="abort"?s.jsx("button",{disabled:r,onClick:o,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:e,children:a}):s.jsx("button",{disabled:r,onClick:o,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150 disabled:bg-slate-200 disabled:cursor-not-allowed",type:e,children:a}),se=f.memo(ne),ae=({children:e})=>s.jsx("h1",{className:"text-black font-bold text-xl",children:e}),ie=({placeholder:e,password:t=!1,autoFocus:o=!1,value:a,readonly:r,onChange:n})=>s.jsx("input",{disabled:r,className:"form-input rounded-lg disabled:bg-slate-200 disabled:cursor-not-allowed transition-colors ease-in-out delay-150",value:a,type:t?"password":"text",autoFocus:o,placeholder:e,onChange:n}),w=f.memo(ie);function le(){const e=x(l=>K(l)),t=x(l=>l.login.loginPending),[o,a]=f.useState(""),[r,n]=f.useState(""),[i,c]=f.useState(""),p=oe();return s.jsxs("form",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2 min-w-[30rem]",onSubmit:l=>{l.preventDefault(),p({type:y,baseUrl:o,username:r,password:i})},children:[s.jsx(ae,{children:"Login"}),e?s.jsx("h2",{className:"text-red-500 font-normal text-sm",children:e}):s.jsx("div",{className:"min-h-[1.25rem]"}),s.jsx(w,{readonly:t,value:o,autoFocus:!0,placeholder:"Homeserver",onChange:l=>a(l.target.value)}),s.jsx(w,{readonly:t,value:r,placeholder:"Username",onChange:l=>n(l.target.value)}),s.jsx(w,{readonly:t,value:i,password:!0,placeholder:"Password",onChange:l=>c(l.target.value)}),s.jsx(se,{readonly:t,style:"primary",type:"submit",onClick:()=>p({type:y,baseUrl:o,username:r,password:i}),children:"Login"})]})}function ce(){return s.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:s.jsx(le,{})})}const de=({children:e})=>x(o=>o.login.client)?e:s.jsx(F,{to:"login"});function ue(){return s.jsx("span",{children:"Placeholder"})}function ge(){return s.jsx(G,{children:s.jsxs(M,{children:[s.jsx(v,{path:"/",element:s.jsx(de,{children:s.jsx(ue,{})})}),s.jsx(v,{path:"/login",element:s.jsx(ce,{})})]})})}const me=document.getElementById("root"),fe=k(me);window.Olm=await z(()=>import("./olm-b5e3f19a.js").then(e=>e.o),["assets/olm-b5e3f19a.js","assets/vendor-f48a33f4.js"]);fe.render(s.jsx($.StrictMode,{children:s.jsx(H,{store:te,children:s.jsx(ge,{})})}));
