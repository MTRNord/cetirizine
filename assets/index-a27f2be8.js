import{c as h,a as d,b as x,f as S,t as N,p as i,s as p,d as L,e as b,g as _,h as O,u as P,i as w,j as t,r as u,N as T,B as Y,R as G,k as m,l as F,m as k,P as B}from"./vendor-9e098463.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const A=d("api/setAccessToken"),j=d("api/setBaseUrl"),M={accessToken:void 0,baseUrl:void 0},Q=h(M,e=>{e.addCase(A,(s,r)=>{s.accessToken=r.payload}).addCase(j,(s,r)=>{s.baseUrl=r.payload})}),C=d("api/LOGIN_REQUEST"),E=d("api/LOGIN_SUCCESS"),f=d("api/LOGIN_FAILURE"),H={loginPending:!1,error:void 0},D=h(H,e=>{e.addCase(C,(s,r)=>{s.loginPending=!0,s.error=void 0}).addCase(E,(s,r)=>{}).addCase(f,(s,r)=>{s.loginPending=!1,s.error=r.payload})});function $(e){return e.login.error}const q=e=>e.api.accessToken,U=e=>e.api.baseUrl;var v=(e=>(e.LOGIN="LOGIN",e.SYNC="SYNC",e.SYNC_REQUEST="SYNC_REQUEST",e.SYNC_SUCCESS="SYNC_SUCCESS",e.SYNC_FAILURE="SYNC_FAILURE",e))(v||{});function z(e,s){return b.get("/sync",{params:{},baseURL:e,headers:{Authorization:`Bearer ${s}`}})}function K(e){return b.get("/login",{params:{},baseURL:e})}function*W(){try{yield i({type:"SYNC_REQUEST"});const e=yield p(q),s=yield p(U),n=(yield L(z,s,e)).data;yield i({type:"SYNC_SUCCESS",data:n})}catch(e){yield i({type:"SYNC_FAILURE",payload:e.toString()})}}function*J(){try{yield i({type:C});const e=yield p(U);if(!e.startsWith("https://")){yield i({type:f,payload:"Homeserver url must start with https://"});return}const r=(yield L(K,e)).data;yield i({type:E,data:r})}catch(e){yield i({type:f,payload:e.toString()})}}function*V(){yield N("LOGIN",J)}function*X(){yield N("SYNC",W)}function*Z(){yield x([S(V),S(X)])}function*ee(){yield x([Z()])}const R=_(),te=[R],se=O({reducer:{api:Q,login:D},middleware:e=>[...e(),...te]});R.run(ee);const re=()=>w(),I=P;function oe({type:e="button",style:s="primary",onClick:r,children:n}){return s==="secondary"?t.jsx("button",{onClick:r,className:"button bg-orange-400 hover:bg-orange-500 ease-out duration-150",type:e,children:n}):s==="abort"?t.jsx("button",{onClick:r,className:"button bg-red-400 hover:bg-red-500 ease-out duration-150",type:e,children:n}):t.jsx("button",{onClick:r,className:"button bg-green-400 hover:bg-green-500 ease-out duration-150",type:e,children:n})}function ae({children:e}){return t.jsx("h1",{className:"text-black font-bold text-xl",children:e})}function g({placeholder:e,password:s=!1,autoFocus:r=!1,value:n,onChange:o}){return t.jsx("input",{className:"form-input rounded-lg",value:n,type:s?"password":"text",autoFocus:r,placeholder:e,onChange:o})}function ne(){const e=I(c=>$(c)),[s,r]=u.useState(""),[n,o]=u.useState(""),[a,l]=u.useState(""),y=re();return t.jsxs("div",{className:"flex flex-col rounded-md shadow p-4 bg-white gap-2",children:[t.jsx(ae,{children:"Login"}),e?t.jsx("h2",{className:"text-red-500 font-normal text-sm",children:e}):t.jsx(t.Fragment,{}),t.jsx(g,{value:s,autoFocus:!0,placeholder:"Homeserver",onChange:c=>{r(c.target.value),y(j(c.target.value))}}),t.jsx(g,{value:n,placeholder:"Username",onChange:c=>o(c.target.value)}),t.jsx(g,{value:a,password:!0,placeholder:"Password",onChange:c=>l(c.target.value)}),t.jsx(oe,{style:"primary",type:"button",onClick:()=>y({type:v.LOGIN}),children:"Login"})]})}function ce(){return t.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-img",children:t.jsx(ne,{})})}const ie=({children:e})=>I(r=>r.api.accessToken)?e:t.jsx(T,{to:"login"});function le(){return t.jsx("span",{children:"Placeholder"})}function de(){return t.jsx(Y,{children:t.jsxs(G,{children:[t.jsx(m,{path:"/",element:t.jsx(ie,{children:t.jsx(le,{})})}),t.jsx(m,{path:"/login",element:t.jsx(ce,{})})]})})}const ue=document.getElementById("root"),ge=F(ue);ge.render(t.jsx(k.StrictMode,{children:t.jsx(B,{store:se,children:t.jsx(de,{})})}));
